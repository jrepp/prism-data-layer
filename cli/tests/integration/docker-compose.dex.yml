# Dex OIDC Test Server for Prismctl Integration Tests
#
# This compose file starts a local Dex identity provider for testing
# prismctl authentication flows without requiring external services.
#
# Usage:
#   podman compose -f docker-compose.dex.yml up -d
#   podman compose -f docker-compose.dex.yml down
#
# See: MEMO-022 for integration testing requirements

services:
  dex:
    image: ghcr.io/dexidp/dex:v2.37.0
    container_name: prismctl-test-dex
    ports:
      - "5556:5556"  # HTTP port for OIDC endpoints
    volumes:
      - ./dex-config.yaml:/etc/dex/config.yaml:ro
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:5556/healthz"]
      interval: 2s
      timeout: 2s
      retries: 10
      start_period: 5s
    networks:
      - prismctl-test

networks:
  prismctl-test:
    driver: bridge
