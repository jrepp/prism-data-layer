"use strict";(globalThis.webpackChunkdocusaurus=globalThis.webpackChunkdocusaurus||[]).push([[7837],{3961:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"go-for-tooling","title":"ADR-012: Go for Tooling and CLI Utilities","description":"Context","source":"@site/../docs-cms/adr/012-go-for-tooling.md","sourceDirName":".","slug":"/go-for-tooling","permalink":"/prism-data-layer/adr/go-for-tooling","draft":false,"unlisted":false,"editUrl":"https://github.com/jrepp/prism-data-layer/tree/main/docs-cms/../docs-cms/adr/012-go-for-tooling.md","tags":[{"inline":true,"label":"language","permalink":"/prism-data-layer/adr/tags/language"},{"inline":true,"label":"tooling","permalink":"/prism-data-layer/adr/tags/tooling"},{"inline":true,"label":"cli","permalink":"/prism-data-layer/adr/tags/cli"},{"inline":true,"label":"developer-experience","permalink":"/prism-data-layer/adr/tags/developer-experience"}],"version":"current","sidebarPosition":12,"frontMatter":{"title":"ADR-012: Go for Tooling and CLI Utilities","status":"Accepted","date":"2025-10-07T00:00:00.000Z","deciders":"Core Team","tags":["language","tooling","cli","developer-experience"]},"sidebar":"adrSidebar","previous":{"title":"ADR-011: Implementation Roadmap and Next Steps","permalink":"/prism-data-layer/adr/implementation-roadmap"},"next":{"title":"ADR-013: Go Error Handling Strategy","permalink":"/prism-data-layer/adr/go-error-handling-strategy"}}');var o=i(4848),s=i(8453);const l={title:"ADR-012: Go for Tooling and CLI Utilities",status:"Accepted",date:new Date("2025-10-07T00:00:00.000Z"),deciders:"Core Team",tags:["language","tooling","cli","developer-experience"]},t=void 0,a={},d=[{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Rationale",id:"rationale",level:2},{value:"Why Go for Tooling",id:"why-go-for-tooling",level:3},{value:"Use Cases in Prism",id:"use-cases-in-prism",level:3},{value:"Primary Use Cases (Go)",id:"primary-use-cases-go",level:4},{value:"NOT Recommended (Use Rust Instead)",id:"not-recommended-use-rust-instead",level:4},{value:"NOT Recommended (Use Python Instead)",id:"not-recommended-use-python-instead",level:4},{value:"Alternatives Considered",id:"alternatives-considered",level:3},{value:"Consequences",id:"consequences",level:2},{value:"Positive",id:"positive",level:3},{value:"Negative",id:"negative",level:3},{value:"Neutral",id:"neutral",level:3},{value:"Implementation Notes",id:"implementation-notes",level:2},{value:"Directory Structure",id:"directory-structure",level:3},{value:"Key Libraries",id:"key-libraries",level:3},{value:"Protobuf Sharing",id:"protobuf-sharing",level:3},{value:"Example Tool: prism-cli",id:"example-tool-prism-cli",level:3},{value:"References",id:"references",level:2},{value:"Revision History",id:"revision-history",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,o.jsx)(n.p,{children:"Prism uses Rust for the proxy (performance-critical path) and Python for orchestration. We need to choose a language for:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"CLI utilities and dev tools"}),"\n",(0,o.jsx)(n.li,{children:"Repository management tools"}),"\n",(0,o.jsx)(n.li,{children:"Data migration utilities"}),"\n",(0,o.jsx)(n.li,{children:"Performance testing harnesses"}),"\n",(0,o.jsx)(n.li,{children:"Potential backend adapters where appropriate"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Requirements:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Fast compilation for rapid iteration"}),"\n",(0,o.jsx)(n.li,{children:"Single-binary distribution"}),"\n",(0,o.jsx)(n.li,{children:"Good concurrency primitives"}),"\n",(0,o.jsx)(n.li,{children:"Protobuf interoperability"}),"\n",(0,o.jsx)(n.li,{children:"Cross-platform support"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"decision",children:"Decision"}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.strong,{children:"Go"})," for tooling, CLI utilities, and select backend adapters."]}),"\n",(0,o.jsx)(n.h2,{id:"rationale",children:"Rationale"}),"\n",(0,o.jsx)(n.h3,{id:"why-go-for-tooling",children:"Why Go for Tooling"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Single Binary Distribution"}),": No runtime dependencies, easy deployment"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Fast Compile Times"}),": Rapid iteration during development"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Strong Standard Library"}),": Excellent I/O, networking, and HTTP support"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Goroutines"}),": Natural concurrency for parallel operations"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Protobuf Interoperability"}),": First-class protobuf support, can consume same ",(0,o.jsx)(n.code,{children:".proto"})," files as Rust"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Cross-Platform"}),": Easy cross-compilation for Linux, macOS, Windows"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"use-cases-in-prism",children:"Use Cases in Prism"}),"\n",(0,o.jsx)(n.h4,{id:"primary-use-cases-go",children:"Primary Use Cases (Go)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["CLI tools (",(0,o.jsx)(n.code,{children:"prism-cli"}),", ",(0,o.jsx)(n.code,{children:"prism-migrate"}),", ",(0,o.jsx)(n.code,{children:"prism-bench"}),")"]}),"\n",(0,o.jsx)(n.li,{children:"Data migration utilities"}),"\n",(0,o.jsx)(n.li,{children:"Load testing harnesses"}),"\n",(0,o.jsx)(n.li,{children:"Repository analysis tools"}),"\n",(0,o.jsx)(n.li,{children:"Backend health checkers"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"not-recommended-use-rust-instead",children:"NOT Recommended (Use Rust Instead)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Proxy core (latency-sensitive, use Rust)"}),"\n",(0,o.jsx)(n.li,{children:"Hot-path request handlers (use Rust)"}),"\n",(0,o.jsx)(n.li,{children:"Memory-intensive data processing (use Rust)"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"not-recommended-use-python-instead",children:"NOT Recommended (Use Python Instead)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Code generation from protobuf (Python tooling established)"}),"\n",(0,o.jsx)(n.li,{children:"Docker Compose orchestration (Python established)"}),"\n",(0,o.jsx)(n.li,{children:"CI/CD scripting (Python established)"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"alternatives-considered",children:"Alternatives Considered"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Rust"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Pros: Maximum performance, memory safety, consistency with proxy"}),"\n",(0,o.jsx)(n.li,{children:"Cons: Slower compile times, steeper learning curve for tools"}),"\n",(0,o.jsx)(n.li,{children:"Rejected: Overkill for CLI tools, slower development velocity"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Python"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Pros: Rapid development, rich ecosystem"}),"\n",(0,o.jsx)(n.li,{children:"Cons: Slow execution, GIL limits concurrency, requires interpreter"}),"\n",(0,o.jsx)(n.li,{children:"Rejected: Too slow for data migration/load testing"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Node.js"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Pros: Fast async I/O, large ecosystem"}),"\n",(0,o.jsx)(n.li,{children:"Cons: Memory overhead, callback complexity"}),"\n",(0,o.jsx)(n.li,{children:"Rejected: Go's concurrency model clearer for our use cases"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"consequences",children:"Consequences"}),"\n",(0,o.jsx)(n.h3,{id:"positive",children:"Positive"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Fast compile times enable rapid iteration"}),"\n",(0,o.jsx)(n.li,{children:"Single binaries simplify distribution (no Docker needed for tools)"}),"\n",(0,o.jsx)(n.li,{children:"Strong concurrency primitives for parallel operations"}),"\n",(0,o.jsx)(n.li,{children:"Shared protobuf definitions with Rust proxy"}),"\n",(0,o.jsx)(n.li,{children:"Growing ecosystem for data infrastructure tools"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"negative",children:"Negative"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Another language in the stack (Rust, Python, Go)"}),"\n",(0,o.jsx)(n.li,{children:"Different error handling patterns than Rust"}),"\n",(0,o.jsx)(n.li,{children:"Garbage collection pauses (mitigated: not on hot path)"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"neutral",children:"Neutral"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Learning curve for developers unfamiliar with Go"}),"\n",(0,o.jsx)(n.li,{children:"Protobuf code generation required (standard across all languages)"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"implementation-notes",children:"Implementation Notes"}),"\n",(0,o.jsx)(n.h3,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"prism/\n\u251c\u2500\u2500 tooling/               # Python orchestration (unchanged)\n\u251c\u2500\u2500 tools/                 # Go CLI tools (new)\n\u2502   \u251c\u2500\u2500 cmd/\n\u2502   \u2502   \u251c\u2500\u2500 prism-cli/    # Main CLI tool\n\u2502   \u2502   \u251c\u2500\u2500 prism-migrate/ # Data migration\n\u2502   \u2502   \u2514\u2500\u2500 prism-bench/   # Load testing\n\u2502   \u251c\u2500\u2500 internal/\n\u2502   \u2502   \u251c\u2500\u2500 config/\n\u2502   \u2502   \u251c\u2500\u2500 proto/        # Generated Go protobuf code\n\u2502   \u2502   \u2514\u2500\u2500 util/\n\u2502   \u251c\u2500\u2500 go.mod\n\u2502   \u2514\u2500\u2500 go.sum\n"})}),"\n",(0,o.jsx)(n.h3,{id:"key-libraries",children:"Key Libraries"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'// Protobuf\nimport "google.golang.org/protobuf/proto"\n\n// CLI framework\nimport "github.com/spf13/cobra"\n\n// Configuration\nimport "github.com/spf13/viper"\n\n// Structured logging\nimport "log/slog"\n\n// Concurrency patterns\nimport "golang.org/x/sync/errgroup"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"protobuf-sharing",children:"Protobuf Sharing"}),"\n",(0,o.jsx)(n.p,{children:"Generate Go code from the same proto definitions:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Generate Go protobuf code\nbuf generate --template tools/buf.gen.go.yaml\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"tools/buf.gen.go.yaml"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"version: v1\nplugins:\n  - plugin: go\n    out: internal/proto\n    opt:\n      - paths=source_relative\n  - plugin: go-grpc\n    out: internal/proto\n    opt:\n      - paths=source_relative\n"})}),"\n",(0,o.jsx)(n.h3,{id:"example-tool-prism-cli",children:"Example Tool: prism-cli"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n    "log/slog"\n\n    "github.com/spf13/cobra"\n    "github.com/prism/tools/internal/config"\n    "github.com/prism/tools/internal/proto/prism/keyvalue/v1"\n)\n\nvar rootCmd = &cobra.Command{\n    Use:   "prism-cli",\n    Short: "Prism command-line interface",\n}\n\nvar getCmd = &cobra.Command{\n    Use:   "get [namespace] [id] [key]",\n    Short: "Get a value from Prism",\n    Args:  cobra.ExactArgs(3),\n    RunE: func(cmd *cobra.Command, args []string) error {\n        // Connect to proxy, issue Get request\n        // ...\n        return nil\n    },\n}\n\nfunc main() {\n    rootCmd.AddCommand(getCmd)\n    if err := rootCmd.Execute(); err != nil {\n        slog.Error("command failed", "error", err)\n        os.Exit(1)\n    }\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://go.dev/doc/effective_go",children:"Effective Go"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://protobuf.dev/reference/go/go-generated/",children:"Go Protobuf Documentation"})}),"\n",(0,o.jsx)(n.li,{children:"ADR-003: Protobuf as Single Source of Truth"}),"\n",(0,o.jsx)(n.li,{children:"org-stream-producer ADR-001: Go for Git Analysis"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"revision-history",children:"Revision History"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"2025-10-07: Initial draft and acceptance"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>t});var r=i(6540);const o={},s=r.createContext(o);function l(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);