"use strict";(globalThis.webpackChunkdocusaurus=globalThis.webpackChunkdocusaurus||[]).push([[7874],{19638:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"adr-012","title":"Go for Tooling and CLI Utilities","description":"Context","source":"@site/../docs-cms/adr/adr-012-go-for-tooling.md","sourceDirName":".","slug":"/adr-012","permalink":"/prism-data-layer/adr/adr-012","draft":false,"unlisted":false,"editUrl":"https://github.com/jrepp/prism-data-layer/tree/main/docs-cms/../docs-cms/adr/adr-012-go-for-tooling.md","tags":[{"inline":true,"label":"language","permalink":"/prism-data-layer/adr/tags/language"},{"inline":true,"label":"tooling","permalink":"/prism-data-layer/adr/tags/tooling"},{"inline":true,"label":"cli","permalink":"/prism-data-layer/adr/tags/cli"},{"inline":true,"label":"developer-experience","permalink":"/prism-data-layer/adr/tags/developer-experience"}],"version":"current","frontMatter":{"date":"2025-10-07T00:00:00.000Z","deciders":"Core Team","doc_uuid":"4dab61b4-9416-44f9-ab93-36ebc2256e12","id":"adr-012","project_id":"prism-data-layer","status":"Accepted","tags":["language","tooling","cli","developer-experience"],"title":"Go for Tooling and CLI Utilities"},"sidebar":"adrSidebar","previous":{"title":"Implementation Roadmap and Next Steps \u2022 ADR-011","permalink":"/prism-data-layer/adr/adr-011"},"next":{"title":"Go Error Handling Strategy \u2022 ADR-013","permalink":"/prism-data-layer/adr/adr-013"}}');var s=r(74848),o=r(28453);const t={date:new Date("2025-10-07T00:00:00.000Z"),deciders:"Core Team",doc_uuid:"4dab61b4-9416-44f9-ab93-36ebc2256e12",id:"adr-012",project_id:"prism-data-layer",status:"Accepted",tags:["language","tooling","cli","developer-experience"],title:"Go for Tooling and CLI Utilities"},l=void 0,a={},d=[{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Rationale",id:"rationale",level:2},{value:"Why Go for Tooling",id:"why-go-for-tooling",level:3},{value:"Use Cases in Prism",id:"use-cases-in-prism",level:3},{value:"Primary Use Cases (Go)",id:"primary-use-cases-go",level:4},{value:"NOT Recommended (Use Rust Instead)",id:"not-recommended-use-rust-instead",level:4},{value:"NOT Recommended (Use Python Instead)",id:"not-recommended-use-python-instead",level:4},{value:"Alternatives Considered",id:"alternatives-considered",level:3},{value:"Consequences",id:"consequences",level:2},{value:"Positive",id:"positive",level:3},{value:"Negative",id:"negative",level:3},{value:"Neutral",id:"neutral",level:3},{value:"Implementation Notes",id:"implementation-notes",level:2},{value:"Directory Structure",id:"directory-structure",level:3}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,s.jsx)(n.p,{children:"Prism uses Rust for the proxy (performance-critical path) and Python for orchestration. We need to choose a language for:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"CLI utilities and dev tools"}),"\n",(0,s.jsx)(n.li,{children:"Repository management tools"}),"\n",(0,s.jsx)(n.li,{children:"Data migration utilities"}),"\n",(0,s.jsx)(n.li,{children:"Performance testing harnesses"}),"\n",(0,s.jsx)(n.li,{children:"Potential backend adapters where appropriate"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Requirements:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Fast compilation for rapid iteration"}),"\n",(0,s.jsx)(n.li,{children:"Single-binary distribution"}),"\n",(0,s.jsx)(n.li,{children:"Good concurrency primitives"}),"\n",(0,s.jsx)(n.li,{children:"Protobuf interoperability"}),"\n",(0,s.jsx)(n.li,{children:"Cross-platform support"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"decision",children:"Decision"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.strong,{children:"Go"})," for tooling, CLI utilities, and select backend adapters."]}),"\n",(0,s.jsx)(n.h2,{id:"rationale",children:"Rationale"}),"\n",(0,s.jsx)(n.h3,{id:"why-go-for-tooling",children:"Why Go for Tooling"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Single Binary Distribution"}),": No runtime dependencies, easy deployment"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fast Compile Times"}),": Rapid iteration during development"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Strong Standard Library"}),": Excellent I/O, networking, and HTTP support"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Goroutines"}),": Natural concurrency for parallel operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Protobuf Interoperability"}),": First-class protobuf support, can consume same ",(0,s.jsx)(n.code,{children:".proto"})," files as Rust"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cross-Platform"}),": Easy cross-compilation for Linux, macOS, Windows"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"use-cases-in-prism",children:"Use Cases in Prism"}),"\n",(0,s.jsx)(n.h4,{id:"primary-use-cases-go",children:"Primary Use Cases (Go)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["CLI tools (",(0,s.jsx)(n.code,{children:"prism-cli"}),", ",(0,s.jsx)(n.code,{children:"prism-migrate"}),", ",(0,s.jsx)(n.code,{children:"prism-bench"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"Data migration utilities"}),"\n",(0,s.jsx)(n.li,{children:"Load testing harnesses"}),"\n",(0,s.jsx)(n.li,{children:"Repository analysis tools"}),"\n",(0,s.jsx)(n.li,{children:"Backend health checkers"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"not-recommended-use-rust-instead",children:"NOT Recommended (Use Rust Instead)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Proxy core (latency-sensitive, use Rust)"}),"\n",(0,s.jsx)(n.li,{children:"Hot-path request handlers (use Rust)"}),"\n",(0,s.jsx)(n.li,{children:"Memory-intensive data processing (use Rust)"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"not-recommended-use-python-instead",children:"NOT Recommended (Use Python Instead)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Code generation from protobuf (Python tooling established)"}),"\n",(0,s.jsx)(n.li,{children:"Docker Compose orchestration (Python established)"}),"\n",(0,s.jsx)(n.li,{children:"CI/CD scripting (Python established)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"alternatives-considered",children:"Alternatives Considered"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Rust"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Pros: Maximum performance, memory safety, consistency with proxy"}),"\n",(0,s.jsx)(n.li,{children:"Cons: Slower compile times, steeper learning curve for tools"}),"\n",(0,s.jsx)(n.li,{children:"Rejected: Overkill for CLI tools, slower development velocity"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Python"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Pros: Rapid development, rich ecosystem"}),"\n",(0,s.jsx)(n.li,{children:"Cons: Slow execution, GIL limits concurrency, requires interpreter"}),"\n",(0,s.jsx)(n.li,{children:"Rejected: Too slow for data migration/load testing"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Node.js"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Pros: Fast async I/O, large ecosystem"}),"\n",(0,s.jsx)(n.li,{children:"Cons: Memory overhead, callback complexity"}),"\n",(0,s.jsx)(n.li,{children:"Rejected: Go's concurrency model clearer for our use cases"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"consequences",children:"Consequences"}),"\n",(0,s.jsx)(n.h3,{id:"positive",children:"Positive"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Fast compile times enable rapid iteration"}),"\n",(0,s.jsx)(n.li,{children:"Single binaries simplify distribution (no Docker needed for tools)"}),"\n",(0,s.jsx)(n.li,{children:"Strong concurrency primitives for parallel operations"}),"\n",(0,s.jsx)(n.li,{children:"Shared protobuf definitions with Rust proxy"}),"\n",(0,s.jsx)(n.li,{children:"Growing ecosystem for data infrastructure tools"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"negative",children:"Negative"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Another language in the stack (Rust, Python, Go)"}),"\n",(0,s.jsx)(n.li,{children:"Different error handling patterns than Rust"}),"\n",(0,s.jsx)(n.li,{children:"Garbage collection pauses (mitigated: not on hot path)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"neutral",children:"Neutral"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Learning curve for developers unfamiliar with Go"}),"\n",(0,s.jsx)(n.li,{children:"Protobuf code generation required (standard across all languages)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"implementation-notes",children:"Implementation Notes"}),"\n",(0,s.jsx)(n.h3,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,s.jsx)(n.p,{children:"prism/\n\u251c\u2500\u2500 tooling/               # Python orchestration (unchanged)\n\u251c\u2500\u2500 tools/                 # Go CLI tools (new)\n\u2502   \u251c\u2500\u2500 cmd/\n\u2502   \u2502   \u251c\u2500\u2500 prism-cli/    # Main CLI tool\n\u2502   \u2502   \u251c\u2500\u2500 prism-migrate/ # Data migration\n\u2502   \u2502   \u2514\u2500\u2500 prism-bench/   # Load testing\n\u2502   \u251c\u2500\u2500 internal/\n\u2502   \u2502   \u251c\u2500\u2500 config/\n\u2502   \u2502   \u251c\u2500\u2500 proto/        # Generated Go protobuf code\n\u2502   \u2502   \u2514\u2500\u2500 util/\n\u2502   \u251c\u2500\u2500 go.mod\n\u2502   \u2514\u2500\u2500 go.sum"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"\n### Key Libraries\n\n"})}),"\n",(0,s.jsx)(n.p,{children:'// Protobuf\nimport "google.golang.org/protobuf/proto"'}),"\n",(0,s.jsx)(n.p,{children:'// CLI framework\nimport "github.com/spf13/cobra"'}),"\n",(0,s.jsx)(n.p,{children:'// Configuration\nimport "github.com/spf13/viper"'}),"\n",(0,s.jsx)(n.p,{children:'// Structured logging\nimport "log/slog"'}),"\n",(0,s.jsx)(n.p,{children:'// Concurrency patterns\nimport "golang.org/x/sync/errgroup"'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"\n### Protobuf Sharing\n\nGenerate Go code from the same proto definitions:\n\n"})}),"\n",(0,s.jsx)(n.h1,{id:"generate-go-protobuf-code",children:"Generate Go protobuf code"}),"\n",(0,s.jsx)(n.p,{children:"buf generate --template tools/buf.gen.go.yaml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"\n`tools/buf.gen.go.yaml`:\n"})}),"\n",(0,s.jsx)(n.p,{children:"version: v1\nplugins:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["plugin: go\nout: internal/proto\nopt:\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"paths=source_relative"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["plugin: go-grpc\nout: internal/proto\nopt:\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"paths=source_relative"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"\n### Example Tool: prism-cli\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"package main"}),"\n",(0,s.jsx)(n.p,{children:'import (\n"context"\n"log/slog"'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'"github.com/spf13/cobra"\n"github.com/prism/tools/internal/config"\n"github.com/prism/tools/internal/proto/prism/keyvalue/v1"\n'})}),"\n",(0,s.jsx)(n.p,{children:")"}),"\n",(0,s.jsx)(n.p,{children:'var rootCmd = &cobra.Command{\nUse:   "prism-cli",\nShort: "Prism command-line interface",\n}'}),"\n",(0,s.jsx)(n.p,{children:'var getCmd = &cobra.Command{\nUse:   "get [namespace] [id] [key]",\nShort: "Get a value from Prism",\nArgs:  cobra.ExactArgs(3),\nRunE: func(cmd *cobra.Command, args []string) error {\n// Connect to proxy, issue Get request\n// ...\nreturn nil\n},\n}'}),"\n",(0,s.jsx)(n.p,{children:'func main() {\nrootCmd.AddCommand(getCmd)\nif err := rootCmd.Execute(); err != nil {\nslog.Error("command failed", "error", err)\nos.Exit(1)\n}\n}'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"\n## References\n\n- [Effective Go](https://go.dev/doc/effective_go)\n- [Go Protobuf Documentation](https://protobuf.dev/reference/go/go-generated/)\n- ADR-003: Protobuf as Single Source of Truth\n- org-stream-producer ADR-001: Go for Git Analysis\n\n## Revision History\n\n- 2025-10-07: Initial draft and acceptance\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>l});var i=r(96540);const s={},o=i.createContext(s);function t(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);