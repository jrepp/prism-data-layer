<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-architecture" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Architecture | Prism</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jrepp.github.io/prism-data-layer/docs/architecture"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Architecture | Prism"><meta data-rh="true" name="description" content="Architecture overview with system diagrams, component responsibilities, and backend interface mapping"><meta data-rh="true" property="og:description" content="Architecture overview with system diagrams, component responsibilities, and backend interface mapping"><link data-rh="true" rel="icon" href="/prism-data-layer/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jrepp.github.io/prism-data-layer/docs/architecture"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/docs/architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/docs/architecture" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Architecture","item":"https://jrepp.github.io/prism-data-layer/docs/architecture"}]}</script><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes">
<meta name="theme-color" content="#6366f1">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="stylesheet" href="/prism-data-layer/assets/css/styles.73adf43b.css">
<script src="/prism-data-layer/assets/js/runtime~main.553f3957.js" defer="defer"></script>
<script src="/prism-data-layer/assets/js/main.b135ba04.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/prism-data-layer/"><div class="navbar__logo"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">Prism</b></a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/intro">Overview</a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/changelog">Change Log</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Documentation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/prism-data-layer/adr">ADRs (Architecture Decision Records)</a></li><li><a class="dropdown__link" href="/prism-data-layer/rfc">RFCs (Request for Comments)</a></li><li><a class="dropdown__link" href="/prism-data-layer/memos">Memos (Technical Analysis)</a></li><li><a class="dropdown__link" href="/prism-data-layer/prds">PRDs (Product Requirements)</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="buildInfo_asc2"><span class="version_ADrX" title="Build: 12230f2">12230f2</span><span class="separator_VfCt">•</span><span class="buildTime_n1Nn" title="Last updated: Oct 14, 10:32 AM PDT">Oct 14, 10:32 AM PDT</span></div><div class="navbar__item"><a href="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml" target="_blank" rel="noopener noreferrer" title="GitHub Pages" style="display: flex; align-items: center; padding: 0 0.5rem;"><img src="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml/badge.svg" alt="Build" style="margin: 0;"></a></div><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_x44X"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/docs/changelog"><span title="Changelog" class="linkLabel_WmDU">Changelog</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/docs/intro"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/docs/key-documents"><span title="Foundations" class="linkLabel_WmDU">Foundations</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/prism-data-layer/docs/architecture"><span title="Architecture" class="linkLabel_WmDU">Architecture</span></a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/prism-data-layer/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Architecture</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="docMetadata_NQcq"><div class="tagsRow_ipDH"><span class="tag_VbXK">architecture</span><span class="tag_VbXK">technical-overview</span><span class="tag_VbXK">system-design</span><span class="tag_VbXK">backend-interfaces</span><span class="tag_VbXK">patterns</span></div><div class="metadataRow_PvZM"></div></div><div class="theme-doc-markdown markdown"><header><h1>Architecture</h1></header>
<p><strong>Target Audience</strong>: Technical users, platform engineers, backend developers</p>
<p><strong>Purpose</strong>: Provide a comprehensive architectural overview of Prism&#x27;s layered design, component responsibilities, backend interface decomposition, and pattern composition strategy.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-prism">What is Prism?<a href="#what-is-prism" class="hash-link" aria-label="Direct link to What is Prism?" title="Direct link to What is Prism?" translate="no">​</a></h2>
<p><strong>Prism is a high-performance data access gateway</strong> that sits between applications and heterogeneous data backends (Kafka, NATS, Postgres, Redis, etc.), providing a unified, client-configurable interface with built-in reliability patterns.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="core-value-propositions">Core Value Propositions<a href="#core-value-propositions" class="hash-link" aria-label="Direct link to Core Value Propositions" title="Direct link to Core Value Propositions" translate="no">​</a></h3>
<ol>
<li><strong>Unified API</strong>: Single gRPC/HTTP interface across all backends</li>
<li><strong>Client-Originated Configuration</strong>: Applications declare requirements; Prism provisions and optimizes
<ul>
<li><strong>Organizational Scalability</strong>: Teams self-service without infrastructure bottlenecks</li>
<li><strong>Authorization Boundaries</strong>: Policy-driven configuration limits ensure security and reliability</li>
</ul>
</li>
<li><strong>Rust Performance</strong>: 10-100x faster than JVM alternatives (Netflix Data Gateway)</li>
<li><strong>Pluggable Pattern Providers</strong>: Add new backends without changing application code</li>
<li><strong>Pattern Composition</strong>: Reliability patterns (Outbox, Claim Check, CDC) transparently implemented</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-metrics">Key Metrics<a href="#key-metrics" class="hash-link" aria-label="Direct link to Key Metrics" title="Direct link to Key Metrics" translate="no">​</a></h3>



































<table><thead><tr><th>Metric</th><th>Target</th><th>Status</th></tr></thead><tbody><tr><td>P50 Latency</td><td>&lt; 1ms</td><td>✅ Achieved (Rust proxy)</td></tr><tr><td>P99 Latency</td><td>&lt; 10ms</td><td>✅ Achieved (no GC pauses)</td></tr><tr><td>Throughput</td><td>10k+ RPS per connection</td><td>✅ Achieved</td></tr><tr><td>Memory Footprint</td><td>&lt; 500MB per proxy instance</td><td>✅ Achieved</td></tr><tr><td>Cold Start</td><td>&lt; 100ms</td><td>✅ Achieved (vs JVM ~10s)</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-architecture">High-Level Architecture<a href="#high-level-architecture" class="hash-link" aria-label="Direct link to High-Level Architecture" title="Direct link to High-Level Architecture" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="three-layer-design-philosophy">Three-Layer Design Philosophy<a href="#three-layer-design-philosophy" class="hash-link" aria-label="Direct link to Three-Layer Design Philosophy" title="Direct link to Three-Layer Design Philosophy" translate="no">​</a></h3>
<p>Prism separates <strong>What</strong> (client API), <strong>How</strong> (pattern composition), and <strong>Where</strong> (backend execution):</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             Layer 3: Client API (What)                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Queue | PubSub | Reader | Transact | Cache | Stream       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  &quot;I want to publish messages to a queue&quot;                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────  ───────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         Layer 2: Pattern Composition (How)                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Claim Check | Outbox | CDC | Tiered Storage | WAL        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  &quot;Automatically store large payloads in S3&quot;                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│         Layer 1: Backend Execution (Where)                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Kafka | NATS | Postgres | Redis | S3 | ClickHouse        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  &quot;Connect to and execute operations on backend&quot;            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────────────────────────────────────────────────┘</span><br></span></code></pre></div></div>
<p><strong>Key Insight</strong>: Applications interact with <strong>Layer 3</strong> (stable APIs), while Prism transparently applies <strong>Layer 2</strong> patterns and routes to <strong>Layer 1</strong> backends. This separation enables:</p>
<ul>
<li>Backend migration without client changes</li>
<li>Pattern evolution without API breakage</li>
<li>Configuration-driven reliability</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-architecture-diagram">System Architecture Diagram<a href="#system-architecture-diagram" class="hash-link" aria-label="Direct link to System Architecture Diagram" title="Direct link to System Architecture Diagram" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="complete-data-flow-client--proxy--pattern--pattern-provider--backend">Complete Data Flow: Client → Proxy → Pattern → Pattern Provider → Backend<a href="#complete-data-flow-client--proxy--pattern--pattern-provider--backend" class="hash-link" aria-label="Direct link to Complete Data Flow: Client → Proxy → Pattern → Pattern Provider → Backend" title="Direct link to Complete Data Flow: Client → Proxy → Pattern → Pattern Provider → Backend" translate="no">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-flow-example-publishing-large-message">Data Flow Example: Publishing Large Message<a href="#data-flow-example-publishing-large-message" class="hash-link" aria-label="Direct link to Data Flow Example: Publishing Large Message" title="Direct link to Data Flow Example: Publishing Large Message" translate="no">​</a></h3>
<p><strong>Client Request:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;videos&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> video_bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 2GB payload</span><br></span></code></pre></div></div>
<p><strong>Internal Flow:</strong></p>
<ol>
<li><strong>Layer 3 (Client API)</strong>: <code>PubSubService.Publish()</code> accepts request</li>
<li><strong>Authentication</strong>: JWT validated, namespace access checked</li>
<li><strong>Layer 2 (Patterns)</strong>:
<ul>
<li><strong>Claim Check Pattern</strong>: Detects size &gt; 1MB, uploads to S3, replaces payload with reference</li>
<li><strong>Outbox Pattern</strong>: Wraps in transaction, inserts into outbox table</li>
</ul>
</li>
<li><strong>Layer 1 (Pattern Provider)</strong>: Kafka pattern provider publishes lightweight message (&lt; 1KB)</li>
<li><strong>Response</strong>: Client receives success</li>
</ol>
<p><strong>Consumer retrieves:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">event </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;videos&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">video_bytes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">payload  </span><span class="token comment" style="color:#999988;font-style:italic"># Prism fetches 2GB from S3 transparently</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="proxy-and-pattern-provider-architecture">Proxy and Pattern Provider Architecture<a href="#proxy-and-pattern-provider-architecture" class="hash-link" aria-label="Direct link to Proxy and Pattern Provider Architecture" title="Direct link to Proxy and Pattern Provider Architecture" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="responsibility-separation">Responsibility Separation<a href="#responsibility-separation" class="hash-link" aria-label="Direct link to Responsibility Separation" title="Direct link to Responsibility Separation" translate="no">​</a></h3>
<p>The Prism proxy is <strong>intentionally minimal</strong> - it handles networking, authentication, and routing. All backend-specific logic lives in <strong>pattern providers</strong>.</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-provider-interface-grpc-based">Pattern Provider Interface (gRPC-Based)<a href="#pattern-provider-interface-grpc-based" class="hash-link" aria-label="Direct link to Pattern Provider Interface (gRPC-Based)" title="Direct link to Pattern Provider Interface (gRPC-Based)" translate="no">​</a></h3>
<p><strong>Design Decision</strong>: Pattern providers are <strong>out-of-process</strong> by default for fault isolation and independent scaling.</p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">PatternProvider</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Initialize provider with configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">InitializeRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">InitializeResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Health check</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">HealthCheck</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HealthCheckRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HealthCheckResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Execute operation (generic interface)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExecuteRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExecuteResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Stream operations (for subscriptions)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ExecuteStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">stream</span><span class="token plain"> </span><span class="token class-name">StreamRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">stream</span><span class="token plain"> </span><span class="token class-name">StreamResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Shutdown gracefully</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Shutdown</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ShutdownRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ShutdownResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Pattern Provider Deployment Options:</strong></p>





























<table><thead><tr><th>Model</th><th>Use Case</th><th>Latency Overhead</th><th>Fault Isolation</th></tr></thead><tbody><tr><td><strong>In-Process</strong> (Shared Library)</td><td>Ultra-low latency (Redis, Memcached)</td><td>~0.1ms</td><td>❌ Shared process</td></tr><tr><td><strong>Sidecar</strong> (Unix Socket)</td><td>Most backends</td><td>~1-2ms</td><td>✅ Separate process</td></tr><tr><td><strong>Remote</strong> (gRPC/mTLS)</td><td>Cloud-managed providers</td><td>~5-10ms</td><td>✅ Network isolation</td></tr></tbody></table>
<p><strong>Recommended Default</strong>: <strong>Sidecar deployment</strong> for fault isolation and independent scaling.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="zero-copy-data-path">Zero-Copy Data Path<a href="#zero-copy-data-path" class="hash-link" aria-label="Direct link to Zero-Copy Data Path" title="Direct link to Zero-Copy Data Path" translate="no">​</a></h3>
<p>For large payloads (object storage, bulk exports), Prism uses <strong>zero-copy proxying</strong>:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Rust proxy with Tonic (gRPC) and Bytes (zero-copy buffers)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">handle_get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">ExecuteRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">ExecuteResponse</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Extract key without copying</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">as_ref</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// No allocation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Fetch from backend (e.g., S3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> object_data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Arc</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Bytes</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Return Arc&lt;Bytes&gt; - gRPC shares the same buffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExecuteResponse</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        success</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">object_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">..</span><span class="token class-name">Default</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Performance</strong>: Negligible overhead for payloads &gt; 1MB regardless of size.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="backend-interface-decomposition">Backend Interface Decomposition<a href="#backend-interface-decomposition" class="hash-link" aria-label="Direct link to Backend Interface Decomposition" title="Direct link to Backend Interface Decomposition" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="design-philosophy-thin-composable-interfaces">Design Philosophy: Thin, Composable Interfaces<a href="#design-philosophy-thin-composable-interfaces" class="hash-link" aria-label="Direct link to Design Philosophy: Thin, Composable Interfaces" title="Direct link to Design Philosophy: Thin, Composable Interfaces" translate="no">​</a></h3>
<p><strong>Key Decision</strong>: Use <strong>explicit interface flavors</strong> (not capability flags) for type safety and clear contracts.</p>
<p>Each data model has multiple interface flavors:</p>
<ul>
<li><code>&lt;Model&gt;Basic</code> - Core CRUD operations (required)</li>
<li><code>&lt;Model&gt;Scan</code> - Enumeration capability (optional)</li>
<li><code>&lt;Model&gt;TTL</code> - Time-to-live expiration (optional)</li>
<li><code>&lt;Model&gt;Transactional</code> - Multi-operation atomicity (optional)</li>
<li><code>&lt;Model&gt;Batch</code> - Bulk operations (optional)</li>
</ul>
<p><strong>Example: KeyValue Interfaces</strong></p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// proto/interfaces/keyvalue_basic.proto</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">KeyValueBasicInterface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SetRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SetResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Delete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExistsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExistsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// proto/interfaces/keyvalue_scan.proto</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">KeyValueScanInterface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Scan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ScanRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">stream</span><span class="token plain"> </span><span class="token class-name">ScanResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ScanKeys</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ScanKeysRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">stream</span><span class="token plain"> </span><span class="token class-name">KeyResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CountRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CountResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// proto/interfaces/keyvalue_ttl.proto</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">KeyValueTTLInterface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Expire</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExpireRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExpireResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetTTL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetTTLRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetTTLResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Persist</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">PersistRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">PersistResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// proto/interfaces/keyvalue_transactional.proto</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">KeyValueTransactionalInterface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">BeginTransaction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BeginTransactionRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TransactionHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Commit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CommitRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CommitResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Rollback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RollbackRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RollbackResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="complete-interface-catalog-45-interfaces">Complete Interface Catalog (45 Interfaces)<a href="#complete-interface-catalog-45-interfaces" class="hash-link" aria-label="Direct link to Complete Interface Catalog (45 Interfaces)" title="Direct link to Complete Interface Catalog (45 Interfaces)" translate="no">​</a></h3>




























































<table><thead><tr><th>Data Model</th><th>Interfaces</th><th>Description</th></tr></thead><tbody><tr><td><strong>KeyValue</strong></td><td>6 interfaces</td><td>keyvalue_basic, keyvalue_scan, keyvalue_ttl, keyvalue_transactional, keyvalue_batch, keyvalue_cas</td></tr><tr><td><strong>PubSub</strong></td><td>5 interfaces</td><td>pubsub_basic, pubsub_wildcards, pubsub_persistent, pubsub_filtering, pubsub_ordering</td></tr><tr><td><strong>Stream</strong></td><td>5 interfaces</td><td>stream_basic, stream_consumer_groups, stream_replay, stream_retention, stream_partitioning</td></tr><tr><td><strong>Queue</strong></td><td>5 interfaces</td><td>queue_basic, queue_visibility, queue_dead_letter, queue_priority, queue_delayed</td></tr><tr><td><strong>List</strong></td><td>4 interfaces</td><td>list_basic, list_indexing, list_range, list_blocking</td></tr><tr><td><strong>Set</strong></td><td>4 interfaces</td><td>set_basic, set_operations, set_cardinality, set_random</td></tr><tr><td><strong>SortedSet</strong></td><td>5 interfaces</td><td>sortedset_basic, sortedset_range, sortedset_rank, sortedset_operations, sortedset_lex</td></tr><tr><td><strong>TimeSeries</strong></td><td>4 interfaces</td><td>timeseries_basic, timeseries_aggregation, timeseries_retention, timeseries_interpolation</td></tr><tr><td><strong>Graph</strong></td><td>4 interfaces</td><td>graph_basic, graph_traversal, graph_query, graph_analytics</td></tr><tr><td><strong>Document</strong></td><td>3 interfaces</td><td>document_basic, document_query, document_indexing</td></tr></tbody></table>
<p><strong>Total: 45 thin, composable interfaces</strong> across 10 data models.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="backend-implementation-matrix">Backend Implementation Matrix<a href="#backend-implementation-matrix" class="hash-link" aria-label="Direct link to Backend Implementation Matrix" title="Direct link to Backend Implementation Matrix" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="which-backends-implement-which-interfaces">Which Backends Implement Which Interfaces?<a href="#which-backends-implement-which-interfaces" class="hash-link" aria-label="Direct link to Which Backends Implement Which Interfaces?" title="Direct link to Which Backends Implement Which Interfaces?" translate="no">​</a></h3>
<p>This table shows how backends compose multiple interfaces to provide capabilities:</p>



























































<table><thead><tr><th>Backend</th><th>Interfaces Implemented</th><th>Data Models</th><th>Implementability Score</th></tr></thead><tbody><tr><td><strong>Redis</strong></td><td>16 interfaces</td><td>KeyValue, PubSub, Stream, List, Set, SortedSet</td><td><strong>95/100</strong></td></tr><tr><td><strong>Postgres</strong></td><td>16 interfaces</td><td>KeyValue, Queue, TimeSeries, Document, Graph</td><td><strong>93/100</strong></td></tr><tr><td><strong>Kafka</strong></td><td>7 interfaces</td><td>Stream, PubSub</td><td><strong>78/100</strong></td></tr><tr><td><strong>NATS</strong></td><td>8 interfaces</td><td>PubSub, Stream, Queue</td><td><strong>90/100</strong></td></tr><tr><td><strong>DynamoDB</strong></td><td>9 interfaces</td><td>KeyValue, Document, Set</td><td><strong>85/100</strong></td></tr><tr><td><strong>MemStore</strong></td><td>6 interfaces</td><td>KeyValue, List</td><td><strong>100/100</strong></td></tr><tr><td><strong>ClickHouse</strong></td><td>3 interfaces</td><td>TimeSeries, Stream</td><td><strong>70/100</strong></td></tr><tr><td><strong>Neptune</strong></td><td>4 interfaces</td><td>Graph</td><td><strong>50/100</strong></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="backend-comparison-redis-vs-postgresql">Backend Comparison: Redis vs PostgreSQL<a href="#backend-comparison-redis-vs-postgresql" class="hash-link" aria-label="Direct link to Backend Comparison: Redis vs PostgreSQL" title="Direct link to Backend Comparison: Redis vs PostgreSQL" translate="no">​</a></h3>
<p><strong>Redis (16 interfaces):</strong></p>
<ul>
<li>KeyValue: basic, scan, ttl, transactional, batch</li>
<li>PubSub: basic, wildcards</li>
<li>Stream: basic, consumer_groups, replay, retention</li>
<li>List: basic, indexing, range, blocking</li>
<li>Set: basic, operations, cardinality, random</li>
<li>SortedSet: All 5 interfaces</li>
</ul>
<p><strong>PostgreSQL (16 interfaces, different mix):</strong></p>
<ul>
<li>KeyValue: basic, scan, transactional, batch (no TTL - requires cron)</li>
<li>Queue: basic, visibility, dead_letter, delayed</li>
<li>TimeSeries: basic, aggregation, retention (with TimescaleDB)</li>
<li>Document: basic, query, indexing (JSONB support)</li>
<li>Graph: basic, traversal (recursive CTEs)</li>
</ul>
<p><strong>Key Insight</strong>: Redis and Postgres both implement 16 interfaces, but <strong>different combinations</strong> for different use cases. Redis excels at in-memory data structures; Postgres excels at durable ACID storage.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="capabilities-expressed-through-interface-presence">Capabilities Expressed Through Interface Presence<a href="#capabilities-expressed-through-interface-presence" class="hash-link" aria-label="Direct link to Capabilities Expressed Through Interface Presence" title="Direct link to Capabilities Expressed Through Interface Presence" translate="no">​</a></h3>
<p><strong>Design Principle</strong>: Capabilities are NOT separate metadata - they&#x27;re expressed through <strong>interface implementation</strong>.</p>

































<table><thead><tr><th>Capability</th><th>How It&#x27;s Expressed</th></tr></thead><tbody><tr><td>TTL Support</td><td>Backend implements <code>keyvalue_ttl</code> interface</td></tr><tr><td>Scan Support</td><td>Backend implements <code>keyvalue_scan</code> interface</td></tr><tr><td>Transactions</td><td>Backend implements <code>keyvalue_transactional</code> interface</td></tr><tr><td>Wildcards in Pub/Sub</td><td>Backend implements <code>pubsub_wildcards</code> interface</td></tr><tr><td>Consumer Groups</td><td>Backend implements <code>stream_consumer_groups</code> interface</td></tr><tr><td>Replay</td><td>Backend implements <code>stream_replay</code> interface</td></tr></tbody></table>
<p><strong>Why This is Better:</strong></p>
<ol>
<li><strong>Type-safe</strong>: Compiler enforces backend has required interfaces</li>
<li><strong>Self-documenting</strong>: Look at implemented interfaces to know capabilities</li>
<li><strong>No runtime surprises</strong>: If interface is present, capability MUST work</li>
<li><strong>Proto-first</strong>: Everything in <code>.proto</code> files, not separate metadata</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-composition-and-backend-mapping">Pattern Composition and Backend Mapping<a href="#pattern-composition-and-backend-mapping" class="hash-link" aria-label="Direct link to Pattern Composition and Backend Mapping" title="Direct link to Pattern Composition and Backend Mapping" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="patterns-require-backend-interfaces">Patterns Require Backend Interfaces<a href="#patterns-require-backend-interfaces" class="hash-link" aria-label="Direct link to Patterns Require Backend Interfaces" title="Direct link to Patterns Require Backend Interfaces" translate="no">​</a></h3>
<p>Patterns declare <strong>slots</strong> that must be filled with backends implementing specific interfaces.</p>
<p><strong>Example: Multicast Registry Pattern</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> multicast</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Register identities with metadata and multicast messages&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">slots</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Stores identity → metadata mappings&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">required_interfaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> keyvalue_basic  </span><span class="token comment" style="color:#999988;font-style:italic"># MUST implement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> keyvalue_scan   </span><span class="token comment" style="color:#999988;font-style:italic"># MUST implement (enumerate identities)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">optional_interfaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> keyvalue_ttl    </span><span class="token comment" style="color:#999988;font-style:italic"># Nice to have (auto-expire offline identities)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">recommended_backends</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">redis</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> postgres</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dynamodb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> etcd</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">messaging</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Delivers multicast messages to identities&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">required_interfaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pubsub_basic    </span><span class="token comment" style="color:#999988;font-style:italic"># MUST implement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">optional_interfaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pubsub_persistent  </span><span class="token comment" style="color:#999988;font-style:italic"># Nice to have (durable delivery)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">recommended_backends</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">nats</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> redis</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kafka</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">durability</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Persists undelivered messages for offline identities&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">required_interfaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> queue_basic           </span><span class="token comment" style="color:#999988;font-style:italic"># MUST implement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> queue_visibility      </span><span class="token comment" style="color:#999988;font-style:italic"># MUST implement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> queue_dead_letter     </span><span class="token comment" style="color:#999988;font-style:italic"># MUST handle failed deliveries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">recommended_backends</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">postgres</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sqs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rabbitmq</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">optional</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="backend-slot-validation">Backend Slot Validation<a href="#backend-slot-validation" class="hash-link" aria-label="Direct link to Backend Slot Validation" title="Direct link to Backend Slot Validation" translate="no">​</a></h3>
<p><strong>Configuration Example:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> iot</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">devices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> multicast</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">slots</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Validation: Redis implements keyvalue_basic ✓</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#             Redis implements keyvalue_scan ✓</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#             Redis implements keyvalue_ttl ✓ (bonus)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">messaging</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Validation: NATS implements pubsub_basic ✓</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">durability</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Validation: Postgres implements queue_basic ✓</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#             Postgres implements queue_visibility ✓</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#             Postgres implements queue_dead_letter ✓</span><br></span></code></pre></div></div>
<p><strong>Validation at Config Load Time:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ prism validate namespace-config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Validating namespace: iot-devices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pattern: multicast-registry v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slot: registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Backend: redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Required interfaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ keyvalue_basic       </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">redis implements</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ keyvalue_scan        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">redis implements</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Optional interfaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ keyvalue_ttl         </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">redis implements</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slot: messaging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Backend: nats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Required interfaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ pubsub_basic         </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nats implements</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slot: durability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Backend: postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Required interfaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ queue_basic          </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">postgres implements</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ queue_visibility     </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">postgres implements</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ queue_dead_letter    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">postgres implements</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Configuration valid</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-portability-across-backends">Pattern Portability Across Backends<a href="#pattern-portability-across-backends" class="hash-link" aria-label="Direct link to Pattern Portability Across Backends" title="Direct link to Pattern Portability Across Backends" translate="no">​</a></h3>
<p>Same pattern works with different backend combinations:</p>








































<table><thead><tr><th>Combination</th><th>Registry</th><th>Messaging</th><th>Durability</th><th>Use Case</th></tr></thead><tbody><tr><td><strong>Combo 1</strong></td><td>Redis</td><td>NATS</td><td>Postgres</td><td>Production (high performance)</td></tr><tr><td><strong>Combo 2</strong></td><td>Postgres</td><td>Kafka</td><td>Postgres</td><td>All-in-one (single DB)</td></tr><tr><td><strong>Combo 3</strong></td><td>DynamoDB</td><td>SNS</td><td>SQS</td><td>AWS-native (managed services)</td></tr><tr><td><strong>Combo 4</strong></td><td>MemStore</td><td>NATS</td><td>(none)</td><td>Local dev (fast, no persistence)</td></tr></tbody></table>
<p><strong>Key Insight</strong>: Application code is <strong>identical</strong> across all combinations. Only configuration changes.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="design-rationale-and-decision-history">Design Rationale and Decision History<a href="#design-rationale-and-decision-history" class="hash-link" aria-label="Direct link to Design Rationale and Decision History" title="Direct link to Design Rationale and Decision History" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-three-layers">Why Three Layers?<a href="#why-three-layers" class="hash-link" aria-label="Direct link to Why Three Layers?" title="Direct link to Why Three Layers?" translate="no">​</a></h3>
<p><strong>Problem</strong>: Netflix Data Gateway tightly couples client API with backend implementation. Adding Claim Check pattern requires changing application code.</p>
<p><strong>Solution</strong>: Separate <strong>What</strong> (client API), <strong>How</strong> (patterns), and <strong>Where</strong> (backends).</p>
<p><strong>Benefits:</strong></p>
<ol>
<li><strong>Backend Migration</strong>: Swap Redis → DynamoDB without client changes</li>
<li><strong>Pattern Evolution</strong>: Add CDC without API breakage</li>
<li><strong>Configuration-Driven</strong>: Declare needs, Prism selects patterns</li>
<li><strong>Testing Isolation</strong>: Test patterns independently of backends</li>
<li><strong>Organizational Scalability</strong>: Teams configure namespaces independently with policy guardrails</li>
</ol>
<p><strong>Reference</strong>: <a href="/prism-data-layer/rfc/rfc-014">RFC-014: Layered Data Access Patterns</a>, <a href="/prism-data-layer/adr/adr-002">ADR-002: Client-Originated Configuration</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-rust-for-proxy">Why Rust for Proxy?<a href="#why-rust-for-proxy" class="hash-link" aria-label="Direct link to Why Rust for Proxy?" title="Direct link to Why Rust for Proxy?" translate="no">​</a></h3>
<p><strong>Problem</strong>: JVM-based proxies (Netflix Data Gateway) have GC pauses, high memory overhead, and unpredictable latency.</p>
<p><strong>Solution</strong>: Rust proxy with Tokio async runtime.</p>
<p><strong>Performance Comparison:</strong></p>









































<table><thead><tr><th>Metric</th><th>Java/Spring Boot</th><th>Rust/Tokio</th><th>Improvement</th></tr></thead><tbody><tr><td>P50 Latency</td><td>~5ms</td><td>~0.3ms</td><td><strong>16x</strong></td></tr><tr><td>P99 Latency</td><td>~50ms</td><td>~2ms</td><td><strong>25x</strong></td></tr><tr><td>Throughput (RPS)</td><td>~20k</td><td>~200k</td><td><strong>10x</strong></td></tr><tr><td>Memory (idle)</td><td>~500MB</td><td>~20MB</td><td><strong>25x</strong></td></tr><tr><td>Cold Start</td><td>~10s</td><td>~100ms</td><td><strong>100x</strong></td></tr></tbody></table>
<p><strong>Reference</strong>: <a href="/prism-data-layer/adr/adr-001">ADR-001: Rust for Proxy Implementation</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-thin-interfaces-instead-of-capability-flags">Why Thin Interfaces Instead of Capability Flags?<a href="#why-thin-interfaces-instead-of-capability-flags" class="hash-link" aria-label="Direct link to Why Thin Interfaces Instead of Capability Flags?" title="Direct link to Why Thin Interfaces Instead of Capability Flags?" translate="no">​</a></h3>
<p><strong>Problem</strong>: Monolithic interfaces with capability flags lead to runtime errors.</p>
<p><strong>Bad Example:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">capabilities</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scan_support</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Runtime metadata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ttl_support</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre></div></div>
<p><strong>Good Example (Prism Approach):</strong></p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Redis implements these interfaces (compile-time contracts)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">implements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> keyvalue_basic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> keyvalue_scan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> keyvalue_ttl</span><br></span></code></pre></div></div>
<p><strong>Benefits:</strong></p>
<ol>
<li><strong>Type Safety</strong>: Compiler enforces interface implementation</li>
<li><strong>Clear Contracts</strong>: Interface presence guarantees functionality</li>
<li><strong>No Runtime Surprises</strong>: If backend claims interface, it MUST work</li>
<li><strong>Proto-First</strong>: All contracts in <code>.proto</code> files</li>
</ol>
<p><strong>Reference</strong>: <a href="/prism-data-layer/memos/memo-006">MEMO-006: Backend Interface Decomposition</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-out-of-process-pattern-providers">Why Out-of-Process Pattern Providers?<a href="#why-out-of-process-pattern-providers" class="hash-link" aria-label="Direct link to Why Out-of-Process Pattern Providers?" title="Direct link to Why Out-of-Process Pattern Providers?" translate="no">​</a></h3>
<p><strong>Problem</strong>: In-process pattern providers (shared libraries) crash the proxy and lack fault isolation.</p>
<p><strong>Solution</strong>: Pattern providers run as <strong>separate processes</strong> (sidecar) communicating via gRPC.</p>
<p><strong>Benefits:</strong></p>
<ol>
<li><strong>Fault Isolation</strong>: Provider crash doesn&#x27;t affect proxy</li>
<li><strong>Independent Scaling</strong>: Scale providers separately from proxy</li>
<li><strong>Language Flexibility</strong>: Implement providers in Go, Python, Java (not just Rust)</li>
<li><strong>Security</strong>: Process-level isolation limits blast radius</li>
</ol>
<p><strong>Trade-off</strong>: ~1-2ms latency overhead vs in-process (~0.1ms), but worth it for reliability.</p>
<p><strong>Reference</strong>: <a href="/prism-data-layer/rfc/rfc-008">RFC-008: Proxy Plugin Architecture</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-provider-side-token-validation">Why Provider-Side Token Validation?<a href="#why-provider-side-token-validation" class="hash-link" aria-label="Direct link to Why Provider-Side Token Validation?" title="Direct link to Why Provider-Side Token Validation?" translate="no">​</a></h3>
<p><strong>Problem</strong>: Proxy validating tokens per-request adds 10-50ms latency per request.</p>
<p><strong>Solution</strong>: Pattern providers validate tokens <strong>once per session</strong>, then cache validation result.</p>
<p><strong>Benefits:</strong></p>
<ol>
<li><strong>Amortized Cost</strong>: Validate once, reuse claims for session lifetime</li>
<li><strong>Defense-in-Depth</strong>: Even if proxy is bypassed, providers enforce auth</li>
<li><strong>Per-User Credentials</strong>: Vault provides dynamic, short-lived credentials (1h TTL)</li>
<li><strong>Audit Trails</strong>: Backend logs show which user accessed what data</li>
</ol>
<p><strong>Reference</strong>: <a href="/prism-data-layer/rfc/rfc-019">RFC-019: Plugin SDK Authorization Layer</a></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="related-documentation">Related Documentation<a href="#related-documentation" class="hash-link" aria-label="Direct link to Related Documentation" title="Direct link to Related Documentation" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="core-rfcs">Core RFCs<a href="#core-rfcs" class="hash-link" aria-label="Direct link to Core RFCs" title="Direct link to Core RFCs" translate="no">​</a></h3>
<ul>
<li><a href="/prism-data-layer/rfc/rfc-001">RFC-001: Prism Architecture</a> - Foundational design</li>
<li><a href="/prism-data-layer/rfc/rfc-008">RFC-008: Proxy Plugin Architecture</a> - Plugin system</li>
<li><a href="/prism-data-layer/rfc/rfc-014">RFC-014: Layered Data Access Patterns</a> - Three-layer design</li>
<li><a href="/prism-data-layer/rfc/rfc-017">RFC-017: Multicast Registry Pattern</a> - Pattern example</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="design-memos">Design Memos<a href="#design-memos" class="hash-link" aria-label="Direct link to Design Memos" title="Direct link to Design Memos" translate="no">​</a></h3>
<ul>
<li><a href="/prism-data-layer/memos/memo-005">MEMO-005: Client Protocol Design Philosophy</a> - Composition vs use-case</li>
<li><a href="/prism-data-layer/memos/memo-006">MEMO-006: Backend Interface Decomposition</a> - Interface catalog</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-guides">Implementation Guides<a href="#implementation-guides" class="hash-link" aria-label="Direct link to Implementation Guides" title="Direct link to Implementation Guides" translate="no">​</a></h3>
<ul>
<li><a href="/prism-data-layer/memos/memo-004">MEMO-004: Backend Plugin Implementation Guide</a> - Implementability scores</li>
<li><a href="/prism-data-layer/rfc/rfc-015">RFC-015: Plugin Acceptance Test Framework</a> - Testing strategy</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-adrs">Key ADRs<a href="#key-adrs" class="hash-link" aria-label="Direct link to Key ADRs" title="Direct link to Key ADRs" translate="no">​</a></h3>
<ul>
<li><a href="/prism-data-layer/adr/adr-001">ADR-001: Rust for Proxy Implementation</a> - Language choice</li>
<li><a href="/prism-data-layer/adr/adr-050">ADR-050: Topaz for Policy-Based Authorization</a> - Authorization</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="quick-reference">Quick Reference<a href="#quick-reference" class="hash-link" aria-label="Direct link to Quick Reference" title="Direct link to Quick Reference" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="backend-selection-guide">Backend Selection Guide<a href="#backend-selection-guide" class="hash-link" aria-label="Direct link to Backend Selection Guide" title="Direct link to Backend Selection Guide" translate="no">​</a></h3>
<p><strong>Q: Which backend should I use for caching?</strong>
<strong>A:</strong> Redis (16 interfaces including <code>keyvalue_ttl</code>) or MemStore (6 interfaces, zero dependencies)</p>
<p><strong>Q: Which backend for event streaming?</strong>
<strong>A:</strong> Kafka (7 interfaces including <code>stream_consumer_groups</code>) or NATS JetStream (8 interfaces)</p>
<p><strong>Q: Which backend for transactional messaging?</strong>
<strong>A:</strong> PostgreSQL (16 interfaces including <code>queue_basic</code> + <code>keyvalue_transactional</code> for Outbox pattern)</p>
<p><strong>Q: Which backend for graph queries?</strong>
<strong>A:</strong> Neptune (4 graph interfaces with Gremlin/SPARQL) or PostgreSQL (2 graph interfaces with recursive CTEs)</p>
<p><strong>Q: Which backend for local testing?</strong>
<strong>A:</strong> MemStore (100/100 implementability score, zero external dependencies, sub-microsecond latency)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-selection-guide">Pattern Selection Guide<a href="#pattern-selection-guide" class="hash-link" aria-label="Direct link to Pattern Selection Guide" title="Direct link to Pattern Selection Guide" translate="no">​</a></h3>








































<table><thead><tr><th>Use Case</th><th>Recommended Pattern</th><th>Backend Combination</th></tr></thead><tbody><tr><td><strong>High-volume logging</strong></td><td>WAL + Tiered Storage</td><td>Kafka + S3</td></tr><tr><td><strong>Large files (videos, models)</strong></td><td>Claim Check</td><td>S3 + Kafka</td></tr><tr><td><strong>Transactional events</strong></td><td>Outbox</td><td>Postgres + Kafka</td></tr><tr><td><strong>Database change streaming</strong></td><td>CDC</td><td>Postgres + Kafka</td></tr><tr><td><strong>Fast cached reads</strong></td><td>Cache + CDC</td><td>Redis + Postgres</td></tr><tr><td><strong>Event sourcing</strong></td><td>WAL + Event Store</td><td>Kafka + ClickHouse</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-operations">Common Operations<a href="#common-operations" class="hash-link" aria-label="Direct link to Common Operations" title="Direct link to Common Operations" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Validate namespace configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism validate namespace-config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># List available backends</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism registry backends list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Find backends implementing specific interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism registry backends </span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--interface</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">keyvalue_scan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Show pattern requirements</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism registry patterns describe multicast-registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate configuration from requirements</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism generate config </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--pattern</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">multicast-registry </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--slot</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">registry:redis </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--slot</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">messaging:nats</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" translate="no">​</a></h2>
<p><strong>Prism Architecture in Three Sentences:</strong></p>
<ol>
<li><strong>Three-layer design</strong> separates client API (What), pattern composition (How), and backend execution (Where) for flexibility and reliability.</li>
<li><strong>Thin, composable interfaces</strong> (45 total across 10 data models) enable type-safe backend substitutability and clear capability contracts.</li>
<li><strong>Out-of-process plugins</strong> provide fault isolation and independent scaling, while the Rust proxy delivers 10-100x performance vs JVM alternatives.</li>
</ol>
<p><strong>Key Takeaways:</strong></p>
<ul>
<li>Applications interact with <strong>stable Layer 3 APIs</strong> (Queue, PubSub, Reader)</li>
<li>Prism transparently applies <strong>Layer 2 patterns</strong> (Outbox, Claim Check, CDC)</li>
<li>Patterns compose <strong>Layer 1 backend interfaces</strong> via slot-based configuration</li>
<li>Backend capabilities expressed through <strong>interface presence</strong> (not metadata flags)</li>
<li><strong>Configuration-driven</strong>: Same application code works across different backend combinations</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/docs/tags/architecture">architecture</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/docs/tags/technical-overview">technical-overview</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/docs/tags/system-design">system-design</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/docs/tags/backend-interfaces">backend-interfaces</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/docs/tags/patterns">patterns</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/jrepp/prism-data-layer/tree/main/docusaurus/docs/architecture.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/prism-data-layer/docs/key-documents"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Foundations</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-prism" class="table-of-contents__link toc-highlight">What is Prism?</a><ul><li><a href="#core-value-propositions" class="table-of-contents__link toc-highlight">Core Value Propositions</a></li><li><a href="#key-metrics" class="table-of-contents__link toc-highlight">Key Metrics</a></li></ul></li><li><a href="#high-level-architecture" class="table-of-contents__link toc-highlight">High-Level Architecture</a><ul><li><a href="#three-layer-design-philosophy" class="table-of-contents__link toc-highlight">Three-Layer Design Philosophy</a></li></ul></li><li><a href="#system-architecture-diagram" class="table-of-contents__link toc-highlight">System Architecture Diagram</a><ul><li><a href="#complete-data-flow-client--proxy--pattern--pattern-provider--backend" class="table-of-contents__link toc-highlight">Complete Data Flow: Client → Proxy → Pattern → Pattern Provider → Backend</a></li><li><a href="#data-flow-example-publishing-large-message" class="table-of-contents__link toc-highlight">Data Flow Example: Publishing Large Message</a></li></ul></li><li><a href="#proxy-and-pattern-provider-architecture" class="table-of-contents__link toc-highlight">Proxy and Pattern Provider Architecture</a><ul><li><a href="#responsibility-separation" class="table-of-contents__link toc-highlight">Responsibility Separation</a></li><li><a href="#pattern-provider-interface-grpc-based" class="table-of-contents__link toc-highlight">Pattern Provider Interface (gRPC-Based)</a></li><li><a href="#zero-copy-data-path" class="table-of-contents__link toc-highlight">Zero-Copy Data Path</a></li></ul></li><li><a href="#backend-interface-decomposition" class="table-of-contents__link toc-highlight">Backend Interface Decomposition</a><ul><li><a href="#design-philosophy-thin-composable-interfaces" class="table-of-contents__link toc-highlight">Design Philosophy: Thin, Composable Interfaces</a></li><li><a href="#complete-interface-catalog-45-interfaces" class="table-of-contents__link toc-highlight">Complete Interface Catalog (45 Interfaces)</a></li></ul></li><li><a href="#backend-implementation-matrix" class="table-of-contents__link toc-highlight">Backend Implementation Matrix</a><ul><li><a href="#which-backends-implement-which-interfaces" class="table-of-contents__link toc-highlight">Which Backends Implement Which Interfaces?</a></li><li><a href="#backend-comparison-redis-vs-postgresql" class="table-of-contents__link toc-highlight">Backend Comparison: Redis vs PostgreSQL</a></li><li><a href="#capabilities-expressed-through-interface-presence" class="table-of-contents__link toc-highlight">Capabilities Expressed Through Interface Presence</a></li></ul></li><li><a href="#pattern-composition-and-backend-mapping" class="table-of-contents__link toc-highlight">Pattern Composition and Backend Mapping</a><ul><li><a href="#patterns-require-backend-interfaces" class="table-of-contents__link toc-highlight">Patterns Require Backend Interfaces</a></li><li><a href="#backend-slot-validation" class="table-of-contents__link toc-highlight">Backend Slot Validation</a></li><li><a href="#pattern-portability-across-backends" class="table-of-contents__link toc-highlight">Pattern Portability Across Backends</a></li></ul></li><li><a href="#design-rationale-and-decision-history" class="table-of-contents__link toc-highlight">Design Rationale and Decision History</a><ul><li><a href="#why-three-layers" class="table-of-contents__link toc-highlight">Why Three Layers?</a></li><li><a href="#why-rust-for-proxy" class="table-of-contents__link toc-highlight">Why Rust for Proxy?</a></li><li><a href="#why-thin-interfaces-instead-of-capability-flags" class="table-of-contents__link toc-highlight">Why Thin Interfaces Instead of Capability Flags?</a></li><li><a href="#why-out-of-process-pattern-providers" class="table-of-contents__link toc-highlight">Why Out-of-Process Pattern Providers?</a></li><li><a href="#why-provider-side-token-validation" class="table-of-contents__link toc-highlight">Why Provider-Side Token Validation?</a></li></ul></li><li><a href="#related-documentation" class="table-of-contents__link toc-highlight">Related Documentation</a><ul><li><a href="#core-rfcs" class="table-of-contents__link toc-highlight">Core RFCs</a></li><li><a href="#design-memos" class="table-of-contents__link toc-highlight">Design Memos</a></li><li><a href="#implementation-guides" class="table-of-contents__link toc-highlight">Implementation Guides</a></li><li><a href="#key-adrs" class="table-of-contents__link toc-highlight">Key ADRs</a></li></ul></li><li><a href="#quick-reference" class="table-of-contents__link toc-highlight">Quick Reference</a><ul><li><a href="#backend-selection-guide" class="table-of-contents__link toc-highlight">Backend Selection Guide</a></li><li><a href="#pattern-selection-guide" class="table-of-contents__link toc-highlight">Pattern Selection Guide</a></li><li><a href="#common-operations" class="table-of-contents__link toc-highlight">Common Operations</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/intro">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/changelog">Change Log</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/adr">ADRs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/rfc">RFCs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/memos">Memos</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/prds">PRDs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Project</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div>Copyright © 2025 Prism. Built with Docusaurus.</div><div style="margin-top:0.5rem;font-size:0.875rem;opacity:0.8"><span>Version <!-- -->12230f2</span><span> • </span><span>Built <!-- -->Oct 14, 2025, 10:32 AM PDT</span><span> • </span><span>Commit <!-- -->12230f2</span></div></div></div></div></footer></div>
</body>
</html>