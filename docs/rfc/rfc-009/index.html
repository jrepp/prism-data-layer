<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-rfc docs-version-current docs-doc-page docs-doc-id-rfc-009" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Distributed Reliability Data Patterns | Prism</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jrepp.github.io/prism-data-layer/rfc/rfc-009"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" property="og:title" content="Distributed Reliability Data Patterns | Prism"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/prism-data-layer/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-009"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-009" hreflang="en"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-009" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Distributed Reliability Data Patterns • RFC-009","item":"https://jrepp.github.io/prism-data-layer/rfc/rfc-009"}]}</script><link rel="stylesheet" href="/prism-data-layer/assets/css/styles.3b9928e7.css">
<script src="/prism-data-layer/assets/js/runtime~main.9b513438.js" defer="defer"></script>
<script src="/prism-data-layer/assets/js/main.d41eedff.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/prism-data-layer/"><div class="navbar__logo"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">Prism</b></a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/intro">Overview</a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/changelog">Change Log</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Documentation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/prism-data-layer/adr">ADRs (Architecture Decision Records)</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/prism-data-layer/rfc">RFCs (Request for Comments)</a></li><li><a class="dropdown__link" href="/prism-data-layer/memos">Memos (Technical Analysis)</a></li><li><a class="dropdown__link" href="/prism-data-layer/prds">PRDs (Product Requirements)</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="buildInfo_asc2"><span class="version_ADrX" title="Build: fc3d6ad">fc3d6ad</span><span class="separator_VfCt">•</span><span class="buildTime_n1Nn" title="Last updated: Oct 13">Oct 13</span></div><div class="navbar__item"><a href="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml" target="_blank" rel="noopener noreferrer" title="GitHub Pages" style="display: flex; align-items: center; padding: 0 0.5rem;"><img src="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml/badge.svg" alt="Build" style="margin: 0;"></a></div><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_x44X"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/"><span title="Request for Comments (RFCs)" class="linkLabel_WmDU">Request for Comments (RFCs)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-001"><span title="Prism Data Access Layer Architecture • RFC-001" class="linkLabel_WmDU">Prism Data Access Layer Architecture • RFC-001</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-002"><span title="Data Layer Interface Specification • RFC-002" class="linkLabel_WmDU">Data Layer Interface Specification • RFC-002</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-003"><span title="Admin Interface for Prism • RFC-003" class="linkLabel_WmDU">Admin Interface for Prism • RFC-003</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-004"><span title="Redis Integration for Cache, PubSub, and Vector Search • RFC-004" class="linkLabel_WmDU">Redis Integration for Cache, PubSub, and Vector Search • RFC-004</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-005"><span title="ClickHouse Integration for Time Series Analytics • RFC-005" class="linkLabel_WmDU">ClickHouse Integration for Time Series Analytics • RFC-005</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-006"><span title="RFC-006 Admin CLI" class="linkLabel_WmDU">RFC-006 Admin CLI</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-007"><span title="RFC-007 Cache Strategies" class="linkLabel_WmDU">RFC-007 Cache Strategies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-008"><span title="RFC-008 Plugin Architecture" class="linkLabel_WmDU">RFC-008 Plugin Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/prism-data-layer/rfc/rfc-009"><span title="Distributed Reliability Data Patterns • RFC-009" class="linkLabel_WmDU">Distributed Reliability Data Patterns • RFC-009</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-010"><span title="Admin Protocol with OIDC Authentication • RFC-010" class="linkLabel_WmDU">Admin Protocol with OIDC Authentication • RFC-010</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-011"><span title="Data Proxy Authentication (Input/Output) • RFC-011" class="linkLabel_WmDU">Data Proxy Authentication (Input/Output) • RFC-011</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-012"><span title="Prism Network Gateway (prism-netgw) - Multi-Region Control Plane • RFC-012" class="linkLabel_WmDU">Prism Network Gateway (prism-netgw) - Multi-Region Control Plane • RFC-012</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-013"><span title="Neptune Graph Backend Implementation • RFC-013" class="linkLabel_WmDU">Neptune Graph Backend Implementation • RFC-013</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-014"><span title="Layered Data Access Patterns • RFC-014" class="linkLabel_WmDU">Layered Data Access Patterns • RFC-014</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-015"><span title="Plugin Acceptance Test Framework (Interface-Based Testing) • RFC-015" class="linkLabel_WmDU">Plugin Acceptance Test Framework (Interface-Based Testing) • RFC-015</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-016"><span title="Local Development Infrastructure • RFC-016" class="linkLabel_WmDU">Local Development Infrastructure • RFC-016</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-017"><span title="Multicast Registry Pattern • RFC-017" class="linkLabel_WmDU">Multicast Registry Pattern • RFC-017</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-018"><span title="POC Implementation Strategy • RFC-018" class="linkLabel_WmDU">POC Implementation Strategy • RFC-018</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-019"><span title="Pattern SDK Authorization Layer - Token Validation and Policy Enforcement • RFC-019" class="linkLabel_WmDU">Pattern SDK Authorization Layer - Token Validation and Policy Enforcement • RFC-019</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-020"><span title="Streaming HTTP Listener - API-Specific Adapter Pattern • RFC-020" class="linkLabel_WmDU">Streaming HTTP Listener - API-Specific Adapter Pattern • RFC-020</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-021"><span title="POC 1 - Three Minimal Plugins Implementation Plan • RFC-021" class="linkLabel_WmDU">POC 1 - Three Minimal Plugins Implementation Plan • RFC-021</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-022"><span title="Core Pattern SDK - Build System and Physical Code Layout • RFC-022" class="linkLabel_WmDU">Core Pattern SDK - Build System and Physical Code Layout • RFC-022</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-023"><span title="Publish Snapshotter Plugin - Write-Only Event Buffering with Pagination • RFC-023" class="linkLabel_WmDU">Publish Snapshotter Plugin - Write-Only Event Buffering with Pagination • RFC-023</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-024"><span title="Distributed Session Store Pattern - Cross-Region Session Management • RFC-024" class="linkLabel_WmDU">Distributed Session Store Pattern - Cross-Region Session Management • RFC-024</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-025"><span title="Pattern SDK Architecture - Backend Drivers and Concurrency Primitives • RFC-025" class="linkLabel_WmDU">Pattern SDK Architecture - Backend Drivers and Concurrency Primitives • RFC-025</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-026"><span title="POC 1 - KeyValue with MemStore Implementation Plan (Original) • RFC-026" class="linkLabel_WmDU">POC 1 - KeyValue with MemStore Implementation Plan (Original) • RFC-026</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-027"><span title="Namespace Configuration and Client Request Flow • RFC-027" class="linkLabel_WmDU">Namespace Configuration and Client Request Flow • RFC-027</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-028"><span title="prism-probe - CLI Client for Testing and Debugging • RFC-028" class="linkLabel_WmDU">prism-probe - CLI Client for Testing and Debugging • RFC-028</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-029"><span title="Load Testing Framework Evaluation and Strategy • RFC-029" class="linkLabel_WmDU">Load Testing Framework Evaluation and Strategy • RFC-029</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/prism-data-layer/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Distributed Reliability Data Patterns • RFC-009</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="docMetadata_NQcq"><div class="metadataRow_PvZM"><span class="metadataItem_RMFE info_Qo8L"><strong>Status:</strong> <!-- -->Proposed</span><span class="metadataItem_RMFE"><strong>Author:</strong> <!-- -->System</span><span class="metadataItem_RMFE"><strong>Created:</strong> <!-- -->Oct 7, 2025</span></div></div><div class="theme-doc-markdown markdown"><header><h1>RFC-009: Distributed Reliability Data Patterns</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>This RFC documents high-level distributed reliability patterns that push complexity into the data access layer. These patterns typically require either <strong>multiple data stores</strong> or <strong>specific patterned access</strong> on a single data store, and are critical for building scalable, fault-tolerant systems.</p>
<p><strong>Core Philosophy</strong>: Rather than implementing complex reliability logic in every application, Prism provides these patterns as <strong>data access abstractions</strong>, making them easy to adopt and operationally sound.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-priority">Implementation Priority<a href="#implementation-priority" class="hash-link" aria-label="Direct link to Implementation Priority" title="Direct link to Implementation Priority" translate="no">​</a></h2>
<p>Patterns are ordered by complexity and value. Prism will implement in this order:</p>





























































<table><thead><tr><th>Priority</th><th>Pattern</th><th>Complexity</th><th>Value</th><th>Status</th></tr></thead><tbody><tr><td><strong>P0</strong></td><td>Claim Check</td><td>Low</td><td>High</td><td>Planned for Phase 1</td></tr><tr><td><strong>P0</strong></td><td>Outbox</td><td>Low</td><td>High</td><td>Planned for Phase 1</td></tr><tr><td><strong>P1</strong></td><td>Write-Ahead Log</td><td>Medium</td><td>High</td><td>Planned for Phase 2</td></tr><tr><td><strong>P1</strong></td><td>Tiered Storage</td><td>Medium</td><td>Medium</td><td>Planned for Phase 2</td></tr><tr><td><strong>P1</strong></td><td>CDC</td><td>Medium</td><td>High</td><td>Planned for Phase 2</td></tr><tr><td><strong>P2</strong></td><td>Event Sourcing</td><td>High</td><td>Medium</td><td>Planned for Phase 3</td></tr><tr><td><strong>P2</strong></td><td>CQRS</td><td>High</td><td>Medium</td><td>Planned for Phase 3</td></tr></tbody></table>
<p><strong>Complexity ratings</strong>:</p>
<ul>
<li><strong>Low</strong>: Single-backend or simple orchestration, &lt;1 week implementation</li>
<li><strong>Medium</strong>: Multi-backend coordination, background workers, 2-4 weeks implementation</li>
<li><strong>High</strong>: Complex state management, multiple projections, 4-8 weeks implementation</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-catalog">Pattern Catalog<a href="#pattern-catalog" class="hash-link" aria-label="Direct link to Pattern Catalog" title="Direct link to Pattern Catalog" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-tiered-storage-pattern">1. Tiered Storage Pattern<a href="#1-tiered-storage-pattern" class="hash-link" aria-label="Direct link to 1. Tiered Storage Pattern" title="Direct link to 1. Tiered Storage Pattern" translate="no">​</a></h3>
<p><strong>Problem</strong>: Hot data (recent, frequently accessed) requires expensive, fast storage. Cold data (old, rarely accessed) wastes resources on premium storage.</p>
<p><strong>Solution</strong>: Automatically migrate data between hot/warm/cold storage tiers based on access patterns and age.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture" translate="no">​</a></h4>
<p>┌─────────────────────────────────────────────────────────────┐
│                    Application Layer                        │
│              (Sees unified interface)                       │
└─────────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────┐
│              Prism Tiered Storage DAL                       │
│                                                             │
│  ┌──────────┐      ┌──────────┐      ┌──────────┐         │
│  │   Hot    │ ───► │   Warm   │ ───► │   Cold   │         │
│  │  Tier    │      │   Tier   │      │   Tier   │         │
│  └──────────┘      └──────────┘      └──────────┘         │
│       │                 │                 │                │
└───────┼─────────────────┼─────────────────┼────────────────┘
│                 │                 │
▼                 ▼                 ▼
┌────────┐       ┌──────────┐     ┌──────────┐
│ Redis  │       │ Postgres │     │   S3     │
│ (ms)   │       │ (10ms)   │     │ (100ms)  │
└────────┘       └──────────┘     └──────────┘</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Prism Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>.config.yaml</h1>
<p>namespaces:</p>
<ul>
<li>
<p>name: user-activity-logs
pattern: tiered-storage</p>
<h1>Reference store tracks which tier holds each key</h1>
<p>reference_store:
backend: postgres
table: tier_metadata</p>
<h1>Schema: (key, tier, last_access, access_count, size)</h1>
<p>tiers:
hot:
backend: redis
ttl: 86400  # 1 day
capacity: 10GB</p>
<p>warm:
backend: postgres
ttl: 2592000  # 30 days
capacity: 1TB</p>
<p>cold:
backend: s3
ttl: null  # Forever
lifecycle:
glacier_after: 7776000  # 90 days</p>
<p>promotion_rules:</p>
<ul>
<li>
<p>condition: access_count &gt; 10
action: promote_to_hot</p>
</li>
<li>
<p>condition: age &gt; 1_day AND tier == hot
action: demote_to_warm</p>
</li>
<li>
<p>condition: age &gt; 30_days AND tier == warm
action: demote_to_cold</p>
</li>
</ul>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Client Code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>// Application sees unified interface
let log = client.get(&quot;user-activity-logs&quot;, &quot;user:12345:2025-01-15&quot;).await?;</p>
<p>// Prism automatically:
// 1. Checks hot tier (Redis) - CACHE MISS
// 2. Checks warm tier (Postgres) - HIT
// 3. Returns result
// 4. Optionally promotes to hot tier (if access_count &gt; 10)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Key Characteristics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Automatic migration**: No application logic needed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Transparent access**: Applications don&#x27;t know which tier serves the request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Cost optimization**: Pay for performance only where needed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Tunable policies**: Per-namespace tier rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Use Cases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Time-series data**: Recent metrics in Redis, historical in S3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **User sessions**: Active in Redis, archived in Postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Log aggregation**: Hot logs searchable, cold logs compressed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 2. Write-Ahead Log (WAL) Pattern</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Problem**: Direct writes to databases can be slow and block application threads. Need durability without sacrificing write latency.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Solution**: Write to fast, durable append-only log first; apply to database asynchronously.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**CRITICAL**: WAL requires a **durable** queue backend (Kafka, NATS JetStream). Basic NATS (in-memory) is NOT sufficient for WAL patterns as it doesn&#x27;t provide durability guarantees.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Architecture</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                   Application                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              │ write(key, value)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Prism WAL DAL                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. Append to WAL (Kafka/NATS) ◄──────┐                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. Return success to client          │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. Async apply to database ──────────┘                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │ (fast, durable)            │ (async, replayed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ▼                            ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ┌────────┐                   ┌──────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │ Kafka  │                   │ Postgres │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │ (1ms)  │                   │ (10ms)   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └────────┘                   └──────────┘</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prism-configuration">Prism Configuration<a href="#prism-configuration" class="hash-link" aria-label="Direct link to Prism Configuration" title="Direct link to Prism Configuration" translate="no">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">writes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> write</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ahead</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">wal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka  </span><span class="token comment" style="color:#999988;font-style:italic"># or nats-jetstream (MUST be durable!)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">topic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">wal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">retention</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">604800</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 7 days</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">replication</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Durability: survive 2 broker failures</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Apply strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">apply_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> async  </span><span class="token comment" style="color:#999988;font-style:italic"># or sync, hybrid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">batch_size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">batch_timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Consumer-style compute (replay, compaction, transformations)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">consumers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">applier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> database_writer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">parallelism</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> compactor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> log_compactor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">strategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keep_latest  </span><span class="token comment" style="color:#999988;font-style:italic"># For key-value style data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 3600s  </span><span class="token comment" style="color:#999988;font-style:italic"># Compact hourly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Crash recovery</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">checkpoint_interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">consistency</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">read_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wal_first  </span><span class="token comment" style="color:#999988;font-style:italic"># Read from WAL if not yet applied</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">durability</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">wal_fsync</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Kafka fsync before ack</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="client-code">Client Code<a href="#client-code" class="hash-link" aria-label="Direct link to Client Code" title="Direct link to Client Code" translate="no">​</a></h4>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Write returns immediately after WAL append</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;order-writes&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;order:789&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> order_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ✅ Durable in Kafka (1ms)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ⏳ Applying to Postgres asynchronously</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Read checks WAL first, then database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;order-writes&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;order:789&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Returns even if not yet applied to Postgres</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="key-characteristics">Key Characteristics<a href="#key-characteristics" class="hash-link" aria-label="Direct link to Key Characteristics" title="Direct link to Key Characteristics" translate="no">​</a></h4>
<ul>
<li><strong>Fast writes</strong>: 1-2ms (Kafka append) vs 10-20ms (database write)</li>
<li><strong>Durability</strong>: Kafka replication ensures no data loss</li>
<li><strong>Crash recovery</strong>: Replay WAL from last checkpoint</li>
<li><strong>Read-your-writes</strong>: Reads check WAL for unapplied writes</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases">Use Cases<a href="#use-cases" class="hash-link" aria-label="Direct link to Use Cases" title="Direct link to Use Cases" translate="no">​</a></h4>
<ul>
<li><strong>High-throughput writes</strong>: Order processing, financial transactions</li>
<li><strong>Event sourcing</strong>: Event log as source of truth</li>
<li><strong>Database migration</strong>: Replay WAL to populate new database</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-claim-check-pattern">3. Claim Check Pattern<a href="#3-claim-check-pattern" class="hash-link" aria-label="Direct link to 3. Claim Check Pattern" title="Direct link to 3. Claim Check Pattern" translate="no">​</a></h3>
<p><strong>Problem</strong>: Messaging systems (Kafka, NATS, SQS) have message size limits (1MB-10MB). Large payloads (images, videos, ML models) can&#x27;t be published directly.</p>
<p><strong>Solution</strong>: Store large payloads in object storage; publish reference (claim check) to queue.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-1">Architecture<a href="#architecture-1" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture" translate="no">​</a></h4>
<p>┌─────────────────────────────────────────────────────────┐
│                   Producer                              │
└─────────────────────────────────────────────────────────┘
│
│ publish(event)
▼
┌─────────────────────────────────────────────────────────┐
│            Prism Claim Check DAL                        │
│                                                         │
│  1. if payload &gt; threshold:                            │
│     - Store payload in S3                              │
│     - Generate claim_check_id                          │
│     - Publish {claim_check_id, metadata} to Kafka      │
│  2. else:                                              │
│     - Publish payload directly to Kafka                │
│                                                         │
└─────────────────────────────────────────────────────────┘
│                            │
│ (small: pointer)           │ (large: full data)
▼                            ▼
┌────────┐                   ┌──────────┐
│ Kafka  │                   │   S3     │
│        │                   │          │
└────────┘                   └──────────┘
│
▼
┌─────────────────────────────────────────────────────────┐
│                   Consumer                              │
│                                                         │
│  1. Receive message from Kafka                         │
│  2. if has claim_check_id:                             │
│     - Fetch payload from S3                            │
│  3. Process full payload                               │
│                                                         │
└─────────────────────────────────────────────────────────┘</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Prism Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>namespaces:</p>
<ul>
<li>
<p>name: video-processing-events
pattern: claim-check
backend: kafka</p>
<p>claim_check:
threshold: 1MB  # Payloads &gt; 1MB go to S3</p>
<p>storage:
backend: s3
bucket: prism-claim-checks
prefix: video-events/
ttl: 604800  # 7 days (match Kafka retention)</p>
<p>message:
include_metadata: true  # Include size, content_type in queue message
compression: gzip</p>
<h1>Automatic cleanup</h1>
<p>cleanup:
on_consume: true  # Delete S3 object after consumer acks</p>
<h1>OR retain for replay</h1>
<p>on_consume: false
retention: 604800  # 7 days</p>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Client Code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>// Producer: Prism handles claim check automatically
let event = VideoProcessingEvent {
video_id: &quot;vid123&quot;,
raw_video: vec![0u8; 50_000_000],  // 50MB - exceeds threshold
};</p>
<p>client.publish(&quot;video-processing-events&quot;, event).await?;
// Prism:
// 1. Detects payload &gt; 1MB
// 2. Stores raw_video in S3 → claim_check_id = &quot;s3://prism-claim-checks/video-events/abc123&quot;
// 3. Publishes to Kafka: { video_id: &quot;vid123&quot;, claim_check_id: &quot;abc123&quot;, size: 50MB }</p>
<p>// Consumer: Prism fetches claim check automatically
let event: VideoProcessingEvent = client.consume(&quot;video-processing-events&quot;).await?;
// Prism:
// 1. Receives Kafka message with claim_check_id
// 2. Fetches raw_video from S3
// 3. Reconstructs full VideoProcessingEvent
// 4. Returns to consumer</p>
<p>assert_eq!(event.raw_video.len(), 50_000_000);</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Key Characteristics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Transparent**: Applications don&#x27;t implement claim check logic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Automatic threshold**: Prism decides when to use S3 vs inline payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Lifecycle management**: Auto-cleanup after consumption or TTL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Compression**: Reduce S3 storage costs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Use Cases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Media processing**: Images, videos, audio files in event streams</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **ML pipelines**: Model weights, training datasets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **ETL pipelines**: Large CSV/Parquet files in data pipelines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Document workflows**: PDF rendering, OCR processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 4. Event Sourcing Pattern</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Problem**: Traditional CRUD loses history. Need to reconstruct state at any point in time, audit all changes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Solution**: Store all state changes as immutable events; materialize current state by replaying events.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Architecture</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                   Application                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │ command                    │ query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ▼                            ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────┐         ┌──────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Command Handler │         │  Query Handler   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                  │         │                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Append Event    │         │  Read View       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────┘         └──────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ▼                            ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────┐         ┌──────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Event Store     │ ──────► │ Materialized     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  (Kafka/NATS)    │ replay  │ View (Postgres)  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                  │         │                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ - Immutable      │         │ - Current state  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ - Append-only    │         │ - Projections    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ - Full history   │         │ - Queryable      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────┘         └──────────────────┘</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prism-configuration-1">Prism Configuration<a href="#prism-configuration-1" class="hash-link" aria-label="Direct link to Prism Configuration" title="Direct link to Prism Configuration" translate="no">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bank</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">account</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sourcing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">event_store</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">topic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bank</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">account</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">retention</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> infinite  </span><span class="token comment" style="color:#999988;font-style:italic"># Keep all events forever</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">materialized_views</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">balances</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">projection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          CREATE TABLE account_balances (</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            account_id TEXT PRIMARY KEY,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            balance BIGINT NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            version BIGINT NOT NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          );</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">event_handlers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">event</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AccountCreated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              INSERT INTO account_balances (account_id, balance, version)</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              VALUES ($event.account_id, 0, 1);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">event</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MoneyDeposited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              UPDATE account_balances</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              SET balance = balance + $event.amount,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                  version = version + 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              WHERE account_id = $event.account_id;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">event</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MoneyWithdrawn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              UPDATE account_balances</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              SET balance = balance - $event.amount,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                  version = version + 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              WHERE account_id = $event.account_id;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">snapshots</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Snapshot every 100 events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="client-code-1">Client Code<a href="#client-code-1" class="hash-link" aria-label="Direct link to Client Code" title="Direct link to Client Code" translate="no">​</a></h4>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Append events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">append_event</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;bank-account-events&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">BankAccountEvent</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">AccountCreated</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;acct123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    owner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Alice&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timestamp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">append_event</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;bank-account-events&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">BankAccountEvent</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">MoneyDeposited</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    account_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;acct123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    amount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timestamp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Query materialized view</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> balance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i64</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;account-balances&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;acct123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Time-travel: replay events up to specific timestamp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> balance_yesterday </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">query_at_time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;account-balances&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;acct123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> yesterday</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Full audit trail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> events </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_event_history</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;bank-account-events&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;acct123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> event </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> events </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">println!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;{:?}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Full history of account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="key-characteristics-1">Key Characteristics<a href="#key-characteristics-1" class="hash-link" aria-label="Direct link to Key Characteristics" title="Direct link to Key Characteristics" translate="no">​</a></h4>
<ul>
<li><strong>Immutable events</strong>: Never update or delete events</li>
<li><strong>Full audit trail</strong>: Complete history of state changes</li>
<li><strong>Time-travel</strong>: Reconstruct state at any point in time</li>
<li><strong>Snapshots</strong>: Avoid replaying millions of events</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases-1">Use Cases<a href="#use-cases-1" class="hash-link" aria-label="Direct link to Use Cases" title="Direct link to Use Cases" translate="no">​</a></h4>
<ul>
<li><strong>Financial systems</strong>: Account balances, transactions</li>
<li><strong>Inventory management</strong>: Stock levels, warehouse movements</li>
<li><strong>User management</strong>: Profile changes, permission grants</li>
<li><strong>Collaboration tools</strong>: Document edits, comments</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-change-data-capture-cdc-pattern">5. Change Data Capture (CDC) Pattern<a href="#5-change-data-capture-cdc-pattern" class="hash-link" aria-label="Direct link to 5. Change Data Capture (CDC) Pattern" title="Direct link to 5. Change Data Capture (CDC) Pattern" translate="no">​</a></h3>
<p><strong>Problem</strong>: Need to replicate database changes to other systems (search indexes, caches, analytics warehouses) without dual writes.</p>
<p><strong>Solution</strong>: Capture database transaction log; stream changes as events.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="change-notification-flow">Change Notification Flow<a href="#change-notification-flow" class="hash-link" aria-label="Direct link to Change Notification Flow" title="Direct link to Change Notification Flow" translate="no">​</a></h4>
<!-- -->
<p><strong>Key Change Notification Patterns:</strong></p>
<ol>
<li><strong>Cache Invalidation</strong>: UPDATE/DELETE → Invalidate cache entries</li>
<li><strong>Search Indexing</strong>: INSERT/UPDATE → Update search index</li>
<li><strong>Analytics Sync</strong>: All changes → Append to data warehouse</li>
<li><strong>Webhook Notifications</strong>: Filtered changes → Notify external systems</li>
<li><strong>Audit Trail</strong>: All changes → Append to immutable log</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-2">Architecture<a href="#architecture-2" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture" translate="no">​</a></h4>
<p>┌─────────────────────────────────────────────────────────┐
│                   Application                           │
│               (Normal CRUD operations)                  │
└─────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────┐
│                   PostgreSQL                            │
│                                                         │
│  ┌───────────────────────────────────────┐             │
│  │  Write-Ahead Log (WAL)                │             │
│  │  - INSERT INTO users ...              │             │
│  │  - UPDATE orders SET status = ...     │             │
│  └───────────────────────────────────────┘             │
└─────────────────────────────────────────────────────────┘
│
│ (logical replication)
▼
┌─────────────────────────────────────────────────────────┐
│            Prism CDC Connector                          │
│            (Debezium-style)                             │
│                                                         │
│  1. Read WAL via replication slot                      │
│  2. Parse changes (INSERT/UPDATE/DELETE)               │
│  3. Publish to Kafka topic                             │
│                                                         │
└─────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────┐
│                 Kafka (CDC Events)                      │
└─────────────────────────────────────────────────────────┘
│              │              │
▼              ▼              ▼
┌─────────┐    ┌─────────┐    ┌─────────────┐
│  Redis  │    │ Elastic │    │ ClickHouse  │
│ (Cache) │    │ (Search)│    │ (Analytics) │
└─────────┘    └─────────┘    └─────────────┘</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Prism Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>namespaces:</p>
<ul>
<li>
<p>name: user-cdc
pattern: change-data-capture</p>
<p>source:
backend: postgres
database: prod
schema: public
tables:
- users
- user_profiles</p>
<h1>Postgres-specific CDC config</h1>
<p>replication_slot: prism_cdc_slot
publication: prism_publication</p>
<p>sink:
backend: kafka
topic_prefix: cdc.postgres.public</p>
<h1>Results in topics:</h1>
<h1>- cdc.postgres.public.users</h1>
<h1>- cdc.postgres.public.user_profiles</h1>
<p>message_format: json  # or avro, protobuf
include_old_value: true  # For UPDATEs, include old row</p>
<h1>Downstream consumers</h1>
<p>consumers:</p>
<ul>
<li>
<p>name: user-cache
backend: redis
operations: [INSERT, UPDATE, DELETE]
key_pattern: &quot;user:{id}&quot;</p>
</li>
<li>
<p>name: user-search
backend: elasticsearch
operations: [INSERT, UPDATE, DELETE]
index: users</p>
</li>
<li>
<p>name: user-analytics
backend: clickhouse
operations: [INSERT, UPDATE]
table: user_events</p>
</li>
</ul>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### CDC Event Format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>{
&quot;op&quot;: &quot;u&quot;,  // c=create, u=update, d=delete
&quot;source&quot;: {
&quot;db&quot;: &quot;prod&quot;,
&quot;schema&quot;: &quot;public&quot;,
&quot;table&quot;: &quot;users&quot;,
&quot;lsn&quot;: 123456789
},
&quot;before&quot;: {
&quot;id&quot;: 42,
&quot;email&quot;: &quot;<a href="mailto:old@example.com" target="_blank" rel="noopener noreferrer">old@example.com</a>&quot;,
&quot;name&quot;: &quot;Old Name&quot;
},
&quot;after&quot;: {
&quot;id&quot;: 42,
&quot;email&quot;: &quot;<a href="mailto:new@example.com" target="_blank" rel="noopener noreferrer">new@example.com</a>&quot;,
&quot;name&quot;: &quot;New Name&quot;
},
&quot;ts_ms&quot;: 1704931200000
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Client Code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Application does normal database operations</h1>
<p>db.execute(&quot;UPDATE users SET email = &#x27;<a href="mailto:new@example.com" target="_blank" rel="noopener noreferrer">new@example.com</a>&#x27; WHERE id = 42&quot;)</p>
<h1>Prism CDC automatically:</h1>
<h1>1. Captures change from Postgres WAL</h1>
<h1>2. Publishes to Kafka: cdc.postgres.public.users</h1>
<h1>3. Updates Redis cache: user:42</h1>
<h1>4. Updates Elasticsearch: users index</h1>
<h1>5. Inserts into ClickHouse: user_events table</h1>
<h1>No dual writes needed!</h1>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Key Characteristics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Single source of truth**: Database WAL is authoritative</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **No dual writes**: Avoid consistency issues</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Guaranteed delivery**: Replication slot ensures no missed changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Schema evolution**: Handle ALTER TABLE gracefully</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Use Cases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Cache invalidation**: Keep Redis in sync with Postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Search indexing**: Elasticsearch follows database changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Data warehousing**: Stream changes to ClickHouse/Snowflake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Microservices sync**: Replicate data across service boundaries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 6. CQRS (Command Query Responsibility Segregation)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Problem**: Read and write workloads have different scaling characteristics. Single database struggles with both.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Solution**: Separate write model (optimized for transactions) from read model (optimized for queries).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Architecture</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────── ──────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                   Application                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │ commands                   │ queries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ▼                            ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────┐         ┌──────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Write Model     │         │  Read Model      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  (Postgres)      │ ──────► │  (Postgres +     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                  │ events  │   Elasticsearch) │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Normalized    │         │                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - ACID          │         │  - Denormalized  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Low volume     │         │  - Eventually    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                  │         │    consistent    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                  │         │  - High volume   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────┘         └──────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                            ▲</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         └────────► Kafka ────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    (Change events)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prism-configuration-2">Prism Configuration<a href="#prism-configuration-2" class="hash-link" aria-label="Direct link to Prism Configuration" title="Direct link to Prism Configuration" translate="no">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> product</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">catalog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cqrs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">write_model</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> normalized</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> products</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> categories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> inventory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">consistency</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> strong</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">read_models</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> product</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">search</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> elasticsearch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">index</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> products</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">denormalization</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;product_id&quot;: product.id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;name&quot;: product.name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;category_name&quot;: category.name,  # Joined from categories</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;in_stock&quot;: inventory.quantity &gt; 0  # Computed</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> product</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">listings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres_replica</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">materialized_view</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          CREATE MATERIALIZED VIEW product_listings AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          SELECT p.id, p.name, c.name AS category, i.quantity</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          FROM products p</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          JOIN categories c ON p.category_id = c.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          JOIN inventory i ON p.id = i.product_id;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">refresh_strategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> on_change  </span><span class="token comment" style="color:#999988;font-style:italic"># or periodic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">synchronization</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">topic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> product</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">lag_tolerance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1000ms  </span><span class="token comment" style="color:#999988;font-style:italic"># Alert if read model lags &gt; 1s</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="client-code-2">Client Code<a href="#client-code-2" class="hash-link" aria-label="Direct link to Client Code" title="Direct link to Client Code" translate="no">​</a></h4>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Write: Goes to write model (Postgres)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">execute_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;product-catalog&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">CreateProduct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Widget&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    category_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    price</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1999</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Prism:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 1. Inserts into products table (write model)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 2. Publishes ProductCreated event to Kafka</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 3. Async updates read models (Elasticsearch, materialized view)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Read: Goes to read model (Elasticsearch)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">search</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;product-search&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;widget&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Returns denormalized, pre-joined data for fast search</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Another read: Goes to different read model (Postgres replica)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> listings </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;product-listings&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> filters</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="key-characteristics-2">Key Characteristics<a href="#key-characteristics-2" class="hash-link" aria-label="Direct link to Key Characteristics" title="Direct link to Key Characteristics" translate="no">​</a></h4>
<ul>
<li><strong>Independent scaling</strong>: Scale write DB for transactions, read DBs for queries</li>
<li><strong>Optimized schemas</strong>: Normalized writes, denormalized reads</li>
<li><strong>Eventual consistency</strong>: Acceptable lag between write and read models</li>
<li><strong>Multiple read models</strong>: Same data, different projections</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases-2">Use Cases<a href="#use-cases-2" class="hash-link" aria-label="Direct link to Use Cases" title="Direct link to Use Cases" translate="no">​</a></h4>
<ul>
<li><strong>E-commerce</strong>: Product catalog (complex queries, high read volume)</li>
<li><strong>Social media</strong>: Posts (write once, read many)</li>
<li><strong>Analytics dashboards</strong>: Pre-aggregated metrics</li>
<li><strong>Reporting</strong>: Historical data in OLAP format</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-outbox-pattern">7. Outbox Pattern<a href="#7-outbox-pattern" class="hash-link" aria-label="Direct link to 7. Outbox Pattern" title="Direct link to 7. Outbox Pattern" translate="no">​</a></h3>
<p><strong>Problem</strong>: Need to atomically update database AND publish event. Dual writes can fail partially (database succeeds, Kafka publish fails).</p>
<p><strong>Solution</strong>: Write event to outbox table in same transaction as business data; separate process publishes events.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-3">Architecture<a href="#architecture-3" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture" translate="no">​</a></h4>
<p>┌─────────────────────────────────────────────────────────┐
│                   Application                           │
└─────────────────────────────────────────────────────────┘
│
│ BEGIN TRANSACTION
▼
┌─────────────────────────────────────────────────────────┐
│                   PostgreSQL                            │
│                                                         │
│  ┌─────────────────────────────────────────┐           │
│  │  Business Table                         │           │
│  │  INSERT INTO orders (id, status, ...)   │           │
│  └─────────────────────────────────────────┘           │
│                                                         │
│  ┌─────────────────────────────────────────┐           │
│  │  Outbox Table                           │           │
│  │  INSERT INTO outbox (event_type,        │           │
│  │                      payload, ...)      │           │
│  └─────────────────────────────────────────┘           │
│                                                         │
│  COMMIT TRANSACTION                                     │
└─────────────────────────────────────────────────────────┘
│
│ (polling or CDC)
▼
┌─────────────────────────────────────────────────────────┐
│            Prism Outbox Publisher                       │
│                                                         │
│  1. Poll outbox table for unpublished events           │
│  2. Publish to Kafka                                   │
│  3. Mark as published (or delete)                      │
│                                                         │
└─────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────┐
│                 Kafka (Events)                          │
└─────────────────────────────────────────────────────────┘</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Prism Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>namespaces:</p>
<ul>
<li>
<p>name: order-service
pattern: outbox</p>
<p>database:
backend: postgres</p>
<p>outbox:
table: outbox
schema: |
CREATE TABLE outbox (
id BIGSERIAL PRIMARY KEY,
event_type TEXT NOT NULL,
aggregate_id TEXT NOT NULL,
payload JSONB NOT NULL,
created_at TIMESTAMP DEFAULT NOW(),
published_at TIMESTAMP
);
CREATE INDEX idx_outbox_unpublished ON outbox (created_at) WHERE published_at IS NULL;</p>
<p>publisher:
mode: polling  # or cdc
interval: 100ms
batch_size: 1000</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">destination:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  backend: kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  topic_pattern: &quot;{event_type}&quot;  # OrderCreated → order-created topic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cleanup:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  strategy: delete  # or mark_published</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  retention: 86400  # Keep published events for 1 day</span><br></span></code></pre></div></div>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Client Code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>// Application: Single transaction
let tx = db.begin().await?;</p>
<p>// 1. Insert business data
tx.execute(
&quot;INSERT INTO orders (id, user_id, total) VALUES ($1, $2, $3)&quot;,
&amp;[&amp;order_id, &amp;user_id, &amp;total],
).await?;</p>
<p>// 2. Insert into outbox (same transaction)
tx.execute(
&quot;INSERT INTO outbox (event_type, aggregate_id, payload) VALUES ($1, $2, $3)&quot;,
&amp;[&quot;OrderCreated&quot;, &amp;order_id, &amp;json!({&quot;order_id&quot;: order_id, &quot;total&quot;: total})],
).await?;</p>
<p>// 3. Commit (atomic!)
tx.commit().await?;</p>
<p>// Prism Outbox Publisher:
// - Polls outbox table every 100ms
// - Finds unpublished events
// - Publishes to Kafka topic: order-created
// - Deletes from outbox (or marks published_at)</p>
<p>// Guaranteed: If order exists in database, event will be published.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Key Characteristics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Atomicity**: Event publishing guaranteed if transaction commits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **No dual writes**: Single transaction for database + outbox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **At-least-once delivery**: Outbox publisher may retry failed publishes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Cleanup**: Delete published events or mark with timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Use Cases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Order processing**: Guarantee OrderCreated event after order insertion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **User registration**: Guarantee UserRegistered event after user creation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Inventory updates**: Guarantee InventoryChanged event after stock update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Any transactional messaging**: Need ACID + event publishing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Pattern Selection Guide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Pattern | When to Use | Backends | Complexity |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|---------|-------------|----------|------------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| **Tiered Storage** | Hot/warm/cold data lifecycle | Redis + Postgres + S3 | Medium |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| **Write-Ahead Log** | High write throughput, durability | Kafka + Postgres | Medium |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| **Claim Check** | Large payloads in messaging | Kafka + S3 | Low |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| **Event Sourcing** | Full audit trail, time-travel | Kafka + Postgres | High |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| **CDC** | Sync database to cache/search/warehouse | Postgres + Kafka → (Redis/ES/ClickHouse) | Medium |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| **CQRS** | Different read/write scaling needs | Postgres + Elasticsearch | High |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| **Outbox** | Transactional messaging | Postgres + Kafka | Low |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Pattern Composition and Layering</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Key Insight**: Patterns can be **layered together** to create powerful distributed systems. Prism supports composing multiple patterns in a single namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Common Pattern Combinations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### 1. Claim Check + Pub/Sub Queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Use Case**: Video processing pipeline where videos are too large for Kafka, but you want pub/sub semantics.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>namespaces:</p>
<ul>
<li>
<p>name: video-processing
patterns:</p>
<ul>
<li>claim-check   # Layer 1: Handle large payloads</li>
<li>pub-sub       # Layer 2: Multiple consumers</li>
</ul>
<p>backend: kafka</p>
<p>claim_check:
threshold: 1MB
storage:
backend: s3
bucket: video-processing</p>
<h1>Claim check field is automatically injected</h1>
<p>claim_check_field: &quot;s3_reference&quot;</p>
<p>pub_sub:
consumer_groups:
- name: thumbnail-generator
- name: transcoder
- name: metadata-extractor</p>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**How it works**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Producer publishes large video (50MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Prism stores video in S3, generates `claim_check_id`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Prism publishes lightweight message to Kafka: `{video_id: &quot;abc&quot;, s3_reference: &quot;s3://...&quot;}`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. All consumer groups receive message with S3 reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. Each consumer fetches video from S3 independently</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### 2. Outbox + Claim Check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Use Case**: Transactionally publish large payloads (e.g., ML model weights after training).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>namespaces:</p>
<ul>
<li>
<p>name: ml-model-releases
patterns:</p>
<ul>
<li>outbox       # Layer 1: Transactional guarantees</li>
<li>claim-check  # Layer 2: Handle large model files</li>
</ul>
<p>database:
backend: postgres</p>
<p>outbox:
table: model_outbox</p>
<p>claim_check:
threshold: 10MB
storage:
backend: s3
bucket: ml-models
claim_check_field: &quot;model_s3_path&quot;</p>
<p>publisher:
destination:
backend: kafka
topic: model-releases</p>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**How it works**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Application saves model metadata + model weights to outbox table (single transaction)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Outbox publisher polls for new entries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. For each entry, Prism checks if payload &amp;gt; 10MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. If yes, stores model weights in S3, updates outbox entry with S3 path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. Publishes Kafka event with S3 reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. Consumers receive lightweight event, fetch model from S3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### 3. WAL + Tiered Storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Use Case**: High-throughput writes with automatic hot/warm/cold tiering.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>namespaces:</p>
<ul>
<li>
<p>name: user-activity
patterns:</p>
<ul>
<li>write-ahead-log  # Layer 1: Fast, durable writes</li>
<li>tiered-storage   # Layer 2: Cost-optimized storage</li>
</ul>
<p>wal:
backend: kafka
topic: activity-wal
consumers:
- name: tier-applier
type: tiered_storage_writer</p>
<p>reference_store:
backend: postgres
table: activity_tiers</p>
<p>tiers:
hot:
backend: redis
ttl: 86400
warm:
backend: postgres
ttl: 2592000
cold:
backend: s3</p>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**How it works**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Application writes activity log (fast Kafka append)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. WAL consumer reads from Kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Based on data freshness, writes to appropriate tier (hot = Redis)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Background tier migration moves data: hot → warm → cold</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. Reads check reference store to find current tier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### 4. CDC + CQRS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Use Case**: Keep read models in sync with write model using change data capture.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>namespaces:</p>
<ul>
<li>
<p>name: product-catalog
patterns:</p>
<ul>
<li>cqrs  # Layer 1: Separate read/write models</li>
<li>cdc   # Layer 2: Automatic sync via database WAL</li>
</ul>
<p>write_model:
backend: postgres
tables: [products, categories]</p>
<p>cdc:
source:
backend: postgres
tables: [products, categories]
sink:
backend: kafka
topic_prefix: product-cdc</p>
<p>read_models:</p>
<ul>
<li>
<p>name: product-search
backend: elasticsearch
sync_from: product-cdc.products</p>
</li>
<li>
<p>name: product-cache
backend: redis
sync_from: product-cdc.products</p>
</li>
</ul>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**How it works**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Application writes to Postgres (write model)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. CDC captures changes from Postgres WAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Publishes changes to Kafka topics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Read models (Elasticsearch, Redis) consume from Kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. Each read model stays in sync automatically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Pattern Layering Guidelines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**When to layer patterns:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ✅ Patterns address different concerns (e.g., Claim Check = payload size, Pub/Sub = routing)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ✅ Later patterns build on earlier patterns (e.g., Outbox → Claim Check → Kafka)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ✅ Combined complexity is manageable (two low-complexity patterns = medium complexity)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**When NOT to layer:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ❌ Patterns conflict (e.g., Event Sourcing + CQRS both define event storage)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ❌ Over-engineering (don&#x27;t layer patterns &quot;just in case&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ❌ Combined complexity exceeds team capability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Pattern Compatibility Matrix:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Pattern | Compatible With | Conflicts With |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|---------|-----------------|----------------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Claim Check | Pub/Sub, Outbox, CDC | - |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Outbox | Claim Check, CDC | Event Sourcing |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| WAL | Tiered Storage, CDC | Event Sourcing |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Tiered Storage | WAL, Claim Check | - |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| CDC | CQRS, Claim Check | - |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Event Sourcing | CQRS | Outbox, WAL |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| CQRS | CDC, Event Sourcing | - |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Prism Implementation Strategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 1. Pattern as Namespace Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Each pattern is a first-class `pattern` type in namespace config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>namespaces:</p>
<ul>
<li>name: my-data
pattern: tiered-storage  # or event-sourcing, cqrs, etc.
backend: multi  # Indicates multiple backends
<h1>Pattern-specific config follows</h1>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 2. Code Generation from Patterns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Prism generates:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Client SDKs**: Type-safe APIs for each pattern</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Proxy routes**: Pattern-specific request handlers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Background jobs**: Tier migration, outbox publishing, CDC streaming</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 3. Observability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pattern-specific metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Tiered Storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_tiered_storage_tier_size{namespace=&quot;user-activity-logs&quot;, tier=&quot;hot&quot;} 8.5e9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_tiered_storage_promotion_count{namespace=&quot;user-activity-logs&quot;} 1234</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Write-Ahead Log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_wal_lag_seconds{namespace=&quot;order-writes&quot;} 0.15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_wal_unapplied_entries{namespace=&quot;order-writes&quot;} 523</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Claim Check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_claim_check_stored_count{namespace=&quot;video-processing-events&quot;} 89</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_claim_check_storage_bytes{namespace=&quot;video-processing-events&quot;} 4.5e9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CDC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_cdc_replication_lag_ms{namespace=&quot;user-cdc&quot;, table=&quot;users&quot;} 120</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_cdc_events_published{namespace=&quot;user-cdc&quot;, table=&quot;users&quot;} 15234</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Outbox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_outbox_unpublished_count{namespace=&quot;order-service&quot;} 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_outbox_publish_latency_ms{namespace=&quot;order-service&quot;} 45</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enterprise-integration-patterns">Enterprise Integration Patterns<a href="#enterprise-integration-patterns" class="hash-link" aria-label="Direct link to Enterprise Integration Patterns" title="Direct link to Enterprise Integration Patterns" translate="no">​</a></h3>
<ul>
<li><a href="https://www.enterpriseintegrationpatterns.com/" target="_blank" rel="noopener noreferrer">Enterprise Integration Patterns (Hohpe &amp; Woolf)</a></li>
<li><a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/StoreInLibrary.html" target="_blank" rel="noopener noreferrer">Claim Check Pattern</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="event-sourcing--cqrs">Event Sourcing &amp; CQRS<a href="#event-sourcing--cqrs" class="hash-link" aria-label="Direct link to Event Sourcing &amp; CQRS" title="Direct link to Event Sourcing &amp; CQRS" translate="no">​</a></h3>
<ul>
<li><a href="https://martinfowler.com/eaaDev/EventSourcing.html" target="_blank" rel="noopener noreferrer">Event Sourcing (Martin Fowler)</a></li>
<li><a href="https://martinfowler.com/bliki/CQRS.html" target="_blank" rel="noopener noreferrer">CQRS (Martin Fowler)</a></li>
<li><a href="https://docs.axoniq.io/" target="_blank" rel="noopener noreferrer">Axon Framework Documentation</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="change-data-capture">Change Data Capture<a href="#change-data-capture" class="hash-link" aria-label="Direct link to Change Data Capture" title="Direct link to Change Data Capture" translate="no">​</a></h3>
<ul>
<li><a href="https://debezium.io/" target="_blank" rel="noopener noreferrer">Debezium Documentation</a></li>
<li><a href="https://www.postgresql.org/docs/current/logical-replication.html" target="_blank" rel="noopener noreferrer">PostgreSQL Logical Replication</a></li>
<li><a href="https://docs.confluent.io/platform/current/connect/index.html" target="_blank" rel="noopener noreferrer">Kafka Connect CDC</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="outbox-pattern">Outbox Pattern<a href="#outbox-pattern" class="hash-link" aria-label="Direct link to Outbox Pattern" title="Direct link to Outbox Pattern" translate="no">​</a></h3>
<ul>
<li><a href="https://microservices.io/patterns/data/transactional-outbox.html" target="_blank" rel="noopener noreferrer">Transactional Outbox (Microservices.io)</a></li>
<li><a href="https://debezium.io/documentation/reference/stable/transformations/outbox-event-router.html" target="_blank" rel="noopener noreferrer">Outbox Pattern (Debezium)</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="netflix-data-gateway">Netflix Data Gateway<a href="#netflix-data-gateway" class="hash-link" aria-label="Direct link to Netflix Data Gateway" title="Direct link to Netflix Data Gateway" translate="no">​</a></h3>
<ul>
<li>ADR-034: Product/Feature Sharding Strategy (Netflix-informed)</li>
<li>ADR-035: Connection Pooling</li>
<li>ADR-036: SQLite Config Storage</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="revision-history">Revision History<a href="#revision-history" class="hash-link" aria-label="Direct link to Revision History" title="Direct link to Revision History" translate="no">​</a></h2>
<ul>
<li>2025-10-08: Initial draft documenting 7 distributed reliability patterns</li>
<li>2025-10-09: Added change notification flow diagram to CDC pattern showing notification consumers and change types</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/jrepp/prism-data-layer/tree/main/docs-cms/../docs-cms/rfcs/rfc-009-distributed-reliability-patterns.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/prism-data-layer/rfc/rfc-008"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">RFC-008 Plugin Architecture</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/prism-data-layer/rfc/rfc-010"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Admin Protocol with OIDC Authentication • RFC-010</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#implementation-priority" class="table-of-contents__link toc-highlight">Implementation Priority</a></li><li><a href="#pattern-catalog" class="table-of-contents__link toc-highlight">Pattern Catalog</a><ul><li><a href="#1-tiered-storage-pattern" class="table-of-contents__link toc-highlight">1. Tiered Storage Pattern</a></li><li><a href="#3-claim-check-pattern" class="table-of-contents__link toc-highlight">3. Claim Check Pattern</a></li><li><a href="#5-change-data-capture-cdc-pattern" class="table-of-contents__link toc-highlight">5. Change Data Capture (CDC) Pattern</a></li><li><a href="#7-outbox-pattern" class="table-of-contents__link toc-highlight">7. Outbox Pattern</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a><ul><li><a href="#enterprise-integration-patterns" class="table-of-contents__link toc-highlight">Enterprise Integration Patterns</a></li><li><a href="#event-sourcing--cqrs" class="table-of-contents__link toc-highlight">Event Sourcing &amp; CQRS</a></li><li><a href="#change-data-capture" class="table-of-contents__link toc-highlight">Change Data Capture</a></li><li><a href="#outbox-pattern" class="table-of-contents__link toc-highlight">Outbox Pattern</a></li><li><a href="#netflix-data-gateway" class="table-of-contents__link toc-highlight">Netflix Data Gateway</a></li></ul></li><li><a href="#revision-history" class="table-of-contents__link toc-highlight">Revision History</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/intro">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/changelog">Change Log</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/adr">ADRs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/rfc">RFCs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/memos">Memos</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/prds">PRDs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Project</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div>Copyright © 2025 Prism. Built with Docusaurus.</div><div style="margin-top:0.5rem;font-size:0.875rem;opacity:0.8"><span>Version <!-- -->fc3d6ad</span><span> • </span><span>Built <!-- -->Oct 13, 2025, 10:35 AM PDT</span><span> • </span><span>Commit <!-- -->fc3d6ad</span></div></div></div></div></footer></div>
</body>
</html>