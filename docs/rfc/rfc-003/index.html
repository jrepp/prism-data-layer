<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-rfc docs-version-current docs-doc-page docs-doc-id-rfc-003" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Admin Interface for Prism | Prism</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jrepp.github.io/prism-data-layer/rfc/rfc-003"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" property="og:title" content="Admin Interface for Prism | Prism"><meta data-rh="true" name="description" content="Abstract"><meta data-rh="true" property="og:description" content="Abstract"><link data-rh="true" rel="icon" href="/prism-data-layer/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-003"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-003" hreflang="en"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-003" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Admin Interface for Prism • RFC-003","item":"https://jrepp.github.io/prism-data-layer/rfc/rfc-003"}]}</script><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes">
<meta name="theme-color" content="#6366f1">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="stylesheet" href="/prism-data-layer/assets/css/styles.73adf43b.css">
<script src="/prism-data-layer/assets/js/runtime~main.a67713af.js" defer="defer"></script>
<script src="/prism-data-layer/assets/js/main.a0e7c1d3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/prism-data-layer/"><div class="navbar__logo"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">Prism</b></a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/intro">Overview</a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/changelog">Change Log</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Documentation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/prism-data-layer/adr">ADRs (Architecture Decision Records)</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/prism-data-layer/rfc">RFCs (Request for Comments)</a></li><li><a class="dropdown__link" href="/prism-data-layer/memos">Memos (Technical Analysis)</a></li><li><a class="dropdown__link" href="/prism-data-layer/prds">PRDs (Product Requirements)</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="buildInfo_asc2"><span class="version_ADrX" title="Build: 7f44008">7f44008</span><span class="separator_VfCt">•</span><span class="buildTime_n1Nn" title="Last updated: Oct 14, 8:03 AM PDT">Oct 14, 8:03 AM PDT</span></div><div class="navbar__item"><a href="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml" target="_blank" rel="noopener noreferrer" title="GitHub Pages" style="display: flex; align-items: center; padding: 0 0.5rem;"><img src="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml/badge.svg" alt="Build" style="margin: 0;"></a></div><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_x44X"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/"><span title="Request for Comments (RFCs)" class="linkLabel_WmDU">Request for Comments (RFCs)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/prism-data-layer/rfc/rfc-001"><span title="RFC-001 to 010" class="categoryLinkLabel_W154">RFC-001 to 010</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-001"><span title="Prism Data Access Layer Architecture • RFC-001" class="linkLabel_WmDU">Prism Data Access Layer Architecture • RFC-001</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-002"><span title="Data Layer Interface Specification • RFC-002" class="linkLabel_WmDU">Data Layer Interface Specification • RFC-002</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/prism-data-layer/rfc/rfc-003"><span title="Admin Interface for Prism • RFC-003" class="linkLabel_WmDU">Admin Interface for Prism • RFC-003</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-004"><span title="Redis Integration for Cache, PubSub, and Vector Search • RFC-004" class="linkLabel_WmDU">Redis Integration for Cache, PubSub, and Vector Search • RFC-004</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-005"><span title="ClickHouse Integration for Time Series Analytics • RFC-005" class="linkLabel_WmDU">ClickHouse Integration for Time Series Analytics • RFC-005</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-006"><span title="RFC-006 Admin CLI" class="linkLabel_WmDU">RFC-006 Admin CLI</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-007"><span title="RFC-007 Cache Strategies" class="linkLabel_WmDU">RFC-007 Cache Strategies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-008"><span title="RFC-008 Plugin Architecture" class="linkLabel_WmDU">RFC-008 Plugin Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-009"><span title="Distributed Reliability Data Patterns • RFC-009" class="linkLabel_WmDU">Distributed Reliability Data Patterns • RFC-009</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-010"><span title="Admin Protocol with OIDC Authentication • RFC-010" class="linkLabel_WmDU">Admin Protocol with OIDC Authentication • RFC-010</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-011"><span title="RFC-011 to 020" class="categoryLinkLabel_W154">RFC-011 to 020</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-021"><span title="RFC-021 to 030" class="categoryLinkLabel_W154">RFC-021 to 030</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-031"><span title="RFC-031 to 040" class="categoryLinkLabel_W154">RFC-031 to 040</span></a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/prism-data-layer/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">RFC-001 to 010</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Admin Interface for Prism • RFC-003</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="docMetadata_NQcq"><div class="metadataRow_PvZM"><span class="metadataItem_RMFE info_Qo8L"><strong>Status:</strong> <!-- -->Proposed</span><span class="metadataItem_RMFE"><strong>Author:</strong> <!-- -->Platform Team</span><span class="metadataItem_RMFE"><strong>Created:</strong> <!-- -->Oct 7, 2025</span><span class="metadataItem_RMFE"><strong>Updated:</strong> <!-- -->Oct 7, 2025</span></div></div><div class="theme-doc-markdown markdown"><header><h1>Admin Interface for Prism</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a href="#abstract" class="hash-link" aria-label="Direct link to Abstract" title="Direct link to Abstract" translate="no">​</a></h2>
<p>This RFC specifies the administrative interface for Prism, enabling operators to manage configurations, monitor sessions, view backend health, and perform operational tasks. The design separates admin concerns from the data plane while maintaining consistency with Prism&#x27;s gRPC-first architecture.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation" translate="no">​</a></h2>
<p>Prism requires administrative capabilities beyond the data plane APIs. Operators need to:</p>
<ol>
<li><strong>Manage Configuration</strong>: Create, update, and delete client configurations</li>
<li><strong>Monitor Sessions</strong>: View active sessions, metrics, and troubleshoot issues</li>
<li><strong>Maintain System Health</strong>: Check backend status, drain connections, enable maintenance mode</li>
<li><strong>Audit Operations</strong>: Track administrative actions for compliance and debugging</li>
<li><strong>Visualize System State</strong>: Browser-accessible UI for non-CLI users</li>
</ol>
<p><strong>Goals:</strong></p>
<ul>
<li>Provide complete administrative control via gRPC API</li>
<li>Enable browser-based administration for broader accessibility</li>
<li>Maintain security isolation from data plane</li>
<li>Support audit logging for all administrative actions</li>
<li>Keep deployment simple with minimal dependencies</li>
</ul>
<p><strong>Non-Goals:</strong></p>
<ul>
<li>Real-time monitoring dashboards (use Prometheus/Grafana)</li>
<li>Complex workflow orchestration (use external tools)</li>
<li>Multi-cluster management (single cluster scope)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="proposed-design">Proposed Design<a href="#proposed-design" class="hash-link" aria-label="Direct link to Proposed Design" title="Direct link to Proposed Design" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-overview">Architecture Overview<a href="#architecture-overview" class="hash-link" aria-label="Direct link to Architecture Overview" title="Direct link to Architecture Overview" translate="no">​</a></h3>
<p>┌──────────────────────────────────────────────────────────┐
│                    Admin Clients                         │
│                                                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │ CLI Tool     │  │ Web Browser  │  │ Automation   │   │
│  │ (grpcurl)    │  │ (FastAPI UI) │  │ (Go/Python)  │   │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘   │
│         │                  │                  │            │
└─────────┼──────────────────┼──────────────────┼───────────┘
│                  │                  │
│ gRPC             │ HTTP/gRPC-Web    │ gRPC
│                  │                  │
┌─────────▼──────────────────▼──────────────────▼───────────┐
│               Prism Proxy (Port 8981)                      │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ AdminService (gRPC)                                  │ │
│  │ - Config management                                  │ │
│  │ - Session monitoring                                 │ │
│  │ - Namespace operations                               │ │
│  │ - Backend health                                     │ │
│  │ - Operational commands                               │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ Audit Logger                                         │ │
│  │ - Records all admin operations                       │ │
│  │ - Actor identity tracking                            │ │
│  └──────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
│
│ Data access
│
┌─────────▼───────────────────────────────────────────────────┐
│                   Backend Storage                           │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                  │
│  │ Postgres │  │ Kafka    │  │ NATS     │                  │
│  └──────────┘  └──────────┘  └──────────┘                  │
└─────────────────────────────────────────────────────────────┘</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Component 1: Admin API (gRPC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Design Choice: Separate gRPC service on dedicated port**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Rationale:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Security Isolation**: Different port prevents accidental data plane access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Independent Scaling**: Admin traffic patterns differ from data plane</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Evolution**: Admin API versions independently</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Firewall-Friendly**: Internal-only port easily restricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Alternative Considered: Combined service**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- *Pros*: Simpler deployment, single port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- *Cons*: Security risk, hard to separate auth, unclear boundaries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- *Decision*: Rejected due to security requirements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**API Surface:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>service AdminService {
// Configuration Management
rpc ListConfigs(ListConfigsRequest) returns (ListConfigsResponse);
rpc GetConfig(GetConfigRequest) returns (GetConfigResponse);
rpc CreateConfig(CreateConfigRequest) returns (CreateConfigResponse);
rpc UpdateConfig(UpdateConfigRequest) returns (UpdateConfigResponse);
rpc DeleteConfig(DeleteConfigRequest) returns (DeleteConfigResponse);</p>
<p>// Session Management
rpc ListSessions(ListSessionsRequest) returns (ListSessionsResponse);
rpc GetSession(GetSessionRequest) returns (GetSessionResponse);
rpc TerminateSession(TerminateSessionRequest) returns (TerminateSessionResponse);</p>
<p>// Namespace Management
rpc ListNamespaces(ListNamespacesRequest) returns (ListNamespacesResponse);
rpc CreateNamespace(CreateNamespaceRequest) returns (CreateNamespaceResponse);
rpc UpdateNamespace(UpdateNamespaceRequest) returns (UpdateNamespaceResponse);
rpc DeleteNamespace(DeleteNamespaceRequest) returns (DeleteNamespaceResponse);</p>
<p>// Backend Health
rpc GetBackendStatus(GetBackendStatusRequest) returns (GetBackendStatusResponse);
rpc ListBackends(ListBackendsRequest) returns (ListBackendsResponse);</p>
<p>// Operational Commands
rpc SetMaintenanceMode(SetMaintenanceModeRequest) returns (SetMaintenanceModeResponse);
rpc DrainConnections(DrainConnectionsRequest) returns (DrainConnectionsResponse);
rpc GetMetrics(GetMetricsRequest) returns (GetMetricsResponse);</p>
<p>// Audit
rpc GetAuditLog(GetAuditLogRequest) returns (stream AuditLogEntry);
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Implementation:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run on separate port (8981) alongside data plane (8980):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>// proxy/src/main.rs
#[tokio::main]
async fn main() -&gt; Result&lt;()&gt; {
let data_addr = &quot;0.0.0.0:8980&quot;.parse()?;
let admin_addr = &quot;0.0.0.0:8981&quot;.parse()?;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Data plane server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let data_server = Server::builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .add_service(SessionServiceServer::new(session_svc))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .add_service(QueueServiceServer::new(queue_svc))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .serve(data_addr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Admin plane server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let admin_server = Server::builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .add_service(AdminServiceServer::new(admin_svc))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .serve(admin_addr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tokio::try_join!(data_server, admin_server)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ok(())</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Authentication:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Admin API requires separate credentials:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Metadata in all admin requests</h1>
<p>metadata:
x-admin-token: &quot;admin-abc123&quot;
x-admin-user: &quot;<a href="mailto:alice@example.com" target="_blank" rel="noopener noreferrer">alice@example.com</a>&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Pros:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Strong security boundary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Standard gRPC authentication patterns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Supports multiple auth methods (API keys, OAuth2, mTLS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Cons:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Requires credential management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Different auth flow than data plane</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Decision**: Use admin API keys with rotation policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Component 2: Admin UI (FastAPI + gRPC-Web)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Design Choice: FastAPI serving static files + gRPC-Web proxy**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Rationale:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Browser Compatibility**: gRPC-Web enables browser access to gRPC backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Simple Deployment**: Single container with Python service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **No Framework Overhead**: Vanilla JavaScript sufficient for admin UI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Fast Iteration**: No build step for frontend changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Alternative Considered: React/Vue SPA**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- *Pros*: Rich UI, reactive, component-based</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- *Cons*: Build complexity, large bundle size, overkill for admin UI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- *Decision*: Rejected in favor of simplicity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Alternative Considered: Envoy gRPC-Web proxy**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- *Pros*: Production-grade, feature-rich</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- *Cons*: Additional process, more complex configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- *Decision*: Deferred; FastAPI sufficient initially, can migrate if needed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Architecture:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Browser → HTTP/gRPC-Web → FastAPI → gRPC → Prism Admin API</span><br></span></code></pre></div></div>
<p><strong>Implementation:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># admin-ui/main.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> fastapi </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> FastAPI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> fastapi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">staticfiles </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> StaticFiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> fastapi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">responses </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> FileResponse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> FastAPI</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">title</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Prism Admin UI&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Serve static files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/static&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> StaticFiles</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">directory</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;static&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;static&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">read_root</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> FileResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;static/index.html&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/prism.admin.v1.AdminService/{method}&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grpc_proxy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">method</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;Proxy gRPC-Web requests to gRPC backend&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    channel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> grpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">aio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">insecure_channel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;prism-proxy:8981&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Forward request and convert response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ... implementation details ...</span><br></span></code></pre></div></div>
<p><strong>Frontend Structure:</strong></p>
<p>admin-ui/static/
├── index.html          # Main page
├── css/
│   └── styles.css      # Tailwind or minimal CSS
├── js/
│   ├── admin_grpc_web_pb.js   # Generated gRPC-Web client
│   ├── config.js       # Config management
│   ├── sessions.js     # Session monitoring
│   └── health.js       # Health dashboard
└── lib/
└── grpc-web.js     # gRPC-Web runtime</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**JavaScript Client:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>// admin-ui/static/js/config.js
import {AdminServiceClient} from &#x27;./admin_grpc_web_pb.js&#x27;;</p>
<p>const client = new AdminServiceClient(&#x27;<a href="http://localhost:8000" target="_blank" rel="noopener noreferrer">http://localhost:8000</a>&#x27;);</p>
<p>async function loadConfigs() {
const request = new ListConfigsRequest();</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">client.listConfigs(request, {&#x27;x-admin-token&#x27;: getAdminToken()}, (err, response) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (err) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.error(&#x27;Error:&#x27;, err);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    renderConfigs(response.getConfigsList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Pros:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- No build step required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Fast development iteration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Small deployment footprint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Easy debugging (view source in browser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Cons:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Manual DOM manipulation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- No reactive framework</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Limited UI component library</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Decision**: Use vanilla JavaScript initially, migrate to framework if UI complexity grows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Component 3: Audit Logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Design Choice: Structured audit log with queryable storage**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Rationale:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Compliance**: Track all administrative actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Debugging**: Reconstruct sequence of operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Security**: Detect unauthorized access attempts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Implementation:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>impl AdminService {
async fn create_config(&amp;self, req: CreateConfigRequest) -&gt; Result<createconfigresponse> {
let actor = self.get_admin_user_from_metadata()?;</createconfigresponse></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    // Perform operation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let result = self.config_store.create(req.config).await;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Audit log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.audit_logger.log(AuditLogEntry {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timestamp: Utc::now(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        actor: actor.email,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        operation: &quot;CreateConfig&quot;.to_string(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resource: format!(&quot;config:{}&quot;, req.config.name),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace: req.config.namespace,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        success: result.is_ok(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        error: result.as_ref().err().map(|e| e.to_string()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metadata: extract_metadata(&amp;req),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }).await;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Storage:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>CREATE TABLE audit_log (
id UUID PRIMARY KEY,
timestamp TIMESTAMPTZ NOT NULL,
actor TEXT NOT NULL,
operation TEXT NOT NULL,
resource TEXT NOT NULL,
namespace TEXT,
success BOOLEAN NOT NULL,
error TEXT,
metadata JSONB,</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">INDEX idx_audit_timestamp ON audit_log(timestamp DESC),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INDEX idx_audit_actor ON audit_log(actor),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INDEX idx_audit_operation ON audit_log(operation)</span><br></span></code></pre></div></div>
<p>);</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Pros:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Comprehensive audit trail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Queryable via SQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Supports compliance requirements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Cons:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Storage overhead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Performance impact (async mitigates)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Decision**: Always log admin operations; use async writes to minimize latency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Docker Compose:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>services:
prism-proxy:
image: prism/proxy:latest
ports:
- &quot;8980:8980&quot;  # Data plane
- &quot;8981:8981&quot;  # Admin API
environment:
PRISM_DATA_PORT: 8980
PRISM_ADMIN_PORT: 8981</p>
<p>admin-ui:
image: prism/admin-ui:latest
ports:
- &quot;8000:8000&quot;
environment:
PRISM_ADMIN_ENDPOINT: prism-proxy:8981
ADMIN_TOKEN_SECRET: ${ADMIN_TOKEN_SECRET}
depends_on:
- prism-proxy</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Network Policy:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Kubernetes NetworkPolicy example</h1>
<p>apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
name: prism-admin-policy
spec:
podSelector:
matchLabels:
app: prism-proxy
ingress:</p>
<ul>
<li>from:
<ul>
<li>podSelector:
matchLabels:
role: admin
ports:</li>
<li>protocol: TCP
port: 8981  # Admin API - internal only</li>
</ul>
</li>
<li>from:
<ul>
<li>podSelector: {}
ports:</li>
<li>protocol: TCP
port: 8980  # Data plane - all pods</li>
</ul>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Security Considerations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Authentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Admin API Keys:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Long-lived, rotatable tokens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Scoped to specific operations (RBAC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Stored in secret management system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>#[derive(Debug)]
pub struct AdminApiKey {
pub key_id: String,
pub key_hash: String,
pub created_at: DateTime<utc>,
pub expires_at: Option&lt;DateTime<utc>&gt;,
pub permissions: Vec<permission>,
}</permission></utc></utc></p>
<p>pub enum Permission {
ConfigRead,
ConfigWrite,
SessionRead,
SessionTerminate,
NamespaceAdmin,
OperationalAdmin,
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Alternative: OAuth2**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- *Pros*: Standard protocol, integrates with IdP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- *Cons*: More complex, external dependency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- *Decision*: Support both; OAuth2 for enterprise deployments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Authorization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Role-Based Access Control (RBAC):**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>roles:
admin:
- config:*
- session:*
- namespace:*
- operational:*</p>
<p>operator:
- config:read
- session:read
- session:terminate
- operational:maintenance</p>
<p>viewer:
- config:read
- session:read
- backend:read</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Network Isolation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Production Setup:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Admin API on internal network only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Admin UI behind VPN or internal load balancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- mTLS for admin API connections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Example firewall rules</h1>
<ul>
<li>
<p>port: 8980
protocol: TCP
allow: [public]</p>
</li>
<li>
<p>port: 8981
protocol: TCP
allow: [internal, 10.0.0.0/8]</p>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Performance Considerations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Caching</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Admin UI caches configuration list:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>// Cache configs for 30 seconds
const configCache = new Map();
const CACHE_TTL = 30000;</p>
<p>async function getConfigs() {
const now = Date.now();
const cached = configCache.get(&#x27;list&#x27;);</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if (cached &amp;&amp; (now - cached.timestamp) &lt; CACHE_TTL) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return cached.data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const configs = await fetchConfigs();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configCache.set(&#x27;list&#x27;, { data: configs, timestamp: now });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return configs;</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Pagination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">All list operations support pagination:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>message ListSessionsRequest {
int32 page_size = 1;
optional string page_token = 2;
}</p>
<p>message ListSessionsResponse {
repeated SessionInfo sessions = 1;
optional string next_page_token = 2;
int32 total_count = 3;
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Async Operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Long-running operations return operation handle:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>message DrainConnectionsRequest {
optional string namespace = 1;
optional google.protobuf.Duration timeout = 2;
}</p>
<p>message DrainConnectionsResponse {
string operation_id = 1;  // Track progress
int32 initial_count = 2;
}</p>
<p>// Poll for status
message GetOperationRequest {
string operation_id = 1;
}</p>
<p>message GetOperationResponse {
bool complete = 1;
int32 progress_percent = 2;
optional string error = 3;
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Migration and Rollout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Phase 1: Admin API (Week 1-2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Implement AdminService in Rust</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Add authentication/authorization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Deploy on port 8981</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- CLI tooling for early adopters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Phase 2: Audit Logging (Week 2-3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Implement audit logger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Database schema for audit log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Query interface via GetAuditLog RPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Phase 3: Admin UI (Week 3-4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- FastAPI service setup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- gRPC-Web proxy implementation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Basic UI (config management only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Deploy to staging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Phase 4: Full UI Features (Week 4-6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Session monitoring page</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Backend health dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Namespace management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Operational commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Phase 5: Productionization (Week 6-8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- OAuth2 integration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- RBAC implementation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Production deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Documentation and training</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Testing Strategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Unit Tests</span><br></span></code></pre></div></div>
<p>#[cfg(test)]
mod tests {
#[tokio::test]
async fn test_create_config() {
let service = AdminService::new_test();
let req = CreateConfigRequest { /* ... */ };
let res = service.create_config(req).await.unwrap();
assert!(res.success);
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[tokio::test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">async fn test_unauthorized_access() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let service = AdminService::new_test();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = /* request without admin token */;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let err = service.create_config(req).await.unwrap_err();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert_eq!(err.code(), Code::Unauthenticated);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Integration Tests</span><br></span></code></pre></div></div>
<h1>Test admin API</h1>
<p>grpcurl -H &quot;x-admin-token: test-token&quot; <br>
localhost:8981 <br>
prism.admin.v1.AdminService/ListConfigs</p>
<h1>Test audit logging</h1>
<p>psql -c &quot;SELECT * FROM audit_log WHERE operation = &#x27;CreateConfig&#x27;&quot;</p>
<h1>Test UI</h1>
<p>curl <a href="http://localhost:8000" target="_blank" rel="noopener noreferrer">http://localhost:8000</a></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### E2E Tests</span><br></span></code></pre></div></div>
<h1>tests/e2e/test_admin_workflow.py</h1>
<p>def test_full_admin_workflow():
# Create config via UI
ui_client.create_config(config_data)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Verify config exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config = api_client.get_config(config_name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assert config.name == config_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify audit log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">audit = api_client.get_audit_log(operation=&quot;CreateConfig&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assert len(audit) == 1</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Monitoring and Observability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>// Prometheus metrics for admin API
lazy_static! {
static ref ADMIN_REQUESTS: IntCounterVec = register_int_counter_vec!(
&quot;prism_admin_requests_total&quot;,
&quot;Total admin API requests&quot;,
&amp;[&quot;operation&quot;, &quot;status&quot;]
).unwrap();</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">static ref ADMIN_LATENCY: HistogramVec = register_histogram_vec!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;prism_admin_request_duration_seconds&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Admin API request latency&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &amp;[&quot;operation&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">).unwrap();</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Alerts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Prometheus alerting rules</h1>
<p>groups:</p>
<ul>
<li>name: prism_admin
rules:
<ul>
<li>
<p>alert: AdminAPIHighErrorRate
expr: |
rate(prism_admin_requests_total{status=&quot;error&quot;}[5m]) &gt; 0.1
annotations:
summary: &quot;High error rate on admin API&quot;</p>
</li>
<li>
<p>alert: UnauthorizedAdminAccess
expr: |
rate(prism_admin_requests_total{status=&quot;unauthenticated&quot;}[5m]) &gt; 0
annotations:
summary: &quot;Unauthorized access attempts detected&quot;</p>
</li>
</ul>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Open Questions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. **OAuth2 Integration**: Which IdP to support first (Okta, Auth0, Google)?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. **UI Framework Migration**: At what complexity threshold migrate to React/Vue?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. **Multi-cluster Support**: How to extend admin UI for multi-cluster management?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. **Backup/Restore**: Should admin UI include backup/restore capabilities?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## References</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ADR-027: Admin API via gRPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ADR-028: Admin UI with FastAPI and gRPC-Web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ADR-029: Protocol Recording with Protobuf Tagging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ADR-030: Schema Recording with Protobuf Tagging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- RFC-001: Prism Architecture</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- RFC-002: Data Layer Interface Specification</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [gRPC-Web Specification](https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-WEB.md)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [FastAPI Documentation](https://fastapi.tiangolo.com/)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Revision History</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 2025-10-08: Initial draft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/jrepp/prism-data-layer/tree/main/docs-cms/../docs-cms/rfcs/rfc-003-admin-interface.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/prism-data-layer/rfc/rfc-002"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Data Layer Interface Specification • RFC-002</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/prism-data-layer/rfc/rfc-004"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Redis Integration for Cache, PubSub, and Vector Search • RFC-004</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#abstract" class="table-of-contents__link toc-highlight">Abstract</a></li><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#proposed-design" class="table-of-contents__link toc-highlight">Proposed Design</a><ul><li><a href="#architecture-overview" class="table-of-contents__link toc-highlight">Architecture Overview</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/intro">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/changelog">Change Log</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/adr">ADRs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/rfc">RFCs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/memos">Memos</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/prds">PRDs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Project</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div>Copyright © 2025 Prism. Built with Docusaurus.</div><div style="margin-top:0.5rem;font-size:0.875rem;opacity:0.8"><span>Version <!-- -->7f44008</span><span> • </span><span>Built <!-- -->Oct 14, 2025, 08:03 AM PDT</span><span> • </span><span>Commit <!-- -->7f44008</span></div></div></div></div></footer></div>
</body>
</html>