<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-rfc docs-version-current docs-doc-page docs-doc-id-rfc-035" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">RFC-035: Pattern Process Launcher with Bulkhead Isolation | Prism</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jrepp.github.io/prism-data-layer/rfc/rfc-035"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" property="og:title" content="RFC-035: Pattern Process Launcher with Bulkhead Isolation | Prism"><meta data-rh="true" name="description" content="Summary"><meta data-rh="true" property="og:description" content="Summary"><link data-rh="true" rel="icon" href="/prism-data-layer/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-035"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-035" hreflang="en"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-035" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Pattern Process Launcher with Bulkhead Isolation • RFC-035","item":"https://jrepp.github.io/prism-data-layer/rfc/rfc-035"}]}</script><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes">
<meta name="theme-color" content="#6366f1">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="stylesheet" href="/prism-data-layer/assets/css/styles.73adf43b.css">
<script src="/prism-data-layer/assets/js/runtime~main.fdb48932.js" defer="defer"></script>
<script src="/prism-data-layer/assets/js/main.dd013389.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/prism-data-layer/"><div class="navbar__logo"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">Prism</b></a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/intro">Overview</a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/changelog">Change Log</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Documentation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/prism-data-layer/adr">ADRs (Architecture Decision Records)</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/prism-data-layer/rfc">RFCs (Request for Comments)</a></li><li><a class="dropdown__link" href="/prism-data-layer/memos">Memos (Technical Analysis)</a></li><li><a class="dropdown__link" href="/prism-data-layer/prds">PRDs (Product Requirements)</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="buildInfo_asc2"><span class="version_ADrX" title="Build: 09c7a83">09c7a83</span><span class="separator_VfCt">•</span><span class="buildTime_n1Nn" title="Last updated: Oct 15, 10:20 PM PDT">Oct 15, 10:20 PM PDT</span></div><div class="navbar__item"><a href="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml" target="_blank" rel="noopener noreferrer" title="GitHub Pages" style="display: flex; align-items: center; padding: 0 0.5rem;"><img src="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml/badge.svg" alt="Build" style="margin: 0;"></a></div><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_x44X"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/"><span title="Request for Comments (RFCs)" class="linkLabel_WmDU">Request for Comments (RFCs)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-001"><span title="RFC-001 to 010" class="categoryLinkLabel_W154">RFC-001 to 010</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-011"><span title="RFC-011 to 020" class="categoryLinkLabel_W154">RFC-011 to 020</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-021"><span title="RFC-021 to 030" class="categoryLinkLabel_W154">RFC-021 to 030</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/prism-data-layer/rfc/rfc-031"><span title="RFC-031 to 040" class="categoryLinkLabel_W154">RFC-031 to 040</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-031"><span title="Message Envelope Protocol for Pub/Sub Systems • RFC-031" class="linkLabel_WmDU">Message Envelope Protocol for Pub/Sub Systems • RFC-031</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-032"><span title="Minimal Prism Schema Registry for Local Testing • RFC-032" class="linkLabel_WmDU">Minimal Prism Schema Registry for Local Testing • RFC-032</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-033"><span title="Claim Check Pattern for Large Payloads • RFC-033" class="linkLabel_WmDU">Claim Check Pattern for Large Payloads • RFC-033</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-034"><span title="Robust Process Manager Package Inspired by Kubelet • RFC-034" class="linkLabel_WmDU">Robust Process Manager Package Inspired by Kubelet • RFC-034</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/prism-data-layer/rfc/rfc-035"><span title="Pattern Process Launcher with Bulkhead Isolation • RFC-035" class="linkLabel_WmDU">Pattern Process Launcher with Bulkhead Isolation • RFC-035</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-036"><span title="Minimalist Web Framework for Prism Admin UI • RFC-036" class="linkLabel_WmDU">Minimalist Web Framework for Prism Admin UI • RFC-036</span></a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/prism-data-layer/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">RFC-031 to 040</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Pattern Process Launcher with Bulkhead Isolation • RFC-035</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="docMetadata_NQcq"><div class="tagsRow_ipDH"><span class="tag_VbXK">patterns</span><span class="tag_VbXK">process-management</span><span class="tag_VbXK">bulkhead</span><span class="tag_VbXK">isolation</span><span class="tag_VbXK">orchestration</span></div><div class="metadataRow_PvZM"><span class="metadataItem_RMFE info_Qo8L"><strong>Status:</strong> <!-- -->Proposed</span><span class="metadataItem_RMFE"><strong>Author:</strong> <!-- -->Claude Code</span><span class="metadataItem_RMFE"><strong>Created:</strong> <!-- -->Oct 14, 2025</span><span class="metadataItem_RMFE"><strong>Updated:</strong> <!-- -->Oct 14, 2025</span></div></div><div class="theme-doc-markdown markdown"><header><h1>RFC-035: Pattern Process Launcher with Bulkhead Isolation</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" translate="no">​</a></h2>
<p>This RFC proposes a lightweight process launcher for pattern executables that can run headless and answer launch requests from the Prism proxy. The launcher will be an <strong>optional component</strong> (alternatives include Kubernetes deployments, systemd, or other orchestrators) that provides lifecycle management using the bulkhead isolation pattern (via <code>pkg/isolation</code>) and robust process management (via <code>pkg/procmgr</code>). The launcher will support three isolation levels: None, Namespace, and Session, ensuring fault isolation and proper resource boundaries.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="current-situation">Current Situation<a href="#current-situation" class="hash-link" aria-label="Direct link to Current Situation" title="Direct link to Current Situation" translate="no">​</a></h3>
<p>Prism patterns (Consumer, Producer, Multicast Registry, Claim Check, etc.) currently run as standalone executables that must be launched manually or via external orchestration. The Prism proxy needs a way to:</p>
<ol>
<li><strong>Launch pattern processes on demand</strong>: When a client requests a pattern operation, the proxy must ensure the corresponding pattern process is running</li>
<li><strong>Manage process lifecycle</strong>: Start, monitor health, restart on failure, graceful shutdown</li>
<li><strong>Isolate failures</strong>: Prevent one namespace/session&#x27;s failures from affecting others (bulkhead pattern)</li>
<li><strong>List available patterns</strong>: Proxy needs to know which patterns are available and their status</li>
<li><strong>Support multiple deployment models</strong>: Local development (direct exec), containerized (Podman/Docker), orchestrated (Kubernetes)</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-an-optional-launcher">Why an Optional Launcher?<a href="#why-an-optional-launcher" class="hash-link" aria-label="Direct link to Why an Optional Launcher?" title="Direct link to Why an Optional Launcher?" translate="no">​</a></h3>
<p>The pattern process launcher is <strong>optional</strong> because different deployment models have different orchestration needs:</p>



































<table><thead><tr><th>Deployment Model</th><th>Orchestration Method</th><th>When to Use Launcher</th></tr></thead><tbody><tr><td>Local Development</td><td>Direct exec, Launcher</td><td>✅ <strong>Use Launcher</strong> - simplest local workflow</td></tr><tr><td>Docker Compose</td><td>Compose services</td><td>❌ Compose handles lifecycle</td></tr><tr><td>Kubernetes</td><td>Deployments, StatefulSets</td><td>❌ K8s handles lifecycle</td></tr><tr><td>Bare Metal / VMs</td><td>systemd, Launcher</td><td>✅ <strong>Use Launcher</strong> - lightweight alternative to systemd</td></tr><tr><td>Serverless (Lambda)</td><td>Function invocation</td><td>❌ Platform handles lifecycle</td></tr></tbody></table>
<p><strong>Key insight</strong>: The launcher provides <strong>proxy-driven lifecycle control</strong> (proxy decides when to start/stop patterns) rather than <strong>external orchestration</strong> (K8s/systemd decides independently).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bulkhead-isolation-pattern">Bulkhead Isolation Pattern<a href="#bulkhead-isolation-pattern" class="hash-link" aria-label="Direct link to Bulkhead Isolation Pattern" title="Direct link to Bulkhead Isolation Pattern" translate="no">​</a></h3>
<p>The <strong>bulkhead pattern</strong> (from ship design: compartmentalized hull sections prevent total flooding) isolates processes into separate &quot;compartments&quot; to prevent cascading failures:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Pattern Process Launcher (Headless Daemon)         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌────────────────┐  ┌────────────────┐            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  Isolation     │  │  Process       │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  Manager       │←→│  Manager       │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  (Bulkhead)    │  │  (procmgr)     │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────┘  └────────────────┘            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          ↓                    ↓                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────────────────────────────────────────┐  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  Process Pool (Isolated by Level)            │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                               │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  Isolation Level: Namespace                  │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌─────────────┐  ┌─────────────┐           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │ ns:tenant-a │  │ ns:tenant-b │           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │  Consumer   │  │  Consumer   │           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │  Process    │  │  Process    │           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └─────────────┘  └─────────────┘           │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                               │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  Isolation Level: Session                    │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌──────────────┐  ┌──────────────┐         │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │session:user-1│  │session:user-2│         │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │  Producer    │  │  Producer    │         │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │  Process     │  │  Process     │         │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └──────────────┘  └──────────────┘         │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                               │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  Isolation Level: None                       │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  ┌─────────────┐                             │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │   shared    │                             │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │  Registry   │                             │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  │  Process    │                             │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │  └─────────────┘                             │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────────────────────────────────────────┘  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ↑                           ↑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │ gRPC Launch API           │ Health/Status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────────┴────────┐         ┌────────┴────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Prism Proxy    │         │  Monitoring     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  (Rust)         │         │  (Prometheus)   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────┘         └─────────────────┘</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="design">Design<a href="#design" class="hash-link" aria-label="Direct link to Design" title="Direct link to Design" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-components">Architecture Components<a href="#architecture-components" class="hash-link" aria-label="Direct link to Architecture Components" title="Direct link to Architecture Components" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-pattern-process-launcher-cmdpattern-launcher">1. Pattern Process Launcher (<code>cmd/pattern-launcher</code>)<a href="#1-pattern-process-launcher-cmdpattern-launcher" class="hash-link" aria-label="Direct link to 1-pattern-process-launcher-cmdpattern-launcher" title="Direct link to 1-pattern-process-launcher-cmdpattern-launcher" translate="no">​</a></h4>
<p>Headless daemon that:</p>
<ul>
<li>Listens on gRPC for launch requests from proxy</li>
<li>Uses <code>pkg/isolation.IsolationManager</code> to manage process pools</li>
<li>Uses <code>pkg/procmgr.ProcessManager</code> for robust process lifecycle</li>
<li>Discovers available patterns via filesystem (executable manifests)</li>
<li>Exports Prometheus metrics and health endpoints</li>
</ul>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> PatternLauncher </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config         </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">LauncherConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    isolationLevel isolation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IsolationLevel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Management</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    isolationMgr   </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">isolation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IsolationManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Pattern discovery</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    patterns       </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">PatternManifest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    patternsMu     sync</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RWMutex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// gRPC server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    grpcServer     </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">grpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-pattern-manifest-patternsnamemanifestyaml">2. Pattern Manifest (<code>patterns/&lt;name&gt;/manifest.yaml</code>)<a href="#2-pattern-manifest-patternsnamemanifestyaml" class="hash-link" aria-label="Direct link to 2-pattern-manifest-patternsnamemanifestyaml" title="Direct link to 2-pattern-manifest-patternsnamemanifestyaml" translate="no">​</a></h4>
<p>Declarative configuration for each pattern:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">executable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./patterns/consumer/consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">isolation_level</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> namespace  </span><span class="token comment" style="color:#999988;font-style:italic"># none | namespace | session</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">healthcheck</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /health</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cpu_limit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">memory_limit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 512Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">backend_slots</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">required</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> messaging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">required</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">LOG_LEVEL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">METRICS_PORT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;9091&quot;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-launch-grpc-api">3. Launch gRPC API<a href="#3-launch-grpc-api" class="hash-link" aria-label="Direct link to 3. Launch gRPC API" title="Direct link to 3. Launch gRPC API" translate="no">​</a></h4>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">PatternLauncher</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Launch or get existing pattern process</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">LaunchPattern</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">LaunchRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">LaunchResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// List all running pattern processes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ListPatterns</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListPatternsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListPatternsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Terminate a pattern process</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TerminatePattern</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TerminateRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TerminateResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Health check</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Health</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HealthRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HealthResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">LaunchRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> pattern_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// e.g., &quot;consumer&quot;, &quot;producer&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token positional-class-name class-name">IsolationLevel</span><span class="token plain"> isolation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// NONE, NAMESPACE, SESSION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> namespace </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// Tenant namespace (for NAMESPACE isolation)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> session_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Session ID (for SESSION isolation)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token map class-name">map</span><span class="token map class-name punctuation" style="color:#393A34">&lt;</span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">,</span><span class="token map class-name"> </span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// Pattern-specific config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">LaunchResponse</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> process_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Unique process ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token positional-class-name class-name">ProcessState</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// STARTING, RUNNING, TERMINATING, etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> address </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic">// gRPC address to connect to pattern</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">bool</span><span class="token plain"> healthy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">ListPatternsResponse</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">repeated</span><span class="token plain"> </span><span class="token positional-class-name class-name">PatternInfo</span><span class="token plain"> patterns </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">PatternInfo</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> pattern_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> process_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token positional-class-name class-name">ProcessState</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> address </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">bool</span><span class="token plain"> healthy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">int64</span><span class="token plain"> uptime_seconds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> namespace </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> session_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">IsolationLevel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ISOLATION_NONE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ISOLATION_NAMESPACE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ISOLATION_SESSION </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">ProcessState</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    STATE_STARTING </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    STATE_RUNNING </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    STATE_TERMINATING </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    STATE_TERMINATED </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    STATE_FAILED </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="isolation-levels-explained">Isolation Levels Explained<a href="#isolation-levels-explained" class="hash-link" aria-label="Direct link to Isolation Levels Explained" title="Direct link to Isolation Levels Explained" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="isolation-level-none-shared-process-pool">Isolation Level: NONE (Shared Process Pool)<a href="#isolation-level-none-shared-process-pool" class="hash-link" aria-label="Direct link to Isolation Level: NONE (Shared Process Pool)" title="Direct link to Isolation Level: NONE (Shared Process Pool)" translate="no">​</a></h4>
<p>All requests share the same process, regardless of namespace or session.</p>
<p><strong>Use Case</strong>: Stateless patterns with no tenant-specific data (e.g., schema registry lookup)</p>
<p><strong>Example</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Client A (namespace: tenant-a, session: user-1) ──┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Client B (namespace: tenant-b, session: user-2) ──┼─→ shared:consumer (single process)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Client C (namespace: tenant-a, session: user-3) ──┘</span><br></span></code></pre></div></div>
<p><strong>Benefits</strong>:</p>
<ul>
<li>✅ Lowest resource usage (one process serves all)</li>
<li>✅ Simplest management</li>
</ul>
<p><strong>Risks</strong>:</p>
<ul>
<li>❌ No fault isolation (one bug affects all tenants)</li>
<li>❌ No resource isolation (noisy neighbor problem)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="isolation-level-namespace-tenant-isolation">Isolation Level: NAMESPACE (Tenant Isolation)<a href="#isolation-level-namespace-tenant-isolation" class="hash-link" aria-label="Direct link to Isolation Level: NAMESPACE (Tenant Isolation)" title="Direct link to Isolation Level: NAMESPACE (Tenant Isolation)" translate="no">​</a></h4>
<p>Each namespace gets its own dedicated process. Multiple sessions within the same namespace share the process.</p>
<p><strong>Use Case</strong>: Multi-tenant SaaS where tenants must be isolated (data security, billing, fault isolation)</p>
<p><strong>Example</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Client A (namespace: tenant-a, session: user-1) ──┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Client C (namespace: tenant-a, session: user-3) ──┼─→ ns:tenant-a:consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Client B (namespace: tenant-b, session: user-2) ────→ ns:tenant-b:consumer</span><br></span></code></pre></div></div>
<p><strong>Benefits</strong>:</p>
<ul>
<li>✅ Fault isolation: tenant-a&#x27;s crash doesn&#x27;t affect tenant-b</li>
<li>✅ Resource quotas: limit CPU/memory per tenant</li>
<li>✅ Billing: track resource usage per tenant</li>
</ul>
<p><strong>Risks</strong>:</p>
<ul>
<li>⚠️ Higher resource usage (one process per namespace)</li>
<li>⚠️ Cold start latency for new namespaces</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="isolation-level-session-maximum-isolation">Isolation Level: SESSION (Maximum Isolation)<a href="#isolation-level-session-maximum-isolation" class="hash-link" aria-label="Direct link to Isolation Level: SESSION (Maximum Isolation)" title="Direct link to Isolation Level: SESSION (Maximum Isolation)" translate="no">​</a></h4>
<p>Each session gets its own dedicated process. Maximum isolation guarantees.</p>
<p><strong>Use Case</strong>: High-security environments, compliance requirements (PCI-DSS, HIPAA), debugging</p>
<p><strong>Example</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Client A (namespace: tenant-a, session: user-1) ───→ session:user-1:consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Client B (namespace: tenant-b, session: user-2) ───→ session:user-2:consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Client C (namespace: tenant-a, session: user-3) ───→ session:user-3:consumer</span><br></span></code></pre></div></div>
<p><strong>Benefits</strong>:</p>
<ul>
<li>✅ Maximum fault isolation: one session crash = one user affected</li>
<li>✅ Security: no cross-session data leakage possible</li>
<li>✅ Debugging: session-level logs and metrics</li>
</ul>
<p><strong>Risks</strong>:</p>
<ul>
<li>❌ Highest resource usage (one process per session)</li>
<li>❌ Significant cold start latency</li>
<li>❌ Management overhead (thousands of processes possible)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="process-lifecycle-with-procmgr-integration">Process Lifecycle with procmgr Integration<a href="#process-lifecycle-with-procmgr-integration" class="hash-link" aria-label="Direct link to Process Lifecycle with procmgr Integration" title="Direct link to Process Lifecycle with procmgr Integration" translate="no">​</a></h3>
<p>The launcher uses <code>pkg/procmgr.ProcessManager</code> for robust lifecycle management:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Pattern process syncer implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> patternProcessSyncer </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    launcher </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">PatternLauncher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">patternProcessSyncer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SyncProcess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> updateType procmgr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UpdateType</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config </span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">terminal </span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    processConfig </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ProcessConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    manifest </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">launcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">patterns</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">processConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PatternName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Build command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmd </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> exec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CommandContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> manifest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Executable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Environ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;PATTERN_NAME=%s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> processConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PatternName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;NAMESPACE=%s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> processConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Namespace</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;SESSION_ID=%s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> processConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SessionID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;GRPC_PORT=%d&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> processConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GRPCPort</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Start process</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> cmd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Errorf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;start process: %w&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Store process handle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">launcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">storeProcessHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">processConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProcessID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cmd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Wait for health check to pass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">launcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">waitForHealthy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> processConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cmd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Kill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Errorf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;health check failed: %w&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Check if process exited (terminal state)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Done</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Err</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Process still running</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">patternProcessSyncer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SyncTerminatingProcess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config </span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gracePeriodSecs </span><span class="token operator" style="color:#393A34">*</span><span class="token builtin">int64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> statusFn procmgr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProcessStatusFunc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    processConfig </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ProcessConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">launcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getProcessHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">processConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProcessID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Send SIGTERM for graceful shutdown</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Signal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">syscall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SIGTERM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Errorf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;send SIGTERM: %w&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Wait for graceful exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">gracePeriodSecs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Second</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    done </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token boolean" style="color:#36acaa">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        done </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain">done</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Process exited gracefully</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">After</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Grace period expired, force kill</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Kill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Errorf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;forced kill after grace period&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">patternProcessSyncer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SyncTerminatedProcess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config </span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    processConfig </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ProcessConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Cleanup resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">launcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">removeProcessHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">processConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProcessID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="launch-request-flow">Launch Request Flow<a href="#launch-request-flow" class="hash-link" aria-label="Direct link to Launch Request Flow" title="Direct link to Launch Request Flow" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. Proxy receives client request for pattern operation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ├─→ Check if pattern process already running (cache lookup)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   ├─ Yes: Use existing process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   └─ No: Send LaunchPattern gRPC request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Launcher receives LaunchPattern request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├─→ Determine ProcessID based on isolation level</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   ├─ NONE:      &quot;shared:&lt;pattern&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   ├─ NAMESPACE: &quot;ns:&lt;namespace&gt;:&lt;pattern&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   └─ SESSION:   &quot;session:&lt;session_id&gt;:&lt;pattern&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ├─→ IsolationManager.GetOrCreateProcess(isolationKey, processConfig)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   ├─→ Check if process exists and healthy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   │   ├─ Yes: Return existing handle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   │   └─ No: Create new process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │   └─→ ProcessManager.UpdateProcess(CREATE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │       ├─→ patternProcessSyncer.SyncProcess()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │       │   ├─ exec.Command() - start pattern executable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │       │   ├─ Wait for health check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │       │   └─ Return success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │       └─→ Return ProcessHandle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Launcher returns LaunchResponse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   └─→ Proxy caches process address and forwards client request</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pattern-discovery">Pattern Discovery<a href="#pattern-discovery" class="hash-link" aria-label="Direct link to Pattern Discovery" title="Direct link to Pattern Discovery" translate="no">​</a></h3>
<p>The launcher discovers available patterns by scanning directories:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">patterns/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── consumer/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── consumer             # Executable binary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── manifest.yaml        # Pattern metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── producer/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── producer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── manifest.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── multicast_registry/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── multicast_registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── manifest.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── claimcheck/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── claimcheck</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── manifest.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── README.md</span><br></span></code></pre></div></div>
<p>Discovery algorithm:</p>
<ol>
<li>Scan <code>patterns/</code> directory</li>
<li>For each subdirectory, check for <code>manifest.yaml</code></li>
<li>Validate manifest schema</li>
<li>Check executable exists and is runnable</li>
<li>Load pattern into registry</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration" translate="no">​</a></h3>
<p>Launcher configuration (<code>~/.prism/launcher-config.yaml</code>):</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">launcher</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Port for gRPC API</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">grpc_port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8982</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Pattern discovery</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">patterns_dir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./patterns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Default isolation level (can be overridden per pattern)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">default_isolation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Process manager settings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">process_manager</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resync_interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">backoff_period</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">max_concurrent_starts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Resource limits (applied to all pattern processes)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cpu_limit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory_limit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Metrics and observability</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">health</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9093</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /health</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-phases">Implementation Phases<a href="#implementation-phases" class="hash-link" aria-label="Direct link to Implementation Phases" title="Direct link to Implementation Phases" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-1-core-launcher-week-1">Phase 1: Core Launcher (Week 1)<a href="#phase-1-core-launcher-week-1" class="hash-link" aria-label="Direct link to Phase 1: Core Launcher (Week 1)" title="Direct link to Phase 1: Core Launcher (Week 1)" translate="no">​</a></h3>
<p><strong>Deliverables</strong>:</p>
<ol>
<li><code>cmd/pattern-launcher</code> skeleton with gRPC server</li>
<li>Pattern manifest schema and validation</li>
<li>Pattern discovery (scan filesystem for manifests)</li>
<li>Integration with <code>pkg/isolation.IsolationManager</code></li>
<li>LaunchPattern API (no actual process launch yet, just mock)</li>
</ol>
<p><strong>Tests</strong>:</p>
<ul>
<li>Pattern discovery finds all valid manifests</li>
<li>Invalid manifests rejected</li>
<li>gRPC API responds to LaunchPattern requests</li>
<li>IsolationManager creates correct ProcessIDs</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-2-process-launch-week-2">Phase 2: Process Launch (Week 2)<a href="#phase-2-process-launch-week-2" class="hash-link" aria-label="Direct link to Phase 2: Process Launch (Week 2)" title="Direct link to Phase 2: Process Launch (Week 2)" translate="no">​</a></h3>
<p><strong>Deliverables</strong>:</p>
<ol>
<li><code>patternProcessSyncer</code> implementation</li>
<li><code>exec.Command()</code> integration for spawning processes</li>
<li>Process handle tracking (PID, port, address)</li>
<li>Health check polling (HTTP <code>/health</code> endpoint)</li>
<li>LaunchPattern returns running process address</li>
</ol>
<p><strong>Tests</strong>:</p>
<ul>
<li>Launch single pattern process successfully</li>
<li>Health check waits until process ready</li>
<li>Failed process launch returns error</li>
<li>Process address returned correctly</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-3-isolation-levels-week-3--complete">Phase 3: Isolation Levels (Week 3) ✅ COMPLETE<a href="#phase-3-isolation-levels-week-3--complete" class="hash-link" aria-label="Direct link to Phase 3: Isolation Levels (Week 3) ✅ COMPLETE" title="Direct link to Phase 3: Isolation Levels (Week 3) ✅ COMPLETE" translate="no">​</a></h3>
<p><strong>Deliverables</strong>:</p>
<ol>
<li>✅ Namespace isolation: one process per namespace</li>
<li>✅ Session isolation: one process per session</li>
<li>✅ None isolation: shared process</li>
<li>✅ Concurrent launch requests handled correctly</li>
<li>✅ Process reuse for existing isolation keys</li>
</ol>
<p><strong>Tests</strong> (<code>pkg/launcher/integration_test.go</code>):</p>
<ul>
<li>✅ <code>TestIsolationLevels_Integration</code>: All 3 isolation levels (NONE, NAMESPACE, SESSION)
<ul>
<li>Verifies process reuse for same isolation key</li>
<li>Verifies process separation for different keys</li>
<li>Validates PID tracking and address assignment</li>
</ul>
</li>
<li>✅ <code>TestConcurrentLaunches</code>: 5 concurrent requests correctly reuse process</li>
<li>✅ <code>TestProcessTermination</code>: Graceful termination with status verification</li>
<li>✅ <code>TestHealthCheck</code>: Health endpoint monitoring and service health reporting</li>
</ul>
<p><strong>Results</strong>:</p>
<ul>
<li>Unit tests: 100% passing (run with <code>-short</code> flag, 0.2s)</li>
<li>Integration tests: Created (require actual process launching)</li>
<li>Test pattern binary: Built and ready (7.4MB, Go-based with HTTP health endpoint)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-4-termination-and-cleanup-week-4">Phase 4: Termination and Cleanup (Week 4)<a href="#phase-4-termination-and-cleanup-week-4" class="hash-link" aria-label="Direct link to Phase 4: Termination and Cleanup (Week 4)" title="Direct link to Phase 4: Termination and Cleanup (Week 4)" translate="no">​</a></h3>
<p><strong>Deliverables</strong>:</p>
<ol>
<li>TerminatePattern API</li>
<li>Graceful SIGTERM with timeout</li>
<li>Force SIGKILL after grace period</li>
<li>Process cleanup (remove from tracking)</li>
<li>Orphan process detection and cleanup</li>
</ol>
<p><strong>Tests</strong>:</p>
<ul>
<li>Graceful shutdown completes within grace period</li>
<li>Force kill after timeout</li>
<li>Terminated processes removed from list</li>
<li>Orphaned processes detected and terminated</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-5-metrics-and-observability-week-5">Phase 5: Metrics and Observability (Week 5)<a href="#phase-5-metrics-and-observability-week-5" class="hash-link" aria-label="Direct link to Phase 5: Metrics and Observability (Week 5)" title="Direct link to Phase 5: Metrics and Observability (Week 5)" translate="no">​</a></h3>
<p><strong>Deliverables</strong>:</p>
<ol>
<li>Prometheus metrics export</li>
<li>Process lifecycle metrics (starts, stops, failures)</li>
<li>Isolation level distribution metrics</li>
<li>Resource usage per process</li>
<li>Health endpoint with detailed status</li>
</ol>
<p><strong>Tests</strong>:</p>
<ul>
<li>Metrics exported correctly</li>
<li>Counter increases on process start/stop</li>
<li>Health endpoint returns all processes</li>
<li>Resource metrics tracked accurately</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage-examples">Usage Examples<a href="#usage-examples" class="hash-link" aria-label="Direct link to Usage Examples" title="Direct link to Usage Examples" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-1-proxy-launches-consumer-pattern">Example 1: Proxy Launches Consumer Pattern<a href="#example-1-proxy-launches-consumer-pattern" class="hash-link" aria-label="Direct link to Example 1: Proxy Launches Consumer Pattern" title="Direct link to Example 1: Proxy Launches Consumer Pattern" translate="no">​</a></h3>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// In Prism proxy (Rust), making gRPC call to launcher</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">launchConsumerPattern</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">namespace </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewPatternLauncherClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LaunchPattern</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">LaunchRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PatternName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;consumer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Isolation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    IsolationLevel_ISOLATION_NAMESPACE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    namespace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;kafka_brokers&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;localhost:9092&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;consumer_group&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;%s-consumer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> namespace</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Errorf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;launch consumer: %w&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Cache the process address for future requests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxyCache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">namespace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;consumer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-2-local-development-workflow">Example 2: Local Development Workflow<a href="#example-2-local-development-workflow" class="hash-link" aria-label="Direct link to Example 2: Local Development Workflow" title="Direct link to Example 2: Local Development Workflow" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Terminal 1: Start pattern launcher</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> cmd/pattern-launcher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go run </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--config</span><span class="token plain"> ~/.prism/launcher-config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Terminal 2: Use prismctl to launch pattern</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl pattern launch consumer </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> tenant-a </span><span class="token parameter variable" style="color:#36acaa">--isolation</span><span class="token plain"> namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Terminal 3: Check running patterns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl pattern list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># PATTERN              PROCESS ID             STATE      HEALTHY  UPTIME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># consumer             ns:tenant-a:consumer   RUNNING    true     5m30s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># producer             ns:tenant-a:producer   RUNNING    true     3m15s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># multicast_registry   shared:registry        RUNNING    true     10m45s</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-3-kubernetes-alternative-no-launcher-needed">Example 3: Kubernetes Alternative (No Launcher Needed)<a href="#example-3-kubernetes-alternative-no-launcher-needed" class="hash-link" aria-label="Direct link to Example 3: Kubernetes Alternative (No Launcher Needed)" title="Direct link to Example 3: Kubernetes Alternative (No Launcher Needed)" translate="no">​</a></h3>
<p>In Kubernetes, the launcher is <strong>not used</strong>. Instead, patterns are deployed as Deployments:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># patterns/consumer/k8s-deployment.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> consumer</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pattern</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prism/consumer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ISOLATION_LEVEL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;namespace&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GRPC_PORT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;50051&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 512Mi</span><br></span></code></pre></div></div>
<p>The Prism proxy discovers pattern processes via Kubernetes service discovery (DNS, endpoints API).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="metrics-and-observability">Metrics and Observability<a href="#metrics-and-observability" class="hash-link" aria-label="Direct link to Metrics and Observability" title="Direct link to Metrics and Observability" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prometheus-metrics">Prometheus Metrics<a href="#prometheus-metrics" class="hash-link" aria-label="Direct link to Prometheus Metrics" title="Direct link to Prometheus Metrics" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Pattern lifecycle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern_launcher_process_starts_total{pattern, namespace, isolation} counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern_launcher_process_stops_total{pattern, namespace, isolation} counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern_launcher_process_failures_total{pattern, namespace, isolation} counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Process state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern_launcher_processes_running{pattern, isolation} gauge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern_launcher_processes_terminating{pattern, isolation} gauge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Launch latency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern_launcher_launch_duration_seconds{pattern, isolation} histogram</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Isolation distribution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern_launcher_isolation_level{level} gauge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Resource usage (per process)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern_launcher_process_cpu_usage{process_id} gauge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern_launcher_process_memory_bytes{process_id} gauge</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="health-check-response">Health Check Response<a href="#health-check-response" class="hash-link" aria-label="Direct link to Health Check Response" title="Direct link to Health Check Response" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;healthy&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;total_processes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;running_processes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;terminating_processes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;failed_processes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;isolation_distribution&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;none&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;namespace&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;session&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;processes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;pattern_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;consumer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;process_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ns:tenant-a:consumer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;state&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RUNNING&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;healthy&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;uptime_seconds&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3600</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;namespace&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tenant-a&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;address&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;localhost:50051&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-considerations">Security Considerations<a href="#security-considerations" class="hash-link" aria-label="Direct link to Security Considerations" title="Direct link to Security Considerations" translate="no">​</a></h2>
<ol>
<li><strong>Process Isolation</strong>: Use OS-level process isolation (cgroups, namespaces) to prevent cross-contamination</li>
<li><strong>Resource Limits</strong>: Enforce CPU/memory limits per process to prevent resource exhaustion</li>
<li><strong>Authentication</strong>: gRPC API requires mTLS or OIDC token authentication</li>
<li><strong>Authorization</strong>: Only authorized namespaces can launch patterns</li>
<li><strong>Audit Logging</strong>: All launch/terminate operations logged for security audit</li>
<li><strong>Secret Management</strong>: Pattern configs may contain secrets (DB passwords) - use secret providers</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-considerations">Performance Considerations<a href="#performance-considerations" class="hash-link" aria-label="Direct link to Performance Considerations" title="Direct link to Performance Considerations" translate="no">​</a></h2>
<ol>
<li><strong>Cold Start Latency</strong>: First request for a namespace incurs process spawn latency (~500ms-2s)</li>
<li><strong>Process Reuse</strong>: Subsequent requests to same namespace reuse existing process (&lt; 10ms)</li>
<li><strong>Concurrent Launches</strong>: ProcessManager handles concurrent launch requests without race conditions</li>
<li><strong>Memory Overhead</strong>: Each process consumes memory (baseline ~50MB + pattern-specific usage)</li>
<li><strong>CPU Overhead</strong>: Process management goroutines negligible (&lt; 1% CPU)</li>
</ol>
<p><strong>Optimization</strong>: Implement <strong>warm pool</strong> for common patterns (pre-launch consumer processes for popular namespaces).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="alternatives-considered">Alternatives Considered<a href="#alternatives-considered" class="hash-link" aria-label="Direct link to Alternatives Considered" title="Direct link to Alternatives Considered" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="alternative-1-kubernetes-statefulsets">Alternative 1: Kubernetes StatefulSets<a href="#alternative-1-kubernetes-statefulsets" class="hash-link" aria-label="Direct link to Alternative 1: Kubernetes StatefulSets" title="Direct link to Alternative 1: Kubernetes StatefulSets" translate="no">  ​</a></h3>
<p><strong>Pros</strong>:</p>
<ul>
<li>Industry-standard orchestration</li>
<li>Built-in health checks, rolling updates</li>
<li>Service discovery via DNS</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li>Requires Kubernetes cluster (heavy dependency)</li>
<li>Overly complex for local development</li>
<li>Doesn&#x27;t support proxy-driven launch (K8s decides lifecycle)</li>
</ul>
<p><strong>Verdict</strong>: Good for production, but launcher needed for local development.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="alternative-2-systemd">Alternative 2: systemd<a href="#alternative-2-systemd" class="hash-link" aria-label="Direct link to Alternative 2: systemd" title="Direct link to Alternative 2: systemd" translate="no">​</a></h3>
<p><strong>Pros</strong>:</p>
<ul>
<li>Standard on Linux systems</li>
<li>Automatic restart on failure</li>
<li>Resource limits via cgroups</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li>Not cross-platform (Linux only)</li>
<li>Requires root privileges for system-level units</li>
<li>No dynamic isolation levels (fixed unit files)</li>
</ul>
<p><strong>Verdict</strong>: Complementary, not a replacement. Launcher can be managed by systemd.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="alternative-3-docker-compose">Alternative 3: Docker Compose<a href="#alternative-3-docker-compose" class="hash-link" aria-label="Direct link to Alternative 3: Docker Compose" title="Direct link to Alternative 3: Docker Compose" translate="no">​</a></h3>
<p><strong>Pros</strong>:</p>
<ul>
<li>Simple YAML configuration</li>
<li>Built-in networking</li>
<li>Easy local testing</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li>Static configuration (can&#x27;t launch dynamically per namespace)</li>
<li>No isolation level support</li>
<li>Requires Docker daemon</li>
</ul>
<p><strong>Verdict</strong>: Good for fixed deployments, but lacks dynamic launch capability.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="open-questions">Open Questions<a href="#open-questions" class="hash-link" aria-label="Direct link to Open Questions" title="Direct link to Open Questions" translate="no">​</a></h2>
<ol>
<li><strong>Pattern Versioning</strong>: Should launcher support multiple versions of the same pattern running concurrently?</li>
<li><strong>Auto-scaling</strong>: Should launcher automatically scale processes based on load (e.g., spawn more consumer workers)?</li>
<li><strong>Checkpointing</strong>: Should process state be persisted for crash recovery?</li>
<li><strong>Network Isolation</strong>: Should namespace-isolated processes run in separate network namespaces (Linux network namespaces)?</li>
<li><strong>Resource Quotas</strong>: Should launcher enforce global resource quotas (e.g., max 100 processes total)?</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="success-criteria">Success Criteria<a href="#success-criteria" class="hash-link" aria-label="Direct link to Success Criteria" title="Direct link to Success Criteria" translate="no">​</a></h2>
<ol>
<li>✅ Launcher can start/stop pattern processes on demand</li>
<li>✅ All three isolation levels work correctly (none, namespace, session)</li>
<li>✅ Graceful shutdown completes within grace period</li>
<li>✅ Health checks detect unhealthy processes and restart them</li>
<li>✅ Prometheus metrics exported and accurate</li>
<li>✅ Can handle 100+ concurrent namespaces without issues</li>
<li>✅ Cold start latency &lt; 2 seconds</li>
<li>✅ Integrated with Prism proxy via gRPC API</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References" translate="no">​</a></h2>
<ol>
<li><a href="/prism-data-layer/rfc/rfc-034">RFC-034: Robust Process Manager Package</a> - procmgr foundation</li>
<li><a href="https://github.com/jrepp/prism/tree/main/pkg/isolation" target="_blank" rel="noopener noreferrer">pkg/isolation</a> - Bulkhead isolation implementation</li>
<li><a href="https://github.com/jrepp/prism/tree/main/pkg/procmgr" target="_blank" rel="noopener noreferrer">pkg/procmgr</a> - Process manager implementation</li>
<li><a href="https://www.oreilly.com/library/view/release-it-2nd/9781680504552/" target="_blank" rel="noopener noreferrer">Bulkhead Pattern (Michael Nygard, Release It!)</a></li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/" target="_blank" rel="noopener noreferrer">Kubernetes Pod Lifecycle</a></li>
<li><a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html" target="_blank" rel="noopener noreferrer">systemd Service Management</a></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="appendix-a-launch-request-sequence-diagram">Appendix A: Launch Request Sequence Diagram<a href="#appendix-a-launch-request-sequence-diagram" class="hash-link" aria-label="Direct link to Appendix A: Launch Request Sequence Diagram" title="Direct link to Appendix A: Launch Request Sequence Diagram" translate="no">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──────┐           ┌──────┐           ┌──────────┐         ┌──────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│Client│           │Proxy │           │Launcher  │         │Pattern   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      │           │      │           │          │         │Process   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──┬───┘           └──┬───┘           └────┬─────┘         └────┬─────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │  Pattern Request │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │─────────────────→│                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │ LaunchPattern RPC  │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │───────────────────→│                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │ GetOrCreateProcess │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │ (IsolationManager) │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │──────────┐         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │          │         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │←─────────┘         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │ UpdateProcess(CREATE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │ (ProcessManager)   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │──────────┐         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │          │         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │←─────────┘         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │    exec.Command()  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │───────────────────→│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │ Start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │←───────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │   Health Check     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │───────────────────→│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │       OK           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │←───────────────────│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │ LaunchResponse     │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │ (process address)  │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │←───────────────────│                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │  Forward Request   │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │───────────────────────────────────────→│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │       Response     │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │←───────────────────────────────────────│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │     Response     │                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │←─────────────────│                    │                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                  │                    │                    │</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="appendix-b-isolation-level-comparison-table">Appendix B: Isolation Level Comparison Table<a href="#appendix-b-isolation-level-comparison-table" class="hash-link" aria-label="Direct link to Appendix B: Isolation Level Comparison Table" title="Direct link to Appendix B: Isolation Level Comparison Table" translate="no">​</a></h2>



























































<table><thead><tr><th>Aspect</th><th>NONE</th><th>NAMESPACE</th><th>SESSION</th></tr></thead><tbody><tr><td>Process Count</td><td>1 (shared)</td><td>1 per namespace</td><td>1 per session</td></tr><tr><td>Fault Isolation</td><td>❌ None (all fail together)</td><td>✅ Per-tenant isolation</td><td>✅✅ Per-user isolation</td></tr><tr><td>Resource Isolation</td><td>❌ Shared resources</td><td>✅ Per-tenant quotas</td><td>✅✅ Per-user quotas</td></tr><tr><td>Cold Start Latency</td><td>None (always warm)</td><td>~1-2s per namespace</td><td>~1-2s per session</td></tr><tr><td>Memory Overhead</td><td>Lowest (~50MB)</td><td>Medium (~50MB × namespaces)</td><td>Highest (~50MB × sessions)</td></tr><tr><td>Security</td><td>❌ No isolation</td><td>✅ Tenant boundaries</td><td>✅✅ User boundaries</td></tr><tr><td>Use Case</td><td>Read-only lookups</td><td>Multi-tenant SaaS</td><td>High-security, debugging</td></tr><tr><td>Scalability</td><td>✅✅ Best (1 process)</td><td>✅ Good (10-100 processes)</td><td>⚠️ Limited (1000s processes)</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-status">Implementation Status<a href="#implementation-status" class="hash-link" aria-label="Direct link to Implementation Status" title="Direct link to Implementation Status" translate="no">​</a></h2>
<p><strong>Overall Status</strong>: ✅ COMPLETE (All 5 Phases Implemented)</p>
<p><strong>Phase 1</strong> (Week 1): ✅ <strong>COMPLETE</strong></p>
<ul>
<li><code>cmd/pattern-launcher</code> with gRPC server (port 8080)</li>
<li>Pattern manifest schema (<code>patterns/&lt;name&gt;/manifest.yaml</code>)</li>
<li>Pattern discovery and validation (<code>pkg/launcher/discovery.go</code>)</li>
<li>Integration with <code>pkg/isolation</code> and <code>pkg/procmgr</code></li>
<li>All unit tests passing</li>
</ul>
<p><strong>Phase 2</strong> (Week 2): ✅ <strong>COMPLETE</strong></p>
<ul>
<li>Real process launching with <code>exec.Command()</code></li>
<li><code>patternProcessSyncer</code> implementation (<code>pkg/launcher/syncer.go</code>)</li>
<li>Health check polling (HTTP <code>/health</code> endpoint)</li>
<li>Process handle tracking (PID, address, state)</li>
<li>Test pattern binary (Go-based, 7.4MB)</li>
</ul>
<p><strong>Phase 3</strong> (Week 3): ✅ <strong>COMPLETE</strong></p>
<ul>
<li>Comprehensive integration tests for all isolation levels</li>
<li>Process reuse verification (same key → same process)</li>
<li>Process separation verification (different key → different process)</li>
<li>Concurrent launch handling</li>
<li>Health monitoring and termination tests</li>
</ul>
<p><strong>Phase 4</strong> (Week 4): ✅ <strong>COMPLETE</strong></p>
<ul>
<li>✅ Production-ready error handling with retry limits</li>
<li>✅ Orphan process detection and cleanup (Linux /proc, macOS ps fallback)</li>
<li>✅ Resource cleanup verification after termination</li>
<li>✅ Health check monitoring (30s intervals)</li>
<li>✅ Error tracking across restarts (RestartCount, ErrorCount, LastError)</li>
<li>✅ Circuit breaker pattern (max 5 consecutive errors → terminal)</li>
</ul>
<p><strong>Phase 5</strong> (Week 5): ✅ <strong>COMPLETE</strong></p>
<ul>
<li>✅ Prometheus metrics export (text format with HELP/TYPE)</li>
<li>✅ Process lifecycle metrics (starts, stops, failures, restarts)</li>
<li>✅ Health check metrics (success/failure counters)</li>
<li>✅ Launch duration percentiles (p50, p95, p99)</li>
<li>✅ Isolation level distribution tracking</li>
<li>✅ JSON format export for custom dashboards</li>
<li>✅ Uptime tracking and availability metrics</li>
</ul>
<p><strong>Implementation Complete</strong> - All 5 phases delivered:</p>
<ol>
<li>✅ Core launcher with gRPC API and pattern discovery</li>
<li>✅ Real process launching with health checks</li>
<li>✅ All isolation levels (NONE, NAMESPACE, SESSION)</li>
<li>✅ Production error handling and crash recovery</li>
<li>✅ Prometheus metrics and observability</li>
</ol>
<p><strong>Next Steps for Production Deployment</strong>:</p>
<ol>
<li>Integration testing with actual Prism proxy</li>
<li>Performance testing (100+ concurrent namespaces, stress testing)</li>
<li>Documentation for deployment alternatives (K8s, systemd, Docker Compose)</li>
<li>Runbook for operational procedures (scaling, troubleshooting)</li>
<li>SLO definition (launch latency, availability, restart rates)</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/patterns">patterns</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/process-management">process-management</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/bulkhead">bulkhead</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/isolation">isolation</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/orchestration">orchestration</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/jrepp/prism-data-layer/tree/main/docs-cms/../docs-cms/rfcs/RFC-035-pattern-process-launcher.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/prism-data-layer/rfc/rfc-034"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Robust Process Manager Package Inspired by Kubelet • RFC-034</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/prism-data-layer/rfc/rfc-036"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Minimalist Web Framework for Prism Admin UI • RFC-036</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a><ul><li><a href="#current-situation" class="table-of-contents__link toc-highlight">Current Situation</a></li><li><a href="#why-an-optional-launcher" class="table-of-contents__link toc-highlight">Why an Optional Launcher?</a></li><li><a href="#bulkhead-isolation-pattern" class="table-of-contents__link toc-highlight">Bulkhead Isolation Pattern</a></li></ul></li><li><a href="#design" class="table-of-contents__link toc-highlight">Design</a><ul><li><a href="#architecture-components" class="table-of-contents__link toc-highlight">Architecture Components</a></li><li><a href="#isolation-levels-explained" class="table-of-contents__link toc-highlight">Isolation Levels Explained</a></li><li><a href="#process-lifecycle-with-procmgr-integration" class="table-of-contents__link toc-highlight">Process Lifecycle with procmgr Integration</a></li><li><a href="#launch-request-flow" class="table-of-contents__link toc-highlight">Launch Request Flow</a></li><li><a href="#pattern-discovery" class="table-of-contents__link toc-highlight">Pattern Discovery</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li></ul></li><li><a href="#implementation-phases" class="table-of-contents__link toc-highlight">Implementation Phases</a><ul><li><a href="#phase-1-core-launcher-week-1" class="table-of-contents__link toc-highlight">Phase 1: Core Launcher (Week 1)</a></li><li><a href="#phase-2-process-launch-week-2" class="table-of-contents__link toc-highlight">Phase 2: Process Launch (Week 2)</a></li><li><a href="#phase-3-isolation-levels-week-3--complete" class="table-of-contents__link toc-highlight">Phase 3: Isolation Levels (Week 3) ✅ COMPLETE</a></li><li><a href="#phase-4-termination-and-cleanup-week-4" class="table-of-contents__link toc-highlight">Phase 4: Termination and Cleanup (Week 4)</a></li><li><a href="#phase-5-metrics-and-observability-week-5" class="table-of-contents__link toc-highlight">Phase 5: Metrics and Observability (Week 5)</a></li></ul></li><li><a href="#usage-examples" class="table-of-contents__link toc-highlight">Usage Examples</a><ul><li><a href="#example-1-proxy-launches-consumer-pattern" class="table-of-contents__link toc-highlight">Example 1: Proxy Launches Consumer Pattern</a></li><li><a href="#example-2-local-development-workflow" class="table-of-contents__link toc-highlight">Example 2: Local Development Workflow</a></li><li><a href="#example-3-kubernetes-alternative-no-launcher-needed" class="table-of-contents__link toc-highlight">Example 3: Kubernetes Alternative (No Launcher Needed)</a></li></ul></li><li><a href="#metrics-and-observability" class="table-of-contents__link toc-highlight">Metrics and Observability</a><ul><li><a href="#prometheus-metrics" class="table-of-contents__link toc-highlight">Prometheus Metrics</a></li><li><a href="#health-check-response" class="table-of-contents__link toc-highlight">Health Check Response</a></li></ul></li><li><a href="#security-considerations" class="table-of-contents__link toc-highlight">Security Considerations</a></li><li><a href="#performance-considerations" class="table-of-contents__link toc-highlight">Performance Considerations</a></li><li><a href="#alternatives-considered" class="table-of-contents__link toc-highlight">Alternatives Considered</a><ul><li><a href="#alternative-1-kubernetes-statefulsets" class="table-of-contents__link toc-highlight">Alternative 1: Kubernetes StatefulSets</a></li><li><a href="#alternative-2-systemd" class="table-of-contents__link toc-highlight">Alternative 2: systemd</a></li><li><a href="#alternative-3-docker-compose" class="table-of-contents__link toc-highlight">Alternative 3: Docker Compose</a></li></ul></li><li><a href="#open-questions" class="table-of-contents__link toc-highlight">Open Questions</a></li><li><a href="#success-criteria" class="table-of-contents__link toc-highlight">Success Criteria</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li><li><a href="#appendix-a-launch-request-sequence-diagram" class="table-of-contents__link toc-highlight">Appendix A: Launch Request Sequence Diagram</a></li><li><a href="#appendix-b-isolation-level-comparison-table" class="table-of-contents__link toc-highlight">Appendix B: Isolation Level Comparison Table</a></li><li><a href="#implementation-status" class="table-of-contents__link toc-highlight">Implementation Status</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/intro">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/changelog">Change Log</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/adr">ADRs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/rfc">RFCs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/memos">Memos</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/prds">PRDs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Project</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div>Copyright © 2025 Prism. Built with Docusaurus.</div><div style="margin-top:0.5rem;font-size:0.875rem;opacity:0.8"><span>Version <!-- -->09c7a833</span><span> • </span><span>Built <!-- -->Oct 15, 2025, 10:20 PM PDT</span><span> • </span><span>Commit <!-- -->09c7a83</span></div></div></div></div></footer></div>
</body>
</html>