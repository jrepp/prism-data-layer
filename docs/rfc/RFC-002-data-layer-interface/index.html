<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-rfc docs-version-current docs-doc-page docs-doc-id-RFC-002-data-layer-interface" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">RFC-002: Data Layer Interface Specification | Prism</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jrepp.github.io/prism-data-layer/rfc/RFC-002-data-layer-interface"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" property="og:title" content="RFC-002: Data Layer Interface Specification | Prism"><meta data-rh="true" name="description" content="Abstract"><meta data-rh="true" property="og:description" content="Abstract"><link data-rh="true" rel="icon" href="/prism-data-layer/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jrepp.github.io/prism-data-layer/rfc/RFC-002-data-layer-interface"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/RFC-002-data-layer-interface" hreflang="en"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/RFC-002-data-layer-interface" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"RFC-002: Data Layer Interface Specification","item":"https://jrepp.github.io/prism-data-layer/rfc/RFC-002-data-layer-interface"}]}</script><link rel="stylesheet" href="/prism-data-layer/assets/css/styles.ad3ff1c5.css">
<script src="/prism-data-layer/assets/js/runtime~main.9adf936b.js" defer="defer"></script>
<script src="/prism-data-layer/assets/js/main.8228198a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/prism-data-layer/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/prism-data-layer/"><div class="navbar__logo"><img src="/prism-data-layer/img/logo.svg" alt="Prism Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/prism-data-layer/img/logo.svg" alt="Prism Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Prism</b></a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/prism-data-layer/adr">ADRs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/prism-data-layer/rfc">RFCs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/RFC-001-prism-architecture"><span title="RFC-001: Prism Data Access Layer Architecture" class="linkLabel_WmDU">RFC-001: Prism Data Access Layer Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/prism-data-layer/rfc/RFC-002-data-layer-interface"><span title="RFC-002: Data Layer Interface Specification" class="linkLabel_WmDU">RFC-002: Data Layer Interface Specification</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/RFC-003-admin-interface"><span title="RFC-003: Admin Interface for Prism" class="linkLabel_WmDU">RFC-003: Admin Interface for Prism</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/prism-data-layer/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">RFC-002: Data Layer Interface Specification</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>RFC-002: Data Layer Interface Specification</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a href="#abstract" class="hash-link" aria-label="Direct link to Abstract" title="Direct link to Abstract" translate="no">​</a></h2>
<p>This RFC specifies the complete data layer interface for Prism, defining all gRPC services, message formats, error handling, and client patterns. The interface provides a unified API for accessing heterogeneous backends through five core abstractions: Sessions, Queues, PubSub, Readers, and Transactions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-introduction">1. Introduction<a href="#1-introduction" class="hash-link" aria-label="Direct link to 1. Introduction" title="Direct link to 1. Introduction" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-purpose">1.1 Purpose<a href="#11-purpose" class="hash-link" aria-label="Direct link to 1.1 Purpose" title="Direct link to 1.1 Purpose" translate="no">​</a></h3>
<p>The Prism data layer interface provides:</p>
<ol>
<li><strong>Unified API</strong>: Single gRPC interface for all data operations</li>
<li><strong>Type Safety</strong>: Protobuf-defined messages with code generation</li>
<li><strong>Streaming</strong>: First-class support for server/client/bidirectional streaming</li>
<li><strong>Abstraction</strong>: Backend-agnostic operations that map to multiple implementations</li>
<li><strong>Evolution</strong>: Forward/backward compatibility through versioned APIs</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-design-principles">1.2 Design Principles<a href="#12-design-principles" class="hash-link" aria-label="Direct link to 1.2 Design Principles" title="Direct link to 1.2 Design Principles" translate="no">​</a></h3>
<ul>
<li><strong>Session-based</strong>: All operations require authenticated session</li>
<li><strong>Layered</strong>: Progressive disclosure from basic to specialized</li>
<li><strong>Streaming-first</strong>: Use streaming for pagination, pub/sub, transactions</li>
<li><strong>Typed</strong>: All requests/responses strongly typed via protobuf</li>
<li><strong>Versioned</strong>: APIs versioned (v1, v2, etc.) for evolution</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-service-overview">1.3 Service Overview<a href="#13-service-overview" class="hash-link" aria-label="Direct link to 1.3 Service Overview" title="Direct link to 1.3 Service Overview" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           Session Service (v1)             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - CreateSession, CloseSession, Heartbeat  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────┬───────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ┌───────────┴───────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     │                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────▼────────┐      ┌───────▼────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│Queue Service│      │PubSub Service  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    (v1)     │      │     (v1)       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────┘      └────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     │                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────▼────────┐      ┌───────▼────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│Reader       │      │Transact Service│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│Service (v1) │      │     (v1)       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────┘      └────────────────┘</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-session-service">2. Session Service<a href="#2-session-service" class="hash-link" aria-label="Direct link to 2. Session Service" title="Direct link to 2. Session Service" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-overview">2.1 Overview<a href="#21-overview" class="hash-link" aria-label="Direct link to 2.1 Overview" title="Direct link to 2.1 Overview" translate="no">​</a></h3>
<p>Foundation service for authentication, authorization, and connection management.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-service-definition">2.2 Service Definition<a href="#22-service-definition" class="hash-link" aria-label="Direct link to 2.2 Service Definition" title="Direct link to 2.2 Service Definition" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package prism.session.v1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;google/protobuf/timestamp.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;google/protobuf/duration.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;prism/config/v1/client_config.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service SessionService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create new authenticated session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc CreateSession(CreateSessionRequest) returns (CreateSessionResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Close session and release resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc CloseSession(CloseSessionRequest) returns (CloseSessionResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Heartbeat to keep session alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Heartbeat(HeartbeatRequest) returns (HeartbeatResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Get session metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc GetSession(GetSessionRequest) returns (GetSessionResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Refresh session (extend expiration)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc RefreshSession(RefreshSessionRequest) returns (RefreshSessionResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-messages">2.3 Messages<a href="#23-messages" class="hash-link" aria-label="Direct link to 2.3 Messages" title="Direct link to 2.3 Messages" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message CreateSessionRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Authentication credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oneof auth {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string api_key = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string jwt_token = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MutualTLSAuth mtls = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Client configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oneof config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string config_name = 4;              // Use named config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prism.config.v1.ClientConfig inline_config = 5;  // Inline config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Client metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string client_id = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string client_version = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, string&gt; metadata = 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message MutualTLSAuth {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bytes client_cert = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message CreateSessionResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Session token for subsequent requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Session metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp created_at = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp expires_at = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Resolved configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prism.config.v1.ClientConfig config = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Server capabilities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated string supported_features = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message CloseSessionRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool force = 2;  // Force close even with pending operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message CloseSessionResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool success = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string message = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 pending_operations = 3;  // Count of operations not completed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message HeartbeatRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message HeartbeatResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp server_time = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Duration ttl = 2;  // Time until session expires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SessionStatus status = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum SessionStatus {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SESSION_STATUS_UNSPECIFIED = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SESSION_STATUS_ACTIVE = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SESSION_STATUS_EXPIRING = 2;      // Near expiration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SESSION_STATUS_READ_ONLY = 3;     // Read operations only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SESSION_STATUS_TERMINATING = 4;   // Shutting down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message GetSessionRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message GetSessionResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SessionStatus status = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp created_at = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp expires_at = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp last_activity = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prism.config.v1.ClientConfig config = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SessionMetrics metrics = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message SessionMetrics {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 requests_processed = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 bytes_sent = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 bytes_received = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 active_streams = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message RefreshSessionRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Duration extension = 2;  // How long to extend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message RefreshSessionResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp new_expires_at = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-usage-examples">2.4 Usage Examples<a href="#24-usage-examples" class="hash-link" aria-label="Direct link to 2.4 Usage Examples" title="Direct link to 2.4 Usage Examples" translate="no">​</a></h3>
<p><strong>Create Session (Named Config):</strong></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">client </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewSessionServiceClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CreateSession</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CreateSessionRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Auth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CreateSessionRequest_ApiKey</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ApiKey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;key-123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CreateSessionRequest_ConfigName</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConfigName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user-profiles&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ClientId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;app-service-v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ClientVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1.0.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sessionToken </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SessionToken</span><br></span></code></pre></div></div>
<p><strong>Heartbeat Loop:</strong></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ticker </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewTicker</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> ticker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Stop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain">ticker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">C</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Heartbeat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HeartbeatRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SessionToken</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sessionToken</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;heartbeat failed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;heartbeat ok&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ttl&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Ttl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain">done</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-queue-service">3. Queue Service<a href="#3-queue-service" class="hash-link" aria-label="Direct link to 3. Queue Service" title="Direct link to 3. Queue Service" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-overview">3.1 Overview<a href="#31-overview" class="hash-link" aria-label="Direct link to 3.1 Overview" title="Direct link to 3.1 Overview" translate="no">​</a></h3>
<p>Kafka-style message queue operations with topics, partitions, and offsets.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-service-definition">3.2 Service Definition<a href="#32-service-definition" class="hash-link" aria-label="Direct link to 3.2 Service Definition" title="Direct link to 3.2 Service Definition" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package prism.queue.v1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;google/protobuf/timestamp.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;google/protobuf/duration.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service QueueService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Publish message to topic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Publish(PublishRequest) returns (PublishResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Publish batch of messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc PublishBatch(PublishBatchRequest) returns (PublishBatchResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Subscribe to topic (server streaming)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Subscribe(SubscribeRequest) returns (stream Message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Acknowledge message processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Acknowledge(AcknowledgeRequest) returns (AcknowledgeResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Commit offset for consumer group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Commit(CommitRequest) returns (CommitResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Seek to specific offset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Seek(SeekRequest) returns (SeekResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Get topic metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc GetTopicInfo(GetTopicInfoRequest) returns (GetTopicInfoResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-messages">3.3 Messages<a href="#33-messages" class="hash-link" aria-label="Direct link to 3.3 Messages" title="Direct link to 3.3 Messages" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message PublishRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string topic = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bytes payload = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, string&gt; headers = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string partition_key = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional int32 partition = 6;  // Explicit partition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message PublishResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string message_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 offset = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 partition = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp timestamp = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message PublishBatchRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string topic = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated BatchMessage messages = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message BatchMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bytes payload = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, string&gt; headers = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string partition_key = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message PublishBatchResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated PublishResponse results = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 success_count = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 failure_count = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message SubscribeRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string topic = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string consumer_group = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Starting position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oneof start_position {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int64 offset = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    google.protobuf.Timestamp timestamp = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StartPosition position = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Flow control</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional int32 max_messages = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional google.protobuf.Duration timeout = 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum StartPosition {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  START_POSITION_UNSPECIFIED = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  START_POSITION_EARLIEST = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  START_POSITION_LATEST = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  START_POSITION_COMMITTED = 3;  // Last committed offset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Message {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string message_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string topic = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 partition = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 offset = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bytes payload = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, string&gt; headers = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp timestamp = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string producer_id = 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional int32 attempt = 9;  // For retries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message AcknowledgeRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated string message_ids = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message AcknowledgeResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 acknowledged_count = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated string failed_ids = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message CommitRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string topic = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string consumer_group = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated PartitionOffset offsets = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message PartitionOffset {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 partition = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 offset = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message CommitResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool success = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated PartitionOffset committed = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message SeekRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string topic = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string consumer_group = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated PartitionOffset positions = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message SeekResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool success = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message GetTopicInfoRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string topic = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message GetTopicInfoResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string topic = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 partition_count = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 message_count = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated PartitionInfo partitions = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message PartitionInfo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 partition = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 earliest_offset = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 latest_offset = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 message_count = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-usage-examples">3.4 Usage Examples<a href="#34-usage-examples" class="hash-link" aria-label="Direct link to 3.4 Usage Examples" title="Direct link to 3.4 Usage Examples" translate="no">​</a></h3>
<p><strong>Publish:</strong></p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">PublishRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session_token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">clone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    topic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;events&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">to_string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">serde_json</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">to_vec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    headers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    partition_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token class-name">Default</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property" style="color:#36acaa">println!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Published to partition {} offset {}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">partition</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">offset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>Subscribe (Streaming):</strong></p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SubscribeRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session_token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">clone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    topic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;events&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">to_string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consumer_group</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;processors&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">to_string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start_position</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token namespace" style="opacity:0.7">subscribe_request</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">StartPosition</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Position</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StartPosition</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Latest</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token class-name">Default</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">into_inner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> stream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">message</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">process_message</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">acknowledge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">AcknowledgeRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        session_token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">clone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message_ids</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token macro property" style="color:#36acaa">vec!</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">message_id</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-pubsub-service">4. PubSub Service<a href="#4-pubsub-service" class="hash-link" aria-label="Direct link to 4. PubSub Service" title="Direct link to 4. PubSub Service" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-overview">4.1 Overview<a href="#41-overview" class="hash-link" aria-label="Direct link to 4.1 Overview" title="Direct link to 4.1 Overview" translate="no">​</a></h3>
<p>NATS-style publish-subscribe with topic patterns and wildcards.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-service-definition">4.2 Service Definition<a href="#42-service-definition" class="hash-link" aria-label="Direct link to 4.2 Service Definition" title="Direct link to 4.2 Service Definition" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package prism.pubsub.v1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;google/protobuf/timestamp.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service PubSubService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Publish event to topic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Publish(PublishRequest) returns (PublishResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Subscribe to topic pattern (server streaming)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Subscribe(SubscribeRequest) returns (stream Event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Unsubscribe from topic pattern</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Unsubscribe(UnsubscribeRequest) returns (UnsubscribeResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // List active subscriptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc ListSubscriptions(ListSubscriptionsRequest) returns (ListSubscriptionsResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-messages">4.3 Messages<a href="#43-messages" class="hash-link" aria-label="Direct link to 4.3 Messages" title="Direct link to 4.3 Messages" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message PublishRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string topic = 2;  // e.g., &quot;events.user.created&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bytes payload = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, string&gt; metadata = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string correlation_id = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string reply_to = 6;  // For request-reply pattern</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message PublishResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string event_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp published_at = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 subscriber_count = 3;  // How many subscribers received it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message SubscribeRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string topic_pattern = 2;  // e.g., &quot;events.user.*&quot;, &quot;events.&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string queue_group = 3;  // For load balancing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SubscriptionOptions options = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message SubscriptionOptions {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool auto_acknowledge = 1;  // Auto-ack on delivery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional int32 max_messages = 2;  // Limit total messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional google.protobuf.Duration max_duration = 3;  // Subscription timeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Event {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string event_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string topic = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bytes payload = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, string&gt; metadata = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp timestamp = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Request-reply support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string correlation_id = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string reply_to = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Subscription info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string subscription_id = 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message UnsubscribeRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string subscription_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message UnsubscribeResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool success = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message ListSubscriptionsRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message ListSubscriptionsResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated Subscription subscriptions = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Subscription {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string subscription_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string topic_pattern = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string queue_group = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp created_at = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 messages_received = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool active = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-usage-examples">4.4 Usage Examples<a href="#44-usage-examples" class="hash-link" aria-label="Direct link to 4.4 Usage Examples" title="Direct link to 4.4 Usage Examples" translate="no">​</a></h3>
<p><strong>Subscribe with Wildcard:</strong></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stream</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pubsub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SubscribeRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SessionToken</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TopicPattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;events.user.*&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Match all user events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    QueueGroup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;processors&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Load balance across group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pubsub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SubscriptionOptions</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AutoAcknowledge</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> stream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Recv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> io</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EOF </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;stream error&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;received event&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;topic&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Topic</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EventId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">processEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-reader-service">5. Reader Service<a href="#5-reader-service" class="hash-link" aria-label="Direct link to 5. Reader Service" title="Direct link to 5. Reader Service" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-overview">5.1 Overview<a href="#51-overview" class="hash-link" aria-label="Direct link to 5.1 Overview" title="Direct link to 5.1 Overview" translate="no">​</a></h3>
<p>Database-style paged reading with queries and filters.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-service-definition">5.2 Service Definition<a href="#52-service-definition" class="hash-link" aria-label="Direct link to 5.2 Service Definition" title="Direct link to 5.2 Service Definition" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package prism.reader.v1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;google/protobuf/struct.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;google/protobuf/timestamp.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service ReaderService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Read pages of data (server streaming)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Read(ReadRequest) returns (stream Page);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Query with filters (server streaming)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Query(QueryRequest) returns (stream Row);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Count matching records</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Count(CountRequest) returns (CountResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Get single record by ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Get(GetRequest) returns (GetResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-messages">5.3 Messages<a href="#53-messages" class="hash-link" aria-label="Direct link to 5.3 Messages" title="Direct link to 5.3 Messages" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message ReadRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string collection = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 page_size = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string cursor = 4;  // Continuation token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated string fields = 5;  // Projection (empty = all fields)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional Filter filter = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated Sort sort = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Page {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated Row rows = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string next_cursor = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool has_more = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PageMetadata metadata = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message PageMetadata {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 row_count = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 page_number = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp generated_at = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Row {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, google.protobuf.Value&gt; fields = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional RowMetadata metadata = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message RowMetadata {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp created_at = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp updated_at = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string version = 3;  // For optimistic locking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message QueryRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string collection = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Filter filter = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated Sort sort = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional int32 limit = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional int32 offset = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated string fields = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Filter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oneof filter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FieldFilter field = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CompositeFilter composite = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message FieldFilter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string field = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Operator op = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Value value = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enum Operator {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPERATOR_UNSPECIFIED = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPERATOR_EQUALS = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPERATOR_NOT_EQUALS = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPERATOR_GREATER_THAN = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPERATOR_GREATER_THAN_OR_EQUALS = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPERATOR_LESS_THAN = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPERATOR_LESS_THAN_OR_EQUALS = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPERATOR_IN = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPERATOR_NOT_IN = 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPERATOR_CONTAINS = 9;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPERATOR_STARTS_WITH = 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPERATOR_ENDS_WITH = 11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message CompositeFilter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LogicalOperator op = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated Filter filters = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enum LogicalOperator {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGICAL_OPERATOR_UNSPECIFIED = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGICAL_OPERATOR_AND = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGICAL_OPERATOR_OR = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGICAL_OPERATOR_NOT = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Sort {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string field = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Direction direction = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enum Direction {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DIRECTION_UNSPECIFIED = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DIRECTION_ASC = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DIRECTION_DESC = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message CountRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string collection = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional Filter filter = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message CountResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 count = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message GetRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string collection = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string id = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated string fields = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message GetResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional Row row = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool found = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-usage-examples">5.4 Usage Examples<a href="#54-usage-examples" class="hash-link" aria-label="Direct link to 5.4 Usage Examples" title="Direct link to 5.4 Usage Examples" translate="no">​</a></h3>
<p><strong>Paged Reading:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ReadRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session_token</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    collection</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;users&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    page_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fields</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;email&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sort</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">field</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;created_at&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> direction</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Sort</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DIRECTION_DESC</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> page </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> stream</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> row </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        user_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fields</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">string_value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fields</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">string_value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;User: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">user_id</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> - </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">has_more</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><br></span></code></pre></div></div>
<p><strong>Query with Filter:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Complex filter: active users created in last 30 days</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">filter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    composite</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CompositeFilter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        op</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CompositeFilter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LOGICAL_OPERATOR_AND</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filters</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                field</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FieldFilter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    field</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    op</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FieldFilter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OPERATOR_EQUALS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    value</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Value</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string_value</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;active&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                field</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FieldFilter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    field</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;created_at&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    op</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FieldFilter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OPERATOR_GREATER_THAN</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    value</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Value</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string_value</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2025-09-07T00:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reader_pb2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">QueryRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session_token</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    collection</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;users&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">filter</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">filter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    limit</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> row </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> stream</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process_user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">row</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-transact-service">6. Transact Service<a href="#6-transact-service" class="hash-link" aria-label="Direct link to 6. Transact Service" title="Direct link to 6. Transact Service" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="61-overview">6.1 Overview<a href="#61-overview" class="hash-link" aria-label="Direct link to 6.1 Overview" title="Direct link to 6.1 Overview" translate="no">​</a></h3>
<p>Transactional writes across two tables (inbox/outbox pattern).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="62-service-definition">6.2 Service Definition<a href="#62-service-definition" class="hash-link" aria-label="Direct link to 6.2 Service Definition" title="Direct link to 6.2 Service Definition" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package prism.transact.v1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;google/protobuf/struct.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;google/protobuf/timestamp.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service TransactService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Single transactional write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Write(WriteRequest) returns (WriteResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Streaming transaction (begin, writes, commit/rollback)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Transaction(stream TransactRequest) returns (stream TransactResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Read mailbox messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc ReadMailbox(ReadMailboxRequest) returns (stream MailboxMessage);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Mark mailbox messages as processed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc ProcessMailbox(ProcessMailboxRequest) returns (ProcessMailboxResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="63-messages">6.3 Messages<a href="#63-messages" class="hash-link" aria-label="Direct link to 6.3 Messages" title="Direct link to 6.3 Messages" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message WriteRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Data table write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DataWrite data = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Mailbox table write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MailboxWrite mailbox = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Transaction options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TransactionOptions options = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message DataWrite {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string table = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, google.protobuf.Value&gt; record = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  WriteMode mode = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string id_field = 4;  // For updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enum WriteMode {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WRITE_MODE_UNSPECIFIED = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WRITE_MODE_INSERT = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WRITE_MODE_UPDATE = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WRITE_MODE_UPSERT = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WRITE_MODE_DELETE = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message MailboxWrite {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string mailbox_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bytes message = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, string&gt; metadata = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string message_type = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional int32 priority = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message TransactionOptions {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IsolationLevel isolation = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 timeout_ms = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool idempotent = 3;  // Safe to retry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string idempotency_key = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enum IsolationLevel {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ISOLATION_LEVEL_UNSPECIFIED = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ISOLATION_LEVEL_READ_COMMITTED = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ISOLATION_LEVEL_REPEATABLE_READ = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ISOLATION_LEVEL_SERIALIZABLE = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message WriteResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string transaction_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool committed = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DataWriteResult data_result = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MailboxWriteResult mailbox_result = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp timestamp = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message DataWriteResult {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 rows_affected = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, google.protobuf.Value&gt; generated_values = 2;  // Auto-generated IDs, etc.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message MailboxWriteResult {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string message_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 sequence = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Streaming transaction messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message TransactRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oneof request {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BeginTransaction begin = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WriteRequest write = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CommitTransaction commit = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RollbackTransaction rollback = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message BeginTransaction {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TransactionOptions options = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message CommitTransaction {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Empty - just signals commit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message RollbackTransaction {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string reason = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message TransactResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oneof response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TransactionStarted started = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WriteResponse write_result = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TransactionCommitted committed = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TransactionRolledBack rolled_back = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TransactionError error = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message TransactionStarted {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string transaction_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp started_at = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message TransactionCommitted {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool success = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 write_count = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message TransactionRolledBack {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string reason = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message TransactionError {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string code = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string message = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message ReadMailboxRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string mailbox_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional int64 since_sequence = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional int32 limit = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional bool unprocessed_only = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message MailboxMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string message_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string mailbox_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 sequence = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bytes message = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, string&gt; metadata = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string message_type = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp created_at = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool processed = 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional google.protobuf.Timestamp processed_at = 9;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message ProcessMailboxRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string session_token = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated string message_ids = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message ProcessMailboxResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 processed_count = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated string failed_ids = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="64-usage-examples">6.4 Usage Examples<a href="#64-usage-examples" class="hash-link" aria-label="Direct link to 6.4 Usage Examples" title="Direct link to 6.4 Usage Examples" translate="no">​</a></h3>
<p><strong>Single Transaction:</strong></p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">WriteRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session_token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">clone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DataWrite</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        table</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;orders&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">to_string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        record</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">WriteMode</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">..</span><span class="token class-name">Default</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mailbox</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MailboxWrite</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mailbox_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;order-events&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">to_string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> event_bytes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;order.created&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">to_string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">..</span><span class="token class-name">Default</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TransactionOptions</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isolation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">IsolationLevel</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Serializable</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        idempotent</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        idempotency_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order_id</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">clone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">..</span><span class="token class-name">Default</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property" style="color:#36acaa">println!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Transaction {} committed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transaction_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>Streaming Transaction:</strong></p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> tx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> rx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">transaction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">into_inner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TransactRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token namespace" style="opacity:0.7">transact_request</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Request</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Begin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BeginTransaction</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        session_token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">clone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">..</span><span class="token class-name">Default</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> started </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">message</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Multiple writes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> order </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> orders </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TransactRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token namespace" style="opacity:0.7">transact_request</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Request</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token comment" style="color:#999988;font-style:italic">/* ... */</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">message</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Commit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TransactRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token namespace" style="opacity:0.7">transact_request</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Request</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Commit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CommitTransaction</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> committed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">message</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-error-handling">7. Error Handling<a href="#7-error-handling" class="hash-link" aria-label="Direct link to 7. Error Handling" title="Direct link to 7. Error Handling" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="71-grpc-status-codes">7.1 gRPC Status Codes<a href="#71-grpc-status-codes" class="hash-link" aria-label="Direct link to 7.1 gRPC Status Codes" title="Direct link to 7.1 gRPC Status Codes" translate="no">​</a></h3>
<p>All services use standard gRPC status codes:</p>
<table><thead><tr><th>Code</th><th>Usage</th></tr></thead><tbody><tr><td><code>OK</code></td><td>Success</td></tr><tr><td><code>CANCELLED</code></td><td>Client cancelled</td></tr><tr><td><code>INVALID_ARGUMENT</code></td><td>Invalid request parameters</td></tr><tr><td><code>DEADLINE_EXCEEDED</code></td><td>Timeout</td></tr><tr><td><code>NOT_FOUND</code></td><td>Resource not found</td></tr><tr><td><code>ALREADY_EXISTS</code></td><td>Duplicate creation</td></tr><tr><td><code>PERMISSION_DENIED</code></td><td>Authorization failure</td></tr><tr><td><code>RESOURCE_EXHAUSTED</code></td><td>Rate limit exceeded</td></tr><tr><td><code>FAILED_PRECONDITION</code></td><td>Precondition not met</td></tr><tr><td><code>ABORTED</code></td><td>Transaction conflict</td></tr><tr><td><code>OUT_OF_RANGE</code></td><td>Invalid range</td></tr><tr><td><code>UNIMPLEMENTED</code></td><td>Feature not available</td></tr><tr><td><code>INTERNAL</code></td><td>Server error</td></tr><tr><td><code>UNAVAILABLE</code></td><td>Service unavailable</td></tr><tr><td><code>UNAUTHENTICATED</code></td><td>Invalid/missing auth</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="72-error-details">7.2 Error Details<a href="#72-error-details" class="hash-link" aria-label="Direct link to 7.2 Error Details" title="Direct link to 7.2 Error Details" translate="no">​</a></h3>
<p>Use <code>google.rpc.ErrorInfo</code> for structured errors:</p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;google/rpc/error_details.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// In error response metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">google.rpc.ErrorInfo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  reason: &quot;INVALID_SESSION_TOKEN&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  domain: &quot;prism.session.v1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  metadata: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;session_id&quot;: &quot;sess-123&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;expired_at&quot;: &quot;2025-10-07T12:00:00Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="73-client-error-handling">7.3 Client Error Handling<a href="#73-client-error-handling" class="hash-link" aria-label="Direct link to 7.3 Client Error Handling" title="Direct link to 7.3 Client Error Handling" translate="no">​</a></h3>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    st</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ok </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> status</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FromError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">ok </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Non-gRPC error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> st</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Code</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> codes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Unauthenticated</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Refresh session</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">refreshAndRetry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> codes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ResourceExhausted</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Rate limited, backoff</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backoff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">retry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> codes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Unavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Service down, circuit breaker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> circuitBreaker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RecordFailure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-backward-compatibility">8. Backward Compatibility<a href="#8-backward-compatibility" class="hash-link" aria-label="Direct link to 8. Backward Compatibility" title="Direct link to 8. Backward Compatibility" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="81-versioning-strategy">8.1 Versioning Strategy<a href="#81-versioning-strategy" class="hash-link" aria-label="Direct link to 8.1 Versioning Strategy" title="Direct link to 8.1 Versioning Strategy" translate="no">​</a></h3>
<ul>
<li><strong>API Version</strong>: <code>v1</code>, <code>v2</code> in package name (<code>prism.queue.v1</code>)</li>
<li><strong>Service Version</strong>: Separate services for major versions</li>
<li><strong>Message Evolution</strong>: Additive changes only within version</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="82-compatible-changes">8.2 Compatible Changes<a href="#82-compatible-changes" class="hash-link" aria-label="Direct link to 8.2 Compatible Changes" title="Direct link to 8.2 Compatible Changes" translate="no">​</a></h3>
<p>✅ <strong>Allowed:</strong></p>
<ul>
<li>Add new RPC methods</li>
<li>Add new optional fields</li>
<li>Add new enum values (with <code>UNSPECIFIED</code> default)</li>
<li>Add new message types</li>
<li>Deprecate (but don&#x27;t remove) fields</li>
</ul>
<p>❌ <strong>Not Allowed:</strong></p>
<ul>
<li>Remove or rename fields</li>
<li>Change field numbers</li>
<li>Change field types</li>
<li>Remove RPC methods</li>
<li>Change RPC signatures</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="83-deprecation-process">8.3 Deprecation Process<a href="#83-deprecation-process" class="hash-link" aria-label="Direct link to 8.3 Deprecation Process" title="Direct link to 8.3 Deprecation Process" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message OldRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string field1 = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string field2 = 2 [deprecated = true];  // Mark deprecated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string field3 = 3;  // New replacement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service MyService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc OldMethod(OldRequest) returns (OldResponse) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    option deprecated = true;  // Mark deprecated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc NewMethod(NewRequest) returns (NewResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-client-libraries">9. Client Libraries<a href="#9-client-libraries" class="hash-link" aria-label="Direct link to 9. Client Libraries" title="Direct link to 9. Client Libraries" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="91-generated-clients">9.1 Generated Clients<a href="#91-generated-clients" class="hash-link" aria-label="Direct link to 9.1 Generated Clients" title="Direct link to 9.1 Generated Clients" translate="no">​</a></h3>
<p>All languages get generated clients:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Rust</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buf generate --template buf.gen.rust.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buf generate --template buf.gen.go.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buf generate --template buf.gen.python.yaml</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="92-client-patterns">9.2 Client Patterns<a href="#92-client-patterns" class="hash-link" aria-label="Direct link to 9.2 Client Patterns" title="Direct link to 9.2 Client Patterns" translate="no">​</a></h3>
<p><strong>Connection Management:</strong></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Create connection with keepalive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> grpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Dial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;prism.example.com:8980&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    grpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithTransportCredentials</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">creds</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    grpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithKeepaliveParams</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">keepalive</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ClientParameters</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Create clients</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sessionClient </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewSessionServiceClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">queueClient </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewQueueServiceClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Metadata Propagation:</strong></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Add session token to metadata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">md </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Pairs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;x-session-token&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sessionToken</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctx </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewOutgoingContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> md</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Or use interceptor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sessionTokenInterceptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> grpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UnaryClientInterceptor </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> method </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reply </span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cc </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">grpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ClientConn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> invoker grpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UnaryInvoker</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> opts </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">grpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CallOption</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        md </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Pairs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;x-session-token&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ctx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewOutgoingContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> md</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">invoker</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reply</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> opts</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="10-performance-considerations">10. Performance Considerations<a href="#10-performance-considerations" class="hash-link" aria-label="Direct link to 10. Performance Considerations" title="Direct link to 10. Performance Considerations" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="101-connection-pooling">10.1 Connection Pooling<a href="#101-connection-pooling" class="hash-link" aria-label="Direct link to 10.1 Connection Pooling" title="Direct link to 10.1 Connection Pooling" translate="no">​</a></h3>
<ul>
<li>Reuse gRPC connections</li>
<li>Use HTTP/2 multiplexing (multiple RPCs per connection)</li>
<li>Configure connection pool size based on load</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="102-streaming-best-practices">10.2 Streaming Best Practices<a href="#102-streaming-best-practices" class="hash-link" aria-label="Direct link to 10.2 Streaming Best Practices" title="Direct link to 10.2 Streaming Best Practices" translate="no">​</a></h3>
<p><strong>Server Streaming:</strong></p>
<ul>
<li>Use backpressure (flow control)</li>
<li>Set reasonable page sizes</li>
<li>Use cursors for resumption</li>
</ul>
<p><strong>Client Streaming:</strong></p>
<ul>
<li>Batch writes when possible</li>
<li>Use buffering to reduce round trips</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="103-timeouts">10.3 Timeouts<a href="#103-timeouts" class="hash-link" aria-label="Direct link to 10.3 Timeouts" title="Direct link to 10.3 Timeouts" translate="no">​</a></h3>
<p>Set appropriate timeouts:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cancel </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cancel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="11-security">11. Security<a href="#11-security" class="hash-link" aria-label="Direct link to 11. Security" title="Direct link to 11. Security" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="111-transport-security">11.1 Transport Security<a href="#111-transport-security" class="hash-link" aria-label="Direct link to 11.1 Transport Security" title="Direct link to 11.1 Transport Security" translate="no">​</a></h3>
<ul>
<li>TLS 1.3 required</li>
<li>mTLS for service-to-service</li>
<li>Certificate rotation support</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="112-authentication">11.2 Authentication<a href="#112-authentication" class="hash-link" aria-label="Direct link to 11.2 Authentication" title="Direct link to 11.2 Authentication" translate="no">​</a></h3>
<p>Session tokens in metadata:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x-session-token: sess-abc123def456</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="113-authorization">11.3 Authorization<a href="#113-authorization" class="hash-link" aria-label="Direct link to 11.3 Authorization" title="Direct link to 11.3 Authorization" translate="no">​</a></h3>
<ul>
<li>Namespace-level permissions</li>
<li>Operation-level permissions</li>
<li>Row-level security (future)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="12-testing">12. Testing<a href="#12-testing" class="hash-link" aria-label="Direct link to 12. Testing" title="Direct link to 12. Testing" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="121-unit-tests">12.1 Unit Tests<a href="#121-unit-tests" class="hash-link" aria-label="Direct link to 12.1 Unit Tests" title="Direct link to 12.1 Unit Tests" translate="no">​</a></h3>
<p>Test generated code and client logic:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TestPublish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">testing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Mock server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mockQueueService</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        publishFunc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PublishRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PublishResponse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PublishResponse</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                MessageId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;msg-123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Offset</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Partition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Test client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NoError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Equal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;msg-123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MessageId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="122-integration-tests">12.2 Integration Tests<a href="#122-integration-tests" class="hash-link" aria-label="Direct link to 12.2 Integration Tests" title="Direct link to 12.2 Integration Tests" translate="no">​</a></h3>
<p>Test against real server:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TestQueueIntegration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">testing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Start test server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">startTestServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Stop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Create client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conn </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dialTestServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Addr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewQueueServiceClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Test flow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pubResp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PublishRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stream</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SubscribeRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> stream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Recv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Equal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pubResp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MessageId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MessageId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="13-references">13. References<a href="#13-references" class="hash-link" aria-label="Direct link to 13. References" title="Direct link to 13. References" translate="no">​</a></h2>
<ul>
<li>RFC-001: Prism Architecture</li>
<li>ADR-023: gRPC-First Interface Design</li>
<li>ADR-024: Layered Interface Hierarchy</li>
<li><a href="https://grpc.io/docs/" target="_blank" rel="noopener noreferrer">gRPC Documentation</a></li>
<li><a href="https://protobuf.dev/programming-guides/style/" target="_blank" rel="noopener noreferrer">Protobuf Style Guide</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="14-revision-history">14. Revision History<a href="#14-revision-history" class="hash-link" aria-label="Direct link to 14. Revision History" title="Direct link to 14. Revision History" translate="no">​</a></h2>
<ul>
<li>2025-10-07: Initial draft</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/jrepp/prism-data-layer/tree/main/docs-cms/../docs-cms/rfcs/RFC-002-data-layer-interface.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/prism-data-layer/rfc/RFC-001-prism-architecture"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">RFC-001: Prism Data Access Layer Architecture</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/prism-data-layer/rfc/RFC-003-admin-interface"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">RFC-003: Admin Interface for Prism</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#abstract" class="table-of-contents__link toc-highlight">Abstract</a></li><li><a href="#1-introduction" class="table-of-contents__link toc-highlight">1. Introduction</a><ul><li><a href="#11-purpose" class="table-of-contents__link toc-highlight">1.1 Purpose</a></li><li><a href="#12-design-principles" class="table-of-contents__link toc-highlight">1.2 Design Principles</a></li><li><a href="#13-service-overview" class="table-of-contents__link toc-highlight">1.3 Service Overview</a></li></ul></li><li><a href="#2-session-service" class="table-of-contents__link toc-highlight">2. Session Service</a><ul><li><a href="#21-overview" class="table-of-contents__link toc-highlight">2.1 Overview</a></li><li><a href="#22-service-definition" class="table-of-contents__link toc-highlight">2.2 Service Definition</a></li><li><a href="#23-messages" class="table-of-contents__link toc-highlight">2.3 Messages</a></li><li><a href="#24-usage-examples" class="table-of-contents__link toc-highlight">2.4 Usage Examples</a></li></ul></li><li><a href="#3-queue-service" class="table-of-contents__link toc-highlight">3. Queue Service</a><ul><li><a href="#31-overview" class="table-of-contents__link toc-highlight">3.1 Overview</a></li><li><a href="#32-service-definition" class="table-of-contents__link toc-highlight">3.2 Service Definition</a></li><li><a href="#33-messages" class="table-of-contents__link toc-highlight">3.3 Messages</a></li><li><a href="#34-usage-examples" class="table-of-contents__link toc-highlight">3.4 Usage Examples</a></li></ul></li><li><a href="#4-pubsub-service" class="table-of-contents__link toc-highlight">4. PubSub Service</a><ul><li><a href="#41-overview" class="table-of-contents__link toc-highlight">4.1 Overview</a></li><li><a href="#42-service-definition" class="table-of-contents__link toc-highlight">4.2 Service Definition</a></li><li><a href="#43-messages" class="table-of-contents__link toc-highlight">4.3 Messages</a></li><li><a href="#44-usage-examples" class="table-of-contents__link toc-highlight">4.4 Usage Examples</a></li></ul></li><li><a href="#5-reader-service" class="table-of-contents__link toc-highlight">5. Reader Service</a><ul><li><a href="#51-overview" class="table-of-contents__link toc-highlight">5.1 Overview</a></li><li><a href="#52-service-definition" class="table-of-contents__link toc-highlight">5.2 Service Definition</a></li><li><a href="#53-messages" class="table-of-contents__link toc-highlight">5.3 Messages</a></li><li><a href="#54-usage-examples" class="table-of-contents__link toc-highlight">5.4 Usage Examples</a></li></ul></li><li><a href="#6-transact-service" class="table-of-contents__link toc-highlight">6. Transact Service</a><ul><li><a href="#61-overview" class="table-of-contents__link toc-highlight">6.1 Overview</a></li><li><a href="#62-service-definition" class="table-of-contents__link toc-highlight">6.2 Service Definition</a></li><li><a href="#63-messages" class="table-of-contents__link toc-highlight">6.3 Messages</a></li><li><a href="#64-usage-examples" class="table-of-contents__link toc-highlight">6.4 Usage Examples</a></li></ul></li><li><a href="#7-error-handling" class="table-of-contents__link toc-highlight">7. Error Handling</a><ul><li><a href="#71-grpc-status-codes" class="table-of-contents__link toc-highlight">7.1 gRPC Status Codes</a></li><li><a href="#72-error-details" class="table-of-contents__link toc-highlight">7.2 Error Details</a></li><li><a href="#73-client-error-handling" class="table-of-contents__link toc-highlight">7.3 Client Error Handling</a></li></ul></li><li><a href="#8-backward-compatibility" class="table-of-contents__link toc-highlight">8. Backward Compatibility</a><ul><li><a href="#81-versioning-strategy" class="table-of-contents__link toc-highlight">8.1 Versioning Strategy</a></li><li><a href="#82-compatible-changes" class="table-of-contents__link toc-highlight">8.2 Compatible Changes</a></li><li><a href="#83-deprecation-process" class="table-of-contents__link toc-highlight">8.3 Deprecation Process</a></li></ul></li><li><a href="#9-client-libraries" class="table-of-contents__link toc-highlight">9. Client Libraries</a><ul><li><a href="#91-generated-clients" class="table-of-contents__link toc-highlight">9.1 Generated Clients</a></li><li><a href="#92-client-patterns" class="table-of-contents__link toc-highlight">9.2 Client Patterns</a></li></ul></li><li><a href="#10-performance-considerations" class="table-of-contents__link toc-highlight">10. Performance Considerations</a><ul><li><a href="#101-connection-pooling" class="table-of-contents__link toc-highlight">10.1 Connection Pooling</a></li><li><a href="#102-streaming-best-practices" class="table-of-contents__link toc-highlight">10.2 Streaming Best Practices</a></li><li><a href="#103-timeouts" class="table-of-contents__link toc-highlight">10.3 Timeouts</a></li></ul></li><li><a href="#11-security" class="table-of-contents__link toc-highlight">11. Security</a><ul><li><a href="#111-transport-security" class="table-of-contents__link toc-highlight">11.1 Transport Security</a></li><li><a href="#112-authentication" class="table-of-contents__link toc-highlight">11.2 Authentication</a></li><li><a href="#113-authorization" class="table-of-contents__link toc-highlight">11.3 Authorization</a></li></ul></li><li><a href="#12-testing" class="table-of-contents__link toc-highlight">12. Testing</a><ul><li><a href="#121-unit-tests" class="table-of-contents__link toc-highlight">12.1 Unit Tests</a></li><li><a href="#122-integration-tests" class="table-of-contents__link toc-highlight">12.2 Integration Tests</a></li></ul></li><li><a href="#13-references" class="table-of-contents__link toc-highlight">13. References</a></li><li><a href="#14-revision-history" class="table-of-contents__link toc-highlight">14. Revision History</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/adr">ADRs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/rfc">RFCs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Project</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Prism. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>