<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-rfc docs-version-current docs-doc-page docs-doc-id-rfc-010" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Admin Protocol with OIDC Authentication | Prism</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jrepp.github.io/prism-data-layer/rfc/rfc-010"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" property="og:title" content="Admin Protocol with OIDC Authentication | Prism"><meta data-rh="true" name="description" content="Abstract"><meta data-rh="true" property="og:description" content="Abstract"><link data-rh="true" rel="icon" href="/prism-data-layer/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-010"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-010" hreflang="en"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-010" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Admin Protocol with OIDC Authentication • RFC-010","item":"https://jrepp.github.io/prism-data-layer/rfc/rfc-010"}]}</script><link rel="stylesheet" href="/prism-data-layer/assets/css/styles.3b9928e7.css">
<script src="/prism-data-layer/assets/js/runtime~main.9b513438.js" defer="defer"></script>
<script src="/prism-data-layer/assets/js/main.77fbf61e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/prism-data-layer/"><div class="navbar__logo"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">Prism</b></a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/intro">Overview</a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/changelog">Change Log</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Documentation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/prism-data-layer/adr">ADRs (Architecture Decision Records)</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/prism-data-layer/rfc">RFCs (Request for Comments)</a></li><li><a class="dropdown__link" href="/prism-data-layer/memos">Memos (Technical Analysis)</a></li><li><a class="dropdown__link" href="/prism-data-layer/prds">PRDs (Product Requirements)</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="buildInfo_asc2"><span class="version_ADrX" title="Build: f3c4668">f3c4668</span><span class="separator_VfCt">•</span><span class="buildTime_n1Nn" title="Last updated: Oct 13">Oct 13</span></div><div class="navbar__item"><a href="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml" target="_blank" rel="noopener noreferrer" title="GitHub Pages" style="display: flex; align-items: center; padding: 0 0.5rem;"><img src="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml/badge.svg" alt="Build" style="margin: 0;"></a></div><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_x44X"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/"><span title="Request for Comments (RFCs)" class="linkLabel_WmDU">Request for Comments (RFCs)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-001"><span title="Prism Data Access Layer Architecture • RFC-001" class="linkLabel_WmDU">Prism Data Access Layer Architecture • RFC-001</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-002"><span title="Data Layer Interface Specification • RFC-002" class="linkLabel_WmDU">Data Layer Interface Specification • RFC-002</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-003"><span title="Admin Interface for Prism • RFC-003" class="linkLabel_WmDU">Admin Interface for Prism • RFC-003</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-004"><span title="Redis Integration for Cache, PubSub, and Vector Search • RFC-004" class="linkLabel_WmDU">Redis Integration for Cache, PubSub, and Vector Search • RFC-004</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-005"><span title="ClickHouse Integration for Time Series Analytics • RFC-005" class="linkLabel_WmDU">ClickHouse Integration for Time Series Analytics • RFC-005</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-006"><span title="RFC-006 Admin CLI" class="linkLabel_WmDU">RFC-006 Admin CLI</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-007"><span title="RFC-007 Cache Strategies" class="linkLabel_WmDU">RFC-007 Cache Strategies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-008"><span title="RFC-008 Plugin Architecture" class="linkLabel_WmDU">RFC-008 Plugin Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-009"><span title="Distributed Reliability Data Patterns • RFC-009" class="linkLabel_WmDU">Distributed Reliability Data Patterns • RFC-009</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/prism-data-layer/rfc/rfc-010"><span title="Admin Protocol with OIDC Authentication • RFC-010" class="linkLabel_WmDU">Admin Protocol with OIDC Authentication • RFC-010</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-011"><span title="Data Proxy Authentication (Input/Output) • RFC-011" class="linkLabel_WmDU">Data Proxy Authentication (Input/Output) • RFC-011</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-012"><span title="Prism Network Gateway (prism-netgw) - Multi-Region Control Plane • RFC-012" class="linkLabel_WmDU">Prism Network Gateway (prism-netgw) - Multi-Region Control Plane • RFC-012</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-013"><span title="Neptune Graph Backend Implementation • RFC-013" class="linkLabel_WmDU">Neptune Graph Backend Implementation • RFC-013</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-014"><span title="Layered Data Access Patterns • RFC-014" class="linkLabel_WmDU">Layered Data Access Patterns • RFC-014</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-015"><span title="Plugin Acceptance Test Framework (Interface-Based Testing) • RFC-015" class="linkLabel_WmDU">Plugin Acceptance Test Framework (Interface-Based Testing) • RFC-015</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-016"><span title="Local Development Infrastructure • RFC-016" class="linkLabel_WmDU">Local Development Infrastructure • RFC-016</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-017"><span title="Multicast Registry Pattern • RFC-017" class="linkLabel_WmDU">Multicast Registry Pattern • RFC-017</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-018"><span title="POC Implementation Strategy • RFC-018" class="linkLabel_WmDU">POC Implementation Strategy • RFC-018</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-019"><span title="Pattern SDK Authorization Layer - Token Validation and Policy Enforcement • RFC-019" class="linkLabel_WmDU">Pattern SDK Authorization Layer - Token Validation and Policy Enforcement • RFC-019</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-020"><span title="Streaming HTTP Listener - API-Specific Adapter Pattern • RFC-020" class="linkLabel_WmDU">Streaming HTTP Listener - API-Specific Adapter Pattern • RFC-020</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-021"><span title="POC 1 - Three Minimal Plugins Implementation Plan • RFC-021" class="linkLabel_WmDU">POC 1 - Three Minimal Plugins Implementation Plan • RFC-021</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-022"><span title="Core Pattern SDK - Build System and Physical Code Layout • RFC-022" class="linkLabel_WmDU">Core Pattern SDK - Build System and Physical Code Layout • RFC-022</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-023"><span title="Publish Snapshotter Plugin - Write-Only Event Buffering with Pagination • RFC-023" class="linkLabel_WmDU">Publish Snapshotter Plugin - Write-Only Event Buffering with Pagination • RFC-023</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-024"><span title="Distributed Session Store Pattern - Cross-Region Session Management • RFC-024" class="linkLabel_WmDU">Distributed Session Store Pattern - Cross-Region Session Management • RFC-024</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-025"><span title="Pattern SDK Architecture - Backend Drivers and Concurrency Primitives • RFC-025" class="linkLabel_WmDU">Pattern SDK Architecture - Backend Drivers and Concurrency Primitives • RFC-025</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-026"><span title="POC 1 - KeyValue with MemStore Implementation Plan (Original) • RFC-026" class="linkLabel_WmDU">POC 1 - KeyValue with MemStore Implementation Plan (Original) • RFC-026</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-027"><span title="Namespace Configuration and Client Request Flow • RFC-027" class="linkLabel_WmDU">Namespace Configuration and Client Request Flow • RFC-027</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-028"><span title="prism-probe - CLI Client for Testing and Debugging • RFC-028" class="linkLabel_WmDU">prism-probe - CLI Client for Testing and Debugging • RFC-028</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/rfc-029"><span title="Load Testing Framework Evaluation and Strategy • RFC-029" class="linkLabel_WmDU">Load Testing Framework Evaluation and Strategy • RFC-029</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/prism-data-layer/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Admin Protocol with OIDC Authentication • RFC-010</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="docMetadata_NQcq"><div class="tagsRow_ipDH"><span class="tag_VbXK">admin</span><span class="tag_VbXK">oidc</span><span class="tag_VbXK">authentication</span><span class="tag_VbXK">grpc</span><span class="tag_VbXK">protocol</span></div><div class="metadataRow_PvZM"><span class="metadataItem_RMFE info_Qo8L"><strong>Status:</strong> <!-- -->Proposed</span><span class="metadataItem_RMFE"><strong>Author:</strong> <!-- -->Platform Team</span><span class="metadataItem_RMFE"><strong>Created:</strong> <!-- -->Oct 8, 2025</span><span class="metadataItem_RMFE"><strong>Updated:</strong> <!-- -->Oct 8, 2025</span></div></div><div class="theme-doc-markdown markdown"><header><h1>Admin Protocol with OIDC Authentication</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a href="#abstract" class="hash-link" aria-label="Direct link to Abstract" title="Direct link to Abstract" translate="no">​</a></h2>
<p>This RFC specifies the complete Admin Protocol for Prism, including OIDC-based authentication with provable identity, request/response flows, session management, and operational procedures. The Admin API enables platform teams to manage configurations, monitor sessions, check backend health, and perform operational tasks with strong authentication and audit trails.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation" translate="no">​</a></h2>
<p>Platform teams require secure, authenticated access to Prism administration with:</p>
<ul>
<li><strong>Provable Identity</strong>: OIDC tokens with claims from identity provider</li>
<li><strong>Role-Based Access</strong>: Different permission levels (admin, operator, viewer)</li>
<li><strong>Audit Trail</strong>: Every administrative action logged with actor identity</li>
<li><strong>Session Management</strong>: Long-lived sessions for interactive use, short-lived for automation</li>
<li><strong>Network Isolation</strong>: Admin API on separate port, internal-only access</li>
</ul>
<p><strong>Goals:</strong></p>
<ul>
<li>Define complete Admin gRPC protocol</li>
<li>Specify OIDC authentication flow with token acquisition</li>
<li>Document request/response patterns with sequence diagrams</li>
<li>Establish session lifecycle and management</li>
<li>Enable audit logging for compliance</li>
</ul>
<p><strong>Non-Goals:</strong></p>
<ul>
<li>Data plane authentication (covered in RFC-011)</li>
<li>User-facing authentication (application responsibility)</li>
<li>Multi-cluster admin (single cluster scope)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="protocol-overview">Protocol Overview<a href="#protocol-overview" class="hash-link" aria-label="Direct link to Protocol Overview" title="Direct link to Protocol Overview" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture" translate="no">​</a></h3>
<p>┌───────────────────────────────────────────────────────────────┐
│                      Admin Workflow                           │
└───────────────────────────────────────────────────────────────┘</p>
<p>Administrator → OIDC Provider → Admin CLI/UI → Prism Admin API → Backends
(1)            (2)              (3)              (4)</p>
<ol>
<li>Request identity token</li>
<li>Receive JWT with claims</li>
<li>Present JWT in gRPC metadata</li>
<li>Authorized operations</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Ports and Endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Data Plane**: Port 8980 (gRPC, public)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Admin API**: Port 8981 (gRPC, internal-only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Metrics**: Port 9090 (Prometheus, internal-only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Protocol Stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ Admin Client (CLI/UI/Automation)               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────┬───────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 │ gRPC/HTTP2 + TLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 │ Authorization: Bearer &lt;jwt&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────▼───────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ Prism Admin Service (:8981)                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────────────────────────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Authentication Middleware                │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ - JWT validation                         │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ - Claims extraction                      │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ - RBAC policy check                      │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────────────────────────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────────────────────────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ AdminService Implementation              │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ - Configuration management               │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ - Session monitoring                     │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ - Backend health                         │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ - Operational commands                   │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────────────────────────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────────────────────────────────────┐ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ Audit Logger                             │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │ - Records actor + operation + result     │ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └───────  ───────────────────────────────────┘ │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────────────────────────────────────┘</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="oidc-authentication-flow">OIDC Authentication Flow<a href="#oidc-authentication-flow" class="hash-link" aria-label="Direct link to OIDC Authentication Flow" title="Direct link to OIDC Authentication Flow" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="token-acquisition">Token Acquisition<a href="#token-acquisition" class="hash-link" aria-label="Direct link to Token Acquisition" title="Direct link to Token Acquisition" translate="no">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jwt-structure">JWT Structure<a href="#jwt-structure" class="hash-link" aria-label="Direct link to JWT Structure" title="Direct link to JWT Structure" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;header&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;alg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RS256&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;typ&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;JWT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;kid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;key-2024-10&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;payload&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;iss&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://idp.example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;sub&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user:alice@company.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;aud&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;prismctl-api&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;exp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1696867200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;iat&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1696863600</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;email&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;alice@company.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;email_verified&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;groups&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;platform-team&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admins&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;scope&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin:read admin:write admin:operational&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;signature&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="token-validation">Token Validation<a href="#token-validation" class="hash-link" aria-label="Direct link to Token Validation" title="Direct link to Token Validation" translate="no">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">jsonwebtoken</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">decode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">DecodingKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Validation</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">serde</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token class-name">Deserialize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Serialize</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[derive(Debug, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Claims</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> sub</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> email_verified</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> groups</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">String</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> scope</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> exp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> iat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">JwtValidator</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    issuer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    audience</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jwks_client</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">JwksClient</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">impl</span><span class="token plain"> </span><span class="token class-name">JwtValidator</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">validate_token</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Claims</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Decode header to get key ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> header </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">decode_header</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> kid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> header</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ok_or</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">MissingKeyId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Fetch public key from JWKS endpoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> jwk </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jwks_client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">kid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> decoding_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">DecodingKey</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from_jwk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">jwk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Validate signature and claims</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> validation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Validation</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token namespace" style="opacity:0.7">jsonwebtoken</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Algorithm</span><span class="token punctuation" style="color:#393A34">::</span><span class="token constant" style="color:#36acaa">RS256</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        validation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_issuer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">issuer</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        validation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_audience</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">audience</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        validation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">validate_exp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> token_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">decode</span><span class="token punctuation" style="color:#393A34">::</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Claims</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">decoding_key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">validation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Additional validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">token_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">claims</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">email_verified </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">Err</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">EmailNotVerified</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">claims</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requestresponse-flows">Request/Response Flows<a href="#requestresponse-flows" class="hash-link" aria-label="Direct link to Request/Response Flows" title="Direct link to Request/Response Flows" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="namespace-creation-flow">Namespace Creation Flow<a href="#namespace-creation-flow" class="hash-link" aria-label="Direct link to Namespace Creation Flow" title="Direct link to Namespace Creation Flow" translate="no">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="session-monitoring-flow">Session Monitoring Flow<a href="#session-monitoring-flow" class="hash-link" aria-label="Direct link to Session Monitoring Flow" title="Direct link to Session Monitoring Flow" translate="no">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="backend-health-check-flow">Backend Health Check Flow<a href="#backend-health-check-flow" class="hash-link" aria-label="Direct link to Backend Health Check Flow" title="Direct link to Backend Health Check Flow" translate="no">​</a></h3>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="session-management">Session Management<a href="#session-management" class="hash-link" aria-label="Direct link to Session Management" title="Direct link to Session Management" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="session-lifecycle">Session Lifecycle<a href="#session-lifecycle" class="hash-link" aria-label="Direct link to Session Lifecycle" title="Direct link to Session Lifecycle" translate="no">​</a></h3>
<p>Admin sessions support both interactive use (CLI) and automation (CI/CD):</p>
<p><strong>Interactive Session:</strong></p>
<ul>
<li>Acquire OIDC token via device code flow</li>
<li>Token cached to <code>~/.prism/token</code></li>
<li>Token expires after 1 hour (refresh_token extends to 7 days)</li>
<li>Automatic token refresh on expiry</li>
</ul>
<p><strong>Automation Session:</strong></p>
<ul>
<li>Service account with client_credentials grant</li>
<li>Token expires after 1 hour (no refresh token)</li>
<li>Must re-authenticate for new token</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="session-establishment">Session Establishment<a href="#session-establishment" class="hash-link" aria-label="Direct link to Session Establishment" title="Direct link to Session Establishment" translate="no">​</a></h3>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="grpc-protocol-specification">gRPC Protocol Specification<a href="#grpc-protocol-specification" class="hash-link" aria-label="Direct link to gRPC Protocol Specification" title="Direct link to gRPC Protocol Specification" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-definition">Service Definition<a href="#service-definition" class="hash-link" aria-label="Direct link to Service Definition" title="Direct link to Service Definition" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">syntax</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;proto3&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">admin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;google/protobuf/timestamp.proto&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;google/protobuf/duration.proto&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;google/protobuf/empty.proto&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">AdminService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Configuration Management</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ListConfigs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListConfigsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListConfigsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetConfigRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetConfigResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CreateConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CreateConfigRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CreateConfigResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">UpdateConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">UpdateConfigRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">UpdateConfigResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DeleteConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteConfigRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteConfigResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Namespace Management</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ListNamespaces</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListNamespacesRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListNamespacesResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CreateNamespace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CreateNamespaceRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CreateNamespaceResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">UpdateNamespace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">UpdateNamespaceRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">UpdateNamespaceResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DeleteNamespace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteNamespaceRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteNamespaceResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetNamespace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetNamespaceRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetNamespaceResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Session Management</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ListSessions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListSessionsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListSessionsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetSession</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetSessionRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetSessionResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TerminateSession</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TerminateSessionRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TerminateSessionResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Backend Health</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetBackendStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetBackendStatusRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetBackendStatusResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ListBackends</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListBackendsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListBackendsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Operational Commands</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SetMaintenanceMode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SetMaintenanceModeRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SetMaintenanceModeResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DrainConnections</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DrainConnectionsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DrainConnectionsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetMetrics</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetMetricsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetMetricsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Audit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetAuditLog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetAuditLogRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">stream</span><span class="token plain"> </span><span class="token class-name">AuditLogEntry</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metadata-requirements">Metadata Requirements<a href="#metadata-requirements" class="hash-link" aria-label="Direct link to Metadata Requirements" title="Direct link to Metadata Requirements" translate="no">​</a></h3>
<p>All requests must include:</p>
<p>authorization: Bearer &lt;jwt_token&gt;
request-id: <uuid>  // Optional but recommended</uuid></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Error Codes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Standard gRPC status codes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- `OK (0)`: Success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- `INVALID_ARGUMENT (3)`: Invalid request parameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- `NOT_FOUND (5)`: Resource not found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- `ALREADY_EXISTS (6)`: Resource already exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- `PERMISSION_DENIED (7)`: Insufficient permissions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- `UNAUTHENTICATED (16)`: Missing or invalid JWT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- `INTERNAL (13)`: Server error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## RBAC Policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Roles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>roles:
admin:
description: Full administrative access
permissions:
- admin:read
- admin:write
- admin:operational
- admin:audit</p>
<p>operator:
description: Operational tasks, read-only config
permissions:
- admin:read
- admin:operational</p>
<p>viewer:
description: Read-only access
permissions:
- admin:read</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Permission Mapping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Operation | Required Permission |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-----------|-------------------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| ListNamespaces | `admin:read` |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| CreateNamespace | `admin:write` |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| UpdateNamespace | `admin:write` |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| DeleteNamespace | `admin:write` |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| ListSessions | `admin:read` |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| TerminateSession | `admin:operational` |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| GetBackendStatus | `admin:read` |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| SetMaintenanceMode | `admin:operational` |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| DrainConnections | `admin:operational` |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| GetAuditLog | `admin:audit` |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Authorization Middleware</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>use tonic::{Request, Status};
use tonic::metadata::MetadataMap;</p>
<p>pub struct AuthInterceptor {
jwt_validator: Arc<jwtvalidator>,
rbac: Arc<rbacservice>,
}</rbacservice></jwtvalidator></p>
<p>impl AuthInterceptor {
pub async fn intercept(&amp;self, mut req: Request&lt;()&gt;) -&gt; Result&lt;Request&lt;()&gt;, Status&gt; {
// Extract JWT from metadata
let token = req.metadata()
.get(&quot;authorization&quot;)
.and_then(|v| v.to_str().ok())
.and_then(|s| s.strip_prefix(&quot;Bearer &quot;))
.ok_or_else(|| Status::unauthenticated(&quot;Missing authorization header&quot;))?;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    // Validate JWT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let claims = self.jwt_validator.validate_token(token).await</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .map_err(|e| Status::unauthenticated(format!(&quot;Invalid token: {}&quot;, e)))?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Extract required permission from method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let method = req.uri().path();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let required_permission = self.method_to_permission(method);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Check RBAC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if !self.rbac.has_permission(&amp;claims, &amp;required_permission).await {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Err(Status::permission_denied(format!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;User {} lacks permission {}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            claims.email, required_permission</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Inject claims into request extensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    req.extensions_mut().insert(claims);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(req)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn method_to_permission(&amp;self, method: &amp;str) -&gt; String {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match method {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;/prism.admin.v1.AdminService/CreateNamespace&quot; =&gt; &quot;admin:write&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;/prism.admin.v1.AdminService/ListNamespaces&quot; =&gt; &quot;admin:read&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;/prism.admin.v1.AdminService/SetMaintenanceMode&quot; =&gt; &quot;admin:operational&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;/prism.admin.v1.AdminService/GetAuditLog&quot; =&gt; &quot;admin:audit&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; &quot;admin:read&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }.to_string()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Audit Logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Audit Entry Structure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>#[derive(Debug, Serialize)]
pub struct AuditLogEntry {
pub id: Uuid,
pub timestamp: DateTime<utc>,
pub actor: String,              // Claims.email
pub actor_groups: Vec<string>,  // Claims.groups
pub operation: String,           // &quot;CreateNamespace&quot;
pub resource_type: String,       // &quot;namespace&quot;
pub resource_id: String,         // &quot;analytics&quot;
pub namespace: Option<string>,
pub request_id: Option<string>,
pub success: bool,
pub error: Option<string>,
pub metadata: serde_json::Value,
}</string></string></string></string></utc></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>CREATE TABLE admin_audit_log (
id UUID PRIMARY KEY,
timestamp TIMESTAMPTZ NOT NULL,
actor VARCHAR(255) NOT NULL,
actor_groups TEXT[] NOT NULL,
operation VARCHAR(255) NOT NULL,
resource_type VARCHAR(100) NOT NULL,
resource_id VARCHAR(255) NOT NULL,
namespace VARCHAR(255),
request_id VARCHAR(100),
success BOOLEAN NOT NULL,
error TEXT,
metadata JSONB,</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">INDEX idx_audit_timestamp ON admin_audit_log(timestamp DESC),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INDEX idx_audit_actor ON admin_audit_log(actor),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INDEX idx_audit_operation ON admin_audit_log(operation),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INDEX idx_audit_namespace ON admin_audit_log(namespace)</span><br></span></code></pre></div></div>
<p>);</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Security Considerations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Network Isolation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Kubernetes NetworkPolicy</h1>
<p>apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
name: prismctl-policy
spec:
podSelector:
matchLabels:
app: prism-proxy
ingress:</p>
<ul>
<li>from:
<ul>
<li>podSelector:
matchLabels:
role: admin  # Only admin pods
ports:</li>
<li>protocol: TCP
port: 8981</li>
</ul>
</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Rate Limiting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>use governor::{Quota, RateLimiter};</p>
<p>pub struct RateLimitInterceptor {
limiter: Arc&lt;RateLimiter<string>&gt;,  // Key: actor email
}</string></p>
<p>impl RateLimitInterceptor {
pub fn new() -&gt; Self {
// 100 requests per minute per user
let quota = Quota::per_minute(NonZeroU32::new(100).unwrap());
Self {
limiter: Arc::new(RateLimiter::keyed(quota)),
}
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub async fn check(&amp;self, claims: &amp;Claims) -&gt; Result&lt;(), Status&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if self.limiter.check_key(&amp;claims.email).is_err() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Err(Status::resource_exhausted(format!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Rate limit exceeded for {}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            claims.email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### TLS Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>use tonic::transport::{Server, ServerTlsConfig};</p>
<p>let tls_config = ServerTlsConfig::new()
.identity(Identity::from_pem(cert_pem, key_pem))
.client_ca_root(Certificate::from_pem(ca_pem));</p>
<p>Server::builder()
.tls_config(tls_config)?
.add_service(AdminServiceServer::new(admin_service))
.serve(&quot;[::]:8981&quot;.parse()?)
.await?;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Docker Compose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>services:
prism-proxy:
image: prism/proxy:latest
ports:
- &quot;8980:8980&quot;  # Data plane
- &quot;8981:8981&quot;  # Admin API (bind to internal network only)
environment:
PRISM_ADMIN_PORT: 8981
PRISM_OIDC_ISSUER: <a href="https://idp.example.com" target="_blank" rel="noopener noreferrer">https://idp.example.com</a>
PRISM_OIDC_AUDIENCE: prismctl-api
PRISM_OIDC_JWKS_URI: <a href="https://idp.example.com/.well-known/jwks.json" target="_blank" rel="noopener noreferrer">https://idp.example.com/.well-known/jwks.json</a>
networks:
- internal  # Admin API not exposed publicly</p>
<p>networks:
internal:
internal: true</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="apiversion-appsv1kind-deploymentmetadataname-prism-proxyspectemplatespeccontainers--name-proxyimage-prismproxyports--containerport-8980name-data--containerport-8981name-adminenv--name-prism_oidc_issuervaluefromsecretkeyrefname-prism-oidckey-issuer--name-prism_oidc_audiencevaluefromsecretkeyrefname-prism-oidckey-audience">apiVersion: apps/v1
kind: Deployment
metadata:
name: prism-proxy
spec:
template:
spec:
containers:
- name: proxy
image: prism/proxy:latest
ports:
- containerPort: 8980
name: data
- containerPort: 8981
name: admin
env:
- name: PRISM_OIDC_ISSUER
valueFrom:
secretKeyRef:
name: prism-oidc
key: issuer
- name: PRISM_OIDC_AUDIENCE
valueFrom:
secretKeyRef:
name: prism-oidc
key: audience<a href="#apiversion-appsv1kind-deploymentmetadataname-prism-proxyspectemplatespeccontainers--name-proxyimage-prismproxyports--containerport-8980name-data--containerport-8981name-adminenv--name-prism_oidc_issuervaluefromsecretkeyrefname-prism-oidckey-issuer--name-prism_oidc_audiencevaluefromsecretkeyrefname-prism-oidckey-audience" class="hash-link" aria-label="Direct link to apiVersion: apps/v1
kind: Deployment
metadata:
name: prism-proxy
spec:
template:
spec:
containers:
- name: proxy
image: prism/proxy:latest
ports:
- containerPort: 8980
name: data
- containerPort: 8981
name: admin
env:
- name: PRISM_OIDC_ISSUER
valueFrom:
secretKeyRef:
name: prism-oidc
key: issuer
- name: PRISM_OIDC_AUDIENCE
valueFrom:
secretKeyRef:
name: prism-oidc
key: audience" title="Direct link to apiVersion: apps/v1
kind: Deployment
metadata:
name: prism-proxy
spec:
template:
spec:
containers:
- name: proxy
image: prism/proxy:latest
ports:
- containerPort: 8980
name: data
- containerPort: 8981
name: admin
env:
- name: PRISM_OIDC_ISSUER
valueFrom:
secretKeyRef:
name: prism-oidc
key: issuer
- name: PRISM_OIDC_AUDIENCE
valueFrom:
secretKeyRef:
name: prism-oidc
key: audience" translate="no">​</a></h2>
<p>apiVersion: v1
kind: Service
metadata:
name: prismctl
spec:
type: ClusterIP  # Internal only
selector:
app: prism-proxy
ports:</p>
<ul>
<li>port: 8981
targetPort: 8981
name: admin</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Integration Tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>func TestAdminProtocol(t *testing.T) {
// Start mock OIDC server
oidcServer := mockoidc.NewServer(t)
defer oidcServer.Close()</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Start Prism Admin API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">adminAPI := startAdminAPI(t, oidcServer.URL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">defer adminAPI.Close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Acquire token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">token, err := oidcServer.AcquireToken(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;alice@example.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    []string{&quot;admin:read&quot;, &quot;admin:write&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require.NoError(t, err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conn, err := grpc.Dial(adminAPI.Address(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    grpc.WithTransportCredentials(insecure.NewCredentials()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    grpc.WithPerRPCCredentials(BearerToken{token}),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require.NoError(t, err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">defer conn.Close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client := admin.NewAdminServiceClient(conn)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resp, err := client.CreateNamespace(context.Background(), &amp;admin.CreateNamespaceRequest{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name: &quot;test-namespace&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Description: &quot;Test namespace&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require.NoError(t, err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assert.Equal(t, &quot;test-namespace&quot;, resp.Namespace.Name)</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Open Questions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. **OIDC Provider Choice**: Support multiple providers (Okta, Auth0, Google, Azure AD)?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Feedback**: Yes, support AWS Cognito, Azure AD, Google, Okta, Auth0, and Dex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Multi-provider support enables flexibility across different organizational setups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Implementation approach:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - OIDC discovery endpoint (`.well-known/openid-configuration`) for automatic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Provider-specific configuration overrides for edge cases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Common JWT validation logic across all providers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Provider Matrix**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **AWS Cognito**: User pools, federated identities, integrates with AWS IAM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Azure AD**: Enterprise identity, conditional access policies, group claims</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Google Workspace**: Google SSO, organization-wide policies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Okta**: Enterprise SSO, MFA, rich group/role management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Auth0**: Developer-friendly, custom rules, social logins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Dex**: Self-hosted, LDAP/SAML connector, Kubernetes-native</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Recommended**: Start with Dex (self-hosted, testing) and one enterprise provider (Okta/Azure AD)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. **Token Caching**: How long to cache validated JWTs before re-validating?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Feedback**: Is that up to us? Make it configurable, default to 24 hours. Do we have support for refreshing tokens?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Token Validation Caching**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Validated JWTs can be cached to reduce JWKS fetches and validation overhead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Cache keyed by token hash, value contains validated claims</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Recommended**: Cache until token expiry (not beyond), configurable max TTL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Default: Cache for min(token.exp - now, 24 hours)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **JWKS Caching**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Public keys from JWKS endpoint should be cached aggressively</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Recommended**: Cache for 24 hours with background refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Invalidate on signature validation failure (key rotation)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Refresh Token Support**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Yes, implement refresh token flow for long-lived CLI sessions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Flow: When access_token expires, use refresh_token to get new access_token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Refresh tokens stored securely in `~/.prism/token` (mode 0600)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       token_cache:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         jwt_validation_ttl: 24h  # How long to cache validated JWTs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         jwks_cache_ttl: 24h      # How long to cache public keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         auto_refresh: true       # Automatically refresh expired tokens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Security Trade-offs**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Longer caching = better performance, but delayed revocation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Shorter caching = more validation overhead, but faster revocation response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Recommended**: Default 24h for trusted environments, 1h for high-security</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. **Offline Access**: Support for offline token validation (signed JWTs)?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Feedback**: Yes, discuss how, tradeoffs, and tech needed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Offline Validation Benefits**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - No dependency on OIDC provider for every request (reduces latency)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Proxy continues working during identity provider outage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Reduces load on identity provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **How to Implement**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Cache JWKS (public keys) locally with periodic refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Validate JWT signature using cached public keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Check standard claims (iss, aud, exp, nbf) locally</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **No online validation** = Can&#x27;t check real-time revocation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Technology Stack**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     use jsonwebtoken::{decode, DecodingKey, Validation, Algorithm};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     use reqwest::Client;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     pub struct OfflineValidator {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         jwks_cache: Arc&lt;RwLock&lt;HashMap&lt;String, Jwk&gt;&gt;&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         issuer: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         audience: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     impl OfflineValidator {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         pub async fn validate(&amp;self, token: &amp;str) -&gt; Result&lt;Claims&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             let header = decode_header(token)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             let kid = header.kid.ok_or(Error::MissingKeyId)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             // Use cached key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             let jwks = self.jwks_cache.read().await;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             let jwk = jwks.get(&amp;kid).ok_or(Error::UnknownKey)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             // Validate offline (no network call)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             let key = DecodingKey::from_jwk(jwk)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             let mut validation = Validation::new(Algorithm::RS256);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             validation.set_issuer(&amp;[&amp;self.issuer]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             validation.set_audience(&amp;[&amp;self.audience]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             let token_data = decode::&lt;Claims&gt;(token, &amp;key, &amp;validation)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             Ok(token_data.claims)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         // Periodic background refresh of JWKS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         pub async fn refresh_jwks(&amp;self) -&gt; Result&lt;()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             let jwks_uri = format!(&quot;{}/.well-known/jwks.json&quot;, self.issuer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             let jwks: JwkSet = reqwest::get(&amp;jwks_uri).await?.json().await?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             let mut cache = self.jwks_cache.write().await;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             for jwk in jwks.keys {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 if let Some(kid) = &amp;jwk.common.key_id {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     cache.insert(kid.clone(), jwk);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             Ok(())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Trade-offs**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - ✅ **Pros**: Lower latency, no OIDC dependency per-request, better availability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - ❌ **Cons**: Can&#x27;t detect real-time revocation, stale keys if JWKS refresh fails</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Security Considerations**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Risk**: Revoked tokens remain valid until expiry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Mitigation**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       - Use short-lived access tokens (1 hour)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       - Implement token revocation list (check periodically)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       - Alert on JWKS refresh failures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Recommended**: Enable offline validation with 1-hour token expiry and background JWKS refresh every 6 hours</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. **Multi-Tenancy**: How to map OIDC tenants to Prism namespaces?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Feedback**: Provide some options with tradeoffs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Option 1: Group-Based Mapping**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Use OIDC group claims to authorize namespace access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Example: Group `platform-team` → Can access all namespaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Example: Group `team-analytics` → Can access `analytics` namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       namespace_access:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         analytics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           groups: [&quot;team-analytics&quot;, &quot;platform-team&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         user-profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           groups: [&quot;team-users&quot;, &quot;platform-team&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Pros**: Simple, leverages existing IdP groups, easy to understand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Cons**: Tight coupling to IdP group structure, requires group sync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Option 2: Claim-Based Mapping**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Custom JWT claims define namespace access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Example: `&quot;namespaces&quot;: [&quot;analytics&quot;, &quot;user-profiles&quot;]`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - IdP adds custom claims during token issuance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       let authorized_namespaces = claims.custom</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           .get(&quot;namespaces&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           .and_then(|v| v.as_array())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           .map(|arr| arr.iter().filter_map(|v| v.as_str()).collect())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           .unwrap_or_default();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Pros**: Explicit, no group interpretation needed, flexible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Cons**: Requires custom IdP configuration, claim size limits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Option 3: Dynamic RBAC with External Policy**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - JWT provides identity, external policy engine (OPA/Cedar) decides access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Policy checks: `allow if user.email in namespace.allowed_users`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       # OPA policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       allow {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           input.user.email == &quot;alice@company.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           input.namespace == &quot;analytics&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       allow {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           &quot;platform-team&quot; in input.user.groups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Pros**: Most flexible, centralized policy management, audit trail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Cons**: Additional dependency (OPA), higher latency, more complex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Option 4: Tenant-Scoped OIDC Providers**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Each tenant has separate OIDC provider/application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Token issuer determines namespace access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Example: `iss: https://tenant-analytics.idp.com` → `analytics` namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       namespaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         analytics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           oidc_issuer: https://tenant-analytics.idp.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         user-profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           oidc_issuer: https://tenant-users.idp.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Pros**: Strong isolation, tenant-specific policies, clear boundaries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Cons**: Complex setup, multiple IdP integrations, higher overhead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Comparison Table**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | Approach | Complexity | Flexibility | Isolation | Performance |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |----------|-----------|------------|-----------|-------------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | Group-Based | Low | Medium | Low | High |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | Claim-Based | Medium | High | Medium | High |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | External Policy | High | Very High | Medium | Medium |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | Tenant-Scoped | Very High | Low | Very High | Medium |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Recommended**: Start with **Group-Based** for simplicity, evolve to **External Policy (OPA)** for enterprise multi-tenancy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. **Service Accounts**: Best practices for automation tokens?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Feedback**: Include some recommendations and tradeoffs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Recommendation 1: OAuth2 Client Credentials Flow**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Service accounts use client_id/client_secret to obtain tokens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - No user interaction required (headless authentication)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Flow:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       curl -X POST https://idp.example.com/oauth/token \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         -H &quot;Content-Type: application/x-www-form-urlencoded&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         -d &quot;grant_type=client_credentials&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         -d &quot;client_id=prism-ci-service&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         -d &quot;client_secret=&lt;secret&gt;&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         -d &quot;scope=admin:read admin:write&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       # CI/CD environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       PRISM_CLIENT_ID=prism-ci-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       PRISM_CLIENT_SECRET=&lt;secret&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       # CLI auto-detects and uses client credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       prismctl --auth=client-credentials namespace list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Pros**: Standard OAuth2 flow, widely supported, short-lived tokens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Cons**: Secret management required, no refresh tokens (must re-authenticate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Recommendation 2: Long-Lived API Keys**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Prism issues API keys directly (bypass OIDC for service accounts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Keys stored in database, validated by Prism (not IdP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Flow:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       # Generate key (admin operation)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       prismctl serviceaccount create ci-deploy --scopes admin:write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       # Returns: prism_key_abc123...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       # Use key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       export PRISM_API_KEY=prism_key_abc123...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       prismctl namespace create prod-analytics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       CREATE TABLE service_accounts (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           id UUID PRIMARY KEY,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           name VARCHAR(255) NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           key_hash VARCHAR(255) NOT NULL,  -- bcrypt hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           scopes TEXT[] NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           created_at TIMESTAMPTZ NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           expires_at TIMESTAMPTZ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           last_used_at TIMESTAMPTZ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Pros**: Simple, no IdP dependency, fine-grained scopes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Cons**: Not standard OAuth2, custom implementation, key rotation complexity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Recommendation 3: Kubernetes Service Account Tokens**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - For K8s deployments, use projected service account tokens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Tokens automatically rotated by Kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Flow:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       # Pod spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       - name: prism-token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         projected:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           sources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           - serviceAccountToken:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               audience: prism-admin-api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               expirationSeconds: 3600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               path: token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       # Mount at /var/run/secrets/prism/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       # CLI auto-detects and uses</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Pros**: Automatic rotation, no secret management, K8s-native</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Cons**: K8s-only, requires TokenRequest API, audience configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Recommendation 4: Short-Lived Tokens with Secure Storage**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Store client credentials in secret manager (Vault/AWS Secrets Manager)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Fetch credentials at runtime, obtain token, use, discard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       # Fetch from Vault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       export PRISM_CLIENT_SECRET=$(vault kv get -field=secret prism/ci-service)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       # Obtain token (automatically by CLI)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       prismctl namespace list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Pros**: Secrets never stored on disk, audit trail in secret manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - **Cons**: Dependency on secret manager, additional latency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Comparison Table**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | Approach | Security | Ease of Use | Rotation | K8s Native |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |----------|---------|------------|----------|-----------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | Client Credentials | Medium | High | Manual | No |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | API Keys | Low-Medium | Very High | Manual | No |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | K8s SA Tokens | High | High | Automatic | Yes |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | Secret Manager | High | Medium | Automatic | No |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - **Recommended Practices**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - ✅ Use **Client Credentials** for general automation (CI/CD, scripts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - ✅ Use **K8s SA Tokens** for in-cluster automation (CronJobs, Operators)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - ✅ Use **Secret Manager** for high-security environments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - ❌ Avoid long-lived API keys unless absolutely necessary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - ✅ Implement token rotation (max 90 days)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - ✅ Audit service account usage regularly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - ✅ Use least-privilege scopes (e.g., `admin:read` for monitoring)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## References</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [OAuth 2.0 Device Authorization Grant](https://datatracker.ietf.org/doc/html/rfc8628)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [OpenID Connect Core 1.0](https://openid.net/specs/openid-connect-core-1_0.html)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [JSON Web Token (JWT)](https://datatracker.ietf.org/doc/html/rfc7519)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [gRPC Authentication](https://grpc.io/docs/guides/auth/)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ADR-007: Authentication and Authorization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ADR-027: Admin API via gRPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- RFC-003: Admin Interface for Prism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Revision History</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 2025-10-09: Initial draft with OIDC flows and sequence diagrams</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 2025-10-09: Expanded open questions with feedback on multi-provider support (AWS/Azure/Google/Okta/Auth0/Dex), token caching (24h default with refresh token support), offline validation with JWKS caching, multi-tenancy mapping options (group/claim/OPA/tenant-scoped), and service account best practices (client credentials/API keys/K8s tokens/secret manager)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/admin">admin</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/oidc">oidc</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/authentication">authentication</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/grpc">grpc</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/protocol">protocol</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/jrepp/prism-data-layer/tree/main/docs-cms/../docs-cms/rfcs/rfc-010-admin-protocol-oidc.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/prism-data-layer/rfc/rfc-009"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Distributed Reliability Data Patterns • RFC-009</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/prism-data-layer/rfc/rfc-011"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Data Proxy Authentication (Input/Output) • RFC-011</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#abstract" class="table-of-contents__link toc-highlight">Abstract</a></li><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#protocol-overview" class="table-of-contents__link toc-highlight">Protocol Overview</a><ul><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a></li></ul></li><li><a href="#oidc-authentication-flow" class="table-of-contents__link toc-highlight">OIDC Authentication Flow</a><ul><li><a href="#token-acquisition" class="table-of-contents__link toc-highlight">Token Acquisition</a></li><li><a href="#jwt-structure" class="table-of-contents__link toc-highlight">JWT Structure</a></li><li><a href="#token-validation" class="table-of-contents__link toc-highlight">Token Validation</a></li></ul></li><li><a href="#requestresponse-flows" class="table-of-contents__link toc-highlight">Request/Response Flows</a><ul><li><a href="#namespace-creation-flow" class="table-of-contents__link toc-highlight">Namespace Creation Flow</a></li><li><a href="#session-monitoring-flow" class="table-of-contents__link toc-highlight">Session Monitoring Flow</a></li><li><a href="#backend-health-check-flow" class="table-of-contents__link toc-highlight">Backend Health Check Flow</a></li></ul></li><li><a href="#session-management" class="table-of-contents__link toc-highlight">Session Management</a><ul><li><a href="#session-lifecycle" class="table-of-contents__link toc-highlight">Session Lifecycle</a></li><li><a href="#session-establishment" class="table-of-contents__link toc-highlight">Session Establishment</a></li></ul></li><li><a href="#grpc-protocol-specification" class="table-of-contents__link toc-highlight">gRPC Protocol Specification</a><ul><li><a href="#service-definition" class="table-of-contents__link toc-highlight">Service Definition</a></li><li><a href="#metadata-requirements" class="table-of-contents__link toc-highlight">Metadata Requirements</a></li></ul></li><li><a href="#apiversion-appsv1kind-deploymentmetadataname-prism-proxyspectemplatespeccontainers--name-proxyimage-prismproxyports--containerport-8980name-data--containerport-8981name-adminenv--name-prism_oidc_issuervaluefromsecretkeyrefname-prism-oidckey-issuer--name-prism_oidc_audiencevaluefromsecretkeyrefname-prism-oidckey-audience" class="table-of-contents__link toc-highlight">apiVersion: apps/v1
kind: Deployment
metadata:
name: prism-proxy
spec:
template:
spec:
containers:
- name: proxy
image: prism/proxy
ports:
- containerPort: 8980
name: data
- containerPort: 8981
name: admin
env:
- name: PRISM_OIDC_ISSUER
valueFrom:
secretKeyRef:
name: prism-oidc
key: issuer
- name: PRISM_OIDC_AUDIENCE
valueFrom:
secretKeyRef:
name: prism-oidc
key: audience</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/intro">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/changelog">Change Log</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/adr">ADRs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/rfc">RFCs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/memos">Memos</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/prds">PRDs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Project</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div>Copyright © 2025 Prism. Built with Docusaurus.</div><div style="margin-top:0.5rem;font-size:0.875rem;opacity:0.8"><span>Version <!-- -->f3c4668</span><span> • </span><span>Built <!-- -->Oct 13, 2025, 10:32 AM PDT</span><span> • </span><span>Commit <!-- -->f3c4668</span></div></div></div></div></footer></div>
</body>
</html>