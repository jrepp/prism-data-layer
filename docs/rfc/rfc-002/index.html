<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-rfc docs-version-current docs-doc-page docs-doc-id-rfc-002" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Data Layer Interface Specification | Prism</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jrepp.github.io/prism-data-layer/rfc/rfc-002"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" property="og:title" content="Data Layer Interface Specification | Prism"><meta data-rh="true" name="description" content="Abstract"><meta data-rh="true" property="og:description" content="Abstract"><link data-rh="true" rel="icon" href="/prism-data-layer/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-002"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-002" hreflang="en"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-002" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Data Layer Interface Specification • RFC-002","item":"https://jrepp.github.io/prism-data-layer/rfc/rfc-002"}]}</script><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes">
<meta name="theme-color" content="#6366f1">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="stylesheet" href="/prism-data-layer/assets/css/styles.73adf43b.css">
<script src="/prism-data-layer/assets/js/runtime~main.a67713af.js" defer="defer"></script>
<script src="/prism-data-layer/assets/js/main.a0e7c1d3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/prism-data-layer/"><div class="navbar__logo"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">Prism</b></a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/intro">Overview</a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/changelog">Change Log</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Documentation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/prism-data-layer/adr">ADRs (Architecture Decision Records)</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/prism-data-layer/rfc">RFCs (Request for Comments)</a></li><li><a class="dropdown__link" href="/prism-data-layer/memos">Memos (Technical Analysis)</a></li><li><a class="dropdown__link" href="/prism-data-layer/prds">PRDs (Product Requirements)</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="buildInfo_asc2"><span class="version_ADrX" title="Build: 7f44008">7f44008</span><span class="separator_VfCt">•</span><span class="buildTime_n1Nn" title="Last updated: Oct 14, 8:03 AM PDT">Oct 14, 8:03 AM PDT</span></div><div class="navbar__item"><a href="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml" target="_blank" rel="noopener noreferrer" title="GitHub Pages" style="display: flex; align-items: center; padding: 0 0.5rem;"><img src="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml/badge.svg" alt="Build" style="margin: 0;"></a></div><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_x44X"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/"><span title="Request for Comments (RFCs)" class="linkLabel_WmDU">Request for Comments (RFCs)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/prism-data-layer/rfc/rfc-001"><span title="RFC-001 to 010" class="categoryLinkLabel_W154">RFC-001 to 010</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-001"><span title="Prism Data Access Layer Architecture • RFC-001" class="linkLabel_WmDU">Prism Data Access Layer Architecture • RFC-001</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/prism-data-layer/rfc/rfc-002"><span title="Data Layer Interface Specification • RFC-002" class="linkLabel_WmDU">Data Layer Interface Specification • RFC-002</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-003"><span title="Admin Interface for Prism • RFC-003" class="linkLabel_WmDU">Admin Interface for Prism • RFC-003</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-004"><span title="Redis Integration for Cache, PubSub, and Vector Search • RFC-004" class="linkLabel_WmDU">Redis Integration for Cache, PubSub, and Vector Search • RFC-004</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-005"><span title="ClickHouse Integration for Time Series Analytics • RFC-005" class="linkLabel_WmDU">ClickHouse Integration for Time Series Analytics • RFC-005</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-006"><span title="RFC-006 Admin CLI" class="linkLabel_WmDU">RFC-006 Admin CLI</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-007"><span title="RFC-007 Cache Strategies" class="linkLabel_WmDU">RFC-007 Cache Strategies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-008"><span title="RFC-008 Plugin Architecture" class="linkLabel_WmDU">RFC-008 Plugin Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-009"><span title="Distributed Reliability Data Patterns • RFC-009" class="linkLabel_WmDU">Distributed Reliability Data Patterns • RFC-009</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-010"><span title="Admin Protocol with OIDC Authentication • RFC-010" class="linkLabel_WmDU">Admin Protocol with OIDC Authentication • RFC-010</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-011"><span title="RFC-011 to 020" class="categoryLinkLabel_W154">RFC-011 to 020</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-021"><span title="RFC-021 to 030" class="categoryLinkLabel_W154">RFC-021 to 030</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-031"><span title="RFC-031 to 040" class="categoryLinkLabel_W154">RFC-031 to 040</span></a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/prism-data-layer/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">RFC-001 to 010</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Data Layer Interface Specification • RFC-002</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="docMetadata_NQcq"><div class="metadataRow_PvZM"><span class="metadataItem_RMFE info_Qo8L"><strong>Status:</strong> <!-- -->Draft</span><span class="metadataItem_RMFE"><strong>Author:</strong> <!-- -->Core Team</span><span class="metadataItem_RMFE"><strong>Created:</strong> <!-- -->Oct 6, 2025</span><span class="metadataItem_RMFE"><strong>Updated:</strong> <!-- -->Oct 6, 2025</span></div></div><div class="theme-doc-markdown markdown"><header><h1>Data Layer Interface Specification</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a href="#abstract" class="hash-link" aria-label="Direct link to Abstract" title="Direct link to Abstract" translate="no">​</a></h2>
<p>This RFC specifies the complete data layer interface for Prism, defining all gRPC services, message formats, error handling, and client patterns. The interface provides a unified API for accessing heterogeneous backends through five core abstractions: Sessions, Queues, PubSub, Readers, and Transactions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-introduction">1. Introduction<a href="#1-introduction" class="hash-link" aria-label="Direct link to 1. Introduction" title="Direct link to 1. Introduction" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-purpose">1.1 Purpose<a href="#11-purpose" class="hash-link" aria-label="Direct link to 1.1 Purpose" title="Direct link to 1.1 Purpose" translate="no">​</a></h3>
<p>The Prism data layer interface provides:</p>
<ol>
<li><strong>Unified API</strong>: Single gRPC interface for all data operations</li>
<li><strong>Type Safety</strong>: Protobuf-defined messages with code generation</li>
<li><strong>Streaming</strong>: First-class support for server/client/bidirectional streaming</li>
<li><strong>Abstraction</strong>: Backend-agnostic operations that map to multiple implementations</li>
<li><strong>Evolution</strong>: Forward/backward compatibility through versioned APIs</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-design-principles">1.2 Design Principles<a href="#12-design-principles" class="hash-link" aria-label="Direct link to 1.2 Design Principles" title="Direct link to 1.2 Design Principles" translate="no">​</a></h3>
<ul>
<li><strong>Session-based</strong>: All operations require authenticated session</li>
<li><strong>Layered</strong>: Progressive disclosure from basic to specialized</li>
<li><strong>Streaming-first</strong>: Use streaming for pagination, pub/sub, transactions</li>
<li><strong>Typed</strong>: All requests/responses strongly typed via protobuf</li>
<li><strong>Versioned</strong>: APIs versioned (v1, v2, etc.) for evolution</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-service-overview">1.3 Service Overview<a href="#13-service-overview" class="hash-link" aria-label="Direct link to 1.3 Service Overview" title="Direct link to 1.3 Service Overview" translate="no">​</a></h3>
<p>┌────────────────────────────────────────────┐
│           Session Service (v1)             │
│  - CreateSession, CloseSession, Heartbeat  │
└────────────────┬───────────────────────────┘
│
┌───────────┴───────────┐
│                       │
┌────▼─  ───────┐      ┌───────▼────────┐
│Queue Service│      │PubSub Service  │
│    (v1)     │      │     (v1)       │
└─────────────┘      └────────────────┘
│                       │
┌────▼────────┐      ┌───────▼────────┐
│Reader       │      │Transact Service│
│Service (v1) │      │     (v1)       │
└─────────────┘      └────────────────┘</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 2. Session Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 2.1 Overview</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Foundation service for authentication, authorization, and connection management.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 2.2 Service Definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>syntax = &quot;proto3&quot;;</p>
<p>package prism.session.v1;</p>
<p>import &quot;google/protobuf/timestamp.proto&quot;;
import &quot;google/protobuf/duration.proto&quot;;
import &quot;prism/config/v1/client_config.proto&quot;;</p>
<p>service SessionService {
// Create new authenticated session
rpc CreateSession(CreateSessionRequest) returns (CreateSessionResponse);</p>
<p>// Close session and release resources
rpc CloseSession(CloseSessionRequest) returns (CloseSessionResponse);</p>
<p>// Heartbeat to keep session alive
rpc Heartbeat(HeartbeatRequest) returns (HeartbeatResponse);</p>
<p>// Get session metadata
rpc GetSession(GetSessionRequest) returns (GetSessionResponse);</p>
<p>// Refresh session (extend expiration)
rpc RefreshSession(RefreshSessionRequest) returns (RefreshSessionResponse);
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 2.3 Messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>message CreateSessionRequest {
// Authentication credentials
oneof auth {
string api_key = 1;
string jwt_token = 2;
MutualTLSAuth mtls = 3;
}</p>
<p>// Client configuration
oneof config {
string config_name = 4;              // Use named config
prism.config.v1.ClientConfig inline_config = 5;  // Inline config
}</p>
<p>// Client metadata
string client_id = 6;
string client_version = 7;
map&lt;string, string&gt; metadata = 8;
}</p>
<p>message MutualTLSAuth {
bytes client_cert = 1;
}</p>
<p>message CreateSessionResponse {
// Session token for subsequent requests
string session_token = 1;</p>
<p>// Session metadata
string session_id = 2;
google.protobuf.Timestamp created_at = 3;
google.protobuf.Timestamp expires_at = 4;</p>
<p>// Resolved configuration
prism.config.v1.ClientConfig config = 5;</p>
<p>// Server capabilities
repeated string supported_features = 6;
}</p>
<p>message CloseSessionRequest {
string session_token = 1;
bool force = 2;  // Force close even with pending operations
}</p>
<p>message CloseSessionResponse {
bool success = 1;
string message = 2;
int32 pending_operations = 3;  // Count of operations not completed
}</p>
<p>message HeartbeatRequest {
string session_token = 1;
}</p>
<p>message HeartbeatResponse {
google.protobuf.Timestamp server_time = 1;
google.protobuf.Duration ttl = 2;  // Time until session expires
SessionStatus status = 3;
}</p>
<p>enum SessionStatus {
SESSION_STATUS_UNSPECIFIED = 0;
SESSION_STATUS_ACTIVE = 1;
SESSION_STATUS_EXPIRING = 2;      // Near expiration
SESSION_STATUS_READ_ONLY = 3;     // Read operations only
SESSION_STATUS_TERMINATING = 4;   // Shutting down
}</p>
<p>message GetSessionRequest {
string session_token = 1;
}</p>
<p>message GetSessionResponse {
string session_id = 1;
SessionStatus status = 2;
google.protobuf.Timestamp created_at = 3;
google.protobuf.Timestamp expires_at = 4;
google.protobuf.Timestamp last_activity = 5;
prism.config.v1.ClientConfig config = 6;
SessionMetrics metrics = 7;
}</p>
<p>message SessionMetrics {
int64 requests_processed = 1;
int64 bytes_sent = 2;
int64 bytes_received = 3;
int32 active_streams = 4;
}</p>
<p>message RefreshSessionRequest {
string session_token = 1;
google.protobuf.Duration extension = 2;  // How long to extend
}</p>
<p>message RefreshSessionResponse {
google.protobuf.Timestamp new_expires_at = 1;
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 2.4 Usage Examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Create Session (Named Config):**</span><br></span></code></pre></div></div>
<p>client := session.NewSessionServiceClient(conn)</p>
<p>resp, err := client.CreateSession(ctx, &amp;session.CreateSessionRequest{
Auth: &amp;session.CreateSessionRequest_ApiKey{
ApiKey: &quot;key-123&quot;,
},
Config: &amp;session.CreateSessionRequest_ConfigName{
ConfigName: &quot;user-profiles&quot;,
},
ClientId: &quot;app-service-v1&quot;,
ClientVersion: &quot;1.0.0&quot;,
})</p>
<p>sessionToken := resp.SessionToken</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Heartbeat Loop:**</span><br></span></code></pre></div></div>
<p>ticker := time.NewTicker(30 * time.Second)
defer ticker.Stop()</p>
<p>for {
select {
case &lt;-ticker.C:
resp, err := client.Heartbeat(ctx, &amp;session.HeartbeatRequest{
SessionToken: sessionToken,
})
if err != nil {
log.Error(&quot;heartbeat failed&quot;, err)
return
}
log.Debug(&quot;heartbeat ok&quot;, &quot;ttl&quot;, resp.Ttl)
case &lt;-done:
return
}
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 3. Queue Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 3.1 Overview</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Kafka-style message queue operations with topics, partitions, and offsets.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 3.2 Service Definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>syntax = &quot;proto3&quot;;</p>
<p>package prism.queue.v1;</p>
<p>import &quot;google/protobuf/timestamp.proto&quot;;
import &quot;google/protobuf/duration.proto&quot;;</p>
<p>service QueueService {
// Publish message to topic
rpc Publish(PublishRequest) returns (PublishResponse);</p>
<p>// Publish batch of messages
rpc PublishBatch(PublishBatchRequest) returns (PublishBatchResponse);</p>
<p>// Subscribe to topic (server streaming)
rpc Subscribe(SubscribeRequest) returns (stream Message);</p>
<p>// Acknowledge message processing
rpc Acknowledge(AcknowledgeRequest) returns (AcknowledgeResponse);</p>
<p>// Commit offset for consumer group
rpc Commit(CommitRequest) returns (CommitResponse);</p>
<p>// Seek to specific offset
rpc Seek(SeekRequest) returns (SeekResponse);</p>
<p>// Get topic metadata
rpc GetTopicInfo(GetTopicInfoRequest) returns (GetTopicInfoResponse);
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 3.3 Messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>message PublishRequest {
string session_token = 1;
string topic = 2;
bytes payload = 3;
map&lt;string, string&gt; headers = 4;
optional string partition_key = 5;
optional int32 partition = 6;  // Explicit partition
}</p>
<p>message PublishResponse {
string message_id = 1;
int64 offset = 2;
int32 partition = 3;
google.protobuf.Timestamp timestamp = 4;
}</p>
<p>message PublishBatchRequest {
string session_token = 1;
string topic = 2;
repeated BatchMessage messages = 3;
}</p>
<p>message BatchMessage {
bytes payload = 1;
map&lt;string, string&gt; headers = 2;
optional string partition_key = 3;
}</p>
<p>message PublishBatchResponse {
repeated PublishResponse results = 1;
int32 success_count = 2;
int32 failure_count = 3;
}</p>
<p>message SubscribeRequest {
string session_token = 1;
string topic = 2;
string consumer_group = 3;</p>
<p>// Starting position
oneof start_position {
int64 offset = 4;
google.protobuf.Timestamp timestamp = 5;
StartPosition position = 6;
}</p>
<p>// Flow control
optional int32 max_messages = 7;
optional google.protobuf.Duration timeout = 8;
}</p>
<p>enum StartPosition {
START_POSITION_UNSPECIFIED = 0;
START_POSITION_EARLIEST = 1;
START_POSITION_LATEST = 2;
START_POSITION_COMMITTED = 3;  // Last committed offset
}</p>
<p>message Message {
string message_id = 1;
string topic = 2;
int32 partition = 3;
int64 offset = 4;
bytes payload = 5;
map&lt;string, string&gt; headers = 6;
google.protobuf.Timestamp timestamp = 7;</p>
<p>// Metadata
optional string producer_id = 8;
optional int32 attempt = 9;  // For retries
}</p>
<p>message AcknowledgeRequest {
string session_token = 1;
repeated string message_ids = 2;
}</p>
<p>message AcknowledgeResponse {
int32 acknowledged_count = 1;
repeated string failed_ids = 2;
}</p>
<p>message CommitRequest {
string session_token = 1;
string topic = 2;
string consumer_group = 3;
repeated PartitionOffset offsets = 4;
}</p>
<p>message PartitionOffset {
int32 partition = 1;
int64 offset = 2;
}</p>
<p>message CommitResponse {
bool success = 1;
repeated PartitionOffset committed = 2;
}</p>
<p>message SeekRequest {
string session_token = 1;
string topic = 2;
string consumer_group = 3;
repeated PartitionOffset positions = 4;
}</p>
<p>message SeekResponse {
bool success = 1;
}</p>
<p>message GetTopicInfoRequest {
string session_token = 1;
string topic = 2;
}</p>
<p>message GetTopicInfoResponse {
string topic = 1;
int32 partition_count = 2;
int64 message_count = 3;
repeated PartitionInfo partitions = 4;
}</p>
<p>message PartitionInfo {
int32 partition = 1;
int64 earliest_offset = 2;
int64 latest_offset = 3;
int64 message_count = 4;
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 3.4 Usage Examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Publish:**</span><br></span></code></pre></div></div>
<p>let response = client.publish(PublishRequest {
session_token: token.clone(),
topic: &quot;events&quot;.to_string(),
payload: serde_json::to_vec(&amp;event)?,
headers: headers,
partition_key: Some(user_id),
..Default::default()
}).await?;</p>
<p>println!(&quot;Published to partition {} offset {}&quot;,
response.partition, response.offset);</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Subscribe (Streaming):**</span><br></span></code></pre></div></div>
<p>let mut stream = client.subscribe(SubscribeRequest {
session_token: token.clone(),
topic: &quot;events&quot;.to_string(),
consumer_group: &quot;processors&quot;.to_string(),
start_position: Some(
subscribe_request::StartPosition::Position(StartPosition::Latest as i32)
),
..Default::default()
}).await?.into_inner();</p>
<p>while let Some(message) = stream.message().await? {
process_message(&amp;message).await?;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">client.acknowledge(AcknowledgeRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session_token: token.clone(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message_ids: vec![message.message_id],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}).await?;</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 4. PubSub Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 4.1 Overview</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NATS-style publish-subscribe with topic patterns and wildcards.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 4.2 Service Definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>syntax = &quot;proto3&quot;;</p>
<p>package prism.pubsub.v1;</p>
<p>import &quot;google/protobuf/timestamp.proto&quot;;</p>
<p>service PubSubService {
// Publish event to topic
rpc Publish(PublishRequest) returns (PublishResponse);</p>
<p>// Subscribe to topic pattern (server streaming)
rpc Subscribe(SubscribeRequest) returns (stream Event);</p>
<p>// Unsubscribe from topic pattern
rpc Unsubscribe(UnsubscribeRequest) returns (UnsubscribeResponse);</p>
<p>// List active subscriptions
rpc ListSubscriptions(ListSubscriptionsRequest) returns (ListSubscriptionsResponse);
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 4.3 Messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>message PublishRequest {
string session_token = 1;
string topic = 2;  // e.g., &quot;events.user.created&quot;
bytes payload = 3;
map&lt;string, string&gt; metadata = 4;
optional string correlation_id = 5;
optional string reply_to = 6;  // For request-reply pattern
}</p>
<p>message PublishResponse {
string event_id = 1;
google.protobuf.Timestamp published_at = 2;
int32 subscriber_count = 3;  // How many subscribers received it
}</p>
<p>message SubscribeRequest {
string session_token = 1;
string topic_pattern = 2;  // e.g., &quot;events.user.*&quot;, &quot;events.&gt;&quot;
optional string queue_group = 3;  // For load balancing
SubscriptionOptions options = 4;
}</p>
<p>message SubscriptionOptions {
bool auto_acknowledge = 1;  // Auto-ack on delivery
optional int32 max_messages = 2;  // Limit total messages
optional google.protobuf.Duration max_duration = 3;  // Subscription timeout
}</p>
<p>message Event {
string event_id = 1;
string topic = 2;
bytes payload = 3;
map&lt;string, string&gt; metadata = 4;
google.protobuf.Timestamp timestamp = 5;</p>
<p>// Request-reply support
optional string correlation_id = 6;
optional string reply_to = 7;</p>
<p>// Subscription info
string subscription_id = 8;
}</p>
<p>message UnsubscribeRequest {
string session_token = 1;
string subscription_id = 2;
}</p>
<p>message UnsubscribeResponse {
bool success = 1;
}</p>
<p>message ListSubscriptionsRequest {
string session_token = 1;
}</p>
<p>message ListSubscriptionsResponse {
repeated Subscription subscriptions = 1;
}</p>
<p>message Subscription {
string subscription_id = 1;
string topic_pattern = 2;
optional string queue_group = 3;
google.protobuf.Timestamp created_at = 4;
int64 messages_received = 5;
bool active = 6;
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 4.4 Usage Examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Subscribe with Wildcard:**</span><br></span></code></pre></div></div>
<p>stream, err := client.Subscribe(ctx, &amp;pubsub.SubscribeRequest{
SessionToken: token,
TopicPattern: &quot;events.user.*&quot;,  // Match all user events
QueueGroup: &quot;processors&quot;,        // Load balance across group
Options: &amp;pubsub.SubscriptionOptions{
AutoAcknowledge: true,
},
})</p>
<p>for {
event, err := stream.Recv()
if err == io.EOF {
break
}
if err != nil {
log.Error(&quot;stream error&quot;, err)
break
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">log.Info(&quot;received event&quot;, &quot;topic&quot;, event.Topic, &quot;id&quot;, event.EventId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">processEvent(event)</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 5. Reader Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 5.1 Overview</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Database-style paged reading with queries and filters.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 5.2 Service Definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>syntax = &quot;proto3&quot;;</p>
<p>package prism.reader.v1;</p>
<p>import &quot;google/protobuf/struct.proto&quot;;
import &quot;google/protobuf/timestamp.proto&quot;;</p>
<p>service ReaderService {
// Read pages of data (server streaming)
rpc Read(ReadRequest) returns (stream Page);</p>
<p>// Query with filters (server streaming)
rpc Query(QueryRequest) returns (stream Row);</p>
<p>// Count matching records
rpc Count(CountRequest) returns (CountResponse);</p>
<p>// Get single record by ID
rpc Get(GetRequest) returns (GetResponse);
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 5.3 Messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>message ReadRequest {
string session_token = 1;
string collection = 2;
int32 page_size = 3;
optional string cursor = 4;  // Continuation token
repeated string fields = 5;  // Projection (empty = all fields)
optional Filter filter = 6;
repeated Sort sort = 7;
}</p>
<p>message Page {
repeated Row rows = 1;
optional string next_cursor = 2;
bool has_more = 3;
PageMetadata metadata = 4;
}</p>
<p>message PageMetadata {
int32 row_count = 1;
int32 page_number = 2;
google.protobuf.Timestamp generated_at = 3;
}</p>
<p>message Row {
map&lt;string, google.protobuf.Value&gt; fields = 1;
optional RowMetadata metadata = 2;
}</p>
<p>message RowMetadata {
google.protobuf.Timestamp created_at = 1;
google.protobuf.Timestamp updated_at = 2;
string version = 3;  // For optimistic locking
}</p>
<p>message QueryRequest {
string session_token = 1;
string collection = 2;
Filter filter = 3;
repeated Sort sort = 4;
optional int32 limit = 5;
optional int32 offset = 6;
repeated string fields = 7;
}</p>
<p>message Filter {
oneof filter {
FieldFilter field = 1;
CompositeFilter composite = 2;
}
}</p>
<p>message FieldFilter {
string field = 1;
Operator op = 2;
google.protobuf.Value value = 3;</p>
<p>enum Operator {
OPERATOR_UNSPECIFIED = 0;
OPERATOR_EQUALS = 1;
OPERATOR_NOT_EQUALS = 2;
OPERATOR_GREATER_THAN = 3;
OPERATOR_GREATER_THAN_OR_EQUALS = 4;
OPERATOR_LESS_THAN = 5;
OPERATOR_LESS_THAN_OR_EQUALS = 6;
OPERATOR_IN = 7;
OPERATOR_NOT_IN = 8;
OPERATOR_CONTAINS = 9;
OPERATOR_STARTS_WITH = 10;
OPERATOR_ENDS_WITH = 11;
}
}</p>
<p>message CompositeFilter {
LogicalOperator op = 1;
repeated Filter filters = 2;</p>
<p>enum LogicalOperator {
LOGICAL_OPERATOR_UNSPECIFIED = 0;
LOGICAL_OPERATOR_AND = 1;
LOGICAL_OPERATOR_OR = 2;
LOGICAL_OPERATOR_NOT = 3;
}
}</p>
<p>message Sort {
string field = 1;
Direction direction = 2;</p>
<p>enum Direction {
DIRECTION_UNSPECIFIED = 0;
DIRECTION_ASC = 1;
DIRECTION_DESC = 2;
}
}</p>
<p>message CountRequest {
string session_token = 1;
string collection = 2;
optional Filter filter = 3;
}</p>
<p>message CountResponse {
int64 count = 1;
}</p>
<p>message GetRequest {
string session_token = 1;
string collection = 2;
string id = 3;
repeated string fields = 4;
}</p>
<p>message GetResponse {
optional Row row = 1;
bool found = 2;
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 5.4 Usage Examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Paged Reading:**</span><br></span></code></pre></div></div>
<p>stream = client.Read(reader_pb2.ReadRequest(
session_token=token,
collection=&quot;users&quot;,
page_size=100,
fields=[&quot;id&quot;, &quot;name&quot;, &quot;email&quot;],
sort=[
reader_pb2.Sort(field=&quot;created_at&quot;, direction=reader_pb2.Sort.DIRECTION_DESC)
]
))</p>
<p>for page in stream:
for row in page.rows:
user_id = row.fields[&quot;id&quot;].string_value
name = row.fields[&quot;name&quot;].string_value
print(f&quot;User: {user_id} - {name}&quot;)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if not page.has_more:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    break</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Query with Filter:**</span><br></span></code></pre></div></div>
<h1>Complex filter: active users created in last 30 days</h1>
<p>filter = reader_pb2.Filter(
composite=reader_pb2.CompositeFilter(
op=reader_pb2.CompositeFilter.LOGICAL_OPERATOR_AND,
filters=[
reader_pb2.Filter(
field=reader_pb2.FieldFilter(
field=&quot;status&quot;,
op=reader_pb2.FieldFilter.OPERATOR_EQUALS,
value=Value(string_value=&quot;active&quot;)
)
),
reader_pb2.Filter(
field=reader_pb2.FieldFilter(
field=&quot;created_at&quot;,
op=reader_pb2.FieldFilter.OPERATOR_GREATER_THAN,
value=Value(string_value=&quot;2025-09-07T00:00:00Z&quot;)
)
)
]
)
)</p>
<p>stream = client.Query(reader_pb2.QueryRequest(
session_token=token,
collection=&quot;users&quot;,
filter=filter,
limit=1000
))</p>
<p>for row in stream:
process_user(row)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 6. Transact Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 6.1 Overview</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Transactional writes across two tables (inbox/outbox pattern).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 6.2 Service Definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>syntax = &quot;proto3&quot;;</p>
<p>package prism.transact.v1;</p>
<p>import &quot;google/protobuf/struct.proto&quot;;
import &quot;google/protobuf/timestamp.proto&quot;;</p>
<p>service TransactService {
// Single transactional write
rpc Write(WriteRequest) returns (WriteResponse);</p>
<p>// Streaming transaction (begin, writes, commit/rollback)
rpc Transaction(stream TransactRequest) returns (stream TransactResponse);</p>
<p>// Read mailbox messages
rpc ReadMailbox(ReadMailboxRequest) returns (stream MailboxMessage);</p>
<p>// Mark mailbox messages as processed
rpc ProcessMailbox(ProcessMailboxRequest) returns (ProcessMailboxResponse);
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 6.3 Messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>message WriteRequest {
string session_token = 1;</p>
<p>// Data table write
DataWrite data = 2;</p>
<p>// Mailbox table write
MailboxWrite mailbox = 3;</p>
<p>// Transaction options
TransactionOptions options = 4;
}</p>
<p>message DataWrite {
string table = 1;
map&lt;string, google.protobuf.Value&gt; record = 2;
WriteMode mode = 3;
optional string id_field = 4;  // For updates</p>
<p>enum WriteMode {
WRITE_MODE_UNSPECIFIED = 0;
WRITE_MODE_INSERT = 1;
WRITE_MODE_UPDATE = 2;
WRITE_MODE_UPSERT = 3;
WRITE_MODE_DELETE = 4;
}
}</p>
<p>message MailboxWrite {
string mailbox_id = 1;
bytes message = 2;
map&lt;string, string&gt; metadata = 3;
optional string message_type = 4;
optional int32 priority = 5;
}</p>
<p>message TransactionOptions {
IsolationLevel isolation = 1;
int32 timeout_ms = 2;
bool idempotent = 3;  // Safe to retry
optional string idempotency_key = 4;</p>
<p>enum IsolationLevel {
ISOLATION_LEVEL_UNSPECIFIED = 0;
ISOLATION_LEVEL_READ_COMMITTED = 1;
ISOLATION_LEVEL_REPEATABLE_READ = 2;
ISOLATION_LEVEL_SERIALIZABLE = 3;
}
}</p>
<p>message WriteResponse {
string transaction_id = 1;
bool committed = 2;
DataWriteResult data_result = 3;
MailboxWriteResult mailbox_result = 4;
google.protobuf.Timestamp timestamp = 5;
}</p>
<p>message DataWriteResult {
int64 rows_affected = 1;
map&lt;string, google.protobuf.Value&gt; generated_values = 2;  // Auto-generated IDs, etc.
}</p>
<p>message MailboxWriteResult {
string message_id = 1;
int64 sequence = 2;
}</p>
<p>// Streaming transaction messages
message TransactRequest {
oneof request {
BeginTransaction begin = 1;
WriteRequest write = 2;
CommitTransaction commit = 3;
RollbackTransaction rollback = 4;
}
}</p>
<p>message BeginTransaction {
string session_token = 1;
TransactionOptions options = 2;
}</p>
<p>message CommitTransaction {
// Empty - just signals commit
}</p>
<p>message RollbackTransaction {
string reason = 1;
}</p>
<p>message TransactResponse {
oneof response {
TransactionStarted started = 1;
WriteResponse write_result = 2;
TransactionCommitted committed = 3;
TransactionRolledBack rolled_back = 4;
TransactionError error = 5;
}
}</p>
<p>message TransactionStarted {
string transaction_id = 1;
google.protobuf.Timestamp started_at = 2;
}</p>
<p>message TransactionCommitted {
bool success = 1;
int32 write_count = 2;
}</p>
<p>message TransactionRolledBack {
string reason = 1;
}</p>
<p>message TransactionError {
string code = 1;
string message = 2;
}</p>
<p>message ReadMailboxRequest {
string session_token = 1;
string mailbox_id = 2;
optional int64 since_sequence = 3;
optional int32 limit = 4;
optional bool unprocessed_only = 5;
}</p>
<p>message MailboxMessage {
string message_id = 1;
string mailbox_id = 2;
int64 sequence = 3;
bytes message = 4;
map&lt;string, string&gt; metadata = 5;
optional string message_type = 6;
google.protobuf.Timestamp created_at = 7;
bool processed = 8;
optional google.protobuf.Timestamp processed_at = 9;
}</p>
<p>message ProcessMailboxRequest {
string session_token = 1;
repeated string message_ids = 2;
}</p>
<p>message ProcessMailboxResponse {
int32 processed_count = 1;
repeated string failed_ids = 2;
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 6.4 Usage Examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Single Transaction:**</span><br></span></code></pre></div></div>
<p>let response = client.write(WriteRequest {
session_token: token.clone(),
data: Some(DataWrite {
table: &quot;orders&quot;.to_string(),
record: order_data,
mode: WriteMode::Insert as i32,
..Default::default()
}),
mailbox: Some(MailboxWrite {
mailbox_id: &quot;order-events&quot;.to_string(),
message: event_bytes,
metadata: metadata,
message_type: Some(&quot;order.created&quot;.to_string()),
..Default::default()
}),
options: Some(TransactionOptions {
isolation: IsolationLevel::Serializable as i32,
idempotent: true,
idempotency_key: Some(order_id.clone()),
..Default::default()
}),
}).await?;</p>
<p>println!(&quot;Transaction {} committed&quot;, response.transaction_id);</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Streaming Transaction:**</span><br></span></code></pre></div></div>
<p>let (mut tx, mut rx) = client.transaction().await?.into_inner().split();</p>
<p>// Begin
tx.send(TransactRequest {
request: Some(transact_request::Request::Begin(BeginTransaction {
session_token: token.clone(),
..Default::default()
}))
}).await?;</p>
<p>let started = rx.message().await?.unwrap();</p>
<p>// Multiple writes
for order in orders {
tx.send(TransactRequest {
request: Some(transact_request::Request::Write(/* ... */))
}).await?;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let result = rx.message().await?;</span><br></span></code></pre></div></div>
<p>}</p>
<p>// Commit
tx.send(TransactRequest {
request: Some(transact_request::Request::Commit(CommitTransaction {}))
}).await?;</p>
<p>let committed = rx.message().await?.unwrap();</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 7. Error Handling</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 7.1 gRPC Status Codes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">All services use standard gRPC status codes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Code | Usage |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|------|-------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `OK` | Success |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `CANCELLED` | Client cancelled |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `INVALID_ARGUMENT` | Invalid request parameters |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `DEADLINE_EXCEEDED` | Timeout |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `NOT_FOUND` | Resource not found |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `ALREADY_EXISTS` | Duplicate creation |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `PERMISSION_DENIED` | Authorization failure |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `RESOURCE_EXHAUSTED` | Rate limit exceeded |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `FAILED_PRECONDITION` | Precondition not met |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `ABORTED` | Transaction conflict |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `OUT_OF_RANGE` | Invalid range |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `UNIMPLEMENTED` | Feature not available |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `INTERNAL` | Server error |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `UNAVAILABLE` | Service unavailable |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| `UNAUTHENTICATED` | Invalid/missing auth |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 7.2 Error Details</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Use `google.rpc.ErrorInfo` for structured errors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>import &quot;google/rpc/error_details.proto&quot;;</p>
<p>// In error response metadata
google.rpc.ErrorInfo {
reason: &quot;INVALID_SESSION_TOKEN&quot;
domain: &quot;prism.session.v1&quot;
metadata: {
&quot;session_id&quot;: &quot;sess-123&quot;
&quot;expired_at&quot;: &quot;2025-10-07T12:00:00Z&quot;
}
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 7.3 Client Error Handling</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>resp, err := client.Publish(ctx, req)
if err != nil {
st, ok := status.FromError(err)
if !ok {
// Non-gRPC error
return err
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">switch st.Code() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case codes.Unauthenticated:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Refresh session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return refreshAndRetry()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case codes.ResourceExhausted:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Rate limited, backoff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time.Sleep(backoff)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return retry()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case codes.Unavailable:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Service down, circuit breaker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return circuitBreaker.RecordFailure(err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 8. Backward Compatibility</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 8.1 Versioning Strategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **API Version**: `v1`, `v2` in package name (`prism.queue.v1`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Service Version**: Separate services for major versions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Message Evolution**: Additive changes only within version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 8.2 Compatible Changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ **Allowed:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Add new RPC methods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Add new optional fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Add new enum values (with `UNSPECIFIED` default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Add new message types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Deprecate (but don&#x27;t remove) fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ **Not Allowed:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Remove or rename fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Change field numbers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Change field types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Remove RPC methods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Change RPC signatures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 8.3 Deprecation Process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>message OldRequest {
string field1 = 1;
string field2 = 2 [deprecated = true];  // Mark deprecated
string field3 = 3;  // New replacement
}</p>
<p>service MyService {
rpc OldMethod(OldRequest) returns (OldResponse) {
option deprecated = true;  // Mark deprecated
}
rpc NewMethod(NewRequest) returns (NewResponse);
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 9. Client Libraries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 9.1 Repository Location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**GitHub Repository**: `https://github.com/jrepp/prism-data-layer`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">All externally-facing Go library packages are published from this repository. When importing Prism SDK components, use the GitHub module path:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>import (
&quot;github.com/jrepp/prism-data-layer/plugin-sdk/auth&quot;
&quot;github.com/jrepp/prism-data-layer/plugin-sdk/authz&quot;
&quot;github.com/jrepp/prism-data-layer/plugin-sdk/plugin&quot;
)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 9.2 Generated Clients</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">All languages get generated clients:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Rust</h1>
<p>buf generate --template buf.gen.rust.yaml</p>
<h1>Go</h1>
<p>buf generate --template buf.gen.go.yaml</p>
<h1>Python</h1>
<p>buf generate --template buf.gen.python.yaml</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 9.3 Client Patterns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Connection Management:**</span><br></span></code></pre></div></div>
<p>// Create connection with keepalive
conn, err := grpc.Dial(
&quot;prism.example.com:8980&quot;,
grpc.WithTransportCredentials(creds),
grpc.WithKeepaliveParams(keepalive.ClientParameters{
Time:    30 * time.Second,
Timeout: 10 * time.Second,
}),
)
defer conn.Close()</p>
<p>// Create clients
sessionClient := session.NewSessionServiceClient(conn)
queueClient := queue.NewQueueServiceClient(conn)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Metadata Propagation:**</span><br></span></code></pre></div></div>
<p>// Add session token to metadata
md := metadata.Pairs(&quot;x-session-token&quot;, sessionToken)
ctx := metadata.NewOutgoingContext(ctx, md)</p>
<p>// Or use interceptor
func sessionTokenInterceptor(token string) grpc.UnaryClientInterceptor {
return func(ctx context.Context, method string, req, reply interface{},
cc *grpc.ClientConn, invoker grpc.UnaryInvoker, opts ...grpc.CallOption) error {</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    md := metadata.Pairs(&quot;x-session-token&quot;, token)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx = metadata.NewOutgoingContext(ctx, md)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return invoker(ctx, method, req, reply, cc, opts...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 10. Performance Considerations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 10.1 Connection Pooling</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Reuse gRPC connections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Use HTTP/2 multiplexing (multiple RPCs per connection)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Configure connection pool size based on load</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 10.2 Streaming Best Practices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Server Streaming:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Use backpressure (flow control)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Set reasonable page sizes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Use cursors for resumption</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Client Streaming:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Batch writes when possible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Use buffering to reduce round trips</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 10.3 Timeouts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set appropriate timeouts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>ctx, cancel := context.WithTimeout(ctx, 5*time.Second)
defer cancel()</p>
<p>resp, err := client.Publish(ctx, req)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 11. Security</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 11.1 Transport Security</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- TLS 1.3 required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- mTLS for service-to-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Certificate rotation support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 11.2 Authentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session tokens in metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x-session-token: sess-abc123def456</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="113-authorization">11.3 Authorization<a href="#113-authorization" class="hash-link" aria-label="Direct link to 11.3 Authorization" title="Direct link to 11.3 Authorization" translate="no">​</a></h3>
<ul>
<li>Namespace-level permissions</li>
<li>Operation-level permissions</li>
<li>Row-level security (future)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="12-testing">12. Testing<a href="#12-testing" class="hash-link" aria-label="Direct link to 12. Testing" title="Direct link to 12. Testing" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="121-unit-tests">12.1 Unit Tests<a href="#121-unit-tests" class="hash-link" aria-label="Direct link to 12.1 Unit Tests" title="Direct link to 12.1 Unit Tests" translate="no">​</a></h3>
<p>Test generated code and client logic:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TestPublish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">testing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Mock server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mockQueueService</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        publishFunc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PublishRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PublishResponse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PublishResponse</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                MessageId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;msg-123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Offset</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Partition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Test client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NoError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Equal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;msg-123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MessageId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="122-integration-tests">12.2 Integration Tests<a href="#122-integration-tests" class="hash-link" aria-label="Direct link to 12.2 Integration Tests" title="Direct link to 12.2 Integration Tests" translate="no">​</a></h3>
<p>Test against real server:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TestQueueIntegration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">testing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Start test server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">startTestServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Stop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Create client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conn </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dialTestServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Addr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewQueueServiceClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Test flow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pubResp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PublishRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stream</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SubscribeRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> stream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Recv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Equal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pubResp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MessageId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MessageId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="13-references">13. References<a href="#13-references" class="hash-link" aria-label="Direct link to 13. References" title="Direct link to 13. References" translate="no">​</a></h2>
<ul>
<li>RFC-001: Prism Architecture</li>
<li>ADR-023: gRPC-First Interface Design</li>
<li>ADR-024: Layered Interface Hierarchy</li>
<li><a href="https://grpc.io/docs/" target="_blank" rel="noopener noreferrer">gRPC Documentation</a></li>
<li><a href="https://protobuf.dev/programming-guides/style/" target="_blank" rel="noopener noreferrer">Protobuf Style Guide</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="14-cache-service-rfc-007">14. Cache Service (RFC-007)<a href="#14-cache-service-rfc-007" class="hash-link" aria-label="Direct link to 14. Cache Service (RFC-007)" title="Direct link to 14. Cache Service (RFC-007)" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="141-overview">14.1 Overview<a href="#141-overview" class="hash-link" aria-label="Direct link to 14.1 Overview" title="Direct link to 14.1 Overview" translate="no">​</a></h3>
<p>Transparent caching layer with look-aside and write-through strategies for high-performance data access.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="142-service-definition">14.2 Service Definition<a href="#142-service-definition" class="hash-link" aria-label="Direct link to 14.2 Service Definition" title="Direct link to 14.2 Service Definition" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">syntax</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;proto3&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">CacheService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Get value from cache (look-aside pattern)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Set value in cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SetRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SetResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Delete cache entry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Delete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Get multiple values (batch)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetMulti</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetMultiRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetMultiResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Check if key exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExistsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExistsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Set with expiration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SetEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SetExRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SetExResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Increment counter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">IncrementRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">IncrementResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="143-cache-patterns">14.3 Cache Patterns<a href="#143-cache-patterns" class="hash-link" aria-label="Direct link to 14.3 Cache Patterns" title="Direct link to 14.3 Cache Patterns" translate="no">​</a></h3>
<p><strong>Look-Aside (Cache-Aside)</strong>:</p>
<!-- -->
<p><strong>Write-Through</strong>:</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="144-use-case-recommendations">14.4 Use-Case Recommendations<a href="#144-use-case-recommendations" class="hash-link" aria-label="Direct link to 14.4 Use-Case Recommendations" title="Direct link to 14.4 Use-Case Recommendations" translate="no">​</a></h3>

































































<table><thead><tr><th>Use Case</th><th>Strategy</th><th>TTL</th><th>Rationale</th></tr></thead><tbody><tr><td>✅ <strong>User Sessions</strong></td><td>Look-Aside</td><td>24h</td><td>High read, low write</td></tr><tr><td>✅ <strong>API Responses</strong></td><td>Look-Aside</td><td>5-15m</td><td>Tolerate stale data</td></tr><tr><td>✅ <strong>Product Catalog</strong></td><td>Look-Aside</td><td>1h</td><td>Read-only reference data</td></tr><tr><td>✅ <strong>User Profiles</strong></td><td>Look-Aside</td><td>15m</td><td>Frequently accessed</td></tr><tr><td>✅ <strong>Application Config</strong></td><td>Write-Through</td><td>Infinite</td><td>Require consistency</td></tr><tr><td>✅ <strong>Feature Flags</strong></td><td>Write-Through</td><td>Infinite</td><td>Must be fresh</td></tr><tr><td>✅ <strong>Rate Limit Counters</strong></td><td>Cache-Only</td><td>1m</td><td>Temporary state</td></tr><tr><td>❌ <strong>Financial Transactions</strong></td><td>No Cache</td><td>N/A</td><td>Require strong consistency</td></tr><tr><td>❌ <strong>Audit Logs</strong></td><td>No Cache</td><td>N/A</td><td>Write-once, read-rarely</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="15-timeseries-service-rfc-005">15. TimeSeries Service (RFC-005)<a href="#15-timeseries-service-rfc-005" class="hash-link" aria-label="Direct link to 15. TimeSeries Service (RFC-005)" title="Direct link to 15. TimeSeries Service (RFC-005)" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="151-overview">15.1 Overview<a href="#151-overview" class="hash-link" aria-label="Direct link to 15.1 Overview" title="Direct link to 15.1 Overview" translate="no">​</a></h3>
<p>ClickHouse-backed time series analytics for high-volume event data with OLAP queries.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="152-service-definition">15.2 Service Definition<a href="#152-service-definition" class="hash-link" aria-label="Direct link to 15.2 Service Definition" title="Direct link to 15.2 Service Definition" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">syntax</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;proto3&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timeseries</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">TimeSeriesService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Append event(s) to time series</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AppendEvents</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">AppendEventsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">AppendEventsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Stream events for continuous ingestion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">StreamEvents</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">stream</span><span class="token plain"> </span><span class="token class-name">Event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StreamEventsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Query events with time range and filters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QueryEvents</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">QueryRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">QueryResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Query pre-aggregated data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QueryAggregates</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">AggregateRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">AggregateResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Stream query results</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">StreamQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">QueryRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">stream</span><span class="token plain"> </span><span class="token class-name">Event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">Event</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">int64</span><span class="token plain"> timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Unix nanoseconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> event_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token map class-name">map</span><span class="token map class-name punctuation" style="color:#393A34">&lt;</span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">,</span><span class="token map class-name"> </span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> dimensions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token map class-name">map</span><span class="token map class-name punctuation" style="color:#393A34">&lt;</span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">,</span><span class="token map class-name"> </span><span class="token map class-name builtin">double</span><span class="token map class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> metrics </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="153-architecture">15.3 Architecture<a href="#153-architecture" class="hash-link" aria-label="Direct link to 15.3 Architecture" title="Direct link to 15.3 Architecture" translate="no">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="154-use-case-recommendations">15.4 Use-Case Recommendations<a href="#154-use-case-recommendations" class="hash-link" aria-label="Direct link to 15.4 Use-Case Recommendations" title="Direct link to 15.4 Use-Case Recommendations" translate="no">​</a></h3>





















































<table><thead><tr><th>Use Case</th><th>Ingestion Rate</th><th>Retention</th><th>Rationale</th></tr></thead><tbody><tr><td>✅ <strong>Application Logs</strong></td><td>100k events/s</td><td>30 days</td><td>High volume, short retention</td></tr><tr><td>✅ <strong>Observability Metrics</strong></td><td>1M events/s</td><td>90 days</td><td>Standard monitoring retention</td></tr><tr><td>✅ <strong>User Analytics</strong></td><td>10k events/s</td><td>1 year</td><td>Business analytics</td></tr><tr><td>✅ <strong>IoT Sensor Data</strong></td><td>500k events/s</td><td>90 days</td><td>High frequency measurements</td></tr><tr><td>✅ <strong>Click Stream</strong></td><td>50k events/s</td><td>180 days</td><td>User behavior analysis</td></tr><tr><td>✅ <strong>Audit Events</strong></td><td>1k events/s</td><td>7 years</td><td>Compliance requirements</td></tr><tr><td>❌ <strong>Real-Time Transactions</strong></td><td>N/A</td><td>N/A</td><td>Use transactional DB instead</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="16-object-storage-service-adr-032">16. Object Storage Service (ADR-032)<a href="#16-object-storage-service-adr-032" class="hash-link" aria-label="Direct link to 16. Object Storage Service (ADR-032)" title="Direct link to 16. Object Storage Service (ADR-032)" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="161-overview">16.1 Overview<a href="#161-overview" class="hash-link" aria-label="Direct link to 16.1 Overview" title="Direct link to 16.1 Overview" translate="no">​</a></h3>
<p>S3-compatible object storage for blobs with MinIO for local development.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="162-service-definition">16.2 Service Definition<a href="#162-service-definition" class="hash-link" aria-label="Direct link to 16.2 Service Definition" title="Direct link to 16.2 Service Definition" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">syntax</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;proto3&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">objectstore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">ObjectStoreService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Upload object (streaming for large files)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">PutObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">stream</span><span class="token plain"> </span><span class="token class-name">PutObjectRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">PutObjectResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Download object (streaming)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetObjectRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">stream</span><span class="token plain"> </span><span class="token class-name">GetObjectResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Delete object</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DeleteObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteObjectRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteObjectResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// List objects in bucket/prefix</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ListObjects</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListObjectsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListObjectsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Get object metadata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">HeadObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HeadObjectRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HeadObjectResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Generate presigned URL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetPresignedURL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">PresignedURLRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">PresignedURLResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">PutObjectRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> bucket </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token map class-name">map</span><span class="token map class-name punctuation" style="color:#393A34">&lt;</span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">,</span><span class="token map class-name"> </span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> content_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">optional</span><span class="token plain"> </span><span class="token builtin">int64</span><span class="token plain"> ttl_seconds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">bytes</span><span class="token plain"> chunk </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Streaming chunk</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="163-architecture">16.3 Architecture<a href="#163-architecture" class="hash-link" aria-label="Direct link to 16.3 Architecture" title="Direct link to 16.3 Architecture" translate="no">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="164-use-case-recommendations">16.4 Use-Case Recommendations<a href="#164-use-case-recommendations" class="hash-link" aria-label="Direct link to 16.4 Use-Case Recommendations" title="Direct link to 16.4 Use-Case Recommendations" translate="no">​</a></h3>



























































<table><thead><tr><th>Use Case</th><th>Object Size</th><th>TTL</th><th>Rationale</th></tr></thead><tbody><tr><td>✅ <strong>File Uploads</strong></td><td>1KB - 100MB</td><td>90 days</td><td>User-generated content</td></tr><tr><td>✅ <strong>Profile Pictures</strong></td><td>10KB - 5MB</td><td>1 year</td><td>Long-lived media</td></tr><tr><td>✅ <strong>Build Artifacts</strong></td><td>10MB - 2GB</td><td>30 days</td><td>CI/CD outputs</td></tr><tr><td>✅ <strong>ML Models</strong></td><td>100MB - 10GB</td><td>Infinite</td><td>Model serving</td></tr><tr><td>✅ <strong>Backups</strong></td><td>1GB - 100GB</td><td>90 days</td><td>Database backups</td></tr><tr><td>✅ <strong>Video/Audio</strong></td><td>10MB - 5GB</td><td>1 year</td><td>Media streaming</td></tr><tr><td>✅ <strong>Log Archives</strong></td><td>100MB - 10GB</td><td>7 years</td><td>Compliance</td></tr><tr><td>❌ <strong>Small Metadata</strong></td><td>&lt; 1KB</td><td>N/A</td><td>Use KeyValue instead</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="17-vector-search-service-rfc-004">17. Vector Search Service (RFC-004)<a href="#17-vector-search-service-rfc-004" class="hash-link" aria-label="Direct link to 17. Vector Search Service (RFC-004)" title="Direct link to 17. Vector Search Service (RFC-004)" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="171-overview">17.1 Overview<a href="#171-overview" class="hash-link" aria-label="Direct link to 17.1 Overview" title="Direct link to 17.1 Overview" translate="no">​</a></h3>
<p>Redis-backed vector similarity search for ML embeddings and semantic search.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="172-service-definition">17.2 Service Definition<a href="#172-service-definition" class="hash-link" aria-label="Direct link to 17.2 Service Definition" title="Direct link to 17.2 Service Definition" translate="no">​</a></h3>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">syntax</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;proto3&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">vector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">VectorService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Index vector embedding</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">IndexVector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">IndexVectorRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">IndexVectorResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Search for similar vectors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SearchSimilar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SearchRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SearchResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Batch index vectors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">BatchIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">stream</span><span class="token plain"> </span><span class="token class-name">IndexVectorRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BatchIndexResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Delete vector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DeleteVector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteVectorRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteVectorResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Get vector by ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetVector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetVectorRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetVectorResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">IndexVectorRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">repeated</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> vector </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Embedding (e.g., 768 dims)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token map class-name">map</span><span class="token map class-name punctuation" style="color:#393A34">&lt;</span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">,</span><span class="token map class-name"> </span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">SearchRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">repeated</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> query_vector </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">int32</span><span class="token plain"> top_k </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Return top K similar</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">optional</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> min_score </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token map class-name">map</span><span class="token map class-name punctuation" style="color:#393A34">&lt;</span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">,</span><span class="token map class-name"> </span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> filters </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">SearchResponse</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">repeated</span><span class="token plain"> </span><span class="token positional-class-name class-name">SimilarVector</span><span class="token plain"> results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">SimilarVector</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">float</span><span class="token plain"> score </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Similarity score (0-1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token map class-name">map</span><span class="token map class-name punctuation" style="color:#393A34">&lt;</span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">,</span><span class="token map class-name"> </span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="173-architecture">17.3 Architecture<a href="#173-architecture" class="hash-link" aria-label="Direct link to 17.3 Architecture" title="Direct link to 17.3 Architecture" translate="no"> ​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="174-use-case-recommendations">17.4 Use-Case Recommendations<a href="#174-use-case-recommendations" class="hash-link" aria-label="Direct link to 17.4 Use-Case Recommendations" title="Direct link to 17.4 Use-Case Recommendations" translate="no">​</a></h3>





















































<table><thead><tr><th>Use Case</th><th>Vector Dims</th><th>Index Size</th><th>Rationale</th></tr></thead><tbody><tr><td>✅ <strong>Semantic Search</strong></td><td>384-768</td><td>1M vectors</td><td>Document similarity</td></tr><tr><td>✅ <strong>Image Similarity</strong></td><td>512-2048</td><td>10M vectors</td><td>Visual search</td></tr><tr><td>✅ <strong>Product Recommendations</strong></td><td>256-512</td><td>5M vectors</td><td>E-commerce similarity</td></tr><tr><td>✅ <strong>Duplicate Detection</strong></td><td>128-384</td><td>100k vectors</td><td>Content deduplication</td></tr><tr><td>✅ <strong>Anomaly Detection</strong></td><td>64-256</td><td>1M vectors</td><td>Pattern matching</td></tr><tr><td>❌ <strong>High-Dimensional (&gt;4096)</strong></td><td>N/A</td><td>N/A</td><td>Use specialized vector DB</td></tr><tr><td>❌ <strong>Exact Match</strong></td><td>N/A</td><td>N/A</td><td>Use KeyValue index instead</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="18-data-access-pattern-decision-tree">18. Data Access Pattern Decision Tree<a href="#18-data-access-pattern-decision-tree" class="hash-link" aria-label="Direct link to 18. Data Access Pattern Decision Tree" title="Direct link to 18. Data Access Pattern Decision Tree" translate="no">​</a></h2>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="19-performance-comparison">19. Performance Comparison<a href="#19-performance-comparison" class="hash-link" aria-label="Direct link to 19. Performance Comparison" title="Direct link to 19. Performance Comparison" translate="no">​</a></h2>



























































<table><thead><tr><th>Pattern</th><th>Latency (P99)</th><th>Throughput</th><th>Use When</th></tr></thead><tbody><tr><td><strong>Cache (Hit)</strong></td><td>&lt; 5ms</td><td>50k RPS</td><td>Frequent reads</td></tr><tr><td><strong>Cache (Miss)</strong></td><td>&lt; 50ms</td><td>5k RPS</td><td>First access</td></tr><tr><td><strong>KeyValue</strong></td><td>&lt; 20ms</td><td>10k RPS</td><td>Transactional data</td></tr><tr><td><strong>TimeSeries</strong></td><td>&lt; 100ms</td><td>1M events/s</td><td>Analytics</td></tr><tr><td><strong>Object Storage</strong></td><td>&lt; 500ms</td><td>1k RPS</td><td>Large files</td></tr><tr><td><strong>Vector Search</strong></td><td>&lt; 50ms</td><td>5k RPS</td><td>Similarity queries</td></tr><tr><td><strong>Queue</strong></td><td>&lt; 30ms</td><td>100k msgs/s</td><td>Async processing</td></tr><tr><td><strong>PubSub</strong></td><td>&lt; 10ms</td><td>50k msgs/s</td><td>Real-time events</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="20-consistency-guarantees">20. Consistency Guarantees<a href="#20-consistency-guarantees" class="hash-link" aria-label="Direct link to 20. Consistency Guarantees" title="Direct link to 20. Consistency Guarantees" translate="no">​</a></h2>



























































<table><thead><tr><th>Pattern</th><th>Consistency</th><th>Durability</th><th>Rationale</th></tr></thead><tbody><tr><td><strong>Look-Aside Cache</strong></td><td>Eventual</td><td>Cache: None, DB: Strong</td><td>Tolerate stale reads</td></tr><tr><td><strong>Write-Through Cache</strong></td><td>Strong</td><td>Cache: None, DB: Strong</td><td>Fresh reads required</td></tr><tr><td><strong>KeyValue (Transact)</strong></td><td>Serializable</td><td>Strong</td><td>ACID transactions</td></tr><tr><td><strong>TimeSeries</strong></td><td>Eventual</td><td>Strong</td><td>Analytics, not transactions</td></tr><tr><td><strong>Object Storage</strong></td><td>Strong</td><td>Strong</td><td>Immutable objects</td></tr><tr><td><strong>Vector Search</strong></td><td>Eventual</td><td>None (Cache)</td><td>Search results, not source of truth</td></tr><tr><td><strong>Queue</strong></td><td>At-least-once</td><td>Strong</td><td>Message delivery</td></tr><tr><td><strong>PubSub</strong></td><td>At-most-once</td><td>None</td><td>Real-time, ephemeral</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="21-integration-patterns">21. Integration Patterns<a href="#21-integration-patterns" class="hash-link" aria-label="Direct link to 21. Integration Patterns" title="Direct link to 21. Integration Patterns" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="211-cache--keyvalue">21.1 Cache + KeyValue<a href="#211-cache--keyvalue" class="hash-link" aria-label="Direct link to 21.1 Cache + KeyValue" title="Direct link to 21.1 Cache + KeyValue" translate="no">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="212-queue--timeseries">21.2 Queue + TimeSeries<a href="#212-queue--timeseries" class="hash-link" aria-label="Direct link to 21.2 Queue + TimeSeries" title="Direct link to 21.2 Queue + TimeSeries" translate="no">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="213-object-storage--cache">21.3 Object Storage + Cache<a href="#213-object-storage--cache" class="hash-link" aria-label="Direct link to 21.3 Object Storage + Cache" title="Direct link to 21.3 Object Storage + Cache" translate="no">​</a></h3>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="22-migration-guide">22. Migration Guide<a href="#22-migration-guide" class="hash-link" aria-label="Direct link to 22. Migration Guide" title="Direct link to 22. Migration Guide" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="221-moving-from-direct-backend-to-prism">22.1 Moving from Direct Backend to Prism<a href="#221-moving-from-direct-backend-to-prism" class="hash-link" aria-label="Direct link to 22.1 Moving from Direct Backend to Prism" title="Direct link to 22.1 Moving from Direct Backend to Prism" translate="no">​</a></h3>
<p><strong>Before (Direct PostgreSQL)</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> psycopg2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> psycopg2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;postgres://localhost/mydb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cursor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cursor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cursor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM users WHERE id = %s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cursor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fetchone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>After (Prism Reader Service)</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> prism_sdk </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> PrismClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PrismClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;users&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">collection</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;users&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fields</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="222-adding-cache-layer">22.2 Adding Cache Layer<a href="#222-adding-cache-layer" class="hash-link" aria-label="Direct link to 22.2 Adding Cache Layer" title="Direct link to 22.2 Adding Cache Layer" translate="no">​</a></h3>
<p><strong>Before (Direct DB reads)</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>After (Look-Aside Cache via Prism)</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Prism handles cache check + DB fallback automatically</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">collection</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;users&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># First call: ~20ms (DB), subsequent: ~2ms (cache)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="223-event-streaming">22.3 Event Streaming<a href="#223-event-streaming" class="hash-link" aria-label="Direct link to 22.3 Event Streaming" title="Direct link to 22.3 Event Streaming" translate="no">​</a></h3>
<p><strong>Before (Direct Kafka)</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">producer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> KafkaProducer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bootstrap_servers</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;kafka:9092&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;events&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event_data</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>After (Prism Queue Service)</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;events&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">event_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Prism handles Kafka producer config, retries, partitioning</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="23-revision-history">23. Revision History<a href="#23-revision-history" class="hash-link" aria-label="Direct link to 23. Revision History" title="Direct link to 23. Revision History" translate="no">​</a></h2>
<ul>
<li>2025-10-07: Initial draft</li>
<li>2025-10-08: Added Cache, TimeSeries, Object Storage, Vector Search services; decision tree; integration patterns</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/jrepp/prism-data-layer/tree/main/docs-cms/../docs-cms/rfcs/rfc-002-data-layer-interface.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/prism-data-layer/rfc/rfc-001"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Prism Data Access Layer Architecture • RFC-001</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/prism-data-layer/rfc/rfc-003"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Admin Interface for Prism • RFC-003</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#abstract" class="table-of-contents__link toc-highlight">Abstract</a></li><li><a href="#1-introduction" class="table-of-contents__link toc-highlight">1. Introduction</a><ul><li><a href="#11-purpose" class="table-of-contents__link toc-highlight">1.1 Purpose</a></li><li><a href="#12-design-principles" class="table-of-contents__link toc-highlight">1.2 Design Principles</a></li><li><a href="#13-service-overview" class="table-of-contents__link toc-highlight">1.3 Service Overview</a></li><li><a href="#113-authorization" class="table-of-contents__link toc-highlight">11.3 Authorization</a></li></ul></li><li><a href="#12-testing" class="table-of-contents__link toc-highlight">12. Testing</a><ul><li><a href="#121-unit-tests" class="table-of-contents__link toc-highlight">12.1 Unit Tests</a></li><li><a href="#122-integration-tests" class="table-of-contents__link toc-highlight">12.2 Integration Tests</a></li></ul></li><li><a href="#13-references" class="table-of-contents__link toc-highlight">13. References</a></li><li><a href="#14-cache-service-rfc-007" class="table-of-contents__link toc-highlight">14. Cache Service (RFC-007)</a><ul><li><a href="#141-overview" class="table-of-contents__link toc-highlight">14.1 Overview</a></li><li><a href="#142-service-definition" class="table-of-contents__link toc-highlight">14.2 Service Definition</a></li><li><a href="#143-cache-patterns" class="table-of-contents__link toc-highlight">14.3 Cache Patterns</a></li><li><a href="#144-use-case-recommendations" class="table-of-contents__link toc-highlight">14.4 Use-Case Recommendations</a></li></ul></li><li><a href="#15-timeseries-service-rfc-005" class="table-of-contents__link toc-highlight">15. TimeSeries Service (RFC-005)</a><ul><li><a href="#151-overview" class="table-of-contents__link toc-highlight">15.1 Overview</a></li><li><a href="#152-service-definition" class="table-of-contents__link toc-highlight">15.2 Service Definition</a></li><li><a href="#153-architecture" class="table-of-contents__link toc-highlight">15.3 Architecture</a></li><li><a href="#154-use-case-recommendations" class="table-of-contents__link toc-highlight">15.4 Use-Case Recommendations</a></li></ul></li><li><a href="#16-object-storage-service-adr-032" class="table-of-contents__link toc-highlight">16. Object Storage Service (ADR-032)</a><ul><li><a href="#161-overview" class="table-of-contents__link toc-highlight">16.1 Overview</a></li><li><a href="#162-service-definition" class="table-of-contents__link toc-highlight">16.2 Service Definition</a></li><li><a href="#163-architecture" class="table-of-contents__link toc-highlight">16.3 Architecture</a></li><li><a href="#164-use-case-recommendations" class="table-of-contents__link toc-highlight">16.4 Use-Case Recommendations</a></li></ul></li><li><a href="#17-vector-search-service-rfc-004" class="table-of-contents__link toc-highlight">17. Vector Search Service (RFC-004)</a><ul><li><a href="#171-overview" class="table-of-contents__link toc-highlight">17.1 Overview</a></li><li><a href="#172-service-definition" class="table-of-contents__link toc-highlight">17.2 Service Definition</a></li><li><a href="#173-architecture" class="table-of-contents__link toc-highlight">17.3 Architecture</a></li><li><a href="#174-use-case-recommendations" class="table-of-contents__link toc-highlight">17.4 Use-Case Recommendations</a></li></ul></li><li><a href="#18-data-access-pattern-decision-tree" class="table-of-contents__link toc-highlight">18. Data Access Pattern Decision Tree</a></li><li><a href="#19-performance-comparison" class="table-of-contents__link toc-highlight">19. Performance Comparison</a></li><li><a href="#20-consistency-guarantees" class="table-of-contents__link toc-highlight">20. Consistency Guarantees</a></li><li><a href="#21-integration-patterns" class="table-of-contents__link toc-highlight">21. Integration Patterns</a><ul><li><a href="#211-cache--keyvalue" class="table-of-contents__link toc-highlight">21.1 Cache + KeyValue</a></li><li><a href="#212-queue--timeseries" class="table-of-contents__link toc-highlight">21.2 Queue + TimeSeries</a></li><li><a href="#213-object-storage--cache" class="table-of-contents__link toc-highlight">21.3 Object Storage + Cache</a></li></ul></li><li><a href="#22-migration-guide" class="table-of-contents__link toc-highlight">22. Migration Guide</a><ul><li><a href="#221-moving-from-direct-backend-to-prism" class="table-of-contents__link toc-highlight">22.1 Moving from Direct Backend to Prism</a></li><li><a href="#222-adding-cache-layer" class="table-of-contents__link toc-highlight">22.2 Adding Cache Layer</a></li><li><a href="#223-event-streaming" class="table-of-contents__link toc-highlight">22.3 Event Streaming</a></li></ul></li><li><a href="#23-revision-history" class="table-of-contents__link toc-highlight">23. Revision History</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/intro">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/changelog">Change Log</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/adr">ADRs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/rfc">RFCs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/memos">Memos</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/prds">PRDs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Project</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div>Copyright © 2025 Prism. Built with Docusaurus.</div><div style="margin-top:0.5rem;font-size:0.875rem;opacity:0.8"><span>Version <!-- -->7f44008</span><span> • </span><span>Built <!-- -->Oct 14, 2025, 08:03 AM PDT</span><span> • </span><span>Commit <!-- -->7f44008</span></div></div></div></div></footer></div>
</body>
</html>