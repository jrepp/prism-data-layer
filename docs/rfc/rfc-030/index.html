<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-rfc docs-version-current docs-doc-page docs-doc-id-rfc-030" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">RFC-030: Schema Evolution and Validation for Decoupled Pub/Sub | Prism</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jrepp.github.io/prism-data-layer/rfc/rfc-030"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" property="og:title" content="RFC-030: Schema Evolution and Validation for Decoupled Pub/Sub | Prism"><meta data-rh="true" name="description" content="Abstract"><meta data-rh="true" property="og:description" content="Abstract"><link data-rh="true" rel="icon" href="/prism-data-layer/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-030"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-030" hreflang="en"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-030" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Schema Evolution and Validation for Decoupled Pub/Sub • RFC-030","item":"https://jrepp.github.io/prism-data-layer/rfc/rfc-030"}]}</script><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes">
<meta name="theme-color" content="#6366f1">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="stylesheet" href="/prism-data-layer/assets/css/styles.73adf43b.css">
<script src="/prism-data-layer/assets/js/runtime~main.0ea3b2ed.js" defer="defer"></script>
<script src="/prism-data-layer/assets/js/main.f9acdc42.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/prism-data-layer/"><div class="navbar__logo"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">Prism</b></a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/intro">Overview</a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/changelog">Change Log</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Documentation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/prism-data-layer/adr">ADRs (Architecture Decision Records)</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/prism-data-layer/rfc">RFCs (Request for Comments)</a></li><li><a class="dropdown__link" href="/prism-data-layer/memos">Memos (Technical Analysis)</a></li><li><a class="dropdown__link" href="/prism-data-layer/prds">PRDs (Product Requirements)</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="buildInfo_asc2"><span class="version_ADrX" title="Build: 47bd04a">47bd04a</span><span class="separator_VfCt">•</span><span class="buildTime_n1Nn" title="Last updated: Oct 15, 9:36 AM PDT">Oct 15, 9:36 AM PDT</span></div><div class="navbar__item"><a href="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml" target="_blank" rel="noopener noreferrer" title="GitHub Pages" style="display: flex; align-items: center; padding: 0 0.5rem;"><img src="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml/badge.svg" alt="Build" style="margin: 0;"></a></div><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_x44X"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/"><span title="Request for Comments (RFCs)" class="linkLabel_WmDU">Request for Comments (RFCs)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-001"><span title="RFC-001 to 010" class="categoryLinkLabel_W154">RFC-001 to 010</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-011"><span title="RFC-011 to 020" class="categoryLinkLabel_W154">RFC-011 to 020</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/prism-data-layer/rfc/rfc-021"><span title="RFC-021 to 030" class="categoryLinkLabel_W154">RFC-021 to 030</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-021"><span title="POC 1 - Three Minimal Plugins Implementation Plan • RFC-021" class="linkLabel_WmDU">POC 1 - Three Minimal Plugins Implementation Plan • RFC-021</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-022"><span title="Core Pattern SDK - Build System and Physical Code Layout • RFC-022" class="linkLabel_WmDU">Core Pattern SDK - Build System and Physical Code Layout • RFC-022</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-023"><span title="Publish Snapshotter Plugin - Write-Only Event Buffering with Pagination • RFC-023" class="linkLabel_WmDU">Publish Snapshotter Plugin - Write-Only Event Buffering with Pagination • RFC-023</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-024"><span title="Distributed Session Store Pattern - Cross-Region Session Management • RFC-024" class="linkLabel_WmDU">Distributed Session Store Pattern - Cross-Region Session Management • RFC-024</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-025"><span title="Pattern SDK Architecture - Backend Drivers and Concurrency Primitives • RFC-025" class="linkLabel_WmDU">Pattern SDK Architecture - Backend Drivers and Concurrency Primitives • RFC-025</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-026"><span title="POC 1 - KeyValue with MemStore Implementation Plan (Original) • RFC-026" class="linkLabel_WmDU">POC 1 - KeyValue with MemStore Implementation Plan (Original) • RFC-026</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-027"><span title="Namespace Configuration and Client Request Flow • RFC-027" class="linkLabel_WmDU">Namespace Configuration and Client Request Flow • RFC-027</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-028"><span title="prism-probe - CLI Client for Testing and Debugging • RFC-028" class="linkLabel_WmDU">prism-probe - CLI Client for Testing and Debugging • RFC-028</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-029"><span title="Load Testing Framework Evaluation and Strategy • RFC-029" class="linkLabel_WmDU">Load Testing Framework Evaluation and Strategy • RFC-029</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/prism-data-layer/rfc/rfc-030"><span title="Schema Evolution and Validation for Decoupled Pub/Sub • RFC-030" class="linkLabel_WmDU">Schema Evolution and Validation for Decoupled Pub/Sub • RFC-030</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-031"><span title="RFC-031 to 040" class="categoryLinkLabel_W154">RFC-031 to 040</span></a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/prism-data-layer/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">RFC-021 to 030</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Schema Evolution and Validation for Decoupled Pub/Sub • RFC-030</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="docMetadata_NQcq"><div class="tagsRow_ipDH"><span class="tag_VbXK">schema</span><span class="tag_VbXK">pubsub</span><span class="tag_VbXK">validation</span><span class="tag_VbXK">evolution</span><span class="tag_VbXK">governance</span><span class="tag_VbXK">developer-experience</span><span class="tag_VbXK">internet-scale</span></div><div class="metadataRow_PvZM"><span class="metadataItem_RMFE info_Qo8L"><strong>Status:</strong> <!-- -->Draft</span><span class="metadataItem_RMFE"><strong>Author:</strong> <!-- -->Platform Team</span><span class="metadataItem_RMFE"><strong>Created:</strong> <!-- -->Oct 12, 2025</span><span class="metadataItem_RMFE"><strong>Updated:</strong> <!-- -->Oct 12, 2025</span></div></div><div class="theme-doc-markdown markdown"><header><h1>RFC-030: Schema Evolution and Validation for Decoupled Pub/Sub</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a href="#abstract" class="hash-link" aria-label="Direct link to Abstract" title="Direct link to Abstract" translate="no">​</a></h2>
<p>This RFC addresses schema evolution and validation for publisher/consumer patterns in Prism where producers and consumers are decoupled across async teams with different workflows and GitHub repositories. It proposes a schema registry approach that enables producers to declare publish schemas (GitHub or dedicated registry), consumers to validate compatibility at runtime, and platform teams to enforce governance while maintaining development velocity.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-decoupling-problem">The Decoupling Problem<a href="#the-decoupling-problem" class="hash-link" aria-label="Direct link to The Decoupling Problem" title="Direct link to The Decoupling Problem" translate="no">​</a></h3>
<p>Prism&#x27;s pub/sub and queue patterns intentionally decouple producers from consumers:</p>
<p><strong>Current Architecture:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────┐         ┌─────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Producer App   │         │  Consumer App   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  (Team A, Repo 1)  │        │  (Team B, Repo 2)│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────┬────────┘         └────────┬────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │  Publish                  │  Subscribe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         │  events                   │  events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         └───────────┐     ┌─────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     ▼     ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ┌──────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              │  Prism Proxy     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              │  NATS/Kafka      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              └──────────────────┘</span><br></span></code></pre></div></div>
<p><strong>Problems This Creates:</strong></p>
<ol>
<li>
<p><strong>Schema Discovery</strong>: Consumer teams don&#x27;t know what schema producers use</p>
<ul>
<li>No centralized documentation</li>
<li>Tribal knowledge or Slack asks: &quot;Hey, what fields does <code>user.created</code> have?&quot;</li>
<li>Breaking changes discovered at runtime</li>
</ul>
</li>
<li>
<p><strong>Version Mismatches</strong>: Producer evolves schema, consumer breaks</p>
<ul>
<li>Producer adds required field → consumers crash on deserialization</li>
<li>Producer removes field → consumers get <code>null</code> unexpectedly</li>
<li>Producer changes field type → silent data corruption</li>
</ul>
</li>
<li>
<p><strong>Cross-Repo Workflows</strong>: Teams can&#x27;t coordinate deploys</p>
<ul>
<li>Producer Team A deploys v2 schema on Monday</li>
<li>Consumer Team B still running v1 code on Friday</li>
<li>No visibility into downstream breakage</li>
</ul>
</li>
<li>
<p><strong>Testing Challenges</strong>: Consumers can&#x27;t test against producer changes</p>
<ul>
<li>Integration tests use mock data</li>
<li>Mocks drift from real schemas</li>
<li>Production is first place incompatibility detected</li>
</ul>
</li>
<li>
<p><strong>Governance Vacuum</strong>: No platform control over data quality</p>
<ul>
<li>No PII tagging enforcement</li>
<li>No backward compatibility checks</li>
<li>No schema approval workflows</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-this-matters-for-prd-001-goals">Why This Matters for PRD-001 Goals<a href="#why-this-matters-for-prd-001-goals" class="hash-link" aria-label="Direct link to Why This Matters for PRD-001 Goals" title="Direct link to Why This Matters for PRD-001 Goals" translate="no">​</a></h3>
<p><strong>PRD-001 Core Goals This Blocks:</strong></p>



































<table><thead><tr><th>Goal</th><th>Blocked By</th><th>Impact</th></tr></thead><tbody><tr><td><strong>Accelerate Development</strong></td><td>Waiting for schema docs from other teams</td><td>Delays feature delivery</td></tr><tr><td><strong>Enable Migrations</strong></td><td>Can&#x27;t validate consumers before backend change</td><td>Risky migrations</td></tr><tr><td><strong>Reduce Operational Cost</strong></td><td>Runtime failures from schema mismatches</td><td>Incident toil</td></tr><tr><td><strong>Improve Reliability</strong></td><td>Silent data corruption from type changes</td><td>Data quality issues</td></tr><tr><td><strong>Foster Innovation</strong></td><td>Fear of breaking downstream consumers</td><td>Slows experimentation</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="real-world-scenarios">Real-World Scenarios<a href="#real-world-scenarios" class="hash-link" aria-label="Direct link to Real-World Scenarios" title="Direct link to Real-World Scenarios" translate="no">​</a></h3>
<p><strong>Scenario 1: E-Commerce Order Events</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Producer: Order Service (Team A)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Publishes: orders.created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Schema: {order_id, user_id, items[], total, currency}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Consumers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Fulfillment Service (Team B): Needs order_id, items[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Analytics Pipeline (Team C): Needs all fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Email Service (Team D): Needs order_id, user_id, total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Problem: Team A wants to add `tax_amount` field (required)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - How do they know which consumers will break?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - How do consumers discover this change before deploy?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - What happens if Team D deploys before Team A?</span><br></span></code></pre></div></div>
<p><strong>Scenario 2: IoT Sensor Data</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Producer: IoT Gateway (Team A)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Publishes: sensor.readings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Schema: {sensor_id, timestamp, temperature, humidity}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Consumers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Alerting Service (Team B): Needs sensor_id, temperature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Data Lake (Team C): Needs all fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Dashboard (Team D): Needs sensor_id, timestamp, temperature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Problem: Team A changes `temperature` from int (Celsius) to float (Fahrenheit)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Type change breaks deserialization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Semantic change breaks business logic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - How to test this without breaking production?</span><br></span></code></pre></div></div>
<p><strong>Scenario 3: User Profile Updates</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Producer: User Service (Team A)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Publishes: user.profile.updated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Schema: {user_id, email, name, avatar_url}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Contains PII: email, name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Consumer: Search Indexer (Team B)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Stores ALL fields in Elasticsearch (public-facing search)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Problem: PII leak due to missing governance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Producer doesn&#x27;t tag PII fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Consumer indexes email addresses</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Compliance violation, data breach risk</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="goals">Goals<a href="#goals" class="hash-link" aria-label="Direct link to Goals" title="Direct link to Goals" translate="no">​</a></h2>
<ol>
<li><strong>Schema Discovery</strong>: Consumers can find producer schemas without asking humans</li>
<li><strong>Compatibility Validation</strong>: Consumers detect breaking changes before deploy</li>
<li><strong>Decoupled Evolution</strong>: Producers evolve schemas without coordinating deploys</li>
<li><strong>Testing Support</strong>: Consumers test against real schemas in CI/CD</li>
<li><strong>Governance Enforcement</strong>: Platform enforces PII tagging, compatibility rules</li>
<li><strong>Developer Velocity</strong>: Schema changes take minutes, not days of coordination</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="non-goals">Non-Goals<a href="#non-goals" class="hash-link" aria-label="Direct link to Non-Goals" title="Direct link to Non-Goals" translate="no">​</a></h2>
<ol>
<li><strong>Runtime Schema Transformation</strong>: No automatic v1 → v2 translation (use separate topics)</li>
<li><strong>Cross-Language Type System</strong>: Won&#x27;t solve Go struct ↔ Python dict ↔ Rust enum mapping</li>
<li><strong>Schema Inference</strong>: Won&#x27;t auto-generate schemas from published data</li>
<li><strong>Global Schema Uniqueness</strong>: Same event type can have different schemas per namespace</li>
<li><strong>Zero Downtime Schema Migration</strong>: Producers/consumers must handle overlapping schema versions</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="proposed-solution-layered-schema-registry">Proposed Solution: Layered Schema Registry<a href="#proposed-solution-layered-schema-registry" class="hash-link" aria-label="Direct link to Proposed Solution: Layered Schema Registry" title="Direct link to Proposed Solution: Layered Schema Registry" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-overview">Architecture Overview<a href="#architecture-overview" class="hash-link" aria-label="Direct link to Architecture Overview" title="Direct link to Architecture Overview" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                  Producer Workflow                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. Define Schema (protobuf/json-schema/avro)             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ├─ orders.created.v2.proto                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ├─ PII tags: @prism.pii(type=&quot;email&quot;)                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     └─ Backward compat: optional new fields               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. Register Schema                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ├─ Option A: Push to GitHub (git tag release)        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ├─ Option B: POST to Prism Schema Registry           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     └─ CI/CD validates compat                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. Publish with Schema Reference                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     client.publish(topic=&quot;orders.created&quot;, payload=data,  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    schema_url=&quot;github.com/.../v2.proto&quot;)  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                  Consumer Workflow                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. Discover Schema                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ├─ List available schemas for topic                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ├─ GET github.com/.../orders.created.v2.proto         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     └─ Generate client code (protoc)                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. Validate Compatibility (CI/CD)                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ├─ prism schema check --consumer my-schema.proto      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     ├─ Fails if producer added required fields           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     └─ Warns if producer removed fields                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. Subscribe with Schema Assertion                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     client.subscribe(topic=&quot;orders.created&quot;,              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      expected_schema=&quot;v2&quot;,                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      on_mismatch=&quot;warn&quot;)                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│              Prism Proxy (Schema Enforcement)               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Caches schemas from registry/GitHub                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Validates published messages match declared schema     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Attaches schema metadata to messages                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Enforces PII tagging policy                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Tracks schema versions per topic                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────────────────── ──────────────────────────────┘</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="three-tier-schema-storage">Three-Tier Schema Storage<a href="#three-tier-schema-storage" class="hash-link" aria-label="Direct link to Three-Tier Schema Storage" title="Direct link to Three-Tier Schema Storage" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tier-1-github-developer-friendly-git-native">Tier 1: GitHub (Developer-Friendly, Git-Native)<a href="#tier-1-github-developer-friendly-git-native" class="hash-link" aria-label="Direct link to Tier 1: GitHub (Developer-Friendly, Git-Native)" title="Direct link to Tier 1: GitHub (Developer-Friendly, Git-Native)" translate="no">​</a></h4>
<p><strong>Use Case</strong>: Open-source workflows, multi-repo teams, audit trail via Git history</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Producer repository structure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my-service/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── schemas/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── events/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── orders.created.v1.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── orders.created.v2.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── orders.updated.v1.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── prism-config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># prism-config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: orders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pattern: pubsub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    schema:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      registry_type: github</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      repository: github.com/myorg/my-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      path: schemas/events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      branch: main  # or use git tags for immutability</span><br></span></code></pre></div></div>
<p><strong>Schema URL Format:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">github.com/myorg/my-service/blob/main/schemas/events/orders.created.v2.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">github.com/myorg/my-service/blob/v2.1.0/schemas/events/orders.created.v2.proto  # Tagged release</span><br></span></code></pre></div></div>
<p><strong>Pros</strong>:</p>
<ul>
<li>✅ Familiar Git workflow (PR reviews, version tags)</li>
<li>✅ Public schemas for open-source projects</li>
<li>✅ Free (GitHub hosts)</li>
<li>✅ Change history and blame</li>
<li>✅ CI/CD integration via GitHub Actions</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li>❌ Requires GitHub access (not suitable for air-gapped envs)</li>
<li>❌ Rate limits (5000 req/hour authenticated)</li>
<li>❌ Latency (300-500ms per fetch)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tier-2-prism-schema-registry-platform-managed-high-performance">Tier 2: Prism Schema Registry (Platform-Managed, High Performance)<a href="#tier-2-prism-schema-registry-platform-managed-high-performance" class="hash-link" aria-label="Direct link to Tier 2: Prism Schema Registry (Platform-Managed, High Performance)" title="Direct link to Tier 2: Prism Schema Registry (Platform-Managed, High Performance)" translate="no">​</a></h4>
<p><strong>Use Case</strong>: Enterprise, high-throughput, governance controls, private networks</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># POST /v1/schemas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST https://prism-registry.example.com/v1/schemas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;namespace&quot;: &quot;orders&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;topic&quot;: &quot;orders.created&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;version&quot;: &quot;v2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;format&quot;: &quot;protobuf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;schema&quot;: &quot;&lt;base64-encoded proto&gt;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;metadata&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;owner_team&quot;: &quot;order-team&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;pii_fields&quot;: [&quot;email&quot;, &quot;billing_address&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;compatibility_mode&quot;: &quot;backward&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;schema_id&quot;: &quot;schema-abc123&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;schema_url&quot;: &quot;prism-registry.example.com/v1/schemas/schema-abc123&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;validation&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;compatible_with_v1&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;breaking_changes&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;warnings&quot;: [&quot;Field &#x27;tax_amount&#x27; added as optional&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Pros</strong>:</p>
<ul>
<li>✅ Low latency (&lt;10ms, in-cluster)</li>
<li>✅ No external dependencies</li>
<li>✅ Governance hooks (approval workflows)</li>
<li>✅ Caching (aggressive, TTL=1h)</li>
<li>✅ Observability (metrics, audit logs)</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li>❌ Requires infrastructure (deploy + maintain registry service)</li>
<li>❌ Not Git-native (must integrate with Git repos separately)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tier-3-confluent-schema-registry-kafka-native">Tier 3: Confluent Schema Registry (Kafka-Native)<a href="#tier-3-confluent-schema-registry-kafka-native" class="hash-link" aria-label="Direct link to Tier 3: Confluent Schema Registry (Kafka-Native)" title="Direct link to Tier 3: Confluent Schema Registry (Kafka-Native)" translate="no">​</a></h4>
<p><strong>Use Case</strong>: Kafka-heavy deployments, existing Confluent infrastructure</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Use Confluent REST API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST http://kafka-schema-registry:8081/subjects/orders.created-value/versions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;schema&quot;: &quot;{...protobuf IDL...}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;schemaType&quot;: &quot;PROTOBUF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Prism adapter translates to Confluent API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism-config.yaml:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  schema:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    registry_type: confluent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    url: http://kafka-schema-registry:8081</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatibility: BACKWARD</span><br></span></code></pre></div></div>
<p><strong>Pros</strong>:</p>
<ul>
<li>✅ Kafka ecosystem integration</li>
<li>✅ Mature, battle-tested (100k+ deployments)</li>
<li>✅ Built-in compatibility checks</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li>❌ Kafka-specific (doesn&#x27;t work with NATS)</li>
<li>❌ Licensing (Confluent Community vs Enterprise)</li>
<li>❌ Heavy (JVM-based, 1GB+ memory)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="comparison-with-kafka-ecosystem-registries">Comparison with Kafka Ecosystem Registries<a href="#comparison-with-kafka-ecosystem-registries" class="hash-link" aria-label="Direct link to Comparison with Kafka Ecosystem Registries" title="Direct link to Comparison with Kafka Ecosystem Registries" translate="no">​</a></h3>
<p><strong>Validation Against Existing Standards:</strong></p>
<p>Prism&#x27;s schema registry approach is validated against three major Kafka ecosystem registries:</p>







































































































<table><thead><tr><th>Feature</th><th>Confluent Schema Registry</th><th>AWS Glue Schema Registry</th><th>Apicurio Registry</th><th>Prism Schema Registry</th></tr></thead><tbody><tr><td><strong>Protocol Support</strong></td><td>REST</td><td>REST</td><td>REST</td><td>gRPC + REST</td></tr><tr><td><strong>Schema Formats</strong></td><td>Avro, Protobuf, JSON Schema</td><td>Avro, JSON Schema, Protobuf</td><td>Avro, Protobuf, JSON, OpenAPI, AsyncAPI</td><td>Protobuf, JSON Schema, Avro</td></tr><tr><td><strong>Backend Lock-In</strong></td><td>Kafka-specific</td><td>AWS-specific</td><td>Multi-backend</td><td>Multi-backend (NATS, Kafka, etc.)</td></tr><tr><td><strong>Compatibility Checking</strong></td><td>✅ Backward, Forward, Full</td><td>✅ Backward, Forward, Full, None</td><td>✅ Backward, Forward, Full</td><td>✅ Backward, Forward, Full, None</td></tr><tr><td><strong>Schema Evolution</strong></td><td>✅ Subject-based versioning</td><td>✅ Version-based</td><td>✅ Artifact-based</td><td>✅ Topic + namespace versioning</td></tr><tr><td><strong>Language-agnostic</strong></td><td>✅ Yes</td><td>✅ Yes</td><td>✅ Yes</td><td>✅ Yes</td></tr><tr><td><strong>Storage Backend</strong></td><td>Kafka topic</td><td>DynamoDB</td><td>PostgreSQL, Kafka, Infinispan</td><td>SQLite (dev), Postgres (prod)</td></tr><tr><td><strong>Git Integration</strong></td><td>❌ No</td><td>❌ No</td><td>⚠️ External only</td><td>✅ Native GitHub support</td></tr><tr><td><strong>Client-Side Caching</strong></td><td>⚠️ Manual</td><td>⚠️ Manual</td><td>⚠️ Manual</td><td>✅ Built-in (namespace config)</td></tr><tr><td><strong>PII Governance</strong></td><td>❌ No</td><td>❌ No</td><td>❌ No</td><td>✅ Prism annotations</td></tr><tr><td><strong>Deployment</strong></td><td>JVM (1GB+)</td><td>Managed service</td><td>JVM or native</td><td>Rust (&lt;50MB)</td></tr><tr><td><strong>Latency (P99)</strong></td><td>10-20ms</td><td>20-50ms</td><td>10-30ms</td><td>&lt;10ms (in-cluster)</td></tr><tr><td><strong>Pricing</strong></td><td>Free (OSS) / Enterprise $$</td><td>Per API call</td><td>Free (OSS)</td><td>Free (OSS)</td></tr></tbody></table>
<p><strong>Key Differentiators:</strong></p>
<ol>
<li><strong>Multi-Backend Support</strong>: Prism works with NATS, Kafka, RabbitMQ, etc. (not Kafka-specific)</li>
<li><strong>Git-Native</strong>: Schemas can live in GitHub repos (no separate registry infrastructure for OSS)</li>
<li><strong>Config-Time Resolution</strong>: Schema validated once at namespace config, not per-message</li>
<li><strong>PII Governance</strong>: Built-in <code>@prism.pii</code> annotations for compliance</li>
<li><strong>Lightweight</strong>: Rust-based registry (50MB) vs JVM-based (1GB+)</li>
</ol>
<p><strong>Standard Compatibility:</strong></p>
<p>Prism implements the same compatibility modes as Confluent:</p>
<ul>
<li><strong>BACKWARD</strong>: New schema can read old data (add optional fields)</li>
<li><strong>FORWARD</strong>: Old schema can read new data (delete optional fields)</li>
<li><strong>FULL</strong>: Both backward and forward</li>
<li><strong>NONE</strong>: No compatibility checks</li>
</ul>
<p>Prism can also <strong>interoperate</strong> with Confluent Schema Registry via Tier 3 adapter (see above).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="build-vs-buy-custom-prism-schema-registry-feasibility-analysis">Build vs Buy: Custom Prism Schema Registry Feasibility Analysis<a href="#build-vs-buy-custom-prism-schema-registry-feasibility-analysis" class="hash-link" aria-label="Direct link to Build vs Buy: Custom Prism Schema Registry Feasibility Analysis" title="Direct link to Build vs Buy: Custom Prism Schema Registry Feasibility Analysis" translate="no">​</a></h3>
<p><strong>CRITICAL DECISION</strong>: Should Prism build its own schema registry or rely on existing solutions?</p>
<p><strong>Decision Criteria:</strong></p>







































































<table><thead><tr><th>Criterion</th><th>Custom Prism Registry</th><th>Existing Solutions (Confluent, Apicurio)</th><th>Weight</th></tr></thead><tbody><tr><td><strong>Multi-Backend Support</strong></td><td>✅ Works with NATS, Kafka, Redis, etc.</td><td>⚠️ Kafka-specific (Confluent) or heavyweight (Apicurio)</td><td>HIGH</td></tr><tr><td><strong>Development Effort</strong></td><td>❌ 3-4 months initial + ongoing maintenance</td><td>✅ Zero dev effort, use off-the-shelf</td><td>HIGH</td></tr><tr><td><strong>Deployment Complexity</strong></td><td>⚠️ Another service to deploy/monitor</td><td>❌ Same (JVM-based, 1GB+ memory)</td><td>MEDIUM</td></tr><tr><td><strong>Performance</strong></td><td>✅ Rust-based (&lt;50MB, &lt;10ms P99)</td><td>⚠️ JVM overhead (100ms+ P99 at scale)</td><td>MEDIUM</td></tr><tr><td><strong>Git Integration</strong></td><td>✅ Native GitHub support (Tier 1)</td><td>❌ No native Git integration</td><td>HIGH</td></tr><tr><td><strong>PII Governance</strong></td><td>✅ Built-in <code>@prism.pii</code> annotations</td><td>❌ Not supported (manual enforcement)</td><td>MEDIUM</td></tr><tr><td><strong>Operational Maturity</strong></td><td>❌ New, unproven at scale</td><td>✅ Battle-tested (100k+ deployments)</td><td>HIGH</td></tr><tr><td><strong>Ecosystem Tools</strong></td><td>❌ No existing tooling</td><td> ✅ Rich ecosystem (CLI, UI, plugins)</td><td>MEDIUM</td></tr><tr><td><strong>Licensing</strong></td><td>✅ Open-source (Apache 2.0)</td><td>⚠️ Confluent: Community (limited) vs Enterprise</td><td>MEDIUM</td></tr><tr><td><strong>Air-Gap Support</strong></td><td>✅ Works offline with Git repos</td><td>❌ Requires external registry service</td><td>LOW</td></tr></tbody></table>
<p><strong>Recommendation: Hybrid Approach (Build Lightweight Custom Registry + Support Existing)</strong></p>
<p><strong>Phase 1: Minimal Viable Registry (8 weeks)</strong></p>
<p>Build a <strong>lightweight Prism Schema Registry</strong> focused on features that existing solutions don&#x27;t provide:</p>
<ol>
<li>
<p><strong>Core Features (Must-Have)</strong>:</p>
<ul>
<li>Schema CRUD (register, get, list, delete)</li>
<li>Protobuf + JSON Schema support</li>
<li>Backward/forward compatibility checks</li>
<li>SQLite (dev) + PostgreSQL (prod) storage</li>
<li>REST + gRPC API</li>
<li>GitHub URL resolution (Tier 1 support)</li>
</ul>
</li>
<li>
<p><strong>Prism-Specific Features (Differentiators)</strong>:</p>
<ul>
<li>PII annotation validation (<code>@prism.pii</code>)</li>
<li>Multi-backend schema propagation (push to Kafka/NATS)</li>
<li>Namespace-scoped schemas (tenant isolation)</li>
<li>Schema trust verification (SHA256 hash, allowed sources)</li>
<li>Deprecation warnings via field tags</li>
</ul>
</li>
<li>
<p><strong>NOT Building (Use Existing)</strong>:</p>
<ul>
<li>Complex UI (use Apicurio for browsing)</li>
<li>Schema transformation (avro ↔ protobuf)</li>
<li>Advanced governance (approval workflows - Phase 2)</li>
</ul>
</li>
</ol>
<p><strong>Phase 2: Interoperability (4 weeks)</strong></p>
<p>Add adapters to <strong>use existing registries</strong> where already deployed:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Use existing Confluent Schema Registry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> confluent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//kafka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">schema</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Prism acts as pass-through, no custom registry needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use existing Apicurio Registry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apicurio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//apicurio</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Prism fetches schemas from Apicurio</span><br></span></code></pre></div></div>
<p><strong>Phase 3: Federation (Future)</strong></p>
<p>Allow <strong>multiple registries</strong> to work together:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Federated schema discovery</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> federated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//prism</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">registry.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">priority</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Try first</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> confluent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//kafka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">priority</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Fallback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.com/myorg/schemas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">priority</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Last resort</span><br></span></code></pre></div></div>
<p><strong>Build Feasibility Assessment:</strong></p>
<p><strong>Timeline Estimate:</strong></p>



































<table><thead><tr><th>Phase</th><th>Effort</th><th>Calendar Time</th><th>Team Size</th></tr></thead><tbody><tr><td><strong>Phase 1: Core Registry</strong></td><td>320 hours</td><td>8 weeks</td><td>2 engineers</td></tr><tr><td><strong>Phase 2: Interoperability</strong></td><td>160 hours</td><td>4 weeks</td><td>1 engineer</td></tr><tr><td><strong>Phase 3: Federation</strong></td><td>240 hours</td><td>6 weeks</td><td>2 engineers</td></tr><tr><td><strong>Ongoing Maintenance</strong></td><td>80 hours/quarter</td><td>Continuous</td><td>1 engineer (20%)</td></tr></tbody></table>
<p><strong>Technical Risks:</strong></p>
<ol>
<li>
<p><strong>Risk: Schema validation complexity</strong></p>
<ul>
<li>Protobuf has subtle compatibility rules (field renumbering, one-of changes)</li>
<li>Mitigation: Use existing protobuf-go libraries, test against Confluent test suite</li>
</ul>
</li>
<li>
<p><strong>Risk: Operational overhead</strong></p>
<ul>
<li>Another service to deploy, monitor, scale</li>
<li>Mitigation: Deploy as sidecar to Prism proxy, share lifecycle</li>
</ul>
</li>
<li>
<p><strong>Risk: Ecosystem fragmentation</strong></p>
<ul>
<li>Teams may already standardize on Confluent Schema Registry</li>
<li>Mitigation: Support interoperability (Phase 2), not replacement</li>
</ul>
</li>
</ol>
<p><strong>When to Use Custom Prism Registry:</strong></p>








































<table><thead><tr><th>Scenario</th><th>Use Prism Registry</th><th>Use Existing Registry</th></tr></thead><tbody><tr><td><strong>New Prism deployment</strong></td><td>✅ Yes (simple, integrated)</td><td>⚠️ If already using Kafka heavily</td></tr><tr><td><strong>Multi-backend (NATS + Kafka + Redis)</strong></td><td>✅ Yes (unified registry)</td><td>❌ No (need separate registries per backend)</td></tr><tr><td><strong>PII compliance required</strong></td><td>✅ Yes (built-in governance)</td><td>❌ No (manual enforcement)</td></tr><tr><td><strong>Existing Confluent deployment</strong></td><td>❌ No (keep Confluent)</td><td>✅ Yes (use adapter)</td></tr><tr><td><strong>Air-gapped environment</strong></td><td>✅ Yes (works offline)</td><td>⚠️ Need to deploy registry</td></tr><tr><td><strong>Open-source projects</strong></td><td>✅ Yes (GitHub Tier 1)</td><td>❌ No (extra infra)</td></tr></tbody></table>
<p><strong>Cost-Benefit Analysis:</strong></p>
<p><strong>Benefits of Building Custom Registry:</strong></p>
<ol>
<li>✅ <strong>Multi-Backend Support</strong>: One registry for NATS, Kafka, Redis, PostgreSQL</li>
<li>✅ <strong>PII Governance</strong>: Mandatory PII tagging enforced at registration</li>
<li>✅ <strong>Git-Native</strong>: Schemas live in Git repos, no separate infrastructure</li>
<li>✅ <strong>Performance</strong>: Rust-based, &lt;50MB memory, &lt;10ms P99 latency</li>
<li>✅ <strong>Simplicity</strong>: Tightly integrated with Prism proxy (shared config, auth, observability)</li>
</ol>
<p><strong>Costs of Building Custom Registry:</strong></p>
<ol>
<li>❌ <strong>Development Time</strong>: 8-12 weeks initial + ongoing maintenance</li>
<li>❌ <strong>Operational Overhead</strong>: Another service to deploy/monitor</li>
<li>❌ <strong>Ecosystem Gap</strong>: No existing tooling, community support</li>
<li>❌ <strong>Adoption Risk</strong>: Teams may resist non-standard solution</li>
</ol>
<p><strong>FINAL RECOMMENDATION:</strong></p>
<p><strong>Build a minimal Prism Schema Registry (Phase 1) with these constraints:</strong></p>
<ol>
<li><strong>Scope</strong>: Focus on Prism-specific features (PII, multi-backend, Git integration)</li>
<li><strong>Interoperability</strong>: Support existing registries via adapters (Phase 2)</li>
<li><strong>Default to GitHub</strong>: Make Tier 1 (GitHub) the default for simplicity</li>
<li><strong>Optional Deployment</strong>: Prism Registry is opt-in, not required</li>
</ol>
<p><strong>Decision Matrix:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Deployment Scenario                    │ Recommended Registry│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────┼─────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  New Prism deployment                   │ GitHub (Tier 1)     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Multi-backend (NATS + Kafka)           │ Prism Registry      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Existing Confluent infrastructure      │ Confluent (Tier 3)  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  PII compliance required                │ Prism Registry      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Open-source project                    │ GitHub (Tier 1)     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  High-throughput (&amp;gt;100k RPS)            │ Prism Registry      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Air-gapped network                     │ Prism Registry      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────┴─────────────────────┘</span><br></span></code></pre></div></div>
<p><strong>Validation Checklist Before Building:</strong></p>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Survey existing users</strong>: Do they already use Confluent/Apicurio? (If yes, interop only)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Prototype GitHub adapter</strong>: Can we meet 80% of needs with Tier 1 only? (If yes, delay registry)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Load test Apicurio</strong>: Does it meet performance needs at our scale? (If yes, consider using it)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Cost estimate</strong>: What&#x27;s the TCO of running JVM registry vs Rust registry? (Compare ops cost)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Compliance review</strong>: Do we need PII features for regulatory reasons? (If yes, must build)</li>
</ul>
<p>If 3+ boxes checked &quot;build not needed&quot;, defer custom registry to Phase 2.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="internet-scale-decoupled-usage-scenarios">Internet-Scale Decoupled Usage Scenarios<a href="#internet-scale-decoupled-usage-scenarios" class="hash-link" aria-label="Direct link to Internet-Scale Decoupled Usage Scenarios" title="Direct link to Internet-Scale Decoupled Usage Scenarios" translate="no">​</a></h3>
<p><strong>CRITICAL DESIGN REQUIREMENT</strong>: System must support truly independent producers/consumers across organizational boundaries.</p>
<p><strong>Scenario 1: Open-Source Data Exchange</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Producer: IoT Device Manufacturer (Acme Corp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Ships devices that publish telemetry to customer&#x27;s Prism proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Schema: github.com/acme/device-schemas/telemetry.v1.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Public GitHub repo with MIT license</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Consumer: Independent Developer (Alice)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Builds monitoring dashboard for Acme devices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Discovers schema via GitHub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Never talks to Acme directly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Key Challenge: Alice discovers schema change (v2) 6 months after Acme ships it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Solution: Backward compatibility enforced at Acme&#x27;s CI/CD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Alice&#x27;s v1 consumer continues working</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Alice upgrades to v2 when ready (no coordination)</span><br></span></code></pre></div></div>
<p><strong>Scenario 2: Multi-Tenant SaaS Platform</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Producers: 1000s of customer applications (different companies)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Each publishes events to their isolated namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Schemas registered per-customer: customer123.orders.created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Consumers: Platform analytics service (SaaS vendor)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Subscribes to events from all customers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Needs to handle schema drift per customer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Key Challenge: Customer A uses v1 schema, Customer B uses v3 schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Solution: Schema metadata in message headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Consumer deserializes per-message using attached schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - No cross-customer coordination needed</span><br></span></code></pre></div></div>
<p><strong>Scenario 3: Public API Webhooks</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Producer: Payment Gateway (Stripe-like)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Sends webhook events to merchant endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Schema: stripe.com/schemas/payment.succeeded.v2.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Consumers: 100k+ merchants worldwide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Implement webhook handlers in various languages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Download JSON schema from public URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Key Challenge: Payment gateway evolves schema, merchants deploy asynchronously</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Solution: Public schema registry (read-only for merchants)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Merchants use prism schema check in CI/CD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Breaking changes trigger merchant notifications</span><br></span></code></pre></div></div>
<p><strong>Scenario 4: Federated Event Bus</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Producers: Multiple organizations in supply chain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Manufacturer publishes: mfg.shipment.created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Distributor publishes: dist.delivery.scheduled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Retailer publishes: retail.order.fulfilled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Consumers: Each organization subscribes to others&#x27; events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - No direct contracts between organizations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Schema discovery via public registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Key Challenge: No central authority to enforce schemas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Solution: Each organization runs own Prism Schema Registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Cross-organization schema discovery via DNS (schema-registry.mfg.example.com)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Federation via schema URLs (like ActivityPub for events)</span><br></span></code></pre></div></div>
<p><strong>Internet-Scale Design Principles:</strong></p>
<ol>
<li><strong>No Coordination Assumption</strong>: Producers/consumers never talk directly</li>
<li><strong>Public Schema Discovery</strong>: Schemas must be fetchable via HTTPS</li>
<li><strong>Long Version Lifetimes</strong>: Schemas supported for years (not weeks)</li>
<li><strong>Graceful Degradation</strong>: Old consumers ignore new fields silently</li>
<li><strong>Namespace Isolation</strong>: Per-tenant/organization namespaces prevent conflicts</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="schema-declaration-in-namespace-config">Schema Declaration in Namespace Config<a href="#schema-declaration-in-namespace-config" class="hash-link" aria-label="Direct link to Schema Declaration in Namespace Config" title="Direct link to Schema Declaration in Namespace Config" translate="no">​</a></h3>
<p><strong>CRITICAL ARCHITECTURAL DECISION</strong>: Schema is declared ONCE in namespace configuration, not per-message. The proxy automatically attaches schema metadata to all published messages.</p>
<p><strong>Client-Originated Configuration (RFC-014):</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Producer namespace config - schema declared at configuration time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pubsub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">topic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> orders.created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Schema declaration (ONCE per namespace, not per publish)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># IMPORTANT: Schema is referenced by URL only (no inline schema content)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Option 1: GitHub reference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.com/myorg/order</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service/schemas/orders.created.v2.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2  </span><span class="token comment" style="color:#999988;font-style:italic"># Explicit version for this namespace</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Option 2: Prism Schema Registry reference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//schema</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">registry.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">subject</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> orders.created  </span><span class="token comment" style="color:#999988;font-style:italic"># Subject name in registry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Option 3: Any HTTPS endpoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//schemas.example.com/orders/created/v2.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Schema trust verification (mandatory for external URLs)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">trust</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">schema_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;orders.OrderCreated&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Protobuf message name for verification</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sha256_hash</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;abc123...&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Optional: Verify schema integrity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">allowed_sources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Optional: Restrict schema sources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;github.com/myorg/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;schemas.example.com/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># When validation happens:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">config_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Validate schema exists when namespace is configured</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">build_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Generate typed clients at build time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">publish_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># NO per-message validation (performance)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Compatibility policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">compatibility</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> backward  </span><span class="token comment" style="color:#999988;font-style:italic"># v2 consumers can read v1 data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># PII enforcement (checked at registration time, not runtime)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">pii_validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> enforce  </span><span class="token comment" style="color:#999988;font-style:italic"># fail if PII fields not tagged</span><br></span></code></pre></div></div>
<p><strong>Key Design Principles:</strong></p>
<ol>
<li>
<p><strong>Configuration-Time Schema Resolution</strong>: When namespace is configured, Prism:</p>
<ul>
<li>Fetches schema from registry/GitHub</li>
<li>Validates schema exists and is parseable</li>
<li>Caches schema definition in proxy memory</li>
<li>Generates code gen artifacts (if requested)</li>
</ul>
</li>
<li>
<p><strong>Zero Per-Message Overhead</strong>: Proxy attaches cached schema metadata to every message without re-validation</p>
</li>
<li>
<p><strong>Build-Time Assertions</strong>: Client code generation ensures type safety at compile time</p>
</li>
<li>
<p><strong>Optional Runtime Validation</strong>: Only enabled explicitly for debugging (huge performance cost)</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="schema-attachment-at-publish-time">Schema Attachment at Publish Time<a href="#schema-attachment-at-publish-time" class="hash-link" aria-label="Direct link to Schema Attachment at Publish Time" title="Direct link to Schema Attachment at Publish Time" translate="no">​</a></h3>
<p><strong>Configuration-Time Schema Resolution (ONCE):</strong></p>
<!-- -->
<p><strong>Publish Flow (NO per-message validation):</strong></p>
<!-- -->
<p><strong>Optional Runtime Validation (debugging only):</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Enable ONLY for debugging - huge performance cost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">validation:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  config_time: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  build_time: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  publish_time: true  # ⚠️ WARNING: +50% latency overhead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Proxy validates every message against schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use only when debugging schema issues</span><br></span></code></pre></div></div>
<p><strong>Message Format with Schema Metadata:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># NATS message headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Prism-Schema-URL: github.com/myorg/order-service/schemas/orders.created.v2.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Prism-Schema-Version: v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Prism-Schema-Hash: sha256:abc123...  # For immutability check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Prism-Namespace: order-events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Prism-Published-At: 2025-10-13T10:30:00Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Payload (protobuf binary)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;binary protobuf OrderCreated&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="consumer-schema-discovery-and-validation">Consumer Schema Discovery and Validation<a href="#consumer-schema-discovery-and-validation" class="hash-link" aria-label="Direct link to Consumer Schema Discovery and Validation" title="Direct link to Consumer Schema Discovery and Validation" translate="no">​</a></h3>
<p><strong>Discovery API:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># List all schemas for a topic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema list </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># VERSION   URL                                                    PUBLISHED     CONSUMERS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># v2        github.com/.../orders.created.v2.proto                 2025-10-13    3 active</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># v1        github.com/.../orders.created.v1.proto                 2025-09-01    1 active (deprecated)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Get schema definition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema get </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created </span><span class="token parameter variable" style="color:#36acaa">--version</span><span class="token plain"> v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output: (downloads proto file)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syntax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;proto3&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message OrderCreated </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string order_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string user_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string email </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated OrderItem items </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  double total </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string currency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional double tax_amount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  // Added </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate client code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema codegen </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created </span><span class="token parameter variable" style="color:#36acaa">--version</span><span class="token plain"> v2 </span><span class="token parameter variable" style="color:#36acaa">--language</span><span class="token plain"> go </span><span class="token parameter variable" style="color:#36acaa">--output</span><span class="token plain"> ./proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generates: orders_created.pb.go</span><br></span></code></pre></div></div>
<p><strong>Consumer Compatibility Check (CI/CD):</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># In consumer CI pipeline</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema check </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --consumer-schema ./schemas/my_consumer_schema.proto </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--mode</span><span class="token plain"> strict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Compatible with producer schema v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⚠️  Warning: Producer added optional field </span><span class="token string" style="color:#e3116c">&#x27;tax_amount&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">not </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> consumer schema</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ Error: Consumer expects required field </span><span class="token string" style="color:#e3116c">&#x27;discount_code&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">not </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> producer schema</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Exit code: 1 (fail CI)</span><br></span></code></pre></div></div>
<p><strong>Consumer Subscription with Schema Assertion:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Python consumer with schema validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> prism_sdk </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> PrismClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> prism_sdk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schema </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SchemaValidator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PrismClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;order-events&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Option 1: Validate at subscribe time (fail-fast)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    topic</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;orders.created&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    schema_assertion</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;expected_version&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;on_mismatch&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;error&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Options: error | warn | ignore</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;compatibility_mode&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;forward&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># v1 consumer reads v2 data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Option 2: Validate per-message (flexible)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> event </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> stream</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Client SDK deserializes using schema from message headers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">payload  </span><span class="token comment" style="color:#999988;font-style:italic"># Typed OrderCreated object</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Explicit validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schema_version </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v2&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Unexpected schema version: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">schema_version</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        process_order</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> SchemaValidationError </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Schema mismatch: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Reject message, will retry or DLQ</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="backend-schema-propagation">Backend Schema Propagation<a href="#backend-schema-propagation" class="hash-link" aria-label="Direct link to Backend Schema Propagation" title="Direct link to Backend Schema Propagation" translate="no">​</a></h3>
<p><strong>CRITICAL REQUIREMENT</strong>: Prism must push schema metadata to backend systems to enable native schema validation and discovery within each backend&#x27;s ecosystem.</p>
<p><strong>Backend Interface for Schema Distribution:</strong></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Backend plugin interface extension for schema propagation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> SchemaAwareBackend </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Backend  </span><span class="token comment" style="color:#999988;font-style:italic">// Standard backend interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// PushSchema distributes schema to backend-specific registry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">PushSchema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">PushSchemaRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">PushSchemaResponse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// GetBackendSchemaURL returns backend-specific schema location</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">GetBackendSchemaURL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">namespace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> topic</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> version </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// SupportsSchemaRegistry indicates if backend has native schema support</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">SupportsSchemaRegistry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> PushSchemaRequest </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Namespace     </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Topic         </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Version       </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SchemaFormat  </span><span class="token builtin">string</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// &quot;protobuf&quot;, &quot;json-schema&quot;, &quot;avro&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SchemaContent </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Metadata      </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Kafka Backend: Schema Registry Integration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Namespace config with Kafka backend</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pubsub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">broker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka.example.com</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">topic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> orders.created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Enable automatic schema propagation to Confluent Schema Registry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">schema_propagation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">registry_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//schema</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">registry.kafka.example.com</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">subject_naming</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;TopicNameStrategy&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># or RecordNameStrategy, TopicRecordNameStrategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">compatibility</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BACKWARD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//schema</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">registry.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">subject</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> orders.created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2</span><br></span></code></pre></div></div>
<p><strong>How Kafka Schema Propagation Works:</strong></p>
<!-- -->
<p><strong>NATS Backend: JetStream Metadata</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Namespace config with NATS backend</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pubsub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nats</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//nats.example.com</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">subject</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> orders.created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Enable schema metadata in stream configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">schema_propagation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">method</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stream_metadata&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># or &quot;message_headers&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">registry_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.com/myorg/schemas/orders.created.v2.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2</span><br></span></code></pre></div></div>
<p><strong>NATS Schema Propagation Methods:</strong></p>
<p><strong>Method 1: Stream Metadata (Config-Time)</strong></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Prism creates NATS stream with schema metadata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stream </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">nats</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StreamConfig</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">     </span><span class="token string" style="color:#e3116c">&quot;ORDER_EVENTS&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Subjects</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;orders.created&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;schema_url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">     </span><span class="token string" style="color:#e3116c">&quot;github.com/myorg/schemas/orders.created.v2.proto&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;schema_version&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;schema_format&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;protobuf&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;schema_hash&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;sha256:abc123...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">js</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">stream</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Method 2: Message Headers (Publish-Time)</strong></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Prism attaches schema metadata to every message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msg </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">nats</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Msg</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Subject</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;orders.created&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    protobufPayload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Header</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nats</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Header</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Prism-Schema-URL&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;github.com/myorg/schemas/orders.created.v2.proto&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Prism-Schema-Version&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;v2&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Prism-Schema-Hash&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;sha256:abc123...&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Schema Propagation Trade-Offs:</strong></p>















































<table><thead><tr><th>Backend</th><th>Native Registry</th><th>Propagation Method</th><th>Performance</th><th>Discovery</th></tr></thead><tbody><tr><td><strong>Kafka</strong></td><td>✅ Confluent Schema Registry</td><td>POST to registry at config time</td><td>Excellent (schema ID in msg)</td><td>Native Kafka tooling</td></tr><tr><td><strong>NATS</strong></td><td>⚠️ No native registry</td><td>Stream metadata + msg headers</td><td>Good (header overhead ~200 bytes)</td><td>Custom via stream metadata</td></tr><tr><td><strong>RabbitMQ</strong></td><td>❌ No native support</td><td>Message headers only</td><td>Good</td><td>Custom via headers</td></tr><tr><td><strong>Redis</strong></td><td>❌ No native support</td><td>Key prefix (schema:topic:version)</td><td>Excellent</td><td>Custom via key scan</td></tr><tr><td><strong>PostgreSQL</strong></td><td>❌ No native support</td><td>Schema table (topic, version, content)</td><td>Good</td><td>SQL query</td></tr></tbody></table>
<p><strong>Configuration-Time vs Runtime Propagation:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Configuration-time propagation (recommended)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">schema_propagation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config_time  </span><span class="token comment" style="color:#999988;font-style:italic"># Push schema to backend when namespace is configured</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Pros: Zero per-message overhead, backend-native discovery</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Cons: Schema changes require namespace reconfiguration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Runtime propagation (fallback)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">schema_propagation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> runtime  </span><span class="token comment" style="color:#999988;font-style:italic"># Attach schema metadata to every message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">method</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> message_headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Pros: Works with any backend, no backend-specific integration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Cons: +200 bytes per message, no backend-native discovery</span><br></span></code></pre></div></div>
<p><strong>Schema Discovery from Backend Systems:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Kafka: Use native Confluent tooling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://schema-registry:8081/subjects/orders.created-value/versions/latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># NATS: Query stream metadata via CLI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nats stream info ORDER_EVENTS </span><span class="token parameter variable" style="color:#36acaa">--json</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> jq </span><span class="token string" style="color:#e3116c">&#x27;.config.metadata&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   &quot;schema_url&quot;: &quot;github.com/myorg/schemas/orders.created.v2.proto&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   &quot;schema_version&quot;: &quot;v2&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   &quot;schema_format&quot;: &quot;protobuf&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># PostgreSQL: Query schema table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT schema_url, version, </span><span class="token function" style="color:#d73a49">format</span><span class="token plain"> FROM prism_schemas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE topic </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;orders.created&#x27;</span><span class="token plain"> ORDER BY created_at DESC LIMIT </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>Benefits of Backend Schema Propagation:</strong></p>
<ol>
<li><strong>Native Tooling</strong>: Kafka consumers can use Confluent&#x27;s schema registry client libraries</li>
<li><strong>Backend-Aware Validation</strong>: Kafka brokers can enforce schema validation (Confluent Server feature)</li>
<li><strong>Ecosystem Integration</strong>: Works with existing monitoring/debugging tools for each backend</li>
<li><strong>Reduced Coupling</strong>: Consumers don&#x27;t need Prism SDK to discover schemas</li>
<li><strong>Compliance</strong>: Audit trail lives in backend-specific systems</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="optional-field-enforcement-for-producers">Optional Field Enforcement for Producers<a href="#optional-field-enforcement-for-producers" class="hash-link" aria-label="Direct link to Optional Field Enforcement for Producers" title="Direct link to Optional Field Enforcement for Producers" translate="no">​</a></h3>
<p><strong>BEST PRACTICE</strong>: Prism strongly recommends (and can enforce) that all fields in producer schemas are <code>optional</code> to maintain maximum backward compatibility.</p>
<p><strong>Why Optional Fields Matter:</strong></p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ❌ BAD: Required fields break backward compatibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">OrderCreated</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> order_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// Implicitly required (proto3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> user_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Implicitly required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">double</span><span class="token plain"> total </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// Implicitly required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> payment_method </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// NEW field - BREAKS v1 consumers!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ✅ GOOD: Optional fields preserve compatibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">OrderCreated</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">optional</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> order_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// Explicitly optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">optional</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> user_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Explicitly optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">optional</span><span class="token plain"> </span><span class="token builtin">double</span><span class="token plain"> total </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// Explicitly optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">optional</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> payment_method </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// NEW field - v1 consumers ignore it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Prism Optional Field Validation:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Enable optional field enforcement in schema validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">registry_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">registry_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//schema</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">registry.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Validation rules</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">build_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enforce_optional_fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Reject schemas with required fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">optional_field_exceptions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Allow exceptions for specific fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># Primary keys can be required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*_id&quot;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># Foreign keys can be required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;timestamp&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Timestamps can be required</span><br></span></code></pre></div></div>
<p><strong>Schema Registration with Enforcement:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Producer tries to register schema with required fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema register </span><span class="token parameter variable" style="color:#36acaa">--file</span><span class="token plain"> order_created.proto --enforce-optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Prism validation output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ Error: Field </span><span class="token string" style="color:#e3116c">&#x27;order_id&#x27;</span><span class="token plain"> is required </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">not marked optional</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ Error: Field </span><span class="token string" style="color:#e3116c">&#x27;user_id&#x27;</span><span class="token plain"> is required </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">not marked optional</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ Error: Field </span><span class="token string" style="color:#e3116c">&#x27;total&#x27;</span><span class="token plain"> is required </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">not marked optional</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ℹ️  Recommendation: Mark fields as </span><span class="token string" style="color:#e3116c">&#x27;optional&#x27;</span><span class="token plain"> to maintain backward compatibility</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ℹ️  Example: optional string order_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Registration fails (exit code 1)</span><br></span></code></pre></div></div>
<p><strong>Enforcement Levels:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Level 1: Warn only (default, non-blocking)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enforce_optional_fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> warn  </span><span class="token comment" style="color:#999988;font-style:italic"># Log warnings but allow registration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Level 2: Enforce with exceptions (recommended)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enforce_optional_fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">optional_field_exceptions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;*_id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;timestamp&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Level 3: Strict enforcement (no exceptions)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enforce_optional_fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> strict  </span><span class="token comment" style="color:#999988;font-style:italic"># All fields MUST be optional</span><br></span></code></pre></div></div>
<p><strong>Migration Path for Existing Schemas:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Step 1: Audit existing schemas for required fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema audit --check-optional-fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Topic: orders.created (v2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   ❌ Field &#x27;order_id&#x27; is required (recommend: optional)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   ❌ Field &#x27;user_id&#x27; is required (recommend: optional)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   ❌ Field &#x27;total&#x27; is required (recommend: optional)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Topic: user.profile.updated (v3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   ✅ All fields are optional (backward compatible)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 2: Create v3 schema with all optional fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> orders.created.v3.proto </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">message OrderCreated {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  optional string order_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  optional string user_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  optional double total = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  optional string currency = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 3: Register new schema version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema register </span><span class="token parameter variable" style="color:#36acaa">--file</span><span class="token plain"> orders.created.v3.proto --enforce-optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Schema registered: All fields properly marked optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 4: Gradual consumer migration (v2 → v3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    Both schemas coexist during transition period</span><br></span></code></pre></div></div>
<p><strong>Benefits of Optional Field Enforcement:</strong></p>
<ol>
<li>✅ <strong>Backward Compatibility</strong>: Old consumers continue working when fields added</li>
<li>✅ <strong>Forward Compatibility</strong>: New consumers handle missing fields gracefully</li>
<li>✅ <strong>Schema Evolution</strong>: Producers can add fields without breaking changes</li>
<li>✅ <strong>Zero Coordination</strong>: No need to coordinate producer/consumer deployments</li>
<li>✅ <strong>Reduced Risk</strong>: Eliminates class of breaking changes at registration time</li>
</ol>
<p><strong>Trade-Offs:</strong></p>
<ul>
<li>⚠️ <strong>Validation Overhead</strong>: Consumers must check for presence of optional fields</li>
<li>⚠️ <strong>Default Values</strong>: Optional fields need sensible defaults or null handling</li>
<li>⚠️ <strong>Type Safety</strong>: Some languages (Go) treat optional differently than required</li>
</ul>
<p><strong>Example: Consumer Handling Optional Fields:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Python consumer handling optional fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> prism_sdk </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> PrismClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PrismClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;order-events&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;orders.created&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> event </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> stream</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">payload  </span><span class="token comment" style="color:#999988;font-style:italic"># OrderCreated protobuf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Optional fields: Check presence before access</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HasField</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;order_id&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Order ID: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">order</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">order_id</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Order ID: &lt;missing&gt;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Handle missing field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Alternative: Use getattr with default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">getattr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;total&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Default to 0.0 if missing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    currency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">getattr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;currency&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;USD&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Default to USD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process_order</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Go consumer handling optional fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleOrderCreated</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">OrderCreated</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Optional fields are pointers in Go (protobuf)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OrderId </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Order ID: %s\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OrderId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Order ID: &lt;missing&gt;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Safe access with default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Total </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        total </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    currency </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;USD&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Currency </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        currency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Currency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">processOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="backwardforward-compatibility-modes">Backward/Forward Compatibility Modes<a href="#backwardforward-compatibility-modes" class="hash-link" aria-label="Direct link to Backward/Forward Compatibility Modes" title="Direct link to Backward/Forward Compatibility Modes" translate="no">​</a></h3>
<p><strong>Compatibility Matrix:</strong></p>






























<table><thead><tr><th>Mode</th><th>Producer Changes Allowed</th><th>Consumer Requirement</th></tr></thead><tbody><tr><td><strong>Backward</strong></td><td>Add optional fields</td><td>Old consumers work with new data</td></tr><tr><td><strong>Forward</strong></td><td>Delete optional fields</td><td>New consumers work with old data</td></tr><tr><td><strong>Full</strong></td><td>Add/delete optional fields</td><td>Bidirectional compatibility</td></tr><tr><td><strong>None</strong></td><td>Any changes</td><td>No compatibility guarantees</td></tr></tbody></table>
<p><strong>Example: Backward Compatibility</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Producer v1 schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message OrderCreated {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string order_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string user_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  double total = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Producer v2 schema (backward compatible)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message OrderCreated {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string order_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string user_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  double total = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional double tax_amount = 4;  # NEW: Optional field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string promo_code = 5;  # NEW: Optional field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Consumer still on v1 code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order = OrderCreated.decode(payload)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(order.total)  # Works! Ignores unknown fields (tax_amount, promo_code)</span><br></span></code></pre></div></div>
<p><strong>Example: Forward Compatibility</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Producer v1 schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message OrderCreated {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string order_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string user_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  double total = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional string notes = 4;  # Optional field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Producer v2 schema (forward compatible)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message OrderCreated {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string order_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string user_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  double total = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Removed: optional string notes = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Consumer on v2 code reads v1 message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">order = OrderCreated.decode(payload)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(order.notes)  # Empty/default value, no error</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="governance-schema-and-consumer-tags-for-distributed-teams">Governance: Schema and Consumer Tags for Distributed Teams<a href="#governance-schema-and-consumer-tags-for-distributed-teams" class="hash-link" aria-label="Direct link to Governance: Schema and Consumer Tags for Distributed Teams" title="Direct link to Governance: Schema and Consumer Tags for Distributed Teams" translate="no">​</a></h3>
<p><strong>CRITICAL VALUE PROPOSITION</strong>: Prism-level governance tags enable platform teams to enforce policies across distributed teams without manual coordination.</p>
<p><strong>Why Governance Tags Matter:</strong></p>
<p>In distributed organizations with 10+ teams publishing/consuming events:</p>
<ul>
<li><strong>Problem 1</strong>: No visibility into who accesses sensitive data</li>
<li><strong>Problem 2</strong>: No automated enforcement of compliance policies (GDPR, HIPAA, SOC2)</li>
<li><strong>Problem 3</strong>: Manual approval workflows slow down development</li>
<li><strong>Problem 4</strong>: Audit trails require custom tooling per backend</li>
</ul>
<p><strong>Solution</strong>: Declarative tags in schemas + automated enforcement at Prism proxy</p>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="schema-level-governance-tags">Schema-Level Governance Tags<a href="#schema-level-governance-tags" class="hash-link" aria-label="Direct link to Schema-Level Governance Tags" title="Direct link to Schema-Level Governance Tags" translate="no">​</a></h4>
<p><strong>Tag Categories:</strong></p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">syntax</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;proto3&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;prism/annotations.proto&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Schema-level tags (message options)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">UserProfileUpdated</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">option</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensitivity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;high&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// low | medium | high | critical</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">option</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">compliance</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;gdpr,hipaa&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Comma-separated compliance frameworks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">option</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">retention_days</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">90</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Data retention policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">option</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">owner_team</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user-platform&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// Team responsible for schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">option</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consumer_approval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Require approval for new consumers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">option</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">audit_log</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;enabled&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// Log all access to this topic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">option</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data_classification</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;confidential&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// public | internal | confidential | restricted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> user_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;primary&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Field-level tags</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> email </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pii</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;email&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encrypt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;aes256&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">masking</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hash&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// hash | redact | tokenize | none</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> full_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pii</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">masking</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;redact&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> phone </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pii</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;phone&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">masking</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hash&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deprecated</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-12-31&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Deprecation date</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deprecated_reason</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Use phone_e164 instead&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> phone_e164 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pii</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;phone&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Replacement field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Non-PII fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> avatar_url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">int64</span><span class="token plain"> created_at </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Schema Tag Validation at Registration:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Producer tries to register schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema register </span><span class="token parameter variable" style="color:#36acaa">--file</span><span class="token plain"> user_profile.proto </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> user-events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Prism validation checks:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Sensitivity: high </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requires encryption </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> PII fields</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Compliance: gdpr,hipaa </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PII fields properly tagged</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ Error: Field </span><span class="token string" style="color:#e3116c">&#x27;email&#x27;</span><span class="token plain"> marked as PII but missing encryption annotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ Error: Schema </span><span class="token assign-left variable" style="color:#36acaa">sensitivity</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">high but no owner_team specified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ℹ️  Hint: Add </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism.encrypt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;aes256&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> to field </span><span class="token string" style="color:#e3116c">&#x27;email&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Exit code: 1 (registration fails until tags are correct)</span><br></span></code></pre></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="consumer-level-governance-tags">Consumer-Level Governance Tags<a href="#consumer-level-governance-tags" class="hash-link" aria-label="Direct link to Consumer-Level Governance Tags" title="Direct link to Consumer-Level Governance Tags" translate="no">​</a></h4>
<p><strong>Consumer Registration with Tags:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Consumer declares itself when subscribing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pubsub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">subject</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user.profile.updated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Consumer metadata (governance tags)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">consumer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">team</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;analytics-team&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">purpose</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Generate user behavior reports&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">data_usage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;analytics&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># analytics | operational | ml_training | debugging</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">pii_access</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;required&quot;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># required | not_needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">retention_days</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># How long consumer retains data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">compliance_frameworks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;gdpr&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ccpa&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Must match schema requirements</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">approved_by</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;security-team&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Approval ticket/email</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">approval_date</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-10-01&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">access_pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;read_only&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># read_only | write_through | bidirectional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Rate limiting (prevent abuse)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rate_limit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">max_messages_per_second</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">max_consumers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Max concurrent consumer instances</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Allowed fields (column-level access control)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">allowed_fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;user_id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;avatar_url&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;created_at&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Cannot access email, phone</span><br></span></code></pre></div></div>
<p><strong>Consumer Approval Workflow:</strong></p>
<!-- -->
<p><strong>Enforcement at Subscribe Time:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Consumer tries to subscribe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> prism_sdk </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> PrismClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PrismClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;user-events-consumer&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Prism checks consumer tags against schema tags</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;user.profile.updated&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Enforcement scenarios:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Scenario 1: Consumer missing required compliance tag</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ SubscribeError</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Schema requires compliance</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">gdpr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">hipaa</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> consumer declares compliance</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">gdpr</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Add </span><span class="token string" style="color:#e3116c">&#x27;hipaa&#x27;</span><span class="token plain"> to consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">compliance_frameworks </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Scenario 2: Consumer requests PII but doesn&#x27;t need it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⚠️  Warning</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Consumer declares pii_access</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">required but allowed_fields excludes </span><span class="token builtin">all</span><span class="token plain"> PII fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Consider setting pii_access</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">not_needed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Scenario 3: Consumer exceeds rate limit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ SubscribeError</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Consumer rate limit exceeded </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1050</span><span class="token plain"> msg</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"> msg</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">s limit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Increase rate_limit </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> config </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> </span><span class="token builtin">reduce</span><span class="token plain"> consumer count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Scenario 4: Consumer approved for specific fields only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Subscribed </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> field filtering</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Only fields </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avatar_url</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> will be delivered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Other fields automatically filtered by Prism proxy</span><br></span></code></pre></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="governance-tag-enforcement-matrix">Governance Tag Enforcement Matrix<a href="#governance-tag-enforcement-matrix" class="hash-link" aria-label="Direct link to Governance Tag Enforcement Matrix" title="Direct link to Governance Tag Enforcement Matrix" translate="no">​</a></h4>



















































































<table><thead><tr><th>Tag</th><th>Enforced At</th><th>Validation</th><th>Action on Violation</th></tr></thead><tbody><tr><td><strong>prism.sensitivity</strong></td><td>Schema registration</td><td>Check PII fields have encryption/masking</td><td>Reject schema registration</td></tr><tr><td><strong>prism.compliance</strong></td><td>Consumer subscribe</td><td>Match consumer compliance frameworks</td><td>Block subscription</td></tr><tr><td><strong>prism.owner_team</strong></td><td>Schema registration</td><td>Team exists in org directory</td><td>Reject schema</td></tr><tr><td><strong>prism.consumer_approval</strong></td><td>Consumer subscribe</td><td>Check approval ticket exists</td><td>Block until approved</td></tr><tr><td><strong>prism.pii</strong></td><td>Schema registration</td><td>Field name matches PII patterns</td><td>Reject schema</td></tr><tr><td><strong>prism.encrypt</strong></td><td>Publish time</td><td>Payload field is encrypted</td><td>Reject publish</td></tr><tr><td><strong>prism.masking</strong></td><td>Consumer delivery</td><td>Apply masking before delivery</td><td>Auto-mask field</td></tr><tr><td><strong>prism.deprecated</strong></td><td>Consumer subscribe</td><td>Warn about deprecated fields</td><td>Log warning, continue</td></tr><tr><td><strong>prism.retention_days</strong></td><td>Consumer subscribe</td><td>Consumer retention ≤ schema retention</td><td>Block subscription</td></tr><tr><td><strong>prism.allowed_fields</strong></td><td>Consumer delivery</td><td>Filter fields not in allowed list</td><td>Auto-filter fields</td></tr><tr><td><strong>prism.rate_limit</strong></td><td>Consumer delivery</td><td>Track message rate per consumer</td><td>Throttle/block</td></tr><tr><td><strong>prism.audit_log</strong></td><td>All operations</td><td>Log to audit system</td><td>N/A (always logged)</td></tr></tbody></table>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="field-level-access-control-column-security">Field-Level Access Control (Column Security)<a href="#field-level-access-control-column-security" class="hash-link" aria-label="Direct link to Field-Level Access Control (Column Security)" title="Direct link to Field-Level Access Control (Column Security)" translate="no">​</a></h4>
<p><strong>Problem</strong>: Consumer needs some fields but not PII fields</p>
<p><strong>Solution</strong>: Prism proxy auto-filters fields based on <code>allowed_fields</code> tag</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Consumer config with field restrictions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">limited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pubsub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">subject</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user.profile.updated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">consumer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">team</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dashboard-team&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">allowed_fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;user_id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;avatar_url&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;created_at&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># No PII fields</span><br></span></code></pre></div></div>
<p><strong>Proxy Filtering Behavior:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Producer publishes full message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;user.profile.updated&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;user_id&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user-123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;email&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;alice@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># PII</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;full_name&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Alice Johnson&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># PII</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;phone&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;+1-555-1234&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># PII</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;avatar_url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;created_at&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1697200000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Consumer receives filtered message (auto-applied by Prism)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> consumer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">receive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#     &quot;user_id&quot;: &quot;user-123&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#     &quot;avatar_url&quot;: &quot;https://...&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#     &quot;created_at&quot;: 1697200000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#     # email, full_name, phone REMOVED by proxy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># }</span><br></span></code></pre></div></div>
<p><strong>Benefits</strong>:</p>
<ul>
<li>✅ Consumers can&#x27;t accidentally access PII</li>
<li>✅ No code changes needed (filtering is transparent)</li>
<li>✅ Audit logs show which fields were filtered</li>
<li>✅ Reduces compliance risk</li>
</ul>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deprecation-warnings-for-schema-evolution">Deprecation Warnings for Schema Evolution<a href="#deprecation-warnings-for-schema-evolution" class="hash-link" aria-label="Direct link to Deprecation Warnings for Schema Evolution" title="Direct link to Deprecation Warnings for Schema Evolution" translate="no">​</a></h4>
<p><strong>Problem</strong>: Producer wants to deprecate field, needs to warn consumers</p>
<p><strong>Solution</strong>: <code>@prism.deprecated</code> tag with date and reason</p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">OrderCreated</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> order_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Old field (deprecated)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deprecated</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-12-31&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deprecated_reason</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Use order_status enum instead for type safety&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// New field (replacement)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">OrderStatus</span><span class="token plain"> order_status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">OrderStatus</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ORDER_STATUS_UNKNOWN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ORDER_STATUS_PENDING </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ORDER_STATUS_CONFIRMED </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ORDER_STATUS_SHIPPED </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ORDER_STATUS_DELIVERED </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Consumer Warnings at Runtime:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Consumer subscribes to orders.created</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;orders.created&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> event </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> stream</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Accessing deprecated field triggers warning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Warning: Field &#x27;status&#x27; is deprecated as of 2025-12-31</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#          Reason: Use order_status enum instead for type safety</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#          Migration guide: https://docs.example.com/migrate-order-status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Accessing new field (no warning)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">order_status</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ✅ Preferred</span><br></span></code></pre></div></div>
<p><strong>Deprecation Lifecycle:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1. Add deprecation tag (2025-10-01)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    Consumers get warnings but continue working</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Monitor deprecation warnings (2025-10 → 2025-12)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema deprecation-report </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Field: status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Deprecated: 2025-12-31</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Active consumers: 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   - inventory-service (12k accesses/day)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   - analytics-pipeline (8k accesses/day)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   - email-service (2k accesses/day)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. Notify teams (2025-11-01)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema notify-consumers </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created </span><span class="token parameter variable" style="color:#36acaa">--field</span><span class="token plain"> status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Sends email to teams: &quot;Field &#x27;status&#x27; will be removed on 2025-12-31&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 4. Remove field (2026-01-01, after deprecation date)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    Only after all consumers migrated</span><br></span></code></pre></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="audit-logging-and-compliance">Audit Logging and Compliance<a href="#audit-logging-and-compliance" class="hash-link" aria-label="Direct link to Audit Logging and Compliance" title="Direct link to Audit Logging and Compliance" translate="no">​</a></h4>
<p><strong>Automatic Audit Trails:</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Every schema access logged to audit system (e.g., CloudWatch, Splunk)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;event&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;consumer_access&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;timestamp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-10-13T10:30:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;topic&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user.profile.updated&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;schema_version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;consumer_team&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;analytics-team&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;consumer_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;analytics-pipeline-pod-42&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;fields_accessed&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;user_id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;avatar_url&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;fields_filtered&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;email&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;full_name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;phone&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// PII fields not delivered</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;pii_access&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;compliance_frameworks&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;gdpr&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ccpa&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;approval_ticket&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SEC-12345&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message_count&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;delivered&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;event&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;schema_registration&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;timestamp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-10-13T09:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;topic&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user.profile.updated&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;schema_version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v3&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;owner_team&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user-platform&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;sensitivity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;high&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;pii_fields&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;email&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;full_name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;phone&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;compliance_frameworks&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;gdpr&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hipaa&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;registered_by&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;alice@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;approved&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;event&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;consumer_blocked&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;timestamp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-10-13T10:35:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;topic&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user.profile.updated&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;consumer_team&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;external-vendor&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;reason&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Missing compliance framework: hipaa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;blocked&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Compliance Reporting:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Generate GDPR compliance report</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism governance report </span><span class="token parameter variable" style="color:#36acaa">--framework</span><span class="token plain"> gdpr </span><span class="token parameter variable" style="color:#36acaa">--start</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2025</span><span class="token plain">-10-01 </span><span class="token parameter variable" style="color:#36acaa">--end</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2025</span><span class="token plain">-10-31</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># GDPR Compliance Report (2025-10-01 to 2025-10-31)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Topics with PII:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   - user.profile.updated: 3 consumers, 1.2M messages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   - order.created: 2 consumers, 800K messages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># PII Access by Team:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   - analytics-team: 1.2M messages (approved: SEC-12345)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   - email-service: 500K messages (approved: SEC-67890)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   - dashboard-team: 0 messages (field filtering active)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Violations: 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Warnings: 1 (analytics-team exceeded rate limit 3 times)</span><br></span></code></pre></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="governance-tag-best-practices">Governance Tag Best Practices<a href="#governance-tag-best-practices" class="hash-link" aria-label="Direct link to Governance Tag Best Practices" title="Direct link to Governance Tag Best Practices" translate="no">​</a></h4>
<p><strong>For Platform Teams:</strong></p>
<ol>
<li><strong>Start with Required Tags</strong>: Make <code>owner_team</code>, <code>sensitivity</code>, <code>compliance</code> mandatory</li>
<li><strong>Automate Approvals</strong>: Integrate with PagerDuty/Jira for approval workflows</li>
<li><strong>Enforce at Registration</strong>: Block schema registration if tags missing</li>
<li><strong>Audit Everything</strong>: Enable <code>audit_log=enabled</code> for all high-sensitivity topics</li>
<li><strong>Field-Level Control</strong>: Use <code>allowed_fields</code> to implement principle of least privilege</li>
</ol>
<p><strong>For Producer Teams:</strong></p>
<ol>
<li><strong>Tag PII Fields</strong>: Use <code>@prism.pii</code> annotation for all PII</li>
<li><strong>Set Sensitivity</strong>: Mark schemas as <code>high</code> if contains PII</li>
<li><strong>Document Deprecations</strong>: Use <code>@prism.deprecated</code> with clear migration path</li>
<li><strong>Specify Retention</strong>: Set <code>retention_days</code> based on legal requirements</li>
<li><strong>Optional Fields</strong>: Use <code>optional</code> for all new fields to maintain backward compatibility</li>
</ol>
<p><strong>For Consumer Teams:</strong></p>
<ol>
<li><strong>Declare Purpose</strong>: Be specific about <code>data_usage</code> (analytics vs operational)</li>
<li><strong>Minimize Access</strong>: Only request <code>allowed_fields</code> you actually need</li>
<li><strong>Match Compliance</strong>: Ensure your <code>compliance_frameworks</code> match schema requirements</li>
<li><strong>Set Retention</strong>: Don&#x27;t exceed schema&#x27;s <code>retention_days</code> policy</li>
<li><strong>Handle Deprecations</strong>: Monitor warnings and migrate before deadline</li>
</ol>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-end-to-end-governance-flow">Example: End-to-End Governance Flow<a href="#example-end-to-end-governance-flow" class="hash-link" aria-label="Direct link to Example: End-to-End Governance Flow" title="Direct link to Example: End-to-End Governance Flow" translate="no">​</a></h4>
<p><strong>Scenario: Analytics team wants to analyze user behavior</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Step 1: User Platform team creates schema with governance tags</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> user_events.proto </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">import &quot;prism/annotations.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">message UserActivityEvent {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  option (prism.sensitivity) = &quot;high&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  option (prism.compliance) = &quot;gdpr,ccpa&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  option (prism.retention_days) = 90;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  option (prism.owner_team) = &quot;user-platform&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  option (prism.consumer_approval) = &quot;required&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  string user_id = 1 [(prism.index) = &quot;primary&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  string email = 2 [(prism.pii) = &quot;email&quot;, (prism.encrypt) = &quot;aes256&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  string activity_type = 3;  // &quot;login&quot;, &quot;purchase&quot;, &quot;view&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  int64 timestamp = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 2: Register schema (enforces governance tags)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema register </span><span class="token parameter variable" style="color:#36acaa">--file</span><span class="token plain"> user_events.proto </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> user.activity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Schema registered </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">approval required </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> new consumers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 3: Analytics team requests consumer access</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> analytics_consumer.yaml </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">namespaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - name: user-analytics</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    pattern: pubsub</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    backend:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      type: nats</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      subject: user.activity</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    consumer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      team: &quot;analytics-team&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      purpose: &quot;User behavior analysis for product recommendations&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      data_usage: &quot;analytics&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      pii_access: &quot;not_needed&quot;  # Don&#x27;t need email</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      retention_days: 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      compliance_frameworks: [&quot;gdpr&quot;, &quot;ccpa&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      allowed_fields: [&quot;user_id&quot;, &quot;activity_type&quot;, &quot;timestamp&quot;]  # Exclude email</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism namespace configure analytics_consumer.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⚠️  Consumer registration requires approval </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">high sensitivity topic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Approval request created: SEC-99999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 4: Security team approves (automated via Jira/PagerDuty)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Security reviews: purpose, allowed_fields, retention</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Approval granted: SEC-99999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 5: Analytics team subscribes (approval verified automatically)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism namespace configure analytics_consumer.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Consumer registered and approved</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 6: Consumer receives filtered messages (PII auto-removed)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Consumer code:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client.subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;user.activity&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">event</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> stream:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event.payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># { &quot;user_id&quot;: &quot;u123&quot;, &quot;activity_type&quot;: &quot;login&quot;, &quot;timestamp&quot;: 1697200000 }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># &quot;email&quot; field NOT delivered (filtered by Prism proxy)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 7: Audit trail generated automatically</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># All accesses logged with team, purpose, fields accessed, PII filtering applied</span><br></span></code></pre></div></div>
<p><strong>Benefits of Governance Tags:</strong></p>
<ol>
<li>✅ <strong>Self-Service</strong>: Teams can request access without manual coordination</li>
<li>✅ <strong>Automated Enforcement</strong>: Prism proxy blocks non-compliant consumers</li>
<li>✅ <strong>Audit Trail</strong>: Every access logged for compliance reporting</li>
<li>✅ <strong>Least Privilege</strong>: Field-level filtering prevents accidental PII access</li>
<li>✅ <strong>Deprecation Management</strong>: Consumers warned before breaking changes</li>
<li>✅ <strong>Compliance Ready</strong>: GDPR/HIPAA/SOC2 reports generated automatically</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="schema-evolution-workflow">Schema Evolution Workflow<a href="#schema-evolution-workflow" class="hash-link" aria-label="Direct link to Schema Evolution Workflow" title="Direct link to Schema Evolution Workflow" translate="no">​</a></h3>
<p><strong>Scenario: Add Optional Field (Backward Compatible)</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Step 1: Producer team updates schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># schemas/orders.created.v2.proto</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message OrderCreated </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string order_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string user_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  double total </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optional double tax_amount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># NEW</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 2: Validate compatibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema validate </span><span class="token parameter variable" style="color:#36acaa">--file</span><span class="token plain"> orders.created.v2.proto --check-backward</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Backward compatible with v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Added optional field </span><span class="token string" style="color:#e3116c">&#x27;tax_amount&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">safe</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 3: Register new schema version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema register </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--file</span><span class="token plain"> orders.created.v2.proto </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--version</span><span class="token plain"> v2 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--compatibility</span><span class="token plain"> backward</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Schema registered: schema-xyz789</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   URL: github.com/myorg/order-service/schemas/orders.created.v2.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Compatible consumers: v1 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> instances</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 4: Update producer code to publish v2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Producer code change</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">topic</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;orders.created&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">payload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">order_v2,  </span><span class="token comment" style="color:#999988;font-style:italic"># Includes tax_amount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">schema_version</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;v2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 5: Deploy producer (v1 consumers still work!)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> producer-deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 6: Consumers discover new schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema list </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># v2 now available, v1 consumers keep working</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 7: Consumer teams upgrade when ready (no coordination!)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Consumer Team B: Updates code to use tax_amount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Consumer Team C: Ignores new field (still works)</span><br></span></code></pre></div></div>
<p><strong>Scenario: Add Required Field (Breaking Change)</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Producer wants to add required field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message OrderCreated </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string order_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string user_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  double total </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string payment_method </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># NEW: Required field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Validation fails</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema validate </span><span class="token parameter variable" style="color:#36acaa">--file</span><span class="token plain"> orders.created.v3.proto --check-backward</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ NOT backward compatible with v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Added required field </span><span class="token string" style="color:#e3116c">&#x27;payment_method&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BREAKING</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ℹ️  Recommendation: Use new topic </span><span class="token string" style="color:#e3116c">&#x27;orders.created.v3&#x27;</span><span class="token plain"> or </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> field optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Producer options:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Option A: New topic (clean separation)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;orders.created.v3&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">payload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">order_v3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Option B: Make field optional (non-breaking)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">optional string payment_method </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Option C: Parallel publish (transition period)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;orders.created&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">payload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">order_v2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Old consumers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;orders.created.v3&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">payload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">order_v3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># New consumers</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="schema-registry-api-specification">Schema Registry API Specification<a href="#schema-registry-api-specification" class="hash-link" aria-label="Direct link to Schema Registry API Specification" title="Direct link to Schema Registry API Specification" translate="no">​</a></h3>
<p><strong>gRPC Service:</strong></p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">syntax</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;proto3&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">SchemaRegistryService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Register new schema version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">RegisterSchema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RegisterSchemaRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RegisterSchemaResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Get schema by topic + version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetSchema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetSchemaRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetSchemaResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// List all schema versions for topic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ListSchemas</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListSchemasRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListSchemasResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Check compatibility between schemas</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CheckCompatibility</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CheckCompatibilityRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CheckCompatibilityResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Delete schema version (with safety checks)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DeleteSchema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteSchemaRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteSchemaResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Get active consumers for schema version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetConsumers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetConsumersRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetConsumersResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">RegisterSchemaRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> namespace </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> topic </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// e.g., &quot;v2&quot;, &quot;1.0.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">SchemaFormat</span><span class="token plain"> format </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">bytes</span><span class="token plain"> schema_content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Protobuf IDL, JSON Schema, Avro, etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">CompatibilityMode</span><span class="token plain"> compatibility </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token map class-name">map</span><span class="token map class-name punctuation" style="color:#393A34">&lt;</span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">,</span><span class="token map class-name"> </span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// owner_team, description, etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">SchemaFormat</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SCHEMA_FORMAT_UNSPECIFIED </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SCHEMA_FORMAT_PROTOBUF </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SCHEMA_FORMAT_JSON_SCHEMA </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SCHEMA_FORMAT_AVRO </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">CompatibilityMode</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  COMPATIBILITY_MODE_UNSPECIFIED </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  COMPATIBILITY_MODE_NONE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  COMPATIBILITY_MODE_BACKWARD </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  COMPATIBILITY_MODE_FORWARD </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  COMPATIBILITY_MODE_FULL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">RegisterSchemaResponse</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> schema_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> schema_url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">ValidationResult</span><span class="token plain"> validation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">ValidationResult</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">bool</span><span class="token plain"> is_compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">repeated</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> breaking_changes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">repeated</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> warnings </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">repeated</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> compatible_versions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">GetSchemaRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> namespace </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> topic </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// or &quot;latest&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">GetSchemaResponse</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> schema_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">SchemaFormat</span><span class="token plain"> format </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">bytes</span><span class="token plain"> schema_content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">SchemaMetadata</span><span class="token plain"> metadata </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">SchemaMetadata</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> owner_team </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> description </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">google</span><span class="token positional-class-name class-name punctuation" style="color:#393A34">.</span><span class="token positional-class-name class-name">protobuf</span><span class="token positional-class-name class-name punctuation" style="color:#393A34">.</span><span class="token positional-class-name class-name">Timestamp</span><span class="token plain"> created_at </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> created_by </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">repeated</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> pii_fields </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">CompatibilityMode</span><span class="token plain"> compatibility </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">int32</span><span class="token plain"> active_consumers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="developer-workflows">Developer Workflows<a href="#developer-workflows" class="hash-link" aria-label="Direct link to Developer Workflows" title="Direct link to Developer Workflows" translate="no">​</a></h3>
<p><strong>Workflow 1: New Producer Team</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1. Create schema file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> schemas/events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> schemas/events/notification.sent.v1.proto </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">message NotificationSent {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  string notification_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  string user_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  string channel = 3;  // email, sms, push</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  string status = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Register schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema register </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--file</span><span class="token plain"> schemas/events/notification.sent.v1.proto </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> notification.sent </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--version</span><span class="token plain"> v1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--compatibility</span><span class="token plain"> backward </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --owner-team notifications-team</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. Generate client code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema codegen </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> notification.sent </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--version</span><span class="token plain"> v1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--language</span><span class="token plain"> python </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--output</span><span class="token plain"> ./generated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 4. Publish with schema reference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from generated </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> notification_sent_pb2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from prism_sdk </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> PrismClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PrismClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;notifications&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">schema_validation</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">notification </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> notification_sent_pb2.NotificationSent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">notification_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;notif-123&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">user_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;user-456&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">channel</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;email&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">status</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;sent&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">topic</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;notification.sent&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">payload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">notification,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">schema_version</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;v1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Workflow 2: Existing Consumer Team</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1. Discover available schemas</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema list </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># VERSION   STATUS       CONSUMERS   PUBLISHED</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># v2        current      3           2025-10-13</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># v1        deprecated   1           2025-09-01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Get schema definition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema get </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created </span><span class="token parameter variable" style="color:#36acaa">--version</span><span class="token plain"> v2 </span><span class="token parameter variable" style="color:#36acaa">--output</span><span class="token plain"> ./schemas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. Check compatibility with current consumer code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema check </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --consumer-schema ./schemas/my_orders_v1.proto </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--mode</span><span class="token plain"> strict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⚠️  Warning: Producer added field </span><span class="token string" style="color:#e3116c">&#x27;tax_amount&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">optional</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ Your consumer code will </span><span class="token builtin class-name">continue</span><span class="token plain"> to work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 4. Generate updated client code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema codegen </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--version</span><span class="token plain"> v2 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--language</span><span class="token plain"> rust </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--output</span><span class="token plain"> ./src/generated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 5. Update consumer code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use prism_sdk::PrismClient</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use generated::orders_created::OrderCreated</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">let</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PrismClient::new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;order-events&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .with_schema_validation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">let</span><span class="token plain"> stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client.subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;orders.created&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .with_schema_assertion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;v2&quot;</span><span class="token plain">, OnMismatch::Warn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">event</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> stream </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">let</span><span class="token plain"> order: OrderCreated </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> event.payload</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // New field available </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">optional</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin class-name">let</span><span class="token plain"> Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> order.tax_amount </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        println</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Tax: ${}&quot;</span><span class="token plain">, tax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process_order</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">order</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.ack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Workflow 3: Platform Team Governance</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Audit all schemas for PII tagging</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema audit --check-pii</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ orders.created.v2: Field </span><span class="token string" style="color:#e3116c">&#x27;email&#x27;</span><span class="token plain"> missing @prism.pii tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ user.profile.updated.v1: Field </span><span class="token string" style="color:#e3116c">&#x27;phone&#x27;</span><span class="token plain"> missing @prism.pii tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ notification.sent.v1: All PII fields tagged</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Enforce compatibility policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema policy </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> orders </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--compatibility</span><span class="token plain"> backward </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --require-pii-tags </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --approval-required-for breaking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Block incompatible schema registration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema register </span><span class="token parameter variable" style="color:#36acaa">--file</span><span class="token plain"> orders.created.v3.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❌ Registration blocked: Breaking changes detected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Removed field </span><span class="token string" style="color:#e3116c">&#x27;currency&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">required</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Added required field </span><span class="token string" style="color:#e3116c">&#x27;payment_method&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ℹ️  Policy requires approval </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> breaking changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Create approval request: prism schema approve-request --schema-file orders.created.v3.proto</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-plan">Implementation Plan<a href="#implementation-plan" class="hash-link" aria-label="Direct link to Implementation Plan" title="Direct link to Implementation Plan" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-1-github-based-registry-weeks-1-3">Phase 1: GitHub-Based Registry (Weeks 1-3)<a href="#phase-1-github-based-registry-weeks-1-3" class="hash-link" aria-label="Direct link to Phase 1: GitHub-Based Registry (Weeks 1-3)" title="Direct link to Phase 1: GitHub-Based Registry (Weeks 1-3)" translate="no">​</a></h3>
<p><strong>Deliverables:</strong></p>
<ul>
<li>✅ Schema URL parsing (github.com/org/repo/path)</li>
<li>✅ GitHub API client (fetch schema files)</li>
<li>✅ Local schema cache (TTL=1h)</li>
<li>✅ Publish-time schema attachment (message headers)</li>
<li>✅ Consumer schema discovery CLI (<code>prism schema list/get</code>)</li>
</ul>
<p><strong>Success Criteria:</strong></p>
<ul>
<li>Producer can reference GitHub schema in config</li>
<li>Consumer can fetch schema from GitHub</li>
<li>Message headers include schema metadata</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-2-schema-validation-weeks-4-6">Phase 2: Schema Validation (Weeks 4-6)<a href="#phase-2-schema-validation-weeks-4-6" class="hash-link" aria-label="Direct link to Phase 2: Schema Validation (Weeks 4-6)" title="Direct link to Phase 2: Schema Validation (Weeks 4-6)" translate="no">​</a></h3>
<p><strong>Deliverables:</strong></p>
<ul>
<li>✅ Protobuf schema parser</li>
<li>✅ Publish-time payload validation</li>
<li>✅ Compatibility checker (backward/forward)</li>
<li>✅ CI/CD integration (<code>prism schema check</code>)</li>
<li>✅ Consumer-side schema assertion</li>
</ul>
<p><strong>Success Criteria:</strong></p>
<ul>
<li>Invalid publish rejected with clear error</li>
<li>CI pipeline catches breaking changes before merge</li>
<li>Consumer can opt into strict schema validation</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-3-prism-schema-registry-weeks-7-10">Phase 3: Prism Schema Registry (Weeks 7-10)<a href="#phase-3-prism-schema-registry-weeks-7-10" class="hash-link" aria-label="Direct link to Phase 3: Prism Schema Registry (Weeks 7-10)" title="Direct link to Phase 3: Prism Schema Registry (Weeks 7-10)" translate="no">​</a></h3>
<p><strong>Deliverables:</strong></p>
<ul>
<li>✅ Schema Registry gRPC service</li>
<li>✅ SQLite storage (local dev), Postgres (prod)</li>
<li>✅ REST API adapter (for non-gRPC clients)</li>
<li>✅ Admin UI (Ember.js) for browsing schemas</li>
<li>✅ Migration from GitHub to registry</li>
</ul>
<p><strong>Success Criteria:</strong></p>
<ul>
<li>Schema registry handles 10k req/sec</li>
<li>&lt;10ms P99 latency for schema fetch</li>
<li>UI shows schema versions, consumers, compatibility</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-4-governance-and-pii-weeks-11-13">Phase 4: Governance and PII (Weeks 11-13)<a href="#phase-4-governance-and-pii-weeks-11-13" class="hash-link" aria-label="Direct link to Phase 4: Governance and PII (Weeks 11-13)" title="Direct link to Phase 4: Governance and PII (Weeks 11-13)" translate="no">​</a></h3>
<p><strong>Deliverables:</strong></p>
<ul>
<li>✅ PII annotation parser (<code>@prism.pii</code>)</li>
<li>✅ PII validation at schema registration</li>
<li>✅ Approval workflows for breaking changes</li>
<li>✅ Audit logs (who registered what, when)</li>
<li>✅ Consumer PII awareness SDK</li>
</ul>
<p><strong>Success Criteria:</strong></p>
<ul>
<li>Schema without PII tags rejected</li>
<li>Breaking changes require approval</li>
<li>Audit trail for compliance</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-5-code-generation-weeks-14-16">Phase 5: Code Generation (Weeks 14-16)<a href="#phase-5-code-generation-weeks-14-16" class="hash-link" aria-label="Direct link to Phase 5: Code Generation (Weeks 14-16)" title="Direct link to Phase 5: Code Generation (Weeks 14-16)" translate="no">​</a></h3>
<p><strong>Deliverables:</strong></p>
<ul>
<li>✅ <code>prism schema codegen</code> CLI</li>
<li>✅ Protobuf → Go structs</li>
<li>✅ Protobuf → Python dataclasses</li>
<li>✅ Protobuf → Rust structs</li>
<li>✅ JSON Schema → TypeScript interfaces</li>
</ul>
<p><strong>Success Criteria:</strong></p>
<ul>
<li>One command generates client code</li>
<li>Generated code includes PII awareness</li>
<li>Works with all supported languages (Go, Python, Rust)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="trade-offs-and-alternatives">Trade-Offs and Alternatives<a href="#trade-offs-and-alternatives" class="hash-link" aria-label="Direct link to Trade-Offs and Alternatives" title="Direct link to Trade-Offs and Alternatives" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="alternative-1-no-schema-registry-status-quo">Alternative 1: No Schema Registry (Status Quo)<a href="#alternative-1-no-schema-registry-status-quo" class="hash-link" aria-label="Direct link to Alternative 1: No Schema Registry (Status Quo)" title="Direct link to Alternative 1: No Schema Registry (Status Quo)" translate="no">​</a></h3>
<p><strong>Pros:</strong></p>
<ul>
<li>✅ Zero infrastructure overhead</li>
<li>✅ No coordination needed</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>❌ Runtime failures from schema mismatches</li>
<li>❌ No PII governance</li>
<li>❌ Manual coordination for schema changes</li>
<li>❌ Testing impossible without mocks</li>
</ul>
<p><strong>Verdict:</strong> Unacceptable for PRD-001 reliability goals</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="alternative-2-confluent-schema-registry-only">Alternative 2: Confluent Schema Registry Only<a href="#alternative-2-confluent-schema-registry-only" class="hash-link" aria-label="Direct link to Alternative 2: Confluent Schema Registry Only" title="Direct link to Alternative 2: Confluent Schema Registry Only" translate="no">​</a></h3>
<p><strong>Pros:</strong></p>
<ul>
<li>✅ Battle-tested at scale</li>
<li>✅ Rich compatibility checks</li>
<li>✅ Kafka ecosystem integration</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>❌ Kafka-specific (doesn&#x27;t work with NATS)</li>
<li>❌ JVM-based (1GB+ memory)</li>
<li>❌ Licensing complexity</li>
<li>❌ Not Git-native</li>
</ul>
<p><strong>Verdict:</strong> Good for Kafka-heavy deployments, but too narrow for Prism&#x27;s multi-backend vision</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="alternative-3-git-only-no-registry-service">Alternative 3: Git-Only (No Registry Service)<a href="#alternative-3-git-only-no-registry-service" class="hash-link" aria-label="Direct link to Alternative 3: Git-Only (No Registry Service)" title="Direct link to Alternative 3: Git-Only (No Registry Service)" translate="no">​</a></h3>
<p><strong>Pros:</strong></p>
<ul>
<li>✅ Familiar Git workflow</li>
<li>✅ Free (GitHub)</li>
<li>✅ Version control built-in</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>❌ GitHub rate limits (5000 req/hour)</li>
<li>❌ High latency (300-500ms)</li>
<li>❌ No runtime governance</li>
<li>❌ Poor observability</li>
</ul>
<p><strong>Verdict:</strong> Good for low-throughput, open-source projects, but insufficient for enterprise</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="proposed-hybrid-approach">Proposed Hybrid Approach<a href="#proposed-hybrid-approach" class="hash-link" aria-label="Direct link to Proposed Hybrid Approach" title="Direct link to Proposed Hybrid Approach" translate="no">​</a></h3>
<p><strong>Use all three tiers based on context:</strong></p>



































<table><thead><tr><th>Scenario</th><th>Recommended Registry</th><th>Rationale</th></tr></thead><tbody><tr><td><strong>Open-source project</strong></td><td>GitHub</td><td>Public schemas, Git workflow</td></tr><tr><td><strong>Internal services (&lt;1k RPS)</strong></td><td>GitHub</td><td>Simple, no infra</td></tr><tr><td><strong>Production (&gt;10k RPS)</strong></td><td>Prism Registry</td><td>Performance, governance</td></tr><tr><td><strong>Kafka-native pipeline</strong></td><td>Confluent Registry</td><td>Ecosystem integration</td></tr><tr><td><strong>Air-gapped network</strong></td><td>Prism Registry</td><td>No external dependencies</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-considerations">Security Considerations<a href="#security-considerations" class="hash-link" aria-label="Direct link to Security Considerations" title="Direct link to Security Considerations" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="schema-tampering">Schema Tampering<a href="#schema-tampering" class="hash-link" aria-label="Direct link to Schema Tampering" title="Direct link to Schema Tampering" translate="no">​</a></h3>
<p><strong>Risk:</strong> Attacker modifies schema to inject malicious fields</p>
<p><strong>Mitigation:</strong></p>
<ul>
<li>Schema hash verification (SHA256)</li>
<li>Immutable schema versions (can&#x27;t edit v2 after publish)</li>
<li>Git commit signatures (for GitHub registry)</li>
<li>Audit logs (who changed what)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pii-leakage">PII Leakage<a href="#pii-leakage" class="hash-link" aria-label="Direct link to PII Leakage" title="Direct link to PII Leakage" translate="no">​</a></h3>
<p><strong>Risk:</strong> Consumer accidentally logs PII field</p>
<p><strong>Mitigation:</strong></p>
<ul>
<li>Mandatory PII tagging at registration</li>
<li>SDK warnings on PII field access</li>
<li>Automatic masking in logs (via SDK)</li>
<li>Compliance scanning of schemas</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="schema-poisoning">Schema Poisoning<a href="#schema-poisoning" class="hash-link" aria-label="Direct link to Schema Poisoning" title="Direct link to Schema Poisoning" translate="no">​</a></h3>
<p><strong>Risk:</strong> Malicious producer registers incompatible schema</p>
<p><strong>Mitigation:</strong></p>
<ul>
<li>Namespace-based authorization (only owner team can register)</li>
<li>Approval workflows for breaking changes</li>
<li>Rollback capability (revert to previous version)</li>
<li>Canary deployments (gradual rollout)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-characteristics">Performance Characteristics<a href="#performance-characteristics" class="hash-link" aria-label="Direct link to Performance Characteristics" title="Direct link to Performance Characteristics" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="per-message-validation-performance-trade-offs">Per-Message Validation Performance Trade-Offs<a href="#per-message-validation-performance-trade-offs" class="hash-link" aria-label="Direct link to Per-Message Validation Performance Trade-Offs" title="Direct link to Per-Message Validation Performance Trade-Offs" translate="no">​</a></h3>
<p><strong>CRITICAL DESIGN DECISION</strong>: Prism does <strong>NOT</strong> validate every message against schema by default (performance reasons).</p>
<p><strong>Validation Timing Options:</strong></p>





























<table><thead><tr><th>Validation Type</th><th>When</th><th>Cost</th><th>Use Case</th></tr></thead><tbody><tr><td><strong>Config-Time</strong></td><td>Namespace registration</td><td>One-time (~100ms)</td><td>Schema exists and is parseable</td></tr><tr><td><strong>Build-Time</strong></td><td>Code generation</td><td>One-time (~1s)</td><td>Type safety in client code</td></tr><tr><td><strong>Publish-Time</strong></td><td>Every message</td><td><strong>+50% latency</strong></td><td>Debugging schema issues</td></tr></tbody></table>
<p><strong>Per-Message Validation Cost Analysis:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Baseline: No validation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Publish latency (P99): 10ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Throughput: 100k msg/s per proxy instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># With per-message validation (protobuf deserialization + validation)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Publish latency (P99): 15ms (+50%)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Throughput: 66k msg/s per proxy instance (-34%)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Cost breakdown per message:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   - Deserialize payload: +3ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   - Validate required fields: +1ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   - Validate field types: +1ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   - Total overhead: +5ms (50% increase)</span><br></span></code></pre></div></div>
<p><strong>Why Per-Message Validation is Expensive:</strong></p>
<ol>
<li>
<p><strong>Binary Passthrough Problem</strong>: Pattern provider plugins (Kafka, NATS, Redis) treat payloads as <strong>opaque binary blobs</strong></p>
<ul>
<li>Plugins forward bytes without knowing structure</li>
<li>Validation requires deserialization → validation → re-serialization</li>
<li>Triple overhead: parse + validate + encode</li>
</ul>
</li>
<li>
<p><strong>Schema Lookup</strong>: Every message needs schema metadata</p>
<ul>
<li>Cache hit: ~0.1ms (fast, but adds up at scale)</li>
<li>Cache miss: ~10ms (fetch from registry)</li>
</ul>
</li>
<li>
<p><strong>Type Checking</strong>: Protobuf validation is non-trivial</p>
<ul>
<li>Check required fields present</li>
<li>Validate field types match schema</li>
<li>Check enum values are valid</li>
<li>Validate repeated field constraints</li>
</ul>
</li>
</ol>
<p><strong>Recommended Approach: Build-Time + Config-Time Validation</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Recommended configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">registry_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//schema</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">registry.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ✅ Validate schema exists when namespace configured</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">build_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># ✅ Generate typed client code (compile-time safety)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">publish_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ❌ NO per-message validation (performance)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Optional: Enable for debugging only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># publish_time: true  # ⚠️  WARNING: +50% latency, -34% throughput</span><br></span></code></pre></div></div>
<p><strong>When to Enable Per-Message Validation:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Scenario 1: Development/staging environment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use case: Catch schema bugs before production</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">publish_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">on_validation_failure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> reject  </span><span class="token comment" style="color:#999988;font-style:italic"># Block invalid messages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Scenario 2: Production debugging</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use case: Investigate why consumers are failing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">publish_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">on_validation_failure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> warn  </span><span class="token comment" style="color:#999988;font-style:italic"># Log errors but allow publish</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sample_rate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Only validate 1% of messages (reduce overhead)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Scenario 3: Critical compliance topic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use case: Must guarantee schema compliance for audit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">publish_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">on_validation_failure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> reject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Accept performance trade-off for compliance</span><br></span></code></pre></div></div>
<p><strong>Pattern Providers: Schema-Agnostic Binary Passthrough</strong></p>
<p><strong>IMPORTANT ARCHITECTURAL PRINCIPLE</strong>: Backend pattern provider plugins (Kafka, NATS, Redis, PostgreSQL) are <strong>schema-agnostic</strong>.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Backend plugin interface - no schema knowledge</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Producer </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Publish accepts opaque binary payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Plugin does NOT know if payload is protobuf, JSON, Avro, etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> topic </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Consumer </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Subscribe delivers opaque binary payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Plugin does NOT deserialize or validate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> topic </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> Message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Message </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Topic    </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Payload  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Opaque bytes (could be protobuf, JSON, avro, etc.)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Headers  </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Offset   </span><span class="token builtin">int64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Why Schema-Agnostic Design:</strong></p>
<ol>
<li>✅ <strong>Performance</strong>: Zero deserialization overhead in hot path</li>
<li>✅ <strong>Flexibility</strong>: Same plugin works with protobuf, JSON Schema, Avro, custom formats</li>
<li>✅ <strong>Simplicity</strong>: Plugin logic focuses on backend-specific concerns (connection, retries, etc.)</li>
<li>✅ <strong>Composability</strong>: Schema validation is orthogonal concern (handled by proxy)</li>
</ol>
<p><strong>Schema Validation Responsibility Split:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Prism Proxy (Schema Aware)                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Fetches schema from registry                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Optionally validates payload at publish time         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Attaches schema metadata to message headers          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────┬───────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          │ Binary payload + headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Pattern Provider Plugin (Schema Agnostic)              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Treats payload as opaque []byte                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Forwards to backend (NATS, Kafka, etc.)              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - No knowledge of protobuf/JSON/Avro                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────┬───────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          │ Binary payload + headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Backend (NATS/Kafka/Redis)                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - Stores bytes as-is                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  - No deserialization                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────┘</span><br></span></code></pre></div></div>
<p><strong>Schema-Specific Consumers/Producers (Optional)</strong></p>
<p><strong>While pattern providers are schema-agnostic, applications can build schema-specific consumers for type safety:</strong></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Generic schema-agnostic consumer (default)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GenericConsumer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prismClient </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Client</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> topic </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stream</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> prismClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> msg </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">range</span><span class="token plain"> stream </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        payload </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Payload</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// []byte - opaque binary</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Application deserializes based on schema metadata in headers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        schemaURL </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Header</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;X-Prism-Schema-URL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        schema </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetchSchema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">schemaURL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">deserialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> schema</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Schema-specific consumer (type-safe, generated code)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">OrderCreatedConsumer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prismClient </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Client</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stream</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> prismClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SubscribeTyped</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">OrderCreated</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;orders.created&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> msg </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">range</span><span class="token plain"> stream </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Payload</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// *OrderCreated - strongly typed!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// No manual deserialization needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Order ID: %s, Total: %.2f\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OrderId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Total</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Generated typed client (code gen from schema)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> TypedClient </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    schema </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">prism</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">TypedClient</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> SubscribeTyped</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T proto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Message</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> TypedMessage</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rawStream</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    typedStream </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> TypedMessage</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> msg </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">range</span><span class="token plain"> rawStream </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Deserialize using schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> payload T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            proto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Unmarshal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Payload</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Optional: Validate against schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Validate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Skip invalid messages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            typedStream </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> TypedMessage</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">Payload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Metadata</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> typedStream</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Code Generation for Schema-Specific Clients:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Generate typed client from schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema codegen </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--topic</span><span class="token plain"> orders.created </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--version</span><span class="token plain"> v2 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--language</span><span class="token plain"> go </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--output</span><span class="token plain"> ./generated/orders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generated code provides:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># - Strongly typed OrderCreated struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># - Type-safe Subscribe[OrderCreated]() method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># - Automatic deserialization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># - Optional validation</span><br></span></code></pre></div></div>
<p><strong>Trade-Offs: Generic vs Schema-Specific Consumers:</strong></p>

































<table><thead><tr><th>Approach</th><th>Type Safety</th><th>Performance</th><th>Flexibility</th><th>Complexity</th></tr></thead><tbody><tr><td><strong>Generic (schema-agnostic)</strong></td><td>❌ Runtime errors</td><td>✅ Fast (no validation)</td><td>✅ Works with any schema</td><td>✅ Simple</td></tr><tr><td><strong>Schema-Specific (typed)</strong></td><td>✅ Compile-time safety</td><td>⚠️ Slower (validation)</td><td>❌ One consumer per schema</td><td>⚠️ Code gen required</td></tr><tr><td><strong>Hybrid (typed + optional validation)</strong></td><td>✅ Compile-time safety</td><td>✅ Fast (validation disabled)</td><td>⚠️ Moderate</td><td>⚠️ Code gen + config</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="schema-registry-benchmarks">Schema Registry Benchmarks<a href="#schema-registry-benchmarks" class="hash-link" aria-label="Direct link to Schema Registry Benchmarks" title="Direct link to Schema Registry Benchmarks" translate="no">​</a></h3>









































<table><thead><tr><th>Operation</th><th>Latency (P99)</th><th>Throughput</th><th>Caching</th></tr></thead><tbody><tr><td><strong>GitHub fetch</strong></td><td>500ms</td><td>5k req/hour</td><td>TTL=1h</td></tr><tr><td><strong>Registry fetch</strong></td><td>10ms</td><td>100k RPS</td><td>Aggressive</td></tr><tr><td><strong>Compatibility check</strong></td><td>50ms</td><td>10k RPS</td><td>N/A</td></tr><tr><td><strong>Config-time validation</strong></td><td>100ms</td><td>N/A (one-time)</td><td>N/A</td></tr><tr><td><strong>Per-message validation</strong></td><td>5ms</td><td>50k RPS</td><td>In-memory</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="publish-overhead">Publish Overhead<a href="#publish-overhead" class="hash-link" aria-label="Direct link to Publish Overhead" title="Direct link to Publish Overhead" translate="no">​</a></h3>
<p><strong>Without schema validation:</strong> 10ms P99
<strong>With per-message validation:</strong> 15ms P99 (+50% overhead)</p>
<p><strong>Rationale:</strong> Per-message validation is expensive, use config-time + build-time validation instead</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="observability">Observability<a href="#observability" class="hash-link" aria-label="Direct link to Observability" title="Direct link to Observability" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metrics">Metrics<a href="#metrics" class="hash-link" aria-label="Direct link to Metrics" title="Direct link to Metrics" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Schema registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_schema_registry_requests_total{operation=&quot;get_schema&quot;, status=&quot;success&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_schema_registry_cache_hit_rate{namespace=&quot;orders&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_schema_registry_validation_failures{topic=&quot;orders.created&quot;, reason=&quot;missing_field&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Publisher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_publish_schema_validation_duration_seconds{topic=&quot;orders.created&quot;, result=&quot;valid&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_publish_schema_mismatch_total{topic=&quot;orders.created&quot;, error_type=&quot;missing_field&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_subscribe_schema_assertion_failures{topic=&quot;orders.created&quot;, expected_version=&quot;v2&quot;, actual_version=&quot;v1&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism_consumer_schema_incompatible_messages{topic=&quot;orders.created&quot;, action=&quot;dropped&quot;}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="logs">Logs<a href="#logs" class="hash-link" aria-label="Direct link to Logs" title="Direct link to Logs" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;event&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;schema_validation_failed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;topic&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;orders.created&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;schema_version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;error&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Field &#x27;email&#x27; missing (required)&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;publisher_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;order-service-pod-123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;timestamp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-10-13T10:30:00Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="traces">Traces<a href="#traces" class="hash-link" aria-label="Direct link to Traces" title="Direct link to Traces" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Span: PublishWithSchemaValidation [15ms]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ Span: FetchSchema (cached) [2ms]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ Span: ValidatePayload [8ms]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├─ Check required fields [2ms]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├─ Check PII tags [1ms]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └─ Type validation [5ms]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─ Span: PublishToBackend [5ms]</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-strategy">Testing Strategy<a href="#testing-strategy" class="hash-link" aria-label="Direct link to Testing Strategy" title="Direct link to Testing Strategy" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="unit-tests">Unit Tests<a href="#unit-tests" class="hash-link" aria-label="Direct link to Unit Tests" title="Direct link to Unit Tests" translate="no">​</a></h3>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TestSchemaCompatibilityBackward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">testing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v1 </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loadSchema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;orders.created.v1.proto&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v2 </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loadSchema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;orders.created.v2.proto&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    checker </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewCompatibilityChecker</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CompatibilityBackward</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> checker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Check</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">True</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IsCompatible</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Warnings</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Added optional field &#x27;tax_amount&#x27;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TestSchemaValidationFailure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">testing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    schema </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loadSchema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;orders.created.v2.proto&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;order_id&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;order-123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;user_id&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user-456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Missing required field &#x27;total&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    validator </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewSchemaValidator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">schema</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> validator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Validate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Field &#x27;total&#x27; missing&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="integration-tests">Integration Tests<a href="#integration-tests" class="hash-link" aria-label="Direct link to Integration Tests" title="Direct link to Integration Tests" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">test_publish_with_schema_validation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prism_client</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> schema_registry</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Register schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    schema_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> schema_registry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        topic</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;test.events&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        version</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        schema</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">load_proto</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;test_events.v1.proto&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Publish valid message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prism_client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        topic</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;test.events&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        payload</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;event_id&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;evt-123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        schema_version</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;v1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Publish invalid message (should fail)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> pytest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">raises</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SchemaValidationError</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        prism_client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            topic</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;test.events&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            payload</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;event_id&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;evt-456&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Missing &#x27;data&#x27; field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            schema_version</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;v1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="end-to-end-tests">End-to-End Tests<a href="#end-to-end-tests" class="hash-link" aria-label="Direct link to End-to-End Tests" title="Direct link to End-to-End Tests" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Test full workflow: register → publish → consume → validate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> test-e2e-schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Steps:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1. Start Prism proxy + schema registry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Register schema via CLI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. Producer publishes with schema reference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 4. Consumer subscribes with schema assertion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 5. Verify consumer receives typed payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 6. Verify incompatible message rejected</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-path">Migration Path<a href="#migration-path" class="hash-link" aria-label="Direct link to Migration Path" title="Direct link to Migration Path" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-0-no-schemas-current-state">Phase 0: No Schemas (Current State)<a href="#phase-0-no-schemas-current-state" class="hash-link" aria-label="Direct link to Phase 0: No Schemas (Current State)" title="Direct link to Phase 0: No Schemas (Current State)" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Producers publish arbitrary payloads</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.publish(topic=&quot;orders.created&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token key atrule" style="color:#00a4db">&quot;order_id&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-1-optional-schema-references-soft-launch">Phase 1: Optional Schema References (Soft Launch)<a href="#phase-1-optional-schema-references-soft-launch" class="hash-link" aria-label="Direct link to Phase 1: Optional Schema References (Soft Launch)" title="Direct link to Phase 1: Optional Schema References (Soft Launch)" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Producers optionally declare schema URL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> orders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.com/</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">/orders.created.v1.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> warn  </span><span class="token comment" style="color:#999988;font-style:italic"># Log warnings, don&#x27;t fail</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-2-mandatory-schemas-for-new-topics">Phase 2: Mandatory Schemas for New Topics<a href="#phase-2-mandatory-schemas-for-new-topics" class="hash-link" aria-label="Direct link to Phase 2: Mandatory Schemas for New Topics" title="Direct link to Phase 2: Mandatory Schemas for New Topics" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># New topics require schema declaration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">namespaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> new</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.com/</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">/new_events.v1.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">validation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> strict  </span><span class="token comment" style="color:#999988;font-style:italic"># Fail on mismatch</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phase-3-governance-enforcement">Phase 3: Governance Enforcement<a href="#phase-3-governance-enforcement" class="hash-link" aria-label="Direct link to Phase 3: Governance Enforcement" title="Direct link to Phase 3: Governance Enforcement" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># All topics require schema + PII tags</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism schema policy set </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">require</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pii</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">tags </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">global</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="success-criteria">Success Criteria<a href="#success-criteria" class="hash-link" aria-label="Direct link to Success Criteria" title="Direct link to Success Criteria" translate="no">​</a></h2>
<ol>
<li><strong>Schema Discovery</strong>: Consumer finds producer schema in &lt;10 seconds</li>
<li><strong>Breaking Change Detection</strong>: CI catches incompatible schema in &lt;30 seconds</li>
<li><strong>Publish Overhead</strong>: &lt;15ms P99 with validation enabled</li>
<li><strong>Developer Adoption</strong>: 80% of new topics use schemas within 6 months</li>
<li><strong>PII Compliance</strong>: 100% of schemas with PII have tags within 12 months</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="open-questions">Open Questions<a href="#open-questions" class="hash-link" aria-label="Direct link to Open Questions" title="Direct link to Open Questions" translate="no">​</a></h2>
<ol>
<li><strong>Schema Versioning</strong>: Semantic versioning (1.0.0) or simple (v1, v2)?</li>
<li><strong>Schema Deletion</strong>: Allow deletion of old versions with active consumers?</li>
<li><strong>Cross-Namespace Schemas</strong>: Can schemas be shared across namespaces?</li>
<li><strong>Schema Testing</strong>: How to test schema changes before production?</li>
<li><strong>Schema Ownership</strong>: Team-based or individual ownership model?</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References" translate="no">​</a></h2>
<ul>
<li><strong>PRD-001</strong>: Prism Data Access Gateway (core product goals)</li>
<li><strong>RFC-002</strong>: Data Layer Interface Specification (PubSub service)</li>
<li><strong>RFC-014</strong>: Layered Data Access Patterns (pub/sub patterns)</li>
<li><strong>ADR-003</strong>: Protobuf Single Source of Truth (protobuf strategy)</li>
<li><a href="https://docs.confluent.io/platform/current/schema-registry/index.html" target="_blank" rel="noopener noreferrer">Confluent Schema Registry</a></li>
<li><a href="https://cloud.google.com/pubsub/docs/schemas" target="_blank" rel="noopener noreferrer">Google Pub/Sub Schema Validation</a></li>
<li><a href="https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-schema.html" target="_blank" rel="noopener noreferrer">AWS EventBridge Schema Registry</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="revision-history">Revision History<a href="#revision-history" class="hash-link" aria-label="Direct link to Revision History" title="Direct link to Revision History" translate="no">​</a></h2>
<ul>
<li>
<p>2025-10-13 (v3): Governance, performance, and feasibility enhancements based on user feedback:</p>
<ul>
<li><strong>Removed inline schema option</strong>: Config now uses URL references only (no inline protobuf content)</li>
<li><strong>Fixed Mermaid diagrams</strong>: Changed from <code>text to </code>mermaid for proper rendering</li>
<li><strong>Backend schema propagation</strong>: Added SchemaAwareBackend interface for pushing schemas to Kafka/NATS</li>
<li><strong>Schema trust verification</strong>: Added schema_name, sha256_hash, allowed_sources for URL-based schemas</li>
<li><strong>HTTPS schema registry support</strong>: Any HTTPS endpoint can serve schemas (not just GitHub)</li>
<li><strong>Build vs Buy analysis</strong>: Comprehensive feasibility study for custom Prism Schema Registry</li>
<li><strong>Governance tags (MAJOR)</strong>: Schema-level and consumer-level tags for distributed teams:
<ul>
<li>Schema tags: sensitivity, compliance, retention_days, owner_team, consumer_approval, audit_log</li>
<li>Consumer tags: team, purpose, data_usage, pii_access, compliance_frameworks, allowed_fields</li>
<li>Field-level access control: Prism proxy auto-filters fields based on allowed_fields</li>
<li>Deprecation warnings: @prism.deprecated tag with date and reason</li>
<li>Audit logging: Automatic compliance reporting for GDPR/HIPAA/SOC2</li>
</ul>
</li>
<li><strong>Optional field enforcement</strong>: Prism can enforce that all fields are optional for backward compatibility</li>
<li><strong>Per-message validation trade-offs</strong>: Detailed performance analysis (+50% latency, -34% throughput)</li>
<li><strong>Pattern providers schema-agnostic</strong>: Clarified that plugins treat payloads as opaque binary blobs</li>
<li><strong>Schema-specific consumers</strong>: Added examples of typed consumers with code generation</li>
</ul>
</li>
<li>
<p>2025-10-13 (v2): Major architectural revisions based on feedback:</p>
<ul>
<li><strong>Schema declaration moved to namespace config</strong> (not per-publish) for performance</li>
<li><strong>Validation timing clarified</strong>: Build-time (code gen) + config-time (validation), NOT runtime per-message</li>
<li><strong>Comparison with Kafka ecosystem registries</strong>: Confluent, AWS Glue, Apicurio feature matrix</li>
<li><strong>Internet-scale scenarios added</strong>: Open-source data exchange, multi-tenant SaaS, public webhooks, federated event bus</li>
<li><strong>Key principle</strong>: Zero per-message overhead via config-time schema resolution</li>
</ul>
</li>
<li>
<p>2025-10-13 (v1): Initial draft exploring schema evolution and validation for decoupled pub/sub</p>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/schema">schema</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/pubsub">pubsub</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/validation">validation</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/evolution">evolution</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/governance">governance</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/developer-experience">developer-experience</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/prism-data-layer/rfc/tags/internet-scale">internet-scale</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/jrepp/prism-data-layer/tree/main/docs-cms/../docs-cms/rfcs/RFC-030-schema-evolution-pubsub-validation.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/prism-data-layer/rfc/rfc-029"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Load Testing Framework Evaluation and Strategy • RFC-029</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/prism-data-layer/rfc/rfc-031"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Message Envelope Protocol for Pub/Sub Systems • RFC-031</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#abstract" class="table-of-contents__link toc-highlight">Abstract</a></li><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a><ul><li><a href="#the-decoupling-problem" class="table-of-contents__link toc-highlight">The Decoupling Problem</a></li><li><a href="#why-this-matters-for-prd-001-goals" class="table-of-contents__link toc-highlight">Why This Matters for PRD-001 Goals</a></li><li><a href="#real-world-scenarios" class="table-of-contents__link toc-highlight">Real-World Scenarios</a></li></ul></li><li><a href="#goals" class="table-of-contents__link toc-highlight">Goals</a></li><li><a href="#non-goals" class="table-of-contents__link toc-highlight">Non-Goals</a></li><li><a href="#proposed-solution-layered-schema-registry" class="table-of-contents__link toc-highlight">Proposed Solution: Layered Schema Registry</a><ul><li><a href="#architecture-overview" class="table-of-contents__link toc-highlight">Architecture Overview</a></li><li><a href="#three-tier-schema-storage" class="table-of-contents__link toc-highlight">Three-Tier Schema Storage</a></li><li><a href="#comparison-with-kafka-ecosystem-registries" class="table-of-contents__link toc-highlight">Comparison with Kafka Ecosystem Registries</a></li><li><a href="#build-vs-buy-custom-prism-schema-registry-feasibility-analysis" class="table-of-contents__link toc-highlight">Build vs Buy: Custom Prism Schema Registry Feasibility Analysis</a></li><li><a href="#internet-scale-decoupled-usage-scenarios" class="table-of-contents__link toc-highlight">Internet-Scale Decoupled Usage Scenarios</a></li><li><a href="#schema-declaration-in-namespace-config" class="table-of-contents__link toc-highlight">Schema Declaration in Namespace Config</a></li><li><a href="#schema-attachment-at-publish-time" class="table-of-contents__link toc-highlight">Schema Attachment at Publish Time</a></li><li><a href="#consumer-schema-discovery-and-validation" class="table-of-contents__link toc-highlight">Consumer Schema Discovery and Validation</a></li><li><a href="#backend-schema-propagation" class="table-of-contents__link toc-highlight">Backend Schema Propagation</a></li><li><a href="#optional-field-enforcement-for-producers" class="table-of-contents__link toc-highlight">Optional Field Enforcement for Producers</a></li><li><a href="#backwardforward-compatibility-modes" class="table-of-contents__link toc-highlight">Backward/Forward Compatibility Modes</a></li><li><a href="#governance-schema-and-consumer-tags-for-distributed-teams" class="table-of-contents__link toc-highlight">Governance: Schema and Consumer Tags for Distributed Teams</a></li><li><a href="#schema-evolution-workflow" class="table-of-contents__link toc-highlight">Schema Evolution Workflow</a></li><li><a href="#schema-registry-api-specification" class="table-of-contents__link toc-highlight">Schema Registry API Specification</a></li><li><a href="#developer-workflows" class="table-of-contents__link toc-highlight">Developer Workflows</a></li></ul></li><li><a href="#implementation-plan" class="table-of-contents__link toc-highlight">Implementation Plan</a><ul><li><a href="#phase-1-github-based-registry-weeks-1-3" class="table-of-contents__link toc-highlight">Phase 1: GitHub-Based Registry (Weeks 1-3)</a></li><li><a href="#phase-2-schema-validation-weeks-4-6" class="table-of-contents__link toc-highlight">Phase 2: Schema Validation (Weeks 4-6)</a></li><li><a href="#phase-3-prism-schema-registry-weeks-7-10" class="table-of-contents__link toc-highlight">Phase 3: Prism Schema Registry (Weeks 7-10)</a></li><li><a href="#phase-4-governance-and-pii-weeks-11-13" class="table-of-contents__link toc-highlight">Phase 4: Governance and PII (Weeks 11-13)</a></li><li><a href="#phase-5-code-generation-weeks-14-16" class="table-of-contents__link toc-highlight">Phase 5: Code Generation (Weeks 14-16)</a></li></ul></li><li><a href="#trade-offs-and-alternatives" class="table-of-contents__link toc-highlight">Trade-Offs and Alternatives</a><ul><li><a href="#alternative-1-no-schema-registry-status-quo" class="table-of-contents__link toc-highlight">Alternative 1: No Schema Registry (Status Quo)</a></li><li><a href="#alternative-2-confluent-schema-registry-only" class="table-of-contents__link toc-highlight">Alternative 2: Confluent Schema Registry Only</a></li><li><a href="#alternative-3-git-only-no-registry-service" class="table-of-contents__link toc-highlight">Alternative 3: Git-Only (No Registry Service)</a></li><li><a href="#proposed-hybrid-approach" class="table-of-contents__link toc-highlight">Proposed Hybrid Approach</a></li></ul></li><li><a href="#security-considerations" class="table-of-contents__link toc-highlight">Security Considerations</a><ul><li><a href="#schema-tampering" class="table-of-contents__link toc-highlight">Schema Tampering</a></li><li><a href="#pii-leakage" class="table-of-contents__link toc-highlight">PII Leakage</a></li><li><a href="#schema-poisoning" class="table-of-contents__link toc-highlight">Schema Poisoning</a></li></ul></li><li><a href="#performance-characteristics" class="table-of-contents__link toc-highlight">Performance Characteristics</a><ul><li><a href="#per-message-validation-performance-trade-offs" class="table-of-contents__link toc-highlight">Per-Message Validation Performance Trade-Offs</a></li><li><a href="#schema-registry-benchmarks" class="table-of-contents__link toc-highlight">Schema Registry Benchmarks</a></li><li><a href="#publish-overhead" class="table-of-contents__link toc-highlight">Publish Overhead</a></li></ul></li><li><a href="#observability" class="table-of-contents__link toc-highlight">Observability</a><ul><li><a href="#metrics" class="table-of-contents__link toc-highlight">Metrics</a></li><li><a href="#logs" class="table-of-contents__link toc-highlight">Logs</a></li><li><a href="#traces" class="table-of-contents__link toc-highlight">Traces</a></li></ul></li><li><a href="#testing-strategy" class="table-of-contents__link toc-highlight">Testing Strategy</a><ul><li><a href="#unit-tests" class="table-of-contents__link toc-highlight">Unit Tests</a></li><li><a href="#integration-tests" class="table-of-contents__link toc-highlight">Integration Tests</a></li><li><a href="#end-to-end-tests" class="table-of-contents__link toc-highlight">End-to-End Tests</a></li></ul></li><li><a href="#migration-path" class="table-of-contents__link toc-highlight">Migration Path</a><ul><li><a href="#phase-0-no-schemas-current-state" class="table-of-contents__link toc-highlight">Phase 0: No Schemas (Current State)</a></li><li><a href="#phase-1-optional-schema-references-soft-launch" class="table-of-contents__link toc-highlight">Phase 1: Optional Schema References (Soft Launch)</a></li><li><a href="#phase-2-mandatory-schemas-for-new-topics" class="table-of-contents__link toc-highlight">Phase 2: Mandatory Schemas for New Topics</a></li><li><a href="#phase-3-governance-enforcement" class="table-of-contents__link toc-highlight">Phase 3: Governance Enforcement</a></li></ul></li><li><a href="#success-criteria" class="table-of-contents__link toc-highlight">Success Criteria</a></li><li><a href="#open-questions" class="table-of-contents__link toc-highlight">Open Questions</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li><li><a href="#revision-history" class="table-of-contents__link toc-highlight">Revision History</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/intro">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/changelog">Change Log</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/adr">ADRs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/rfc">RFCs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/memos">Memos</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/prds">PRDs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Project</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div>Copyright © 2025 Prism. Built with Docusaurus.</div><div style="margin-top:0.5rem;font-size:0.875rem;opacity:0.8"><span>Version <!-- -->47bd04a</span><span> • </span><span>Built <!-- -->Oct 15, 2025, 09:36 AM PDT</span><span> • </span><span>Commit <!-- -->47bd04a</span></div></div></div></div></footer></div>
</body>
</html>