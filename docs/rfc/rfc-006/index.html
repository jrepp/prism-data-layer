<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-rfc docs-version-current docs-doc-page docs-doc-id-rfc-006" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Admin CLI (prismctl) | Prism</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jrepp.github.io/prism-data-layer/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jrepp.github.io/prism-data-layer/rfc/rfc-006"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-rfc-current"><meta data-rh="true" property="og:title" content="Admin CLI (prismctl) | Prism"><meta data-rh="true" name="description" content="Author: System"><meta data-rh="true" property="og:description" content="Author: System"><link data-rh="true" rel="icon" href="/prism-data-layer/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-006"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-006" hreflang="en"><link data-rh="true" rel="alternate" href="https://jrepp.github.io/prism-data-layer/rfc/rfc-006" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"RFC-006 Admin CLI","item":"https://jrepp.github.io/prism-data-layer/rfc/rfc-006"}]}</script><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes">
<meta name="theme-color" content="#6366f1">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="stylesheet" href="/prism-data-layer/assets/css/styles.73adf43b.css">
<script src="/prism-data-layer/assets/js/runtime~main.852a958a.js" defer="defer"></script>
<script src="/prism-data-layer/assets/js/main.f2490dd2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/prism-data-layer/"><div class="navbar__logo"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/prism-data-layer/img/prism-logo-transparent-background.png" alt="Prism Data Gateway Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">Prism</b></a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/intro">Overview</a><a class="navbar__item navbar__link" href="/prism-data-layer/docs/changelog">Change Log</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Documentation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/prism-data-layer/adr">ADRs (Architecture Decision Records)</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/prism-data-layer/rfc">RFCs (Request for Comments)</a></li><li><a class="dropdown__link" href="/prism-data-layer/memos">Memos (Technical Analysis)</a></li><li><a class="dropdown__link" href="/prism-data-layer/prds">PRDs (Product Requirements)</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="buildInfo_asc2"><span class="version_ADrX" title="Build: d6f49d2">d6f49d2</span><span class="separator_VfCt">•</span><span class="buildTime_n1Nn" title="Last updated: Oct 13, 5:33 PM PDT">Oct 13, 5:33 PM PDT</span></div><div class="navbar__item"><a href="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml" target="_blank" rel="noopener noreferrer" title="GitHub Pages" style="display: flex; align-items: center; padding: 0 0.5rem;"><img src="https://github.com/jrepp/prism-data-layer/actions/workflows/docs.yml/badge.svg" alt="Build" style="margin: 0;"></a></div><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_x44X"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/prism-data-layer/rfc/"><span title="Request for Comments (RFCs)" class="linkLabel_WmDU">Request for Comments (RFCs)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/prism-data-layer/rfc/rfc-001"><span title="RFC-001 to 010" class="categoryLinkLabel_W154">RFC-001 to 010</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-001"><span title="Prism Data Access Layer Architecture • RFC-001" class="linkLabel_WmDU">Prism Data Access Layer Architecture • RFC-001</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-002"><span title="Data Layer Interface Specification • RFC-002" class="linkLabel_WmDU">Data Layer Interface Specification • RFC-002</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-003"><span title="Admin Interface for Prism • RFC-003" class="linkLabel_WmDU">Admin Interface for Prism • RFC-003</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-004"><span title="Redis Integration for Cache, PubSub, and Vector Search • RFC-004" class="linkLabel_WmDU">Redis Integration for Cache, PubSub, and Vector Search • RFC-004</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-005"><span title="ClickHouse Integration for Time Series Analytics • RFC-005" class="linkLabel_WmDU">ClickHouse Integration for Time Series Analytics • RFC-005</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/prism-data-layer/rfc/rfc-006"><span title="RFC-006 Admin CLI" class="linkLabel_WmDU">RFC-006 Admin CLI</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-007"><span title="RFC-007 Cache Strategies" class="linkLabel_WmDU">RFC-007 Cache Strategies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-008"><span title="RFC-008 Plugin Architecture" class="linkLabel_WmDU">RFC-008 Plugin Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-009"><span title="Distributed Reliability Data Patterns • RFC-009" class="linkLabel_WmDU">Distributed Reliability Data Patterns • RFC-009</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/prism-data-layer/rfc/rfc-010"><span title="Admin Protocol with OIDC Authentication • RFC-010" class="linkLabel_WmDU">Admin Protocol with OIDC Authentication • RFC-010</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-011"><span title="RFC-011 to 020" class="categoryLinkLabel_W154">RFC-011 to 020</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-021"><span title="RFC-021 to 030" class="categoryLinkLabel_W154">RFC-021 to 030</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/prism-data-layer/rfc/rfc-031"><span title="RFC-031 to 040" class="categoryLinkLabel_W154">RFC-031 to 040</span></a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/prism-data-layer/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">RFC-001 to 010</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">RFC-006 Admin CLI</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="docMetadata_NQcq"><div class="metadataRow_PvZM"><span class="metadataItem_RMFE warning_zlrf"><strong>Status:</strong> <!-- -->Superseded</span><span class="metadataItem_RMFE"><strong>Author:</strong> <!-- -->System</span><span class="metadataItem_RMFE"><strong>Created:</strong> <!-- -->Oct 7, 2025</span></div></div><div class="theme-doc-markdown markdown"><header><h1>RFC-006: Admin CLI (prismctl)</h1></header>
<p><strong>Author</strong>: System
<strong>Created</strong>: 2025-10-08
<strong>Updated</strong>: 2025-10-09
<strong>Superseded By</strong>: ADR-040 (Go Binary for Admin CLI)</p>
<blockquote>
<p><strong>Note</strong>: This RFC originally proposed a Python-based CLI. The implementation has shifted to <strong>Go</strong> for better performance, single-binary distribution, and consistency with backend plugins. See <a href="/prism-data-layer/adr/adr-040">ADR-040: Go Binary for Admin CLI</a> for the accepted implementation approach. The functional specifications below remain valid regardless of implementation language.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a href="#abstract" class="hash-link" aria-label="Direct link to Abstract" title="Direct link to Abstract" translate="no">​</a></h2>
<p>This RFC proposes a comprehensive command-line interface (CLI) for administering Prism data access gateway, now implemented as <strong>prismctl</strong> (a Go binary). The CLI provides operational visibility, configuration management, and troubleshooting capabilities before building a full web-based admin UI. By delivering CLI-first tooling, we enable automation, scripting, and CI/CD integration while validating the admin API design.</p>
<p>The CLI will interact with Prism&#x27;s admin gRPC services (RFC-003) to manage namespaces, monitor sessions, inspect backend health, and configure data access patterns across all supported backends (Kafka, NATS, PostgreSQL, Redis, ClickHouse).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-cli-first">Why CLI First?<a href="#why-cli-first" class="hash-link" aria-label="Direct link to Why CLI First?" title="Direct link to Why CLI First?" translate="no">​</a></h3>
<ol>
<li><strong>Faster Time to Value</strong>: CLI tools can be developed and iterated faster than full UIs</li>
<li><strong>Automation Ready</strong>: Enable scripting and CI/CD integration from day one</li>
<li><strong>API Validation</strong>: Using the CLI validates admin API design before UI investment</li>
<li><strong>DevOps Friendly</strong>: Operators prefer CLI tools for troubleshooting and automation</li>
<li><strong>Low Barrier</strong>: Python + Click/Typer = rapid development with excellent UX</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="real-world-use-cases">Real-World Use Cases<a href="#real-world-use-cases" class="hash-link" aria-label="Direct link to Real-World Use Cases" title="Direct link to Real-World Use Cases" translate="no">​</a></h3>
<ul>
<li><strong>Namespace Management</strong>: Create, configure, and delete namespaces</li>
<li><strong>Health Monitoring</strong>: Check backend connectivity and performance metrics</li>
<li><strong>Session Inspection</strong>: Debug active client sessions and connection pools</li>
<li><strong>Configuration Changes</strong>: Update backend settings, capacity limits, consistency levels</li>
<li><strong>Traffic Analysis</strong>: Inspect request rates, latency distributions, error rates</li>
<li><strong>Migration Support</strong>: Shadow traffic configuration, backend switching, rollback</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="goals">Goals<a href="#goals" class="hash-link" aria-label="Direct link to Goals" title="Direct link to Goals" translate="no">​</a></h2>
<ul>
<li>Provide complete admin functionality via CLI before building web UI</li>
<li>Support all operations defined in RFC-003 Admin gRPC API</li>
<li>Enable automation and scripting for operational workflows</li>
<li>Deliver excellent developer experience with rich formatting and feedback</li>
<li>Support YAML-first configuration with automatic config file discovery</li>
<li>Integrate with existing Python tooling ecosystem (uv, pytest)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="non-goals">Non-Goals<a href="#non-goals" class="hash-link" aria-label="Direct link to Non-Goals" title="Direct link to Non-Goals" translate="no">​</a></h2>
<ul>
<li><strong>Not replacing web UI</strong>: CLI is a stepping stone and complementary tool</li>
<li><strong>Not a data client</strong>: Use language-specific client SDKs for data access</li>
<li><strong>Not a full TUI</strong>: Keep it simple; use Rich for formatting, not full-screen apps</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-design">High-Level Design<a href="#high-level-design" class="hash-link" aria-label="Direct link to High-Level Design" title="Direct link to High-Level Design" translate="no">​</a></h3>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="authentication">Authentication<a href="#authentication" class="hash-link" aria-label="Direct link to Authentication" title="Direct link to Authentication" translate="no">​</a></h2>
<p>The Admin CLI requires authentication to access the Prism Admin API. We use <strong>OIDC (OpenID Connect)</strong> with the <strong>device code flow</strong> for command-line SSO authentication.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="device-code-flow-oauth-20">Device Code Flow (OAuth 2.0)<a href="#device-code-flow-oauth-20" class="hash-link" aria-label="Direct link to Device Code Flow (OAuth 2.0)" title="Direct link to Device Code Flow (OAuth 2.0)" translate="no">​</a></h3>
<p>The device code flow is designed for CLI applications and devices without browsers. The user authenticates via a web browser while the CLI polls for completion.</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="login-command">Login Command<a href="#login-command" class="hash-link" aria-label="Direct link to Login Command" title="Direct link to Login Command" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Interactive login (device code flow)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Or specify OIDC issuer explicitly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl login </span><span class="token parameter variable" style="color:#36acaa">--issuer</span><span class="token plain"> https://idp.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Local development with Dex (see ADR-046)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl login </span><span class="token parameter variable" style="color:#36acaa">--local</span><br></span></code></pre></div></div>
<p><strong>Output</strong>:
Opening browser for authentication...</p>
<p>Visit: <a href="https://idp.example.com/activate" target="_blank" rel="noopener noreferrer">https://idp.example.com/activate</a>
Enter code: WXYZ-1234</p>
<p>Waiting for authentication...</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Browser opens automatically to verification URL*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Authenticated as alice@company.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Token expires in 1 hour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Token cached to ~/.prism/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You can now use prismctl commands:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prismctl namespace list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prismctl backend health</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prismctl session list</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="token-storage">Token Storage<a href="#token-storage" class="hash-link" aria-label="Direct link to Token Storage" title="Direct link to Token Storage" translate="no">​</a></h3>
<p>Tokens are securely stored in <code>~/.prism/token</code>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;access_token&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;refresh_token&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;token_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Bearer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;expires_at&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-10-09T15:30:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;issued_at&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-10-09T14:30:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;issuer&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://idp.example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;principal&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;alice@company.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;groups&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;platform-team&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admins&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Security</strong>:</p>
<ul>
<li>File permissions: <code>0600</code> (owner read/write only)</li>
<li>Tokens expire after 1 hour</li>
<li>Refresh tokens extend session to 7 days</li>
<li>Automatic refresh on expiry</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="logout-command">Logout Command<a href="#logout-command" class="hash-link" aria-label="Direct link to Logout Command" title="Direct link to Logout Command" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Logout (delete cached token)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl </span><span class="token builtin class-name">logout</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Verify logged out</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl namespace list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># → Error: Not authenticated. Run &#x27;prismctl login&#x27; to authenticate.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authentication-modes">Authentication Modes<a href="#authentication-modes" class="hash-link" aria-label="Direct link to Authentication Modes" title="Direct link to Authentication Modes" translate="no">​</a></h3>



































<table><thead><tr><th>Mode</th><th>Use Case</th><th>Command</th><th>Token Source</th></tr></thead><tbody><tr><td><strong>Interactive</strong></td><td>Developer workstation</td><td><code>prismctl login</code></td><td>Device code flow</td></tr><tr><td><strong>Service Account</strong></td><td>CI/CD, automation</td><td><code>PRISM_TOKEN=&lt;jwt&gt; prismctl ...</code></td><td>Environment variable</td></tr><tr><td><strong>Local (Dex)</strong></td><td>Local development</td><td><code>prismctl login --local</code></td><td>Dex IDP (see ADR-046)</td></tr><tr><td><strong>Custom Issuer</strong></td><td>Enterprise SSO</td><td><code>prismctl login --issuer &lt;url&gt;</code></td><td>Custom OIDC provider</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-account-authentication">Service Account Authentication<a href="#service-account-authentication" class="hash-link" aria-label="Direct link to Service Account Authentication" title="Direct link to Service Account Authentication" translate="no">​</a></h3>
<p>For automation (CI/CD pipelines, cron jobs), use service account tokens:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Export token from secret manager</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PRISM_TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">vault kv get </span><span class="token variable parameter variable" style="color:#36acaa">-field</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">token prism/ci-service</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use prismctl with service account token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl namespace list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># CLI detects PRISM_TOKEN and uses it instead of cached token</span><br></span></code></pre></div></div>
<p><strong>Service Account Token Claims</strong>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;iss&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://idp.example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;sub&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;service:prism-ci&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;aud&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;prismctl-api&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;exp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1696867200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;iat&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1696863600</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;email&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ci-service@prism.local&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;groups&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;ci-automation&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;scope&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin:read admin:write&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authentication-flow-implementation">Authentication Flow Implementation<a href="#authentication-flow-implementation" class="hash-link" aria-label="Direct link to Authentication Flow Implementation" title="Direct link to Authentication Flow Implementation" translate="no">​</a></h3>
<p>The CLI authentication is implemented in the Admin gRPC client wrapper:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// internal/client/auth.go</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;context&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;encoding/json&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;fmt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;os&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;path/filepath&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;golang.org/x/oauth2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> TokenCache </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AccessToken  </span><span class="token builtin">string</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">`json:&quot;access_token&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RefreshToken </span><span class="token builtin">string</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">`json:&quot;refresh_token&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TokenType    </span><span class="token builtin">string</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">`json:&quot;token_type&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ExpiresAt    time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Time </span><span class="token string" style="color:#e3116c">`json:&quot;expires_at&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IssuedAt     time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Time </span><span class="token string" style="color:#e3116c">`json:&quot;issued_at&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Issuer       </span><span class="token builtin">string</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">`json:&quot;issuer&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Principal    </span><span class="token builtin">string</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">`json:&quot;principal&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Groups       </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">`json:&quot;groups&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">LoadToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">TokenCache</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Check environment variable first</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> token </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;PRISM_TOKEN&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> token </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">TokenCache</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AccessToken</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TokenType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">   </span><span class="token string" style="color:#e3116c">&quot;Bearer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Load from cache file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    home</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">UserHomeDir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tokenPath </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> filepath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">home</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.prism&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;token&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ReadFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenPath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Errorf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;not authenticated: %w&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> cache TokenCache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Unmarshal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Check if token expired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">After</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExpiresAt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Try to refresh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">refreshToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SaveToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">TokenCache</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    home</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">UserHomeDir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prismDir </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> filepath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">home</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.prism&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">MkdirAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prismDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0700</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tokenPath </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> filepath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prismDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;token&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">MarshalIndent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;  &quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Write with restricted permissions (0600)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WriteFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0600</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">refreshToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">TokenCache</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">TokenCache</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RefreshToken </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Errorf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;no refresh token available&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Use oauth2 library to refresh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">oauth2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ClientID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;prismctl&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> oauth2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Endpoint</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TokenURL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Issuer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/oauth/token&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    token </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">oauth2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RefreshToken</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RefreshToken</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    src </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">TokenSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Background</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    newToken</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> src</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Token</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Errorf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;failed to refresh token: %w&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AccessToken </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newToken</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AccessToken</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExpiresAt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newToken</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Expiry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IssuedAt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Save updated token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SaveToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="local-development-with-dex">Local Development with Dex<a href="#local-development-with-dex" class="hash-link" aria-label="Direct link to Local Development with Dex" title="Direct link to Local Development with Dex" translate="no">​</a></h3>
<p>For local testing without cloud OIDC providers, use Dex (see ADR-046):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Start Dex in Docker Compose</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> up </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> dex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Login with local Dex</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl login </span><span class="token parameter variable" style="color:#36acaa">--local</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Opens: http://localhost:5556/auth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Login with test user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Email: admin@prism.local</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Password: password</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Token cached, ready to use</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl namespace list</span><br></span></code></pre></div></div>
<p><strong>References</strong>:</p>
<ul>
<li>RFC-010: Admin Protocol with OIDC Authentication (complete OIDC specification)</li>
<li>ADR-046: Dex IDP for Local Identity Testing (local development setup)</li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8628" target="_blank" rel="noopener noreferrer">OAuth 2.0 Device Authorization Grant (RFC 8628)</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="command-structure">Command Structure<a href="#command-structure" class="hash-link" aria-label="Direct link to Command Structure" title="Direct link to Command Structure" translate="no">​</a></h3>
<p>prism
├── namespace
│   ├── create      # Create new namespace
│   ├── list        # List all namespaces
│   ├── describe    # Show namespace details
│   ├── update      # Update namespace config
│   └── delete      # Delete namespace
├── backend
│   ├── list        # List configured backends
│   ├── health      # Check backend health
│   ├── stats       # Show backend statistics
│   └── test        # Test backend connectivity
├── session
│   ├── list        # List active sessions
│   ├── describe    # Show session details
│   ├── kill        # Terminate session
│   └── trace       # Trace session requests
├── config
│   ├── show        # Display current config
│   ├── validate    # Validate config file
│   └── apply       # Apply config changes
├── metrics
│   ├── summary     # Overall metrics summary
│   ├── namespace   # Namespace-level metrics
│   └── export      # Export metrics (Prometheus format)
├── shadow
│   ├── enable      # Enable shadow traffic
│   ├── disable     # Disable shadow traffic
│   └── status      # Show shadow traffic status
└── plugin
├── list        # List installed plugins
├── install     # Install plugin from registry
├── update      # Update plugin version
├── enable      # Enable plugin
├── disable     # Disable plugin
├── status      # Show plugin health and metrics
├── reload      # Hot-reload plugin code
└── logs        # View plugin logs</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Command Specifications</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Namespace Management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Create Namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Preferred: Declarative mode from config file</h1>
<p>prismctl namespace create --config namespace.yaml</p>
<h1>Config file discovery (searches . and parent dirs for .config.yaml)</h1>
<p>prismctl namespace create my-app  # Uses .config.yaml from current or parent dir</p>
<h1>Inline configuration (for simple cases or scripting)</h1>
<p>prismctl namespace create my-app <br>
--backend postgres <br>
--pattern keyvalue <br>
--consistency strong <br>
--cache-ttl 300</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Output (Rich table)**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┏━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━┓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┃ Namespace  ┃ Backend  ┃ Pattern    ┃ Status       ┃</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┡━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━┩</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ my-app     │ postgres │ keyvalue   │ ✓ Created    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────┴──────────┴────────────┴──────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created namespace &#x27;my-app&#x27; successfully</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gRPC endpoint: localhost:50051</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Admin endpoint: localhost:50052</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="list-namespaces">List Namespaces<a href="#list-namespaces" class="hash-link" aria-label="Direct link to List Namespaces" title="Direct link to List Namespaces" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Default table view</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl namespace list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># JSON output for scripting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl namespace list </span><span class="token parameter variable" style="color:#36acaa">--output</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Filter by backend</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl namespace list </span><span class="token parameter variable" style="color:#36acaa">--backend</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Show inactive namespaces</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl namespace list --include-inactive</span><br></span></code></pre></div></div>
<p><strong>Output</strong>:
┏━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━┓
┃ Namespace      ┃ Backend    ┃ Pattern    ┃ Sessions ┃ RPS        ┃
┡━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━┩
│ user-profiles  │ postgres   │ keyvalue   │ 24       │ 1,234      │
│ event-stream   │ kafka      │ stream     │ 8        │ 45,678     │
│ session-cache  │ redis      │ cache      │ 156      │ 89,012     │
│ metrics-olap   │ clickhouse │ timeseries │ 4        │ 12,345     │
└────────────────┴────────────┴────────────┴──────────┴────────────┘</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Describe Namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>prismctl namespace describe my-app</p>
<h1>Include recent errors</h1>
<p>prismctl namespace describe my-app --show-errors</p>
<h1>Include configuration</h1>
<p>prismctl namespace describe my-app --show-config</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Output**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Namespace: my-app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status: Active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created: 2025-10-01 14:23:45 UTC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Updated: 2025-10-08 09:12:34 UTC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Backend Configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Type: PostgreSQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Pattern: KeyValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Connection: postgres://prism-pg-1:5432/prism_my_app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Consistency: Strong</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Connection Pool: 20 max connections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Performance:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Current RPS: 1,234</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  P50 Latency: 2.3ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  P99 Latency: 12.7ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Error Rate: 0.02%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Active Sessions: 24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├─ session-abc123: 2 connections, 45 RPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├─ session-def456: 5 connections, 234 RPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └─ ... (22 more)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recent Errors (last 10):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [2025-10-08 09:05:12] Connection timeout (1 occurrence)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="backend-management">Backend Management<a href="#backend-management" class="hash-link" aria-label="Direct link to Backend Management" title="Direct link to Backend Management" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="health-check">Health Check<a href="#health-check" class="hash-link" aria-label="Direct link to Health Check" title="Direct link to Health Check" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Check all backends</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl backend health</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Check specific backend</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl backend health </span><span class="token parameter variable" style="color:#36acaa">--backend</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Detailed health check with diagnostics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl backend health </span><span class="token parameter variable" style="color:#36acaa">--detailed</span><br></span></code></pre></div></div>
<p><strong>Output</strong>:
Backend Health Status
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</p>
<p>✓ PostgreSQL (postgres-1)
Status: Healthy
Latency: 1.2ms
Connections: 45/100 used
Last Check: 2s ago</p>
<p>✓ Redis (redis-cache-1)
Status: Healthy
Latency: 0.3ms
Memory: 2.1GB / 8GB
Last Check: 2s ago</p>
<p>✓ ClickHouse (clickhouse-1)
Status: Healthy
Latency: 3.4ms
Queries: 234 active
Last Check: 2s ago</p>
<p>✗ Kafka (kafka-1)
Status: Degraded
Error: Connection refused to broker-3
Last Success: 5m ago
Action: Check broker-3 connectivity</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Backend Statistics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Show stats for all backends</h1>
<p>prismctl backend stats</p>
<h1>Stats for specific namespace</h1>
<p>prismctl backend stats --namespace my-app</p>
<h1>Export to JSON</h1>
<p>prismctl backend stats --output json</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Session Management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### List Sessions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>List all active sessions across all namespaces</h1>
<p>prismctl session list</p>
<h1>Scope to specific namespace (preferred for focused inspection)</h1>
<p>prismctl session list --namespace my-app</p>
<h1>Scope using config file (.config.yaml must specify namespace)</h1>
<p>prismctl session list  # Auto-scopes if .config.yaml has namespace set</p>
<h1>Show long-running sessions</h1>
<p>prismctl session list --duration &quot;&gt;1h&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Output**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┃ Session ID    ┃ Principal            ┃ Namespace      ┃ Duration   ┃ Requests   ┃ RPS        ┃</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━┩</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ sess-abc123   │ alice@company.com    │ user-profiles  │ 2h 34m     │ 456,789    │ 45         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ sess-def456   │ user-api.prod (svc)  │ event-stream   │ 45m        │ 123,456    │ 234        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ sess-ghi789   │ bob@company.com      │ session-cache  │ 12m        │ 89,012     │ 567        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└───────────────┴──────────────────────┴────────────────┴────────────┴────────────┴────────────┘</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="trace-session">Trace Session<a href="#trace-session" class="hash-link" aria-label="Direct link to Trace Session" title="Direct link to Trace Session" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Live trace of session requests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl session trace sess-abc123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Trace with filtering</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl session trace sess-abc123 --min-latency 100ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Export trace to file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl session trace sess-abc123 </span><span class="token parameter variable" style="color:#36acaa">--duration</span><span class="token plain"> 60s </span><span class="token parameter variable" style="color:#36acaa">--output</span><span class="token plain"> trace.json</span><br></span></code></pre></div></div>
<p><strong>Output (live streaming)</strong>:
Tracing session sess-abc123 (Ctrl+C to stop)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</p>
<p>09:15:23.456 | GET    | user_profiles:user:12345    | 2.3ms  | ✓
09:15:23.489 | SET    | user_profiles:user:12345    | 3.1ms  | ✓
09:15:23.512 | GET    | user_profiles:user:67890    | 1.8ms  | ✓
09:15:23.534 | DELETE | user_profiles:user:11111    | 145ms  | ✗ Not Found</p>
<p>Statistics:
Requests: 4
Success: 3 (75%)
Avg Latency: 38.05ms
P99 Latency: 145ms</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Configuration Management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Show Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Show proxy-wide configuration</h1>
<p>prismctl config show</p>
<h1>Show namespace-specific config (scoped view)</h1>
<p>prismctl config show --namespace my-app</p>
<h1>Auto-scope using .config.yaml (if namespace specified in config)</h1>
<p>prismctl config show  # Uses namespace from .config.yaml if present</p>
<h1>Export configuration</h1>
<p>prismctl config show --output yaml &gt; prism-config.yaml</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Validate Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Validate config file before applying</h1>
<p>prismctl config validate prism-config.yaml</p>
<h1>Dry-run mode</h1>
<p>prismctl config validate prism-config.yaml --dry-run</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Output**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Validating configuration: prism-config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ YAML syntax valid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Schema validation passed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Backend connections verified (3/3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Namespace uniqueness verified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Capacity limits within bounds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✗ Warning: Redis memory limit (16GB) exceeds available (12GB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Validation: PASSED (1 warning)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Safe to apply: Yes (with warnings)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metrics-and-monitoring">Metrics and Monitoring<a href="#metrics-and-monitoring" class="hash-link" aria-label="Direct link to Metrics and Monitoring" title="Direct link to Metrics and Monitoring" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="metrics-summary">Metrics Summary<a href="#metrics-summary" class="hash-link" aria-label="Direct link to Metrics Summary" title="Direct link to Metrics Summary" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Overall metrics across all namespaces</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl metrics summary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Namespace-specific metrics (scoped view)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl metrics summary </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> my-app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Auto-scope using .config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl metrics summary  </span><span class="token comment" style="color:#999988;font-style:italic"># Uses namespace from .config.yaml if present</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Time range filtering</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl metrics summary </span><span class="token parameter variable" style="color:#36acaa">--since</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1h ago&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> my-app</span><br></span></code></pre></div></div>
<p><strong>Output</strong>:
Prism Metrics Summary (Last 1 hour)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</p>
<p>Request Volume:
Total Requests: 12,456,789
Success Rate: 99.98%
Error Rate: 0.02%</p>
<p>Performance:
P50 Latency: 2.3ms
P95 Latency: 8.7ms
P99 Latency: 23.4ms</p>
<p>Top Namespaces by RPS:</p>
<ol>
<li>event-stream      45,678 RPS</li>
<li>session-cache     12,345 RPS</li>
<li>user-profiles      1,234 RPS</li>
</ol>
<p>Backend Health:
✓ PostgreSQL    (5 instances)
✓ Redis         (3 instances)
✓ ClickHouse    (2 instances)
✗ Kafka         (1 degraded)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Export Metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Prometheus format</h1>
<p>prismctl metrics export --format prometheus &gt; metrics.prom</p>
<h1>JSON format with metadata</h1>
<p>prismctl metrics export --format json --include-metadata &gt; metrics.json</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Shadow Traffic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Enable Shadow Traffic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Enable shadow traffic for Postgres version upgrade (14 → 16)</h1>
<p>prismctl shadow enable user-profiles <br>
--source postgres-14-primary <br>
--target postgres-16-replica <br>
--percentage 10</p>
<h1>Gradual rollout with automatic ramp-up</h1>
<p>prismctl shadow enable user-profiles <br>
--source postgres-14-primary <br>
--target postgres-16-replica <br>
--ramp-up &quot;10%,25%,50%,100%&quot; <br>
--interval 1h</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Output**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enabling shadow traffic for namespace &#x27;user-profiles&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Migration: Postgres 14 → Postgres 16 upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Source: postgres-14-primary (current production)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Target: postgres-16-replica (upgrade candidate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Initial Percentage: 10%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Ramp-up Schedule:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    • 10% at 09:15:00 (now)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    • 25% at 10:15:00 (+1h)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    • 50% at 11:15:00 (+2h)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    • 100% at 12:15:00 (+3h)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Shadow traffic enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Monitor: prismctl shadow status user-profiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Disable: prismctl shadow disable user-profiles</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="shadow-status">Shadow Status<a href="#shadow-status" class="hash-link" aria-label="Direct link to Shadow Status" title="Direct link to Shadow Status" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">prismctl shadow status user-profiles</span><br></span></code></pre></div></div>
<p><strong>Output</strong>:
Shadow Traffic Status: user-profiles
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</p>
<p>Migration: Postgres 14 → Postgres 16 upgrade</p>
<p>Status: Active
Current Stage: 25% traffic to target
Next Stage: 50% at 11:15:00 (+45m)</p>
<p>Backends:
Source: postgres-14-primary (Postgres 14.10)
Target: postgres-16-replica (Postgres 16.1)</p>
<p>Traffic Distribution:
┌────────────────────────────────────────┐
│ ████████████████████████████           │ 75% → postgres-14-primary
│ ████████                               │ 25% → postgres-16-replica
└────────────────────────────────────────┘</p>
<p>Comparison Metrics:
┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃ Metric     ┃ PG 14 (Source)     ┃ PG 16 (Target)     ┃ Delta      ┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ P50        │ 2.3ms              │ 2.1ms              │ -9%        │
│ P99        │ 12.7ms             │ 11.8ms             │ -7%        │
│ Error Rate │ 0.02%              │ 0.01%              │ -50%       │
│ QPS        │ 1,234              │ 1,234              │ 0%         │
└────────────┴────────────────────┴────────────────────┴────────────┘</p>
<p>Query Compatibility:
✓ All queries compatible with PG 16
✓ No deprecated features detected
✓ Performance parity achieved</p>
<p>✓ Target performing well, ready for next stage</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Plugin Management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Plugin commands manage backend plugins (installation, updates, health monitoring, hot-reload).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For complete plugin development guide, see [RFC-008: Plugin Development Experience](/rfc/rfc-008.md#plugin-development-experience).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### List Plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>List all installed plugins</h1>
<p>prismctl plugin list</p>
<h1>Filter by status</h1>
<p>prismctl plugin list --status enabled
prismctl plugin list --status disabled</p>
<h1>Show plugin versions</h1>
<p>prismctl plugin list --show-versions</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Output**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┏━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┃ Plugin       ┃ Version ┃ Status   ┃ Namespaces       ┃ Health     ┃</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┡━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ postgres     │ 1.2.0   │ enabled  │ 45 namespaces    │ ✓ Healthy  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ redis        │ 2.1.3   │ enabled  │ 123 namespaces   │ ✓ Healthy  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ kafka        │ 3.0.1   │ enabled  │ 18 namespaces    │ ⚠ Degraded │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ clickhouse   │ 1.5.0   │ disabled │ 0 namespaces     │ - Disabled │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ mongodb      │ 0.9.0   │ enabled  │ 7 namespaces     │ ✓ Healthy  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────┴─────────┴──────────┴──────────────────┴────────────┘</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="install-plugin">Install Plugin<a href="#install-plugin" class="hash-link" aria-label="Direct link to Install Plugin" title="Direct link to Install Plugin" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Install from registry (default: latest version)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> mongodb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install specific version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> mongodb </span><span class="token parameter variable" style="color:#36acaa">--version</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install from local path (development)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--local</span><span class="token plain"> /path/to/mongodb-plugin.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install with custom config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> mongodb </span><span class="token parameter variable" style="color:#36acaa">--config</span><span class="token plain"> plugin-config.yaml</span><br></span></code></pre></div></div>
<p><strong>Output</strong>:
Installing plugin: mongodb
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</p>
<p>✓ Downloaded mongodb-plugin v1.0.0 (5.2 MB)
✓ Verified plugin signature
✓ Loaded plugin library
✓ Initialized plugin
✓ Health check passed</p>
<p>Plugin &#x27;mongodb&#x27; installed successfully
Supported operations: get, set, query, aggregate
Ready to create namespaces with backend: mongodb</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Update Plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Update to latest version</h1>
<p>prismctl plugin update mongodb</p>
<h1>Update to specific version</h1>
<p>prismctl plugin update mongodb --version 1.1.0</p>
<h1>Dry-run mode (check compatibility without applying)</h1>
<p>prismctl plugin update mongodb --dry-run</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Output (with warnings)**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Updating plugin: mongodb (1.0.0 → 1.1.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ⚠ Warning: 7 namespaces using this plugin will be restarted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - mongodb-cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - user-sessions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - product-catalog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - (4 more...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Downloaded mongodb-plugin v1.1.0 (5.3 MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Verified plugin signature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Proceed with update? [y/N]: y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Stopped old plugin instances</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Loaded new plugin version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Migrated plugin state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Restarted namespaces (7/7 healthy)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Plugin &#x27;mongodb&#x27; updated successfully (1.0.0 → 1.1.0)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="enabledisable-plugin">Enable/Disable Plugin<a href="#enabledisable-plugin" class="hash-link" aria-label="Direct link to Enable/Disable Plugin" title="Direct link to Enable/Disable Plugin" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Disable plugin (prevent new namespaces, keep existing running)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin disable kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Enable previously disabled plugin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin </span><span class="token builtin class-name">enable</span><span class="token plain"> kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Force disable (stop all namespaces using this plugin)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin disable kafka </span><span class="token parameter variable" style="color:#36acaa">--force</span><br></span></code></pre></div></div>
<p><strong>Output</strong>:
Disabling plugin: kafka
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</p>
<p>⚠ 18 namespaces currently using this plugin</p>
<p>Actions:
✓ Prevent new namespaces from using kafka backend
✓ Existing namespaces will continue running
⚠ Use --force to stop all kafka namespaces</p>
<p>Plugin &#x27;kafka&#x27; disabled successfully</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### Plugin Status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>View plugin health and detailed metrics</h1>
<p>prismctl plugin status mongodb</p>
<h1>Include recent errors</h1>
<p>prismctl plugin status mongodb --show-errors</p>
<h1>Live monitoring mode</h1>
<p>prismctl plugin status mongodb --watch</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Output**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Plugin Status: mongodb (v1.0.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Health: ✓ Healthy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status: Enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deployment: Sidecar (gRPC: localhost:50105)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Namespaces Using Plugin: 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├─ mongodb-cache (active, 1234 RPS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├─ user-sessions (active, 567 RPS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └─ ... (5 more)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Performance Metrics (Last 5 minutes):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Requests: 456,789 total (98.5% success rate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Latency:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    P50: 2.1ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    P99: 8.3ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    P999: 24.7ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Connections: 45 active, 12 idle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resource Usage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CPU: 1.2 cores (30% of limit)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Memory: 1.8 GB (22% of limit)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Network: 245 MB/s in, 312 MB/s out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recent Errors (last 10):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [09:15:23] Connection timeout to mongodb-1 (1 occurrence)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [09:12:45] Query timeout for aggregate operation (3 occurrences)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="hot-reload-plugin">Hot-Reload Plugin<a href="#hot-reload-plugin" class="hash-link" aria-label="Direct link to Hot-Reload Plugin" title="Direct link to Hot-Reload Plugin" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Reload plugin code without restarting namespaces</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin reload mongodb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Reload with validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin reload mongodb </span><span class="token parameter variable" style="color:#36acaa">--validate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Reload and tail logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin reload mongodb </span><span class="token parameter variable" style="color:#36acaa">--tail</span><br></span></code></pre></div></div>
<p><strong>Output</strong>:
Reloading plugin: mongodb
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</p>
<p>✓ Built new plugin binary
✓ Verified plugin signature
✓ Validated plugin compatibility
✓ Loaded new plugin instance
✓ Migrated active connections (45 connections)
✓ Switched traffic to new instance
✓ Drained old instance</p>
<p>Plugin &#x27;mongodb&#x27; reloaded successfully
Namespaces affected: 7 (all healthy)
Reload time: 2.3s (zero downtime)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### View Plugin Logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>View recent logs</h1>
<p>prismctl plugin logs mongodb</p>
<h1>Follow logs (live tail)</h1>
<p>prismctl plugin logs mongodb --follow</p>
<h1>Filter by log level</h1>
<p>prismctl plugin logs mongodb --level error</p>
<h1>Show logs from specific time range</h1>
<p>prismctl plugin logs mongodb --since &quot;1h ago&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Output**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tailing logs: mongodb (Ctrl+C to stop)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">09:15:23.456 INFO  Initialized connection pool (size: 20)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">09:15:23.789 INFO  Health check passed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">09:15:24.123 DEBUG Executing query: {&quot;op&quot;: &quot;find&quot;, &quot;collection&quot;: &quot;users&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">09:15:24.156 DEBUG Query completed in 33ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">09:15:25.234 WARN  Connection to mongodb-1 timeout, retrying...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">09:15:25.567 INFO  Connection re-established</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="plugin-development-workflow">Plugin Development Workflow<a href="#plugin-development-workflow" class="hash-link" aria-label="Direct link to Plugin Development Workflow" title="Direct link to Plugin Development Workflow" translate="no">​</a></h3>
<p>For developers creating new plugins, the CLI provides scaffolding and testing tools:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Create new plugin from template</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prism-plugin-init </span><span class="token parameter variable" style="color:#36acaa">--name</span><span class="token plain"> mybackend </span><span class="token parameter variable" style="color:#36acaa">--language</span><span class="token plain"> rust</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Test plugin locally (without Prism proxy)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> mybackend-plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin </span><span class="token builtin class-name">test</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--config</span><span class="token plain"> test-config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Build and package plugin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Publish to registry (for distribution)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prismctl plugin publish </span><span class="token parameter variable" style="color:#36acaa">--registry</span><span class="token plain"> https://plugins.prism.io</span><br></span></code></pre></div></div>
<p>See <a href="/prism-data-layer/rfc/rfc-008#plugin-development-experience">RFC-008: Plugin Development Experience</a> for complete development guide.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="protobuf-integration">Protobuf Integration<a href="#protobuf-integration" class="hash-link" aria-label="Direct link to Protobuf Integration" title="Direct link to Protobuf Integration" translate="no">​</a></h2>
<p>The CLI communicates with Prism via the Admin gRPC API defined in RFC-003:</p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// CLI uses these services from RFC-003</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">service</span><span class="token plain"> </span><span class="token class-name">AdminService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Namespace operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CreateNamespace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">CreateNamespaceRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Namespace</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ListNamespaces</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListNamespacesRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListNamespacesResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DescribeNamespace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DescribeNamespaceRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Namespace</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">UpdateNamespace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">UpdateNamespaceRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Namespace</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DeleteNamespace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteNamespaceRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DeleteNamespaceResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Backend operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ListBackends</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListBackendsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListBackendsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CheckBackendHealth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HealthCheckRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HealthCheckResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetBackendStats</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BackendStatsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BackendStatsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Session operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ListSessions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListSessionsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ListSessionsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DescribeSession</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DescribeSessionRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Session</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">KillSession</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">KillSessionRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">KillSessionResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TraceSession</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TraceSessionRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">stream</span><span class="token plain"> </span><span class="token class-name">TraceEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Configuration operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetConfigRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ValidateConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ValidateConfigRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ValidationResult</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ApplyConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ApplyConfigRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ApplyConfigResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Metrics operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetMetrics</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MetricsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MetricsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ExportMetrics</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExportMetricsRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ExportMetricsResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Shadow traffic operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">EnableShadowTraffic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ShadowTrafficRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ShadowTrafficResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DisableShadowTraffic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">DisableShadowTrafficRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ShadowTrafficResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">rpc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetShadowStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ShadowStatusRequest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ShadowStatus</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation">Implementation<a href="#implementation" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation" translate="no">​</a></h2>
<blockquote>
<p><strong>Note</strong>: The implementation details below were from the original Python proposal. The actual implementation uses <strong>Go</strong> with Cobra/Viper framework. See <a href="/prism-data-layer/adr/adr-040">ADR-040</a> for Go-specific implementation details.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="technology-stack-go-implementation---see-adr-040">Technology Stack (Go Implementation - see ADR-040)<a href="#technology-stack-go-implementation---see-adr-040" class="hash-link" aria-label="Direct link to Technology Stack (Go Implementation - see ADR-040)" title="Direct link to Technology Stack (Go Implementation - see ADR-040)" translate="no">​</a></h3>
<ul>
<li><strong>CLI Framework</strong>: Cobra (command structure) + Viper (configuration)</li>
<li><strong>gRPC Client</strong>: google.golang.org/grpc + protobuf-generated stubs</li>
<li><strong>Formatting</strong>: Custom table rendering (or external library like pterm)</li>
<li><strong>Configuration</strong>: YAML via gopkg.in/yaml.v3</li>
<li><strong>Testing</strong>: testscript for acceptance tests (see ADR-039)</li>
<li><strong>Distribution</strong>: Single binary via GitHub releases</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="project-structure-go-implementation">Project Structure (Go Implementation)<a href="#project-structure-go-implementation" class="hash-link" aria-label="Direct link to Project Structure (Go Implementation)" title="Direct link to Project Structure (Go Implementation)" translate="no">​</a></h3>
<p>tools/
├── cmd/
│   └── prismctl/
│       ├── main.go          # CLI entry point
│       ├── root.go          # Root command + config
│       ├── namespace.go     # Namespace commands
│       ├── backend.go       # Backend commands
│       ├── session.go       # Session commands
│       ├── config.go        # Config commands
│       ├── metrics.go       # Metrics commands
│       ├── shadow.go        # Shadow traffic commands
│       └── plugin.go        # Plugin management commands
├── internal/
│   ├── client/
│   │   ├── admin.go         # Admin gRPC client wrapper
│   │   └── auth.go          # Authentication helpers
│   ├── formatters/
│   │   ├── table.go         # Table formatters
│   │   ├── tree.go          # Tree formatters
│   │   └── json.go          # JSON output
│   └── proto/               # Generated protobuf stubs
│       └── admin.pb.go
├── testdata/
│   └── script/              # testscript acceptance tests
│       ├── namespace_create.txtar
│       ├── session_list.txtar
│       └── ...
├── acceptance_test.go       # testscript runner
├── go.mod
└── go.sum</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Example Implementation (Namespace Commands)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>src/prism_cli/commands/namespace.py</h1>
<p>import typer
from rich.console import Console
from rich.table import Table
from typing import Optional
from ..client.admin import AdminClient
from ..formatters.table import format_namespace_table</p>
<p>app = typer.Typer(help=&quot;Namespace management commands&quot;)
console = Console()</p>
<p>@app.command()
def create(
name: str = typer.Argument(..., help=&quot;Namespace name&quot;),
backend: str = typer.Option(None, help=&quot;Backend type (postgres, redis, etc.)&quot;),
pattern: str = typer.Option(None, help=&quot;Data access pattern&quot;),
consistency: str = typer.Option(&quot;eventual&quot;, help=&quot;Consistency level&quot;),
cache_ttl: Optional[int] = typer.Option(None, help=&quot;Cache TTL in seconds&quot;),
config: Optional[str] = typer.Option(None, help=&quot;Path to config file (or .config.yaml)&quot;),
):
&quot;&quot;&quot;Create a new namespace.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Prefers YAML configuration. If --config not specified, searches for .config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in current directory and parent directories.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client = AdminClient()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Load config from file (explicit or discovered)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config_data = load_yaml_config(config)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config_data = discover_config()  # Search for .config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Override with CLI args if provided</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config_data.update({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    k: v for k, v in {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;backend&#x27;: backend,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;pattern&#x27;: pattern,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;consistency&#x27;: consistency,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;cache_ttl&#x27;: cache_ttl,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }.items() if v is not None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    namespace = client.create_namespace(name=name, **config_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Display result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table = Table(title=&quot;Namespace Created&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.add_column(&quot;Namespace&quot;, style=&quot;cyan&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.add_column(&quot;Backend&quot;, style=&quot;green&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.add_column(&quot;Pattern&quot;, style=&quot;yellow&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.add_column(&quot;Status&quot;, style=&quot;green&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.add_row(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace.name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace.backend,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        namespace.pattern,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;✓ Created&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(table)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;\nCreated namespace &#x27;{name}&#x27; successfully&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;gRPC endpoint: {namespace.grpc_endpoint}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;Admin endpoint: {namespace.admin_endpoint}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;[red]Error creating namespace: {e}[/red]&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    raise typer.Exit(1)</span><br></span></code></pre></div></div>
<p>@app.command()
def list(
output: str = typer.Option(&quot;table&quot;, help=&quot;Output format (table, json)&quot;),
backend: Optional[str] = typer.Option(None, help=&quot;Filter by backend&quot;),
include_inactive: bool = typer.Option(False, help=&quot;Include inactive namespaces&quot;),
):
&quot;&quot;&quot;List all namespaces.&quot;&quot;&quot;
client = AdminClient()</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    namespaces = client.list_namespaces(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        backend=backend,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include_inactive=include_inactive,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if output == &quot;json&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.print_json([ns.to_dict() for ns in namespaces])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        table = format_namespace_table(namespaces)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.print(table)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;[red]Error listing namespaces: {e}[/red]&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    raise typer.Exit(1)</span><br></span></code></pre></div></div>
<p>@app.command()
def describe(
name: str = typer.Argument(..., help=&quot;Namespace name&quot;),
show_errors: bool = typer.Option(False, help=&quot;Show recent errors&quot;),
show_config: bool = typer.Option(False, help=&quot;Show configuration&quot;),
):
&quot;&quot;&quot;Describe a namespace in detail.&quot;&quot;&quot;
client = AdminClient()</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    namespace = client.describe_namespace(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name=name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include_errors=show_errors,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include_config=show_config,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Rich formatted output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;\n[bold cyan]Namespace: {namespace.name}[/bold cyan]&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;Status: [green]{namespace.status}[/green]&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;Created: {namespace.created_at}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;Updated: {namespace.updated_at}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(&quot;\n[bold]Backend Configuration:[/bold]&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;  Type: {namespace.backend}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;  Pattern: {namespace.pattern}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;  Connection: {namespace.connection_string}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;  Consistency: {namespace.consistency}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(&quot;\n[bold]Performance:[/bold]&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;  Current RPS: {namespace.current_rps:,}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;  P50 Latency: {namespace.p50_latency}ms&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;  P99 Latency: {namespace.p99_latency}ms&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;  Error Rate: {namespace.error_rate:.2%}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if namespace.sessions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.print(f&quot;\n[bold]Active Sessions: {len(namespace.sessions)}[/bold]&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for session in namespace.sessions[:3]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            console.print(f&quot;  ├─ {session.id}: {session.connections} connections, {session.rps} RPS&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if len(namespace.sessions) &gt; 3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            console.print(f&quot;  └─ ... ({len(namespace.sessions) - 3} more)&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if show_errors and namespace.errors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.print(&quot;\n[bold]Recent Errors (last 10):[/bold]&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for error in namespace.errors[:10]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            console.print(f&quot;  [{error.timestamp}] {error.message} ({error.count} occurrence(s))&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.print(f&quot;[red]Error describing namespace: {e}[/red]&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    raise typer.Exit(1)</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Admin gRPC Client Wrapper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>src/prism_cli/client/admin.py</h1>
<p>import grpc
from typing import List, Optional
from ..proto import admin_pb2, admin_pb2_grpc
from .auth import get_credentials</p>
<p>class AdminClient:
&quot;&quot;&quot;Wrapper around Admin gRPC client for CLI operations.&quot;&quot;&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def __init__(self, endpoint: str = &quot;localhost:50052&quot;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.endpoint = endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.credentials = get_credentials()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.channel = grpc.secure_channel(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        endpoint,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.credentials,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.stub = admin_pb2_grpc.AdminServiceStub(self.channel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def create_namespace(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: str,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backend: str,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pattern: str,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consistency: str = &quot;eventual&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cache_ttl: Optional[int] = None,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) -&gt; Namespace:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Create a new namespace.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request = admin_pb2.CreateNamespaceRequest(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name=name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        backend=backend,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pattern=pattern,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        consistency=consistency,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cache_ttl=cache_ttl,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response = self.stub.CreateNamespace(request)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Namespace.from_proto(response)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def list_namespaces(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backend: Optional[str] = None,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    include_inactive: bool = False,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) -&gt; List[Namespace]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;List all namespaces.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request = admin_pb2.ListNamespacesRequest(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        backend=backend,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include_inactive=include_inactive,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response = self.stub.ListNamespaces(request)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return [Namespace.from_proto(ns) for ns in response.namespaces]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def describe_namespace(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: str,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    include_errors: bool = False,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    include_config: bool = False,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) -&gt; Namespace:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Get detailed namespace information.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request = admin_pb2.DescribeNamespaceRequest(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name=name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include_errors=include_errors,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include_config=include_config,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response = self.stub.DescribeNamespace(request)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Namespace.from_proto(response)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def check_backend_health(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backend: Optional[str] = None,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) -&gt; List[BackendHealth]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Check health of backends.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request = admin_pb2.HealthCheckRequest(backend=backend)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response = self.stub.CheckBackendHealth(request)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return [BackendHealth.from_proto(h) for h in response.backends]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def trace_session(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session_id: str,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_latency_ms: Optional[int] = None,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Stream trace events for a session.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request = admin_pb2.TraceSessionRequest(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        session_id=session_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        min_latency_ms=min_latency_ms,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for event in self.stub.TraceSession(request):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        yield TraceEvent.from_proto(event)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def __enter__(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return self</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def __exit__(self, *args):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.channel.close()</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Use-Case Recommendations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### ✅ When to Use CLI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Operational Tasks**: Health checks, session management, troubleshooting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Automation**: CI/CD pipelines, infrastructure-as-code, scripting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Quick Checks**: Rapid inspection without opening web UI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **SSH Sessions**: Remote administration without GUI requirements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Development**: Local testing and debugging during development</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### ❌ When CLI is Less Suitable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Complex Visualizations**: Graphs, charts, time-series plots (use web UI)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Interactive Exploration**: Clicking through related entities (web UI better)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Long-Running Monitoring**: Real-time dashboards (use web UI or Grafana)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Non-Technical Users**: Prefer graphical interfaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Migration to Web UI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The CLI validates the admin API design and provides immediate value. Web UI development can proceed in parallel:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. **Phase 1**: CLI delivers all admin functionality</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. **Phase 2**: Web UI built using same Admin gRPC API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. **Phase 3**: Both CLI and Web UI coexist (CLI for automation, UI for exploration)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Configuration File Discovery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The CLI follows a hierarchical configuration search strategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. **Explicit `--config` flag**: Highest priority, direct path to config file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. **`.config.yaml` in current directory**: Checked first for project-specific config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. **`.config.yaml` in parent directories**: Walks up the tree to find inherited config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. **`~/.prism/config.yaml`**: User-level global configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. **Command-line arguments**: Override any config file settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Example `.config.yaml` (project-level)**:</span><br></span></code></pre></div></div>
<h1>.config.yaml - Project configuration for my-app namespace</h1>
<p>namespace: my-app  # Default namespace for scoped commands
endpoint: localhost:50052</p>
<p>backend:
type: postgres
pattern: keyvalue
consistency: strong
cache_ttl: 300</p>
<h1>Sessions, config, metrics will auto-scope to this namespace unless --namespace specified</h1>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Example `~/.prism/config.yaml` (user-level)**:</span><br></span></code></pre></div></div>
<h1>~/.prism/config.yaml - Global CLI configuration</h1>
<p>default_endpoint: localhost:50052
auth:
method: mtls
cert_path: ~/.prism/client.crt
key_path: ~/.prism/client.key
ca_path: ~/.prism/ca.crt</p>
<p>output:
format: table  # table, json, yaml
color: auto    # auto, always, never</p>
<p>timeouts:
connect: 5s
request: 30s</p>
<p>logging:
level: info
file: ~/.prism/cli.log</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Usage pattern**:</span><br></span></code></pre></div></div>
<h1>In project directory with .config.yaml (namespace: my-app):</h1>
<p>cd ~/projects/my-app
prismctl session list          # Auto-scopes to my-app namespace
prismctl metrics summary       # Shows metrics for my-app
prismctl config show           # Shows my-app configuration</p>
<h1>Override with --namespace flag:</h1>
<p>prismctl session list --namespace other-app</p>
<h1>Parent directory search:</h1>
<p>cd ~/projects/my-app/src/handlers
prismctl session list          # Finds .config.yaml in ~/projects/my-app/</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Environment Variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Override config file settings</h1>
<p>export PRISM_ENDPOINT=&quot;prism.example.com:50052&quot;
export PRISM_AUTH_METHOD=&quot;oauth2&quot;
export PRISM_OUTPUT_FORMAT=&quot;json&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Performance and UX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Performance Targets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Command Startup**: &amp;lt;100ms cold start, &amp;lt;50ms warm start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **gRPC Calls**: &amp;lt;10ms for simple queries, &amp;lt;100ms for complex operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Streaming**: Live trace output with &amp;lt;10ms latency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Large Lists**: Pagination and streaming for 1000+ items</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### UX Enhancements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Rich Formatting**: Colors, tables, trees, progress bars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Config File Discovery**: Automatic `.config.yaml` lookup in current and parent directories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Smart Defaults**: Sensible defaults for all optional parameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Helpful Errors**: Clear error messages with suggested fixes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Autocomplete**: Shell completion for commands and options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Aliases**: Common shortcuts (e.g., `ns` for `namespace`, `be` for `backend`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Testing Strategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Unit Tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>tests/test_namespace.py</h1>
<p>from typer.testing import CliRunner
from prism_cli.main import app
from .fixtures.mock_grpc import MockAdminService</p>
<p>runner = CliRunner()</p>
<p>def test_namespace_create():
with MockAdminService() as mock:
mock.set_response(&quot;CreateNamespace&quot;, Namespace(
name=&quot;test-ns&quot;,
backend=&quot;postgres&quot;,
pattern=&quot;keyvalue&quot;,
))</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    result = runner.invoke(app, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;namespace&quot;, &quot;create&quot;, &quot;test-ns&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;--backend&quot;, &quot;postgres&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;--pattern&quot;, &quot;keyvalue&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert result.exit_code == 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert &quot;Created namespace &#x27;test-ns&#x27;&quot; in result.stdout</span><br></span></code></pre></div></div>
<p>def test_namespace_list_json():
with MockAdminService() as mock:
mock.set_response(&quot;ListNamespaces&quot;, ListNamespacesResponse(
namespaces=[
Namespace(name=&quot;ns1&quot;, backend=&quot;postgres&quot;),
Namespace(name=&quot;ns2&quot;, backend=&quot;redis&quot;),
]
))</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    result = runner.invoke(app, [&quot;namespace&quot;, &quot;list&quot;, &quot;--output&quot;, &quot;json&quot;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert result.exit_code == 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data = json.loads(result.stdout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert len(data) == 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert data[0][&quot;name&quot;] == &quot;ns1&quot;</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Integration Tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>tests/integration/test_admin_client.py</h1>
<p>import pytest
from prism_cli.client.admin import AdminClient</p>
<p>@pytest.fixture
def admin_client():
&quot;&quot;&quot;Connect to local test proxy.&quot;&quot;&quot;
return AdminClient(endpoint=&quot;localhost:50052&quot;)</p>
<p>def test_create_and_list_namespace(admin_client):
# Create namespace
ns = admin_client.create_namespace(
name=&quot;test-integration&quot;,
backend=&quot;sqlite&quot;,
pattern=&quot;keyvalue&quot;,
)
assert ns.name == &quot;test-integration&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># List and verify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespaces = admin_client.list_namespaces()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">names = [ns.name for ns in namespaces]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assert &quot;test-integration&quot; in names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Cleanup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin_client.delete_namespace(&quot;test-integration&quot;)</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Installation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Install via uv (development)</h1>
<p>cd prism-cli
uv pip install -e .</p>
<h1>Install from package (production)</h1>
<p>uv pip install prism-cli</p>
<h1>Verify installation</h1>
<p>prismctl --version
prismctl --help</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Shell Completion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h1>Bash</h1>
<p>prismctl --install-completion bash</p>
<h1>Zsh</h1>
<p>prismctl --install-completion zsh</p>
<h1>Fish</h1>
<p>prismctl --install-completion fish</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Migration Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Phase 1: Core CLI (Week 1-2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Namespace CRUD operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Backend health checks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Session listing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Basic metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Deliverable**: Functional CLI covering 80% of admin use cases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Phase 2: Advanced Features (Week 3-4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Session tracing (streaming)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Shadow traffic management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Configuration validation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Metrics export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Deliverable**: Complete feature parity with Admin gRPC API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Phase 3: Polish and Documentation (Week 5-6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Comprehensive tests (unit + integration)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Shell completion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Man pages and documentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- CI/CD integration examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Deliverable**: Production-ready CLI with excellent docs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Phase 4: Web UI Development (Parallel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- RFC-007: Web Admin UI specification</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Ember.js application using same Admin gRPC API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- CLI and web UI coexist and complement each other</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Monitoring and Observability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### CLI Usage Metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Track CLI adoption and usage patterns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Command Usage**: Which commands are most popular</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Error Rates**: Which commands fail most often</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Latency**: gRPC call latency from CLI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Authentication**: Success/failure rates for auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CLI logs structured events:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>{
&quot;timestamp&quot;: &quot;2025-10-08T09:15:23.456Z&quot;,
&quot;level&quot;: &quot;info&quot;,
&quot;command&quot;: &quot;namespace create&quot;,
&quot;args&quot;: {&quot;name&quot;: &quot;my-app&quot;, &quot;backend&quot;: &quot;postgres&quot;},
&quot;duration_ms&quot;: 234,
&quot;status&quot;: &quot;success&quot;
}</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Security Considerations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **mTLS by Default**: All gRPC connections use mutual TLS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Credential Storage**: Secure storage for certificates and tokens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Audit Logging**: All admin operations logged server-side</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **Least Privilege**: Role-based access control (RBAC) enforced by proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- **No Secrets in Logs**: Sanitize sensitive data from CLI logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Open Questions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. **OAuth2 Integration**: Should CLI support OAuth2 device flow for cloud deployments?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. **Plugin System**: Allow third-party commands to extend CLI?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. **TUI Mode**: Add full-screen TUI for real-time monitoring?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. **Multi-Proxy**: Manage multiple Prism proxies from single CLI?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## References</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- RFC-003: Admin gRPC API specification</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Typer Documentation: https://typer.tiangolo.com/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Rich Documentation: https://rich.readthedocs.io/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Click Documentation: https://click.palletsprojects.com/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Appendix: Command Reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### All Commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>prismctl namespace create <name> [options]
prismctl namespace list [options]
prismctl namespace describe <name> [options]
prismctl namespace update <name> [options]
prismctl namespace delete <name> [options]</name></name></name></name></p>
<p>prismctl backend list [options]
prismctl backend health [options]
prismctl backend stats [options]
prismctl backend test <backend> [options]</backend></p>
<p>prismctl session list [options]
prismctl session describe <session-id>
prismctl session kill <session-id>
prismctl session trace <session-id> [options]</session-id></session-id></session-id></p>
<p>prismctl config show [options]
prismctl config validate <file> [options]
prismctl config apply <file> [options]</file></file></p>
<p>prismctl metrics summary [options]
prismctl metrics namespace <name> [options]
prismctl metrics export [options]</name></p>
<p>prismctl shadow enable <namespace> [options]
prismctl shadow disable <namespace>
prismctl shadow status <namespace></namespace></namespace></namespace></p>
<p>prismctl version
prismctl help [command]</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Global Options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>--endpoint <url>        # Proxy endpoint (default: localhost:50052)
--output <format>       # Output format: table, json, yaml
--no-color              # Disable colored output
--verbose, -v           # Verbose logging
--quiet, -q             # Suppress non-error output
--config <file>         # CLI config file
--help, -h              # Show help</file></format></url></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Status**: Ready for Implementation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**Next Steps**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Implement core CLI structure with Typer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Add namespace commands as proof-of-concept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Test against local Prism proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Iterate based on user feedback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/jrepp/prism-data-layer/tree/main/docs-cms/../docs-cms/rfcs/rfc-006-python-admin-cli.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/prism-data-layer/rfc/rfc-005"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ClickHouse Integration for Time Series Analytics • RFC-005</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/prism-data-layer/rfc/rfc-007"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">RFC-007 Cache Strategies</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#abstract" class="table-of-contents__link toc-highlight">Abstract</a></li><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a><ul><li><a href="#why-cli-first" class="table-of-contents__link toc-highlight">Why CLI First?</a></li><li><a href="#real-world-use-cases" class="table-of-contents__link toc-highlight">Real-World Use Cases</a></li></ul></li><li><a href="#goals" class="table-of-contents__link toc-highlight">Goals</a></li><li><a href="#non-goals" class="table-of-contents__link toc-highlight">Non-Goals</a></li><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a><ul><li><a href="#high-level-design" class="table-of-contents__link toc-highlight">High-Level Design</a></li></ul></li><li><a href="#authentication" class="table-of-contents__link toc-highlight">Authentication</a><ul><li><a href="#device-code-flow-oauth-20" class="table-of-contents__link toc-highlight">Device Code Flow (OAuth 2.0)</a></li><li><a href="#login-command" class="table-of-contents__link toc-highlight">Login Command</a></li><li><a href="#token-storage" class="table-of-contents__link toc-highlight">Token Storage</a></li><li><a href="#logout-command" class="table-of-contents__link toc-highlight">Logout Command</a></li><li><a href="#authentication-modes" class="table-of-contents__link toc-highlight">Authentication Modes</a></li><li><a href="#service-account-authentication" class="table-of-contents__link toc-highlight">Service Account Authentication</a></li><li><a href="#authentication-flow-implementation" class="table-of-contents__link toc-highlight">Authentication Flow Implementation</a></li><li><a href="#local-development-with-dex" class="table-of-contents__link toc-highlight">Local Development with Dex</a></li><li><a href="#command-structure" class="table-of-contents__link toc-highlight">Command Structure</a></li><li><a href="#backend-management" class="table-of-contents__link toc-highlight">Backend Management</a></li><li><a href="#metrics-and-monitoring" class="table-of-contents__link toc-highlight">Metrics and Monitoring</a></li><li><a href="#plugin-development-workflow" class="table-of-contents__link toc-highlight">Plugin Development Workflow</a></li></ul></li><li><a href="#protobuf-integration" class="table-of-contents__link toc-highlight">Protobuf Integration</a></li><li><a href="#implementation" class="table-of-contents__link toc-highlight">Implementation</a><ul><li><a href="#technology-stack-go-implementation---see-adr-040" class="table-of-contents__link toc-highlight">Technology Stack (Go Implementation - see ADR-040)</a></li><li><a href="#project-structure-go-implementation" class="table-of-contents__link toc-highlight">Project Structure (Go Implementation)</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/intro">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/docs/changelog">Change Log</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/adr">ADRs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/rfc">RFCs</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/memos">Memos</a></li><li class="footer__item"><a class="footer__link-item" href="/prism-data-layer/prds">PRDs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Project</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/jrepp/prism-data-layer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div>Copyright © 2025 Prism. Built with Docusaurus.</div><div style="margin-top:0.5rem;font-size:0.875rem;opacity:0.8"><span>Version <!-- -->d6f49d2</span><span> • </span><span>Built <!-- -->Oct 13, 2025, 05:33 PM PDT</span><span> • </span><span>Commit <!-- -->d6f49d2</span></div></div></div></div></footer></div>
</body>
</html>